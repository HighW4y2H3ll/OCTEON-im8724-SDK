<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: cvmx-higig.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>cvmx-higig.h</h1><a href="cvmx-higig_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************license start***************</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2003-2016  Cavium Inc. (support@cavium.com). All rights</span>
<a name="l00003"></a>00003 <span class="comment"> * reserved.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00007"></a>00007 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00008"></a>00008 <span class="comment"> * met:</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *   * Redistributions of source code must retain the above copyright</span>
<a name="l00011"></a>00011 <span class="comment"> *     notice, this list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> *   * Redistributions in binary form must reproduce the above</span>
<a name="l00014"></a>00014 <span class="comment"> *     copyright notice, this list of conditions and the following</span>
<a name="l00015"></a>00015 <span class="comment"> *     disclaimer in the documentation and/or other materials provided</span>
<a name="l00016"></a>00016 <span class="comment"> *     with the distribution.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment"> *   * Neither the name of Cavium Inc. nor the names of</span>
<a name="l00019"></a>00019 <span class="comment"> *     its contributors may be used to endorse or promote products</span>
<a name="l00020"></a>00020 <span class="comment"> *     derived from this software without specific prior written</span>
<a name="l00021"></a>00021 <span class="comment"> *     permission.</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment"> * This Software, including technical data, may be subject to U.S. export  control</span>
<a name="l00024"></a>00024 <span class="comment"> * laws, including the U.S. Export Administration Act and its  associated</span>
<a name="l00025"></a>00025 <span class="comment"> * regulations, and may be subject to export or import  regulations in other</span>
<a name="l00026"></a>00026 <span class="comment"> * countries.</span>
<a name="l00027"></a>00027 <span class="comment"></span>
<a name="l00028"></a>00028 <span class="comment"> * TO THE MAXIMUM EXTENT PERMITTED BY LAW, THE SOFTWARE IS PROVIDED &quot;AS IS&quot;</span>
<a name="l00029"></a>00029 <span class="comment"> * AND WITH ALL FAULTS AND CAVIUM INC. MAKES NO PROMISES, REPRESENTATIONS OR</span>
<a name="l00030"></a>00030 <span class="comment"> * WARRANTIES, EITHER EXPRESS, IMPLIED, STATUTORY, OR OTHERWISE, WITH RESPECT TO</span>
<a name="l00031"></a>00031 <span class="comment"> * THE SOFTWARE, INCLUDING ITS CONDITION, ITS CONFORMITY TO ANY REPRESENTATION OR</span>
<a name="l00032"></a>00032 <span class="comment"> * DESCRIPTION, OR THE EXISTENCE OF ANY LATENT OR PATENT DEFECTS, AND CAVIUM</span>
<a name="l00033"></a>00033 <span class="comment"> * SPECIFICALLY DISCLAIMS ALL IMPLIED (IF ANY) WARRANTIES OF TITLE,</span>
<a name="l00034"></a>00034 <span class="comment"> * MERCHANTABILITY, NONINFRINGEMENT, FITNESS FOR A PARTICULAR PURPOSE, LACK OF</span>
<a name="l00035"></a>00035 <span class="comment"> * VIRUSES, ACCURACY OR COMPLETENESS, QUIET ENJOYMENT, QUIET POSSESSION OR</span>
<a name="l00036"></a>00036 <span class="comment"> * CORRESPONDENCE TO DESCRIPTION. THE ENTIRE  RISK ARISING OUT OF USE OR</span>
<a name="l00037"></a>00037 <span class="comment"> * PERFORMANCE OF THE SOFTWARE LIES WITH YOU.</span>
<a name="l00038"></a>00038 <span class="comment"> ***********************license end**************************************/</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">/**</span>
<a name="l00041"></a>00041 <span class="comment"> * @file</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> * Functions and typedefs for using Octeon in HiGig/HiGig+/HiGig2 mode over</span>
<a name="l00044"></a>00044 <span class="comment"> * XAUI.</span>
<a name="l00045"></a>00045 <span class="comment"> *</span>
<a name="l00046"></a>00046 <span class="comment"> * &lt;hr&gt;$Revision: 144255 $&lt;hr&gt;</span>
<a name="l00047"></a>00047 <span class="comment"> */</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#ifndef __CVMX_HIGIG_H__</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#define __CVMX_HIGIG_H__</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="cvmx-wqe_8h.html" title="This header file defines the work queue entry (wqe) data structure.">cvmx-wqe.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-pki_8h.html" title="Interface to the hardware Packet Input Data unit.">cvmx-pki.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-pki-resources_8h.html" title="Resource management for PKI resources.">cvmx-pki-resources.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-helper_8h.html" title="Helper functions for common, but complicated tasks.">cvmx-helper.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-helper-bgx_8h.html" title="Functions to configure the BGX MAC.">cvmx-helper-bgx.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-helper-util_8h.html" title="Small helper utilities.">cvmx-helper-util.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="cvmx-bgxx-defs_8h.html">cvmx-bgxx-defs.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#ifdef  __cplusplus</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="comment">/* *INDENT-OFF* */</span>
<a name="l00061"></a>00061 <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00062"></a>00062 <span class="comment">/* *INDENT-ON* */</span>
<a name="l00063"></a>00063 <span class="preprocessor">#endif</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="structcvmx__higig__header__t.html">00065</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00066"></a>00066     <span class="keyword">union </span>{
<a name="l00067"></a><a class="code" href="structcvmx__higig__header__t.html#a27c39823b21174d53f706a061ef5cbf5">00067</a>         uint32_t u32;
<a name="l00068"></a>00068         <span class="keyword">struct </span>{
<a name="l00069"></a>00069             uint32_t start:8;<span class="comment"></span>
<a name="l00070"></a><a class="code" href="structcvmx__higig__header__t.html#aee46e9b71f5b4cb8034eebb75734ebba">00070</a> <span class="comment">                     /**&lt; 8-bits of Preamble indicating start of frame */</span>
<a name="l00071"></a>00071             uint32_t hgi:2;<span class="comment"></span>
<a name="l00072"></a><a class="code" href="structcvmx__higig__header__t.html#af6168fd7a9db54728e4fbcec4060b799">00072</a> <span class="comment">                     /**&lt; HiGig interface format indicator</span>
<a name="l00073"></a>00073 <span class="comment">                                            00 = Reserved</span>
<a name="l00074"></a>00074 <span class="comment">                                            01 = Pure preamble - IEEE standard framing of 10GE</span>
<a name="l00075"></a>00075 <span class="comment">                                            10 = XGS header - framing based on XGS family definition In this</span>
<a name="l00076"></a>00076 <span class="comment">                                                format, the default length of the header is 12 bytes and additional</span>
<a name="l00077"></a>00077 <span class="comment">                                                bytes are indicated by the HDR_EXT_LEN field</span>
<a name="l00078"></a>00078 <span class="comment">                                            11 = Reserved */</span>
<a name="l00079"></a>00079             uint32_t cng_high:1;<span class="comment"></span>
<a name="l00080"></a><a class="code" href="structcvmx__higig__header__t.html#a336176601868f2e6ea709911b6b236c0">00080</a> <span class="comment">                     /**&lt; Congestion Bit High flag */</span>
<a name="l00081"></a>00081             uint32_t hdr_ext_len:3;<span class="comment"></span>
<a name="l00082"></a><a class="code" href="structcvmx__higig__header__t.html#aeab5064659c1d1ed02983f7797aaf98b">00082</a> <span class="comment">                     /**&lt; This field is valid only if the HGI field is a b&apos;10&apos; and it indicates the extension</span>
<a name="l00083"></a>00083 <span class="comment">                                            to the standard 12-bytes of XGS HiGig header. Each unit represents 4</span>
<a name="l00084"></a>00084 <span class="comment">                                            bytes, giving a total of 16 additional extension bytes. Value of b&apos;101&apos;, b&apos;110&apos;</span>
<a name="l00085"></a>00085 <span class="comment">                                            and b&apos;111&apos; are reserved. For HGI field value of b&apos;01&apos; this field should be</span>
<a name="l00086"></a>00086 <span class="comment">                                            b&apos;01&apos;. For all other values of HGI it is don&apos;t care. */</span>
<a name="l00087"></a>00087             uint32_t src_modid_6:1;<span class="comment"></span>
<a name="l00088"></a><a class="code" href="structcvmx__higig__header__t.html#aa4c58bf40cb66c2a1f3b4d6895a5acc8">00088</a> <span class="comment">                     /**&lt; This field is valid only if the HGI field is a b&apos;10&apos; and it represents Bit 6 of</span>
<a name="l00089"></a>00089 <span class="comment">                                            SRC_MODID (bits 4:0 are in Byte 4 and bit 5 is in Byte 9). For HGI field</span>
<a name="l00090"></a>00090 <span class="comment">                                            value of b&apos;01&apos; this field should be b&apos;0&apos;. For all other values of HGI it is don&apos;t</span>
<a name="l00091"></a>00091 <span class="comment">                                            care. */</span>
<a name="l00092"></a>00092             uint32_t dst_modid_6:1;<span class="comment"></span>
<a name="l00093"></a><a class="code" href="structcvmx__higig__header__t.html#a697aedfb4b0111cdf3604df7be194325">00093</a> <span class="comment">                     /**&lt; This field is valid only if the HGI field is a b&apos;10&apos; and it represents Bit 6 of</span>
<a name="l00094"></a>00094 <span class="comment">                                            DST_MODID (bits 4:0 are in Byte 7 and bit 5 is in Byte 9). ). For HGI field</span>
<a name="l00095"></a>00095 <span class="comment">                                            value of b&apos;01&apos; this field should be b&apos;1&apos;. For all other values of HGI it is don&apos;t</span>
<a name="l00096"></a>00096 <span class="comment">                                            care. */</span>
<a name="l00097"></a>00097             uint32_t vid_high:8;<span class="comment"></span>
<a name="l00098"></a><a class="code" href="structcvmx__higig__header__t.html#a11be0d6fb7891d24b15ad387e0d9c7f0">00098</a> <span class="comment">                     /**&lt; 8-bits of the VLAN tag information */</span>
<a name="l00099"></a>00099             uint32_t vid_low:8;<span class="comment"></span>
<a name="l00100"></a><a class="code" href="structcvmx__higig__header__t.html#aefe333babc64021c57e7a94f6b3b7374">00100</a> <span class="comment">                     /**&lt; 8 bits LSB of the VLAN tag information */</span>
<a name="l00101"></a>00101         } <a class="code" href="cvmx-coremask_8c.html#a7cc33a7fd56e1ab82f778fe3f0e88c25">s</a>;
<a name="l00102"></a>00102     } dw0;
<a name="l00103"></a>00103     <span class="keyword">union </span>{
<a name="l00104"></a>00104         uint32_t u32;
<a name="l00105"></a>00105         <span class="keyword">struct </span>{
<a name="l00106"></a>00106             uint32_t src_modid_low:5;<span class="comment"></span>
<a name="l00107"></a><a class="code" href="structcvmx__higig__header__t.html#a580a7394483bf5b89f738b2326278705">00107</a> <span class="comment">                     /**&lt; Bits 4:0 of Module ID of the source module on which the packet ingress (bit</span>
<a name="l00108"></a>00108 <span class="comment">                                            5 is in Byte 9 and bit 6 Is in Byte 1) */</span>
<a name="l00109"></a>00109             uint32_t opcode:3;<span class="comment"></span>
<a name="l00110"></a><a class="code" href="structcvmx__higig__header__t.html#a94bb239cdce2dd5a7588ce14fc104c62">00110</a> <span class="comment">                     /**&lt; XGS HiGig op-code, indicating the type of packet</span>
<a name="l00111"></a>00111 <span class="comment">                                            000 =     Control frames used for CPU to CPU communications</span>
<a name="l00112"></a>00112 <span class="comment">                                            001 =     Unicast packet with destination resolved; The packet can be</span>
<a name="l00113"></a>00113 <span class="comment">                                                      either Layer 2 unicast packet or L3 unicast packet that was</span>
<a name="l00114"></a>00114 <span class="comment">                                                      routed in the ingress chip.</span>
<a name="l00115"></a>00115 <span class="comment">                                            010 =     Broadcast or unknown Unicast packet or unknown multicast,</span>
<a name="l00116"></a>00116 <span class="comment">                                                      destined to all members of the VLAN</span>
<a name="l00117"></a>00117 <span class="comment">                                            011 =     L2 Multicast packet, destined to all ports of the group indicated</span>
<a name="l00118"></a>00118 <span class="comment">                                                      in the L2MC_INDEX which is overlayed on DST_PORT/DST_MODID fields</span>
<a name="l00119"></a>00119 <span class="comment">                                            100 =     IP Multicast packet, destined to all ports of the group indicated</span>
<a name="l00120"></a>00120 <span class="comment">                                                      in the IPMC_INDEX which is overlayed on DST_PORT/DST_MODID fields</span>
<a name="l00121"></a>00121 <span class="comment">                                            101 =     Reserved</span>
<a name="l00122"></a>00122 <span class="comment">                                            110 =     Reserved</span>
<a name="l00123"></a>00123 <span class="comment">                                            111 =     Reserved */</span>
<a name="l00124"></a>00124             uint32_t pfm:2;<span class="comment"></span>
<a name="l00125"></a><a class="code" href="structcvmx__higig__header__t.html#a447501b849689683f98dc91583431ec1">00125</a> <span class="comment">                     /**&lt; Three Port Filtering Modes (0, 1, 2) used in handling registed/unregistered</span>
<a name="l00126"></a>00126 <span class="comment">                                            multicast (unknown L2 multicast and IPMC) packets. This field is used</span>
<a name="l00127"></a>00127 <span class="comment">                                            when OPCODE is 011 or 100 Semantics of PFM bits are as follows;</span>
<a name="l00128"></a>00128 <span class="comment">                                            For registered L2 multicast packets:</span>
<a name="l00129"></a>00129 <span class="comment">                                                PFM= 0 ­ Flood to VLAN</span>
<a name="l00130"></a>00130 <span class="comment">                                                PFM= 1 or 2 ­ Send to group members in the L2MC table</span>
<a name="l00131"></a>00131 <span class="comment">                                            For unregistered L2 multicast packets:</span>
<a name="l00132"></a>00132 <span class="comment">                                                PFM= 0 or 1 ­ Flood to VLAN</span>
<a name="l00133"></a>00133 <span class="comment">                                                PFM= 2 ­ Drop the packet */</span>
<a name="l00134"></a>00134             uint32_t src_port_tgid:6;<span class="comment"></span>
<a name="l00135"></a><a class="code" href="structcvmx__higig__header__t.html#a79db7aed922b04ab23ac3c4157a2cc6d">00135</a> <span class="comment">                     /**&lt; If the MSB of this field is set, then it indicates the LAG the packet ingressed</span>
<a name="l00136"></a>00136 <span class="comment">                                            on, else it represents the physical port the packet ingressed on. */</span>
<a name="l00137"></a>00137             uint32_t dst_port:5;<span class="comment"></span>
<a name="l00138"></a><a class="code" href="structcvmx__higig__header__t.html#ac7d290afcb73abf13c0709c1ce313a2b">00138</a> <span class="comment">                     /**&lt; Port number of destination port on which the packet needs to egress. */</span>
<a name="l00139"></a>00139             uint32_t priority:3;<span class="comment"></span>
<a name="l00140"></a><a class="code" href="structcvmx__higig__header__t.html#a0eac2c1f4d5f44b2f7b3f9f5d6616847">00140</a> <span class="comment">                     /**&lt; This is the internal priority of the packet. This internal priority will go through</span>
<a name="l00141"></a>00141 <span class="comment">                                            COS_SEL mapping registers to map to the actual MMU queues. */</span>
<a name="l00142"></a>00142             uint32_t header_type:2;<span class="comment"></span>
<a name="l00143"></a><a class="code" href="structcvmx__higig__header__t.html#ac340bfc2f174ebc3b5a41fb2dbf5e899">00143</a> <span class="comment">                     /**&lt; Indicates the format of the next 4 bytes of the XGS HiGig header</span>
<a name="l00144"></a>00144 <span class="comment">                                            00 = Overlay 1 (default)</span>
<a name="l00145"></a>00145 <span class="comment">                                            01 = Overlay 2 (Classification Tag)</span>
<a name="l00146"></a>00146 <span class="comment">                                            10 = Reserved</span>
<a name="l00147"></a>00147 <span class="comment">                                            11 = Reserved */</span>
<a name="l00148"></a>00148             uint32_t cng_low:1;<span class="comment"></span>
<a name="l00149"></a><a class="code" href="structcvmx__higig__header__t.html#aa9d027bcf8969a529a2ceffe7f3b1bbe">00149</a> <span class="comment">                     /**&lt; Semantics of CNG_HIGH and CNG_LOW are as follows: The following</span>
<a name="l00150"></a>00150 <span class="comment">                                            encodings are to make it backward compatible:</span>
<a name="l00151"></a>00151 <span class="comment">                                            [CNG_HIGH, CNG_LOW] - COLOR</span>
<a name="l00152"></a>00152 <span class="comment">                                            [0, 0] ­ Packet is green</span>
<a name="l00153"></a>00153 <span class="comment">                                            [0, 1] ­ Packet is red</span>
<a name="l00154"></a>00154 <span class="comment">                                            [1, 1] ­ Packet is yellow</span>
<a name="l00155"></a>00155 <span class="comment">                                            [1, 0] ­ Undefined */</span>
<a name="l00156"></a>00156             uint32_t dst_modid_low:5;<span class="comment"></span>
<a name="l00157"></a><a class="code" href="structcvmx__higig__header__t.html#a19f83fcc02c5f91a430a75976937e786">00157</a> <span class="comment">                     /**&lt; Bits [4-: 0] of Module ID of the destination port on which the packet needs to egress. */</span>
<a name="l00158"></a>00158         } <a class="code" href="cvmx-coremask_8c.html#a7cc33a7fd56e1ab82f778fe3f0e88c25">s</a>;
<a name="l00159"></a>00159     } dw1;
<a name="l00160"></a>00160     <span class="keyword">union </span>{
<a name="l00161"></a>00161         uint32_t u32;
<a name="l00162"></a>00162         <span class="keyword">struct </span>{
<a name="l00163"></a>00163             uint32_t dst_t:1;<span class="comment"></span>
<a name="l00164"></a><a class="code" href="structcvmx__higig__header__t.html#a623bd860f21ff43a4b3a7c0577648c59">00164</a> <span class="comment">                     /**&lt; Destination Trunk: Indicates that the destination port is a member of a trunk</span>
<a name="l00165"></a>00165 <span class="comment">                                            group. */</span>
<a name="l00166"></a>00166             uint32_t dst_tgid:3;<span class="comment"></span>
<a name="l00167"></a><a class="code" href="structcvmx__higig__header__t.html#a4ed101554973a93b01abd5c64e534d24">00167</a> <span class="comment">                     /**&lt; Destination Trunk Group ID: Trunk group ID of the destination port. The</span>
<a name="l00168"></a>00168 <span class="comment">                                            DO_NOT_LEARN bit is overlaid on the second bit of this field. */</span>
<a name="l00169"></a>00169             uint32_t ingress_tagged:1;<span class="comment"></span>
<a name="l00170"></a><a class="code" href="structcvmx__higig__header__t.html#a42e5e4c06f9d70a07c9e90594b1d16f2">00170</a> <span class="comment">                     /**&lt; Ingress Tagged: Indicates whether the packet was tagged when it originally</span>
<a name="l00171"></a>00171 <span class="comment">                                            ingressed the system. */</span>
<a name="l00172"></a>00172             uint32_t mirror_only:1;<span class="comment"></span>
<a name="l00173"></a><a class="code" href="structcvmx__higig__header__t.html#afc1555b2c3ac87f7a98c177d3ad2fd8e">00173</a> <span class="comment">                     /**&lt; Mirror Only: XGS 1/2 mode: Indicates that the packet was switched and only</span>
<a name="l00174"></a>00174 <span class="comment">                                            needs to be mirrored. */</span>
<a name="l00175"></a>00175             uint32_t mirror_done:1;<span class="comment"></span>
<a name="l00176"></a><a class="code" href="structcvmx__higig__header__t.html#aabbf18127a0c0e557c467fdd6d1b134f">00176</a> <span class="comment">                     /**&lt; Mirroring Done: XGS1/2 mode: Indicates that the packet was mirrored and</span>
<a name="l00177"></a>00177 <span class="comment">                                            may still need to be switched. */</span>
<a name="l00178"></a>00178             uint32_t mirror:1;<span class="comment"></span>
<a name="l00179"></a><a class="code" href="structcvmx__higig__header__t.html#ae9031f5fe128b586110d2431603c75c6">00179</a> <span class="comment">                     /**&lt; Mirror: XGS3 mode: a mirror copy packet. XGS1/2 mode: Indicates that the</span>
<a name="l00180"></a>00180 <span class="comment">                                            packet was switched and only needs to be mirrored. */</span>
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             uint32_t src_modid_5:1;<span class="comment"></span>
<a name="l00183"></a><a class="code" href="structcvmx__higig__header__t.html#a48c904e8846e8295876b0d884adadfef">00183</a> <span class="comment">                     /**&lt; Source Module ID: Bit 5 of Src_ModID (bits 4:0 are in byte 4 and bit 6 is in</span>
<a name="l00184"></a>00184 <span class="comment">                                            byte 1) */</span>
<a name="l00185"></a>00185             uint32_t dst_modid_5:1;<span class="comment"></span>
<a name="l00186"></a><a class="code" href="structcvmx__higig__header__t.html#ad94efa1c4eaef19f7cb426ff59d3bf4b">00186</a> <span class="comment">                     /**&lt; Destination Module ID: Bit 5 of Dst_ModID (bits 4:0 are in byte 7 and bit 6</span>
<a name="l00187"></a>00187 <span class="comment">                                            is in byte 1) */</span>
<a name="l00188"></a>00188             uint32_t l3:1;<span class="comment"></span>
<a name="l00189"></a><a class="code" href="structcvmx__higig__header__t.html#ab25992d344d596277e40866ad93a0c9b">00189</a> <span class="comment">                     /**&lt; L3: Indicates that the packet is L3 switched */</span>
<a name="l00190"></a>00190             uint32_t label_present:1;<span class="comment"></span>
<a name="l00191"></a><a class="code" href="structcvmx__higig__header__t.html#a7302c44e26c31b91bdc9364ae4e781ca">00191</a> <span class="comment">                     /**&lt; Label Present: Indicates that header contains a 20-bit VC label: HiGig+</span>
<a name="l00192"></a>00192 <span class="comment">                                            added field. */</span>
<a name="l00193"></a>00193             uint32_t vc_label_16_19:4;<span class="comment"></span>
<a name="l00194"></a><a class="code" href="structcvmx__higig__header__t.html#a858ed65f1f0c88cb571bddcfb403e463">00194</a> <span class="comment">                     /**&lt; VC Label: Bits 19:16 of VC label: HiGig+ added field */</span>
<a name="l00195"></a>00195             uint32_t vc_label_0_15:16;<span class="comment"></span>
<a name="l00196"></a><a class="code" href="structcvmx__higig__header__t.html#a90c4c83b63cff30975e11a11fcfd03ee">00196</a> <span class="comment">                     /**&lt; VC Label: Bits 15:0 of VC label: HiGig+ added field */</span>
<a name="l00197"></a>00197         } o1;
<a name="l00198"></a>00198         <span class="keyword">struct </span>{
<a name="l00199"></a>00199             uint32_t classification:16;<span class="comment"></span>
<a name="l00200"></a><a class="code" href="structcvmx__higig__header__t.html#a022c800c432e07ee6089381ead921b9e">00200</a> <span class="comment">                      /**&lt; Classification tag information from the HiGig device FFP */</span>
<a name="l00201"></a><a class="code" href="structcvmx__higig__header__t.html#a7e7d26967dd21a606b25b3f474be2bcb">00201</a>             uint32_t reserved_0_15:16;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         } o2;
<a name="l00204"></a>00204     } dw2;
<a name="l00205"></a>00205 } <a class="code" href="structcvmx__higig__header__t.html">cvmx_higig_header_t</a>;
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="structcvmx__higig2__header__t.html">00207</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00208"></a>00208     <span class="keyword">union </span>{
<a name="l00209"></a><a class="code" href="structcvmx__higig2__header__t.html#afa630f5e0882da939f52c566030aa89e">00209</a>         uint32_t u32;
<a name="l00210"></a>00210         <span class="keyword">struct </span>{
<a name="l00211"></a>00211             uint32_t k_sop:8;<span class="comment"></span>
<a name="l00212"></a><a class="code" href="structcvmx__higig2__header__t.html#a7662fccab577749ad1a8ba274e3ad65e">00212</a> <span class="comment">                      /**&lt; The delimiter indicating the start of a packet transmission */</span>
<a name="l00213"></a><a class="code" href="structcvmx__higig2__header__t.html#a249e5c37111d11fec5a8a473b78923e7">00213</a>             uint32_t reserved_21_23:3;
<a name="l00214"></a>00214             uint32_t mcst:1;<span class="comment"></span>
<a name="l00215"></a><a class="code" href="structcvmx__higig2__header__t.html#a01bca34671654523d872ba79559c985c">00215</a> <span class="comment">                      /**&lt; MCST indicates whether the packet should be unicast or</span>
<a name="l00216"></a>00216 <span class="comment">                                            multicast forwarded through the XGS switching fabric</span>
<a name="l00217"></a>00217 <span class="comment">                                            - 0: Unicast</span>
<a name="l00218"></a>00218 <span class="comment">                                            - 1: Mulitcast */</span>
<a name="l00219"></a>00219             uint32_t tc:4;<span class="comment"></span>
<a name="l00220"></a><a class="code" href="structcvmx__higig2__header__t.html#a1043aa5a2f45a28a7fd3d3763c6bab7d">00220</a> <span class="comment">                      /**&lt; Traffic Class [3:0] indicates the distinctive Quality of Service (QoS)</span>
<a name="l00221"></a>00221 <span class="comment">                                            the switching fabric will provide when forwarding the packet</span>
<a name="l00222"></a>00222 <span class="comment">                                            through the fabric */</span>
<a name="l00223"></a>00223             uint32_t dst_modid_mgid:8;<span class="comment"></span>
<a name="l00224"></a><a class="code" href="structcvmx__higig2__header__t.html#acaba5f942b5165158678153e0fef4e35">00224</a> <span class="comment">                      /**&lt; When MCST=0, this field indicates the destination XGS module to</span>
<a name="l00225"></a>00225 <span class="comment">                                            which the packet will be delivered. When MCST=1, this field indicates</span>
<a name="l00226"></a>00226 <span class="comment">                                            higher order bits of the Multicast Group ID. */</span>
<a name="l00227"></a>00227             uint32_t dst_pid_mgid:8;<span class="comment"></span>
<a name="l00228"></a><a class="code" href="structcvmx__higig2__header__t.html#a2795ef37406a3d1a892381dac7740d11">00228</a> <span class="comment">                      /**&lt; When MCST=0, this field indicates a port associated with the</span>
<a name="l00229"></a>00229 <span class="comment">                                            module indicated by the DST_MODID, through which the packet</span>
<a name="l00230"></a>00230 <span class="comment">                                            will exit the system. When MCST=1, this field indicates lower order</span>
<a name="l00231"></a>00231 <span class="comment">                                            bits of the Multicast Group ID */</span>
<a name="l00232"></a>00232         } <a class="code" href="cvmx-coremask_8c.html#a7cc33a7fd56e1ab82f778fe3f0e88c25">s</a>;
<a name="l00233"></a>00233     } dw0;
<a name="l00234"></a>00234     <span class="keyword">union </span>{
<a name="l00235"></a>00235         uint32_t u32;
<a name="l00236"></a>00236         <span class="keyword">struct </span>{
<a name="l00237"></a>00237             uint32_t src_modid:8;<span class="comment"></span>
<a name="l00238"></a><a class="code" href="structcvmx__higig2__header__t.html#a092f6b12e9683e88e7b4e341bed08f6a">00238</a> <span class="comment">                      /**&lt; Source Module ID indicates the source XGS module from which</span>
<a name="l00239"></a>00239 <span class="comment">                                            the packet is originated. (It can also be used for the fabric multicast</span>
<a name="l00240"></a>00240 <span class="comment">                                            load balancing purpose.) */</span>
<a name="l00241"></a>00241             uint32_t src_pid:8;<span class="comment"></span>
<a name="l00242"></a><a class="code" href="structcvmx__higig2__header__t.html#aa4d6b21f01ed5a52219b544b9252a4c9">00242</a> <span class="comment">                      /**&lt; Source Port ID indicates a port associated with the module</span>
<a name="l00243"></a>00243 <span class="comment">                                            indicated by the SRC_MODID, through which the packet has</span>
<a name="l00244"></a>00244 <span class="comment">                                            entered the system */</span>
<a name="l00245"></a>00245             uint32_t lbid:8;<span class="comment"></span>
<a name="l00246"></a><a class="code" href="structcvmx__higig2__header__t.html#abeed26c14f5556397d1601b7b7e76985">00246</a> <span class="comment">                      /**&lt; Load Balancing ID indicates a packet flow hashing index</span>
<a name="l00247"></a>00247 <span class="comment">                                            computed by the ingress XGS module for statistical distribution of</span>
<a name="l00248"></a>00248 <span class="comment">                                            packet flows through a multipath fabric */</span>
<a name="l00249"></a>00249             uint32_t dp:2;<span class="comment"></span>
<a name="l00250"></a><a class="code" href="structcvmx__higig2__header__t.html#a4647ce4c300d440ea9bdb6ccb2c64dfd">00250</a> <span class="comment">                      /**&lt; Drop Precedence indicates the traffic rate violation status of the</span>
<a name="l00251"></a>00251 <span class="comment">                                            packet measured by the ingress module.</span>
<a name="l00252"></a>00252 <span class="comment">                                            - 00: GREEN</span>
<a name="l00253"></a>00253 <span class="comment">                                            - 01: RED</span>
<a name="l00254"></a>00254 <span class="comment">                                            - 10: Reserved</span>
<a name="l00255"></a>00255 <span class="comment">                                            - 11: Yellow */</span>
<a name="l00256"></a><a class="code" href="structcvmx__higig2__header__t.html#ac7c8b2ee4352258777cf4f39a24f90f3">00256</a>             uint32_t reserved_3_5:3;
<a name="l00257"></a>00257             uint32_t ppd_type:3;<span class="comment"></span>
<a name="l00258"></a><a class="code" href="structcvmx__higig2__header__t.html#a42918e68d8e9f624479667562bd1eded">00258</a> <span class="comment">                      /**&lt; Packet Processing Descriptor Type</span>
<a name="l00259"></a>00259 <span class="comment">                                            - 000: PPD Overlay1</span>
<a name="l00260"></a>00260 <span class="comment">                                            - 001: PPD Overlay2</span>
<a name="l00261"></a>00261 <span class="comment">                                            - 010~111: Reserved */</span>
<a name="l00262"></a>00262         } <a class="code" href="cvmx-coremask_8c.html#a7cc33a7fd56e1ab82f778fe3f0e88c25">s</a>;
<a name="l00263"></a>00263     } dw1;
<a name="l00264"></a>00264     <span class="keyword">union </span>{
<a name="l00265"></a>00265         uint32_t u32;
<a name="l00266"></a>00266         <span class="keyword">struct </span>{
<a name="l00267"></a>00267             uint32_t dst_t:1;<span class="comment"></span>
<a name="l00268"></a><a class="code" href="structcvmx__higig2__header__t.html#aeabc72adc3c229e667d39348d367414e">00268</a> <span class="comment">                      /**&lt; Destination Trunk: Indicates that the destination port is a member of a trunk</span>
<a name="l00269"></a>00269 <span class="comment">                                            group. */</span>
<a name="l00270"></a>00270             uint32_t dst_tgid:3;<span class="comment"></span>
<a name="l00271"></a><a class="code" href="structcvmx__higig2__header__t.html#ae9592c79b7f556eeb7e0b67fbf295dcb">00271</a> <span class="comment">                      /**&lt; Destination Trunk Group ID: Trunk group ID of the destination port. The</span>
<a name="l00272"></a>00272 <span class="comment">                                            DO_NOT_LEARN bit is overlaid on the second bit of this field. */</span>
<a name="l00273"></a>00273             uint32_t ingress_tagged:1;<span class="comment"></span>
<a name="l00274"></a><a class="code" href="structcvmx__higig2__header__t.html#a657bdd63c8f6c8cbc94e95d24fd66ffd">00274</a> <span class="comment">                      /**&lt; Ingress Tagged: Indicates whether the packet was tagged when it originally</span>
<a name="l00275"></a>00275 <span class="comment">                                            ingressed the system. */</span>
<a name="l00276"></a>00276             uint32_t mirror_only:1;<span class="comment"></span>
<a name="l00277"></a><a class="code" href="structcvmx__higig2__header__t.html#a5846f1ed9df99d7c423a40ece0153814">00277</a> <span class="comment">                      /**&lt; Mirror Only: XGS 1/2 mode: Indicates that the packet was switched and only</span>
<a name="l00278"></a>00278 <span class="comment">                                            needs to be mirrored. */</span>
<a name="l00279"></a>00279             uint32_t mirror_done:1;<span class="comment"></span>
<a name="l00280"></a><a class="code" href="structcvmx__higig2__header__t.html#a66b390ff15981f135856faaaf6ccc45d">00280</a> <span class="comment">                      /**&lt; Mirroring Done: XGS1/2 mode: Indicates that the packet was mirrored and</span>
<a name="l00281"></a>00281 <span class="comment">                                            may still need to be switched. */</span>
<a name="l00282"></a>00282             uint32_t mirror:1;<span class="comment"></span>
<a name="l00283"></a><a class="code" href="structcvmx__higig2__header__t.html#a208ac915fdf046d7ee257d85926d2854">00283</a> <span class="comment">                      /**&lt; Mirror: XGS3 mode: a mirror copy packet. XGS1/2 mode: Indicates that the</span>
<a name="l00284"></a>00284 <span class="comment">                                            packet was switched and only needs to be mirrored. */</span>
<a name="l00285"></a><a class="code" href="structcvmx__higig2__header__t.html#ac2f74bd263acf7d72f680276febf0591">00285</a>             uint32_t reserved_22_23:2;
<a name="l00286"></a>00286             uint32_t l3:1;<span class="comment"></span>
<a name="l00287"></a><a class="code" href="structcvmx__higig2__header__t.html#a8e82dc5fe845394867e1ca275585fa28">00287</a> <span class="comment">                      /**&lt; L3: Indicates that the packet is L3 switched */</span>
<a name="l00288"></a>00288             uint32_t label_present:1;<span class="comment"></span>
<a name="l00289"></a><a class="code" href="structcvmx__higig2__header__t.html#a66422c12df5696cba922463ebe8ac846">00289</a> <span class="comment">                      /**&lt; Label Present: Indicates that header contains a 20-bit VC label: HiGig+</span>
<a name="l00290"></a>00290 <span class="comment">                                            added field. */</span>
<a name="l00291"></a>00291             uint32_t vc_label:20;<span class="comment"></span>
<a name="l00292"></a><a class="code" href="structcvmx__higig2__header__t.html#a98420a3d9fe24331842956dcc2354211">00292</a> <span class="comment">                      /**&lt; Refer to the HiGig+ Architecture Specification */</span>
<a name="l00293"></a>00293         } o1;
<a name="l00294"></a>00294         <span class="keyword">struct </span>{
<a name="l00295"></a>00295             uint32_t classification:16;<span class="comment"></span>
<a name="l00296"></a><a class="code" href="structcvmx__higig2__header__t.html#a61c926374625670896c4e2d6de252bef">00296</a> <span class="comment">                      /**&lt; Classification tag information from the HiGig device FFP */</span>
<a name="l00297"></a><a class="code" href="structcvmx__higig2__header__t.html#a6baa5bc6091ce1368400f93685d6d5cf">00297</a>             uint32_t reserved_0_15:16;
<a name="l00298"></a>00298         } o2;
<a name="l00299"></a>00299     } dw2;
<a name="l00300"></a>00300     <span class="keyword">union </span>{
<a name="l00301"></a>00301         uint32_t u32;
<a name="l00302"></a>00302         <span class="keyword">struct </span>{
<a name="l00303"></a>00303             uint32_t vid:16;<span class="comment"></span>
<a name="l00304"></a><a class="code" href="structcvmx__higig2__header__t.html#a4b7779684715d34dff586a3734fae5f6">00304</a> <span class="comment">                      /**&lt; VLAN tag information */</span>
<a name="l00305"></a>00305             uint32_t pfm:2;<span class="comment"></span>
<a name="l00306"></a><a class="code" href="structcvmx__higig2__header__t.html#ae1e4a7632e93518aea06eda8599195d5">00306</a> <span class="comment">                      /**&lt; Three Port Filtering Modes (0, 1, 2) used in handling registed/unregistered</span>
<a name="l00307"></a>00307 <span class="comment">                                            multicast (unknown L2 multicast and IPMC) packets. This field is used</span>
<a name="l00308"></a>00308 <span class="comment">                                            when OPCODE is 011 or 100 Semantics of PFM bits are as follows;</span>
<a name="l00309"></a>00309 <span class="comment">                                            For registered L2 multicast packets:</span>
<a name="l00310"></a>00310 <span class="comment">                                                PFM= 0 ­ Flood to VLAN</span>
<a name="l00311"></a>00311 <span class="comment">                                                PFM= 1 or 2 ­ Send to group members in the L2MC table</span>
<a name="l00312"></a>00312 <span class="comment">                                            For unregistered L2 multicast packets:</span>
<a name="l00313"></a>00313 <span class="comment">                                                PFM= 0 or 1 ­ Flood to VLAN</span>
<a name="l00314"></a>00314 <span class="comment">                                                PFM= 2 ­ Drop the packet */</span>
<a name="l00315"></a>00315             uint32_t src_t:1;<span class="comment"></span>
<a name="l00316"></a><a class="code" href="structcvmx__higig2__header__t.html#a3ed2150dd6b6ded0b4872b5e796dbed6">00316</a> <span class="comment">                      /**&lt; If the MSB of this field is set, then it indicates the LAG the packet ingressed</span>
<a name="l00317"></a>00317 <span class="comment">                                            on, else it represents the physical port the packet ingressed on. */</span>
<a name="l00318"></a><a class="code" href="structcvmx__higig2__header__t.html#ad08fabde7240216452e449146017d08b">00318</a>             uint32_t reserved_11_12:2;
<a name="l00319"></a>00319             uint32_t opcode:3;<span class="comment"></span>
<a name="l00320"></a><a class="code" href="structcvmx__higig2__header__t.html#a9ff2f49213c638dbd195176e9b2c5627">00320</a> <span class="comment">                      /**&lt; XGS HiGig op-code, indicating the type of packet</span>
<a name="l00321"></a>00321 <span class="comment">                                            000 =     Control frames used for CPU to CPU communications</span>
<a name="l00322"></a>00322 <span class="comment">                                            001 =     Unicast packet with destination resolved; The packet can be</span>
<a name="l00323"></a>00323 <span class="comment">                                                      either Layer 2 unicast packet or L3 unicast packet that was</span>
<a name="l00324"></a>00324 <span class="comment">                                                      routed in the ingress chip.</span>
<a name="l00325"></a>00325 <span class="comment">                                            010 =     Broadcast or unknown Unicast packet or unknown multicast,</span>
<a name="l00326"></a>00326 <span class="comment">                                                      destined to all members of the VLAN</span>
<a name="l00327"></a>00327 <span class="comment">                                            011 =     L2 Multicast packet, destined to all ports of the group indicated</span>
<a name="l00328"></a>00328 <span class="comment">                                                      in the L2MC_INDEX which is overlayed on DST_PORT/DST_MODID fields</span>
<a name="l00329"></a>00329 <span class="comment">                                            100 =     IP Multicast packet, destined to all ports of the group indicated</span>
<a name="l00330"></a>00330 <span class="comment">                                                      in the IPMC_INDEX which is overlayed on DST_PORT/DST_MODID fields</span>
<a name="l00331"></a>00331 <span class="comment">                                            101 =     Reserved</span>
<a name="l00332"></a>00332 <span class="comment">                                            110 =     Reserved</span>
<a name="l00333"></a>00333 <span class="comment">                                            111 =     Reserved */</span>
<a name="l00334"></a>00334             uint32_t hdr_ext_len:3;<span class="comment"></span>
<a name="l00335"></a><a class="code" href="structcvmx__higig2__header__t.html#a34fc709df0e6c012a9683ffa09417d09">00335</a> <span class="comment">                      /**&lt; This field is valid only if the HGI field is a b&apos;10&apos; and it indicates the extension</span>
<a name="l00336"></a>00336 <span class="comment">                                            to the standard 12-bytes of XGS HiGig header. Each unit represents 4</span>
<a name="l00337"></a>00337 <span class="comment">                                            bytes, giving a total of 16 additional extension bytes. Value of b&apos;101&apos;, b&apos;110&apos;</span>
<a name="l00338"></a>00338 <span class="comment">                                            and b&apos;111&apos; are reserved. For HGI field value of b&apos;01&apos; this field should be</span>
<a name="l00339"></a>00339 <span class="comment">                                            b&apos;01&apos;. For all other values of HGI it is don&apos;t care. */</span>
<a name="l00340"></a><a class="code" href="structcvmx__higig2__header__t.html#ab131a35326fce2506360abdaeacc5120">00340</a>             uint32_t reserved_0_4:5;
<a name="l00341"></a>00341         } <a class="code" href="cvmx-coremask_8c.html#a7cc33a7fd56e1ab82f778fe3f0e88c25">s</a>;
<a name="l00342"></a>00342     } dw3;
<a name="l00343"></a>00343 } <a class="code" href="structcvmx__higig2__header__t.html">cvmx_higig2_header_t</a>;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="cvmx-higig_8h.html#a9d282534428d45a9974114548468a2cd">00346</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cvmx-higig_8h.html#a9d282534428d45a9974114548468a2cd">__cvmx_higig_set_qos_priority_o68</a>(<span class="keywordtype">void</span>)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <span class="keywordtype">int</span> i;
<a name="l00349"></a>00349     <a class="code" href="unioncvmx__pip__pri__tblx.html" title="cvmx_pip_pri_tbl#">cvmx_pip_pri_tblx_t</a> pip_pri_tbl;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     <span class="keywordflow">for</span> (i = 0; i &lt; 64; i++) {
<a name="l00352"></a>00352         pip_pri_tbl.<a class="code" href="unioncvmx__pip__pri__tblx.html#ad43a1e38de665356e517786d85d30b71">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#a83afd0c840789ef40bf83594510e686d">CVMX_PIP_PRI_TBLX</a>(i));
<a name="l00353"></a>00353         pip_pri_tbl.<a class="code" href="unioncvmx__pip__pri__tblx.html#ae0214dc4ebaa9354d5f21b24ac25bee0">s</a>.<a class="code" href="structcvmx__pip__pri__tblx_1_1cvmx__pip__pri__tblx__s.html#acddcc0fb4dd2af53554a76f75efa206f">hg2_qos</a> = i &amp; 7;
<a name="l00354"></a>00354         <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#a83afd0c840789ef40bf83594510e686d">CVMX_PIP_PRI_TBLX</a>(i), pip_pri_tbl.<a class="code" href="unioncvmx__pip__pri__tblx.html#ad43a1e38de665356e517786d85d30b71">u64</a>);
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="cvmx-higig_8h.html#aa5fe6e50f4accca03a8adf17102fb2cd">00358</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="cvmx-higig_8h.html#aa5fe6e50f4accca03a8adf17102fb2cd">__cvmx_higig_set_qos_priority_o1</a>(<span class="keywordtype">void</span>)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360     <span class="keywordtype">int</span> i;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="keywordflow">for</span> (i = 0; i &lt; 64; i++) {
<a name="l00363"></a>00363         <a class="code" href="unioncvmx__pip__hg__pri__qos.html" title="cvmx_pip_hg_pri_qos">cvmx_pip_hg_pri_qos_t</a> pip_hg_pri_qos;
<a name="l00364"></a>00364         pip_hg_pri_qos.<a class="code" href="unioncvmx__pip__hg__pri__qos.html#a8989fd4e5e38e554cdc16c25678343c2">u64</a> = 0;
<a name="l00365"></a>00365         pip_hg_pri_qos.<a class="code" href="unioncvmx__pip__hg__pri__qos.html#af1d1e5a18b96e0174219f407d592dcea">s</a>.<a class="code" href="structcvmx__pip__hg__pri__qos_1_1cvmx__pip__hg__pri__qos__s.html#a3d920432a8a0a4a61d77e80e8bcd7ba9">up_qos</a> = 1;
<a name="l00366"></a>00366         pip_hg_pri_qos.<a class="code" href="unioncvmx__pip__hg__pri__qos.html#af1d1e5a18b96e0174219f407d592dcea">s</a>.<a class="code" href="structcvmx__pip__hg__pri__qos_1_1cvmx__pip__hg__pri__qos__s.html#acc9df6a20917676a5e988a25baad4fa2">pri</a> = i;
<a name="l00367"></a>00367         pip_hg_pri_qos.<a class="code" href="unioncvmx__pip__hg__pri__qos.html#af1d1e5a18b96e0174219f407d592dcea">s</a>.<a class="code" href="structcvmx__pip__hg__pri__qos_1_1cvmx__pip__hg__pri__qos__s.html#a53d4a522a02237d93bf8be83589f5eea">qos</a> = i &amp; 7;
<a name="l00368"></a>00368         <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#a93f7388c9a85a9275592cdb1c062f236">CVMX_PIP_HG_PRI_QOS</a>, pip_hg_pri_qos.<a class="code" href="unioncvmx__pip__hg__pri__qos.html#a8989fd4e5e38e554cdc16c25678343c2">u64</a>);
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 <span class="comment">/*</span>
<a name="l00374"></a>00374 <span class="comment"> * The function below for pre-CN68XX models was derived from</span>
<a name="l00375"></a>00375 <span class="comment"> * a version that combines them with CN68XX, and needs to be</span>
<a name="l00376"></a>00376 <span class="comment"> * reviewed to see on which specific models it may in fact work.</span>
<a name="l00377"></a>00377 <span class="comment"> */</span>
<a name="l00378"></a><a class="code" href="cvmx-higig_8h.html#a5cd93a2ad4c90f299a331ade527e048f">00378</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvmx-higig_8h.html#a5cd93a2ad4c90f299a331ade527e048f">cvmx_higig_init_o1</a>(<span class="keywordtype">int</span> interface, <span class="keywordtype">int</span> enable_higig2)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     <a class="code" href="unioncvmx__pip__prt__cfgx.html" title="cvmx_pip_prt_cfg#">cvmx_pip_prt_cfgx_t</a> pip_prt_cfg;
<a name="l00381"></a>00381     <a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html" title="cvmx_gmx::_rx::_udd_skp">cvmx_gmxx_rxx_udd_skp_t</a> gmx_rx_udd_skp;
<a name="l00382"></a>00382     <a class="code" href="unioncvmx__gmxx__txx__min__pkt.html" title="cvmx_gmx::_tx::_min_pkt">cvmx_gmxx_txx_min_pkt_t</a> gmx_tx_min_pkt;
<a name="l00383"></a>00383     <a class="code" href="unioncvmx__gmxx__txx__append.html" title="cvmx_gmx::_tx::_append">cvmx_gmxx_txx_append_t</a> gmx_tx_append;
<a name="l00384"></a>00384     <a class="code" href="unioncvmx__gmxx__tx__ifg.html" title="cvmx_gmx::_tx_ifg">cvmx_gmxx_tx_ifg_t</a> gmx_tx_ifg;
<a name="l00385"></a>00385     <a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html" title="cvmx_gmx::_tx_ovr_bp">cvmx_gmxx_tx_ovr_bp_t</a> gmx_tx_ovr_bp;
<a name="l00386"></a>00386     <a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html" title="cvmx_gmx::_rx::_frm_ctl">cvmx_gmxx_rxx_frm_ctl_t</a> gmx_rx_frm_ctl;
<a name="l00387"></a>00387     <a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html" title="cvmx_gmx::_tx_xaui_ctl">cvmx_gmxx_tx_xaui_ctl_t</a> gmx_tx_xaui_ctl;
<a name="l00388"></a>00388     <span class="keywordtype">int</span> pknd;
<a name="l00389"></a>00389     <span class="keywordtype">int</span> header_size = (enable_higig2) ? 16 : 12;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="comment">/* Setup PIP to handle HiGig */</span>
<a name="l00392"></a>00392     pknd = interface * 16;
<a name="l00393"></a>00393     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#aaaf9297b7407fa03dc2866001bdaaa1c">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#af1b3d60cfcd2839949323eb830935fbe">CVMX_PIP_PRT_CFGX</a>(pknd));
<a name="l00394"></a>00394     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#ad780e865610cc4f3a114a6482c7ce41e">dsa_en</a> = 0;
<a name="l00395"></a>00395     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#ab691e533147b33827b6cbb6e80271a88">higig_en</a> = 1;
<a name="l00396"></a>00396     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#a584e40b7929085fbae3b691a35e9584e">hg_qos</a> = 1;
<a name="l00397"></a>00397     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#abf4814d6ad50a94653f5ed3149d43ec5">skip</a> = header_size;
<a name="l00398"></a>00398     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#af1b3d60cfcd2839949323eb830935fbe">CVMX_PIP_PRT_CFGX</a>(pknd), pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#aaaf9297b7407fa03dc2866001bdaaa1c">u64</a>);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400     <span class="comment">/* Setup some sample QoS defaults. These can be changed later */</span>
<a name="l00401"></a>00401     <a class="code" href="cvmx-higig_8h.html#aa5fe6e50f4accca03a8adf17102fb2cd">__cvmx_higig_set_qos_priority_o1</a>();
<a name="l00402"></a>00402 
<a name="l00403"></a>00403     <span class="comment">/* Setup GMX RX to treat the HiGig header as user data to ignore */</span>
<a name="l00404"></a>00404     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#ae08b033fe74620184ffb81f081cfbff0">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a365df7f85133497a2f4e9dab0bddcf39">CVMX_GMXX_RXX_UDD_SKP</a>(0, interface));
<a name="l00405"></a>00405     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#a7681af0bf11580c9ef70cf019c536956">s</a>.<a class="code" href="structcvmx__gmxx__rxx__udd__skp_1_1cvmx__gmxx__rxx__udd__skp__s.html#a53225eb18acb95909c5a386a709e0de2">len</a> = header_size;
<a name="l00406"></a>00406     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#a7681af0bf11580c9ef70cf019c536956">s</a>.<a class="code" href="structcvmx__gmxx__rxx__udd__skp_1_1cvmx__gmxx__rxx__udd__skp__s.html#a226d8eff8ea0980b0ea41ae0f154b214">fcssel</a> = 0;
<a name="l00407"></a>00407     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a365df7f85133497a2f4e9dab0bddcf39">CVMX_GMXX_RXX_UDD_SKP</a>(0, interface), gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#ae08b033fe74620184ffb81f081cfbff0">u64</a>);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="comment">/* Disable GMX preamble checking */</span>
<a name="l00410"></a>00410     gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a9d897b7784152499823c57d8b0a692a4">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a28fd5434b7ce586ac24988b6b6aca94d">CVMX_GMXX_RXX_FRM_CTL</a>(0, interface));
<a name="l00411"></a>00411     gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a79ac6e8a1ba0c4f11ff8280192f64542">s</a>.<a class="code" href="structcvmx__gmxx__rxx__frm__ctl_1_1cvmx__gmxx__rxx__frm__ctl__s.html#a4dde9660d431006e0ff6e13facc593c6">pre_chk</a> = 0;
<a name="l00412"></a>00412     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a28fd5434b7ce586ac24988b6b6aca94d">CVMX_GMXX_RXX_FRM_CTL</a>(0, interface), gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a9d897b7784152499823c57d8b0a692a4">u64</a>);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="comment">/* Setup GMX TX to pad properly min sized packets */</span>
<a name="l00415"></a>00415     gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a77e4dda2a27e29225bf4fcec0e3907e5">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a5b8b4ed9dcae214bcbe3ca6a91c090f4">CVMX_GMXX_TXX_MIN_PKT</a>(0, interface));
<a name="l00416"></a>00416     gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a91a4fcf8730071291f2e97882d7446e5">s</a>.<a class="code" href="structcvmx__gmxx__txx__min__pkt_1_1cvmx__gmxx__txx__min__pkt__s.html#a02fa32ff59ea569c1e294a40533a2684">min_size</a> = 59 + header_size;
<a name="l00417"></a>00417     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a5b8b4ed9dcae214bcbe3ca6a91c090f4">CVMX_GMXX_TXX_MIN_PKT</a>(0, interface), gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a77e4dda2a27e29225bf4fcec0e3907e5">u64</a>);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     <span class="comment">/* Setup GMX TX to not add a preamble */</span>
<a name="l00420"></a>00420     gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a037a5d56ea988aaa5bd7a4ee63a7e4c8">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a37e2c00c2cab9acde672387b9c3bbc3e">CVMX_GMXX_TXX_APPEND</a>(0, interface));
<a name="l00421"></a>00421     gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a0ebfddf9001eeaa0d568e9a92314c579">s</a>.<a class="code" href="structcvmx__gmxx__txx__append_1_1cvmx__gmxx__txx__append__s.html#a75e7fe1578cf01fd4617660b4ee81684">preamble</a> = 0;
<a name="l00422"></a>00422     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a37e2c00c2cab9acde672387b9c3bbc3e">CVMX_GMXX_TXX_APPEND</a>(0, interface), gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a037a5d56ea988aaa5bd7a4ee63a7e4c8">u64</a>);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <span class="comment">/* Reduce the inter frame gap to 8 bytes */</span>
<a name="l00425"></a>00425     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a92851d0e3a1e86e357ab8788fc87f83b">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#ab20ad7a4e8ef18e7b167cced78dc3121">CVMX_GMXX_TX_IFG</a>(interface));
<a name="l00426"></a>00426     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a29dd52808f9a5644d3b14e7a393494fe">s</a>.<a class="code" href="structcvmx__gmxx__tx__ifg_1_1cvmx__gmxx__tx__ifg__s.html#a663e115f4df386bb0788180fbd335f06">ifg1</a> = 4;
<a name="l00427"></a>00427     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a29dd52808f9a5644d3b14e7a393494fe">s</a>.<a class="code" href="structcvmx__gmxx__tx__ifg_1_1cvmx__gmxx__tx__ifg__s.html#a102b7c5b7961cd6ef594e8289fc443e2">ifg2</a> = 4;
<a name="l00428"></a>00428     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#ab20ad7a4e8ef18e7b167cced78dc3121">CVMX_GMXX_TX_IFG</a>(interface), gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a92851d0e3a1e86e357ab8788fc87f83b">u64</a>);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">/* Disable GMX backpressure */</span>
<a name="l00431"></a>00431     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a4555c21b5b43aedbf491e342408991c4">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a3de3b427a1a1793d8a5fbf157218f001">CVMX_GMXX_TX_OVR_BP</a>(interface));
<a name="l00432"></a>00432     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#a0d05ebb1e833b64eea48b6f2df246033">bp</a> = 0;
<a name="l00433"></a>00433     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#ae3669df2ad80ae64d03b1cc668ed8a45">en</a> = 0xf;
<a name="l00434"></a>00434     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#a6f38b1d8b5f8b131a5479fcdb0e5c77c">ign_full</a> = 0xf;
<a name="l00435"></a>00435     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a3de3b427a1a1793d8a5fbf157218f001">CVMX_GMXX_TX_OVR_BP</a>(interface), gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a4555c21b5b43aedbf491e342408991c4">u64</a>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (enable_higig2) {
<a name="l00438"></a>00438         <span class="comment">/* Enable HiGig2 support and forwarding of virtual port backpressure</span>
<a name="l00439"></a>00439 <span class="comment">           to PKO */</span>
<a name="l00440"></a>00440         <a class="code" href="unioncvmx__gmxx__hg2__control.html" title="cvmx_gmx::_hg2_control">cvmx_gmxx_hg2_control_t</a> gmx_hg2_control;
<a name="l00441"></a>00441         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#a1465cefdebc10d40184c9ce68a425527">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a193e91f7b1db715a4244da203a920d46">CVMX_GMXX_HG2_CONTROL</a>(interface));
<a name="l00442"></a>00442         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#a9ba48863d2609a80fb1c526742086bed">hg2rx_en</a> = 1;
<a name="l00443"></a>00443         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ac18fee7b9bc0fcb47fce6c65989fed75">hg2tx_en</a> = 1;
<a name="l00444"></a>00444         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ad6840b67c41689229c4f4d060b9cec18">logl_en</a> = 0xffff;
<a name="l00445"></a>00445         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ab3970bbebee426266a5e4cbb81aa9dd7">phys_en</a> = 1;
<a name="l00446"></a>00446         <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a193e91f7b1db715a4244da203a920d46">CVMX_GMXX_HG2_CONTROL</a>(interface), gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#a1465cefdebc10d40184c9ce68a425527">u64</a>);
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449     <span class="comment">/* Enable HiGig */</span>
<a name="l00450"></a>00450     gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#ae8507abf3c7e864f803b2d6ed532d642">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a6b6dd1ce93d2dccd849d4dc75896390d">CVMX_GMXX_TX_XAUI_CTL</a>(interface));
<a name="l00451"></a>00451     gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#a8f35ae2fd87b8ca2244fa27a1f94a65a">s</a>.<a class="code" href="structcvmx__gmxx__tx__xaui__ctl_1_1cvmx__gmxx__tx__xaui__ctl__s.html#abd8d3f01ea0f4acc962cd35c399f4c21">hg_en</a> = 1;
<a name="l00452"></a>00452     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a6b6dd1ce93d2dccd849d4dc75896390d">CVMX_GMXX_TX_XAUI_CTL</a>(interface), gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#ae8507abf3c7e864f803b2d6ed532d642">u64</a>);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <span class="keywordflow">return</span> 0;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="cvmx-higig_8h.html#a5272793f330e208a91118e035aae11f1">00457</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvmx-higig_8h.html#a5272793f330e208a91118e035aae11f1">cvmx_higig_init_o68</a>(<span class="keywordtype">int</span> interface, <span class="keywordtype">int</span> enable_higig2)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459     <a class="code" href="unioncvmx__pip__prt__cfgx.html" title="cvmx_pip_prt_cfg#">cvmx_pip_prt_cfgx_t</a> pip_prt_cfg;
<a name="l00460"></a>00460     <a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html" title="cvmx_gmx::_rx::_udd_skp">cvmx_gmxx_rxx_udd_skp_t</a> gmx_rx_udd_skp;
<a name="l00461"></a>00461     <a class="code" href="unioncvmx__gmxx__txx__min__pkt.html" title="cvmx_gmx::_tx::_min_pkt">cvmx_gmxx_txx_min_pkt_t</a> gmx_tx_min_pkt;
<a name="l00462"></a>00462     <a class="code" href="unioncvmx__gmxx__txx__append.html" title="cvmx_gmx::_tx::_append">cvmx_gmxx_txx_append_t</a> gmx_tx_append;
<a name="l00463"></a>00463     <a class="code" href="unioncvmx__gmxx__tx__ifg.html" title="cvmx_gmx::_tx_ifg">cvmx_gmxx_tx_ifg_t</a> gmx_tx_ifg;
<a name="l00464"></a>00464     <a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html" title="cvmx_gmx::_tx_ovr_bp">cvmx_gmxx_tx_ovr_bp_t</a> gmx_tx_ovr_bp;
<a name="l00465"></a>00465     <a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html" title="cvmx_gmx::_rx::_frm_ctl">cvmx_gmxx_rxx_frm_ctl_t</a> gmx_rx_frm_ctl;
<a name="l00466"></a>00466     <a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html" title="cvmx_gmx::_tx_xaui_ctl">cvmx_gmxx_tx_xaui_ctl_t</a> gmx_tx_xaui_ctl;
<a name="l00467"></a>00467     <a class="code" href="unioncvmx__pko__reg__read__idx.html" title="cvmx_pko_reg_read_idx">cvmx_pko_reg_read_idx_t</a> pko_index;
<a name="l00468"></a>00468     <a class="code" href="unioncvmx__pko__mem__iport__ptrs.html" title="cvmx_pko_mem_iport_ptrs">cvmx_pko_mem_iport_ptrs_t</a> pko_mem_iport;
<a name="l00469"></a>00469     <a class="code" href="unioncvmx__pko__reg__min__pkt.html" title="cvmx_pko_reg_min_pkt">cvmx_pko_reg_min_pkt_t</a> pko_min_pkt;
<a name="l00470"></a>00470     <span class="keywordtype">int</span> pknd;
<a name="l00471"></a>00471     <span class="keywordtype">int</span> header_size = (enable_higig2) ? 16 : 12;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     <span class="comment">/* Setup PIP to handle HiGig */</span>
<a name="l00474"></a>00474     pknd = <a class="code" href="cvmx-helper-util_8c.html#a2e063bd86eddaab06d8962136d3c958d" title="Get port kind for a given port in an interface.">cvmx_helper_get_pknd</a>(interface, 0);
<a name="l00475"></a>00475     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#aaaf9297b7407fa03dc2866001bdaaa1c">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#af1b3d60cfcd2839949323eb830935fbe">CVMX_PIP_PRT_CFGX</a>(pknd));
<a name="l00476"></a>00476     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#ad780e865610cc4f3a114a6482c7ce41e">dsa_en</a> = 0;
<a name="l00477"></a>00477     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#ab691e533147b33827b6cbb6e80271a88">higig_en</a> = 1;
<a name="l00478"></a>00478     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#a584e40b7929085fbae3b691a35e9584e">hg_qos</a> = 1;
<a name="l00479"></a>00479     pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#a4ab66cddab612207a961173ca16b5727">s</a>.<a class="code" href="structcvmx__pip__prt__cfgx_1_1cvmx__pip__prt__cfgx__s.html#abf4814d6ad50a94653f5ed3149d43ec5">skip</a> = header_size;
<a name="l00480"></a>00480     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pip-defs_8h.html#af1b3d60cfcd2839949323eb830935fbe">CVMX_PIP_PRT_CFGX</a>(pknd), pip_prt_cfg.<a class="code" href="unioncvmx__pip__prt__cfgx.html#aaaf9297b7407fa03dc2866001bdaaa1c">u64</a>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="comment">/* Setup some sample QoS defaults. These can be changed later */</span>
<a name="l00483"></a>00483     <a class="code" href="cvmx-higig_8h.html#a9d282534428d45a9974114548468a2cd">__cvmx_higig_set_qos_priority_o68</a>();
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="comment">/* Setup GMX RX to treat the HiGig header as user data to ignore */</span>
<a name="l00486"></a>00486     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#ae08b033fe74620184ffb81f081cfbff0">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a365df7f85133497a2f4e9dab0bddcf39">CVMX_GMXX_RXX_UDD_SKP</a>(0, interface));
<a name="l00487"></a>00487     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#a7681af0bf11580c9ef70cf019c536956">s</a>.<a class="code" href="structcvmx__gmxx__rxx__udd__skp_1_1cvmx__gmxx__rxx__udd__skp__s.html#a53225eb18acb95909c5a386a709e0de2">len</a> = header_size;
<a name="l00488"></a>00488     gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#a7681af0bf11580c9ef70cf019c536956">s</a>.<a class="code" href="structcvmx__gmxx__rxx__udd__skp_1_1cvmx__gmxx__rxx__udd__skp__s.html#a226d8eff8ea0980b0ea41ae0f154b214">fcssel</a> = 0;
<a name="l00489"></a>00489     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a365df7f85133497a2f4e9dab0bddcf39">CVMX_GMXX_RXX_UDD_SKP</a>(0, interface), gmx_rx_udd_skp.<a class="code" href="unioncvmx__gmxx__rxx__udd__skp.html#ae08b033fe74620184ffb81f081cfbff0">u64</a>);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">/* Encounter Higig header in setting min-pkt size */</span>
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     pko_index.<a class="code" href="unioncvmx__pko__reg__read__idx.html#adf52eb49dd83a00cc367b94d6a5322f6">u64</a> = 0;
<a name="l00494"></a>00494     pko_index.<a class="code" href="unioncvmx__pko__reg__read__idx.html#a4c3a314aa28edb67b2b5e7e49fa49587">s</a>.<a class="code" href="structcvmx__pko__reg__read__idx_1_1cvmx__pko__reg__read__idx__s.html#aceb71d8762a0242cca6905929dcddfd8">index</a> = <a class="code" href="cvmx-helper-util_8c.html#a0e206117af6ff3e7d97ace1568389d21" title="Returns the PKO port number for a port on the given interface, This is the base pko_port...">cvmx_helper_get_pko_port</a>(interface, 0);
<a name="l00495"></a>00495     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pko-defs_8h.html#a16bfff4c04ffe969627d2a60c3cfec40">CVMX_PKO_REG_READ_IDX</a>, pko_index.<a class="code" href="unioncvmx__pko__reg__read__idx.html#adf52eb49dd83a00cc367b94d6a5322f6">u64</a>);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="comment">/* Use size2 for higig and size3 for higig2 */</span>
<a name="l00498"></a>00498     pko_mem_iport.<a class="code" href="unioncvmx__pko__mem__iport__ptrs.html#a86ced7b50b81f8c4c30058a7af861af0">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-pko-defs_8h.html#a070095fc75b4ceb2704adb0d14b2101f">CVMX_PKO_MEM_IPORT_PTRS</a>);
<a name="l00499"></a>00499     pko_mem_iport.<a class="code" href="unioncvmx__pko__mem__iport__ptrs.html#aa35797c35839d0a0455a3639b3a35330">s</a>.<a class="code" href="structcvmx__pko__mem__iport__ptrs_1_1cvmx__pko__mem__iport__ptrs__s.html#a1faa5e2c3af2486bbb0486472829a9bb">min_pkt</a> = (enable_higig2) ? 2 : 3;
<a name="l00500"></a>00500     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pko-defs_8h.html#a070095fc75b4ceb2704adb0d14b2101f">CVMX_PKO_MEM_IPORT_PTRS</a>, pko_mem_iport.<a class="code" href="unioncvmx__pko__mem__iport__ptrs.html#a86ced7b50b81f8c4c30058a7af861af0">u64</a>);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     pko_min_pkt.<a class="code" href="unioncvmx__pko__reg__min__pkt.html#adeec8c726e7083f7188c7621a1e1a97e">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-pko-defs_8h.html#aea66bd2a4729e4ac5190c82e73c541a0">CVMX_PKO_REG_MIN_PKT</a>);
<a name="l00503"></a>00503     <span class="keywordflow">if</span> (enable_higig2)
<a name="l00504"></a>00504         pko_min_pkt.<a class="code" href="unioncvmx__pko__reg__min__pkt.html#a9143abe4ea4474aa9af20d09c5ad7a88">s</a>.<a class="code" href="structcvmx__pko__reg__min__pkt_1_1cvmx__pko__reg__min__pkt__s.html#ae73a2555977a763da26176e1806a59ff">size2</a> = 59 + header_size;
<a name="l00505"></a>00505     <span class="keywordflow">else</span>
<a name="l00506"></a>00506         pko_min_pkt.<a class="code" href="unioncvmx__pko__reg__min__pkt.html#a9143abe4ea4474aa9af20d09c5ad7a88">s</a>.<a class="code" href="structcvmx__pko__reg__min__pkt_1_1cvmx__pko__reg__min__pkt__s.html#a44d0439e0c379c74b1026adddc84a3c7">size3</a> = 59 + header_size;
<a name="l00507"></a>00507     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-pko-defs_8h.html#aea66bd2a4729e4ac5190c82e73c541a0">CVMX_PKO_REG_MIN_PKT</a>, pko_min_pkt.<a class="code" href="unioncvmx__pko__reg__min__pkt.html#adeec8c726e7083f7188c7621a1e1a97e">u64</a>);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="comment">/* Disable GMX preamble checking */</span>
<a name="l00510"></a>00510     gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a9d897b7784152499823c57d8b0a692a4">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a28fd5434b7ce586ac24988b6b6aca94d">CVMX_GMXX_RXX_FRM_CTL</a>(0, interface));
<a name="l00511"></a>00511     gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a79ac6e8a1ba0c4f11ff8280192f64542">s</a>.<a class="code" href="structcvmx__gmxx__rxx__frm__ctl_1_1cvmx__gmxx__rxx__frm__ctl__s.html#a4dde9660d431006e0ff6e13facc593c6">pre_chk</a> = 0;
<a name="l00512"></a>00512     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a28fd5434b7ce586ac24988b6b6aca94d">CVMX_GMXX_RXX_FRM_CTL</a>(0, interface), gmx_rx_frm_ctl.<a class="code" href="unioncvmx__gmxx__rxx__frm__ctl.html#a9d897b7784152499823c57d8b0a692a4">u64</a>);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     <span class="comment">/* Setup GMX TX to pad properly min sized packets */</span>
<a name="l00515"></a>00515     gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a77e4dda2a27e29225bf4fcec0e3907e5">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a5b8b4ed9dcae214bcbe3ca6a91c090f4">CVMX_GMXX_TXX_MIN_PKT</a>(0, interface));
<a name="l00516"></a>00516     gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a91a4fcf8730071291f2e97882d7446e5">s</a>.<a class="code" href="structcvmx__gmxx__txx__min__pkt_1_1cvmx__gmxx__txx__min__pkt__s.html#a02fa32ff59ea569c1e294a40533a2684">min_size</a> = 59 + header_size;
<a name="l00517"></a>00517     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a5b8b4ed9dcae214bcbe3ca6a91c090f4">CVMX_GMXX_TXX_MIN_PKT</a>(0, interface), gmx_tx_min_pkt.<a class="code" href="unioncvmx__gmxx__txx__min__pkt.html#a77e4dda2a27e29225bf4fcec0e3907e5">u64</a>);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="comment">/* Setup GMX TX to not add a preamble */</span>
<a name="l00520"></a>00520     gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a037a5d56ea988aaa5bd7a4ee63a7e4c8">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a37e2c00c2cab9acde672387b9c3bbc3e">CVMX_GMXX_TXX_APPEND</a>(0, interface));
<a name="l00521"></a>00521     gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a0ebfddf9001eeaa0d568e9a92314c579">s</a>.<a class="code" href="structcvmx__gmxx__txx__append_1_1cvmx__gmxx__txx__append__s.html#a75e7fe1578cf01fd4617660b4ee81684">preamble</a> = 0;
<a name="l00522"></a>00522     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a37e2c00c2cab9acde672387b9c3bbc3e">CVMX_GMXX_TXX_APPEND</a>(0, interface), gmx_tx_append.<a class="code" href="unioncvmx__gmxx__txx__append.html#a037a5d56ea988aaa5bd7a4ee63a7e4c8">u64</a>);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="comment">/* Reduce the inter frame gap to 8 bytes */</span>
<a name="l00525"></a>00525     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a92851d0e3a1e86e357ab8788fc87f83b">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#ab20ad7a4e8ef18e7b167cced78dc3121">CVMX_GMXX_TX_IFG</a>(interface));
<a name="l00526"></a>00526     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a29dd52808f9a5644d3b14e7a393494fe">s</a>.<a class="code" href="structcvmx__gmxx__tx__ifg_1_1cvmx__gmxx__tx__ifg__s.html#a663e115f4df386bb0788180fbd335f06">ifg1</a> = 4;
<a name="l00527"></a>00527     gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a29dd52808f9a5644d3b14e7a393494fe">s</a>.<a class="code" href="structcvmx__gmxx__tx__ifg_1_1cvmx__gmxx__tx__ifg__s.html#a102b7c5b7961cd6ef594e8289fc443e2">ifg2</a> = 4;
<a name="l00528"></a>00528     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#ab20ad7a4e8ef18e7b167cced78dc3121">CVMX_GMXX_TX_IFG</a>(interface), gmx_tx_ifg.<a class="code" href="unioncvmx__gmxx__tx__ifg.html#a92851d0e3a1e86e357ab8788fc87f83b">u64</a>);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="comment">/* Disable GMX backpressure */</span>
<a name="l00531"></a>00531     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a4555c21b5b43aedbf491e342408991c4">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a3de3b427a1a1793d8a5fbf157218f001">CVMX_GMXX_TX_OVR_BP</a>(interface));
<a name="l00532"></a>00532     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#a0d05ebb1e833b64eea48b6f2df246033">bp</a> = 0;
<a name="l00533"></a>00533     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#ae3669df2ad80ae64d03b1cc668ed8a45">en</a> = 0xf;
<a name="l00534"></a>00534     gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a7cc5621ceef72f09232eb53b855eb274">s</a>.<a class="code" href="structcvmx__gmxx__tx__ovr__bp_1_1cvmx__gmxx__tx__ovr__bp__s.html#a6f38b1d8b5f8b131a5479fcdb0e5c77c">ign_full</a> = 0xf;
<a name="l00535"></a>00535     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a3de3b427a1a1793d8a5fbf157218f001">CVMX_GMXX_TX_OVR_BP</a>(interface), gmx_tx_ovr_bp.<a class="code" href="unioncvmx__gmxx__tx__ovr__bp.html#a4555c21b5b43aedbf491e342408991c4">u64</a>);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (enable_higig2) {
<a name="l00538"></a>00538         <span class="comment">/* Enable HiGig2 support and forwarding of virtual port backpressure</span>
<a name="l00539"></a>00539 <span class="comment">           to PKO */</span>
<a name="l00540"></a>00540         <a class="code" href="unioncvmx__gmxx__hg2__control.html" title="cvmx_gmx::_hg2_control">cvmx_gmxx_hg2_control_t</a> gmx_hg2_control;
<a name="l00541"></a>00541         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#a1465cefdebc10d40184c9ce68a425527">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a193e91f7b1db715a4244da203a920d46">CVMX_GMXX_HG2_CONTROL</a>(interface));
<a name="l00542"></a>00542         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#a9ba48863d2609a80fb1c526742086bed">hg2rx_en</a> = 1;
<a name="l00543"></a>00543         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ac18fee7b9bc0fcb47fce6c65989fed75">hg2tx_en</a> = 1;
<a name="l00544"></a>00544         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ad6840b67c41689229c4f4d060b9cec18">logl_en</a> = 0xffff;
<a name="l00545"></a>00545         gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#af28366f266eb72d5fe45e5f08a58ba69">s</a>.<a class="code" href="structcvmx__gmxx__hg2__control_1_1cvmx__gmxx__hg2__control__s.html#ab3970bbebee426266a5e4cbb81aa9dd7">phys_en</a> = 1;
<a name="l00546"></a>00546         <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a193e91f7b1db715a4244da203a920d46">CVMX_GMXX_HG2_CONTROL</a>(interface), gmx_hg2_control.<a class="code" href="unioncvmx__gmxx__hg2__control.html#a1465cefdebc10d40184c9ce68a425527">u64</a>);
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <span class="comment">/* Enable HiGig */</span>
<a name="l00550"></a>00550     gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#ae8507abf3c7e864f803b2d6ed532d642">u64</a> = <a class="code" href="cvmx-usb_8c.html#af74058148304a28824f934994c132b63">cvmx_read_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a6b6dd1ce93d2dccd849d4dc75896390d">CVMX_GMXX_TX_XAUI_CTL</a>(interface));
<a name="l00551"></a>00551     gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#a8f35ae2fd87b8ca2244fa27a1f94a65a">s</a>.<a class="code" href="structcvmx__gmxx__tx__xaui__ctl_1_1cvmx__gmxx__tx__xaui__ctl__s.html#abd8d3f01ea0f4acc962cd35c399f4c21">hg_en</a> = 1;
<a name="l00552"></a>00552     <a class="code" href="cvmx-usb_8c.html#ab647f34c57823e589be07188a96a501b">cvmx_write_csr</a>(<a class="code" href="cvmx-gmxx-defs_8h.html#a6b6dd1ce93d2dccd849d4dc75896390d">CVMX_GMXX_TX_XAUI_CTL</a>(interface), gmx_tx_xaui_ctl.<a class="code" href="unioncvmx__gmxx__tx__xaui__ctl.html#ae8507abf3c7e864f803b2d6ed532d642">u64</a>);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554     <span class="keywordflow">return</span> 0;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">/*</span>
<a name="l00558"></a>00558 <span class="comment"> * Install a HiGig/HiGig2 PCAM entry that skips over</span>
<a name="l00559"></a>00559 <span class="comment"> * the header before parsing Layer-2 header for every</span>
<a name="l00560"></a>00560 <span class="comment"> * port configured for HiGig* support.</span>
<a name="l00561"></a>00561 <span class="comment"> */</span>
<a name="l00562"></a><a class="code" href="cvmx-higig_8h.html#acb926a64faa3b68cd10fcff9769c3d70">00562</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="cvmx-higig_8h.html#acb926a64faa3b68cd10fcff9769c3d70">__cvmx_pki_pcam_higig</a>(<span class="keywordtype">int</span> node, <span class="keywordtype">int</span> style, <span class="keywordtype">int</span> hsz)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564     <span class="keyword">struct </span><a class="code" href="structcvmx__pki__pcam__input.html">cvmx_pki_pcam_input</a> pcam_input;
<a name="l00565"></a>00565     <span class="keyword">struct </span><a class="code" href="structcvmx__pki__pcam__action.html">cvmx_pki_pcam_action</a> pcam_action;
<a name="l00566"></a>00566     <span class="keyword">enum</span> <a class="code" href="cvmx-pki_8h.html#ad985daf7f453c8157b505ed69e24e4a0">cvmx_pki_term</a> field;
<a name="l00567"></a>00567     <span class="keywordtype">int</span> index;
<a name="l00568"></a>00568     <span class="keywordtype">int</span> bank;
<a name="l00569"></a>00569     uint64_t cl_mask = <a class="code" href="cvmx-pki_8h.html#a0e527b99a59ab90d4b7563d0be5c6c26">CVMX_PKI_CLUSTER_ALL</a>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     memset(&amp;pcam_input, 0, <span class="keyword">sizeof</span>(pcam_input));
<a name="l00572"></a>00572     memset(&amp;pcam_action, 0, <span class="keyword">sizeof</span>(pcam_action));
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     field = <a class="code" href="cvmx-pki_8h.html#ad985daf7f453c8157b505ed69e24e4a0ab2d8018f1d5703373f3f9851e5ffeb43">CVMX_PKI_PCAM_TERM_HIGIG</a>;
<a name="l00575"></a>00575     bank = field &amp; 0x01;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     index = <a class="code" href="cvmx-pki-resources_8c.html#a78d234444b297ae628051f76ad4d2fe3" title="This function allocates/reserves a pcam entry from node.">cvmx_pki_pcam_entry_alloc</a>(node,
<a name="l00578"></a>00578         <a class="code" href="cvmx-pki_8h.html#ae3b7bf1ed53bdf5448a2929351e26401">CVMX_PKI_FIND_AVAL_ENTRY</a>, bank, cl_mask);
<a name="l00579"></a>00579     <span class="keywordflow">if</span> (index &lt; 0) {
<a name="l00580"></a>00580         <a class="code" href="cvmx-utils_8h.html#a50112e4e118a749dcf244ccafcdc37ba">cvmx_dprintf</a>(<span class="stringliteral">&quot;ERROR: Allocating pcam entry node=%d bank=%d\n&quot;</span>,
<a name="l00581"></a>00581             node, bank);
<a name="l00582"></a>00582         <span class="keywordflow">return</span> -1;
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a6e85fb76549e523c87bb3de510e5f072">style</a> = style;
<a name="l00586"></a>00586     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a7578eb680c83675100adbf7b4bff1558">style_mask</a> = 0xff;
<a name="l00587"></a>00587     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a390c160f2f74e9b7e7d2c912c50d189b">field</a> = field;
<a name="l00588"></a>00588     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a240d04b7bc6c606a47efd80b57f5baca">field_mask</a> = 0xff;
<a name="l00589"></a>00589     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a59449443ff896f2fa046a4fd8b2b6ad5">data</a> = 0;
<a name="l00590"></a>00590     pcam_input.<a class="code" href="structcvmx__pki__pcam__input.html#a1a9fbe0faf91fa765a5cb0625ff509a9">data_mask</a> = 0;
<a name="l00591"></a>00591     pcam_action.<a class="code" href="structcvmx__pki__pcam__action.html#a9fd1abb9614f9824e8d5ba5254b4ed45">parse_mode_chg</a> = <a class="code" href="cvmx-pki_8h.html#a9cc9d7cb4da581abb70ac3a898467af7ace52dabaa5590c744bd2a9426e472350">CVMX_PKI_PARSE_NO_CHG</a>;
<a name="l00592"></a>00592     pcam_action.<a class="code" href="structcvmx__pki__pcam__action.html#a0514397fd894df47cb57bf75253b3a60">layer_type_set</a> = <a class="code" href="cvmx-wqe_8h.html#a1192e8af58f86a0c2a890b74561dc679a827105058e1ac02521f9b4b90eeab597">CVMX_PKI_LTYPE_E_NONE</a>;
<a name="l00593"></a>00593     pcam_action.<a class="code" href="structcvmx__pki__pcam__action.html#a18a0ddead73b2f9a9a75d82f26284424">style_add</a> = 0;
<a name="l00594"></a>00594     pcam_action.<a class="code" href="structcvmx__pki__pcam__action.html#afbeaa508a3216177e4ea7b82ef79d961">pointer_advance</a> = hsz;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <a class="code" href="cvmx-pki_8c.html#a36c49d304bd5debffda4ed7a504a7a7e" title="This function writes pcam entry at given offset in pcam table in hardware.">cvmx_pki_pcam_write_entry</a>(node, index, cl_mask,
<a name="l00597"></a>00597             pcam_input, pcam_action);
<a name="l00598"></a>00598     <span class="keywordflow">return</span> 0;
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="cvmx-higig_8h.html#a3229c79885bd038e8751e62219180898">00601</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvmx-higig_8h.html#a3229c79885bd038e8751e62219180898">cvmx_higig_init_o3</a>(<span class="keywordtype">int</span> xiface, <span class="keywordtype">int</span> port, <span class="keywordtype">int</span> enable_higig2)
<a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <span class="keywordtype">int</span> header_size = (enable_higig2) ? 16 : 12;
<a name="l00604"></a>00604     <span class="keyword">struct </span><a class="code" href="structcvmx__pki__global__config.html">cvmx_pki_global_config</a> gcfg;
<a name="l00605"></a>00605         <span class="keyword">struct </span><a class="code" href="structcvmx__pki__pkind__config.html">cvmx_pki_pkind_config</a> pcfg;
<a name="l00606"></a>00606     <span class="keywordtype">int</span> pkind;
<a name="l00607"></a>00607     <a class="code" href="unioncvmx__bgxx__cmrx__config.html" title="cvmx_bgx::_cmr::_config">cvmx_bgxx_cmrx_config_t</a> cmr_config;
<a name="l00608"></a>00608     <a class="code" href="unioncvmx__bgxx__smux__rx__udd__skp.html" title="cvmx_bgx::_smu::_rx_udd_skp">cvmx_bgxx_smux_rx_udd_skp_t</a> udd_skip;
<a name="l00609"></a>00609     <a class="code" href="unioncvmx__bgxx__spux__misc__control.html" title="cvmx_bgx::_spu::_misc_control">cvmx_bgxx_spux_misc_control_t</a> misc_ctl;
<a name="l00610"></a>00610     <a class="code" href="unioncvmx__bgxx__smux__hg2__control.html" title="cvmx_bgx::_smu::_hg2_control">cvmx_bgxx_smux_hg2_control_t</a> hg2_control;
<a name="l00611"></a>00611     <a class="code" href="unioncvmx__bgxx__smux__tx__ifg.html" title="cvmx_bgx::_smu::_tx_ifg">cvmx_bgxx_smux_tx_ifg_t</a> ifg;
<a name="l00612"></a>00612     <a class="code" href="unioncvmx__bgxx__smux__rx__frm__ctl.html" title="cvmx_bgx::_smu::_rx_frm_ctl">cvmx_bgxx_smux_rx_frm_ctl_t</a> frm_ctl;
<a name="l00613"></a>00613     <a class="code" href="unioncvmx__bgxx__smux__tx__ctl.html" title="cvmx_bgx::_smu::_tx_ctl">cvmx_bgxx_smux_tx_ctl_t</a> tx_ctl;
<a name="l00614"></a>00614     <a class="code" href="unioncvmx__bgxx__smux__tx__append.html" title="cvmx_bgx::_smu::_tx_append">cvmx_bgxx_smux_tx_append_t</a> txa;
<a name="l00615"></a>00615     <a class="code" href="structcvmx__xiface.html">cvmx_xiface_t</a> xi = <a class="code" href="cvmx-helper-util_8h.html#a6144aa7baf9f7ce4c172351fc6d50e6f" title="Return node and interface number from XIFACE.">cvmx_helper_xiface_to_node_interface</a>(xiface);
<a name="l00616"></a>00616     <span class="keywordtype">int</span> node = xi.<a class="code" href="structcvmx__xiface.html#a5ed9a1f950ccfaf54f72a1dab8c9ad0e">node</a>;
<a name="l00617"></a>00617     <span class="keywordtype">int</span> interface = xi.<a class="code" href="structcvmx__xiface.html#ae37109b551c64eea96b5ad220e8a6027">interface</a>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="comment">/* Verify that the interface belongs to BGX */</span>
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (interface &gt;= <a class="code" href="cvmx-helper_8h.html#ad7f3c4e131747a30af8171f7ee59f394">CVMX_HELPER_MAX_GMX</a>)
<a name="l00621"></a>00621         <span class="keywordflow">return</span> -1;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623         cmr_config.<a class="code" href="unioncvmx__bgxx__cmrx__config.html#a13f114ccc68598a47f768648f8d4e67e">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00624"></a>00624         <a class="code" href="cvmx-bgxx-defs_8h.html#a7ee1fcd3432e2b34fe3e38ee8303a836" title="cvmx-bgxx-defs.h">CVMX_BGXX_CMRX_CONFIG</a>(port, interface));
<a name="l00625"></a>00625 
<a name="l00626"></a>00626     <span class="comment">/* HiGig is not supported for SGMII/XCV interfaces */</span>
<a name="l00627"></a>00627     <span class="keywordflow">if</span> ((cmr_config.<a class="code" href="unioncvmx__bgxx__cmrx__config.html#a9b9f1a0260906b63b6c45d6cd3065098">s</a>.<a class="code" href="structcvmx__bgxx__cmrx__config_1_1cvmx__bgxx__cmrx__config__s.html#af842e84757edce27992f42beb641bdd0">lmac_type</a> == 0) || (cmr_config.<a class="code" href="unioncvmx__bgxx__cmrx__config.html#a9b9f1a0260906b63b6c45d6cd3065098">s</a>.<a class="code" href="structcvmx__bgxx__cmrx__config_1_1cvmx__bgxx__cmrx__config__s.html#af842e84757edce27992f42beb641bdd0">lmac_type</a> == 5))
<a name="l00628"></a>00628         <span class="keywordflow">return</span> -2;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     <span class="comment">/*</span>
<a name="l00631"></a>00631 <span class="comment">     * NOTE: Code below assumes each BGX interface has</span>
<a name="l00632"></a>00632 <span class="comment">     * a unique PKIND, and a unuque initial STYLE.</span>
<a name="l00633"></a>00633 <span class="comment">     */</span>
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="comment">/* Setup PKI to handle HiGig: Global and PKIND */</span>
<a name="l00636"></a>00636     <a class="code" href="cvmx-pki_8c.html#a6826d2ba257bf5c1a80e61c23016b7af" title="This function reads global configuration of PKI block.">cvmx_pki_read_global_config</a>(node, &amp;gcfg);
<a name="l00637"></a>00637     gcfg.<a class="code" href="structcvmx__pki__global__config.html#aa4e6563db1996194ddeb1e039fe0a917" title="Controls Global parsing options for chip.">gbl_pen</a>.<a class="code" href="structcvmx__pki__global__parse.html#a0d5f4728db0cbb06a2647ec5d2593cd2" title="HiGig parsing enable.">hg_pen</a> = 1;
<a name="l00638"></a>00638     <a class="code" href="cvmx-pki_8c.html#a5338c761d00be6e06e57d4dd4e97ff49" title="This function writes global configuration of PKI into hw.">cvmx_pki_write_global_config</a>(node, &amp;gcfg);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     pkind = <a class="code" href="cvmx-helper-util_8c.html#a2e063bd86eddaab06d8962136d3c958d" title="Get port kind for a given port in an interface.">cvmx_helper_get_pknd</a>(xiface, port);
<a name="l00641"></a>00641     <a class="code" href="cvmx-pki_8c.html#a6ee9f2962c3b18fc7e34820220c974ef" title="This function reads per pkind parameters in hardware which defines how the incoming...">cvmx_pki_read_pkind_config</a>(node, pkind, &amp;pcfg);
<a name="l00642"></a>00642         pcfg.<a class="code" href="structcvmx__pki__pkind__config.html#a5a1a9e40617f4cd0a38a9c5f6a60b4f5">parse_en</a>.<a class="code" href="structcvmx__pki__pkind__parse.html#a8c3ddf43c1a824884cad0a8f2a3872be" title="Enable HiGig parsing.">hg_en</a> = 1;
<a name="l00643"></a>00643         pcfg.<a class="code" href="structcvmx__pki__pkind__config.html#a5a1a9e40617f4cd0a38a9c5f6a60b4f5">parse_en</a>.<a class="code" href="structcvmx__pki__pkind__parse.html#a629f4b726dec916c5be393f56e4bcc34" title="Enable HiGig 2 parsing.">hg2_en</a> = (enable_higig2)? 1: 0;
<a name="l00644"></a>00644     <a class="code" href="cvmx-pki_8c.html#ac2626f908a43f431346b020ace48353e" title="This function writes per pkind parameters in hardware which defines how the incoming...">cvmx_pki_write_pkind_config</a>(node, pkind, &amp;pcfg);
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="comment">/* PKI: Install a PCAM entry to skip HiGiG/HiGiG2 header in parser */</span>
<a name="l00647"></a>00647     <a class="code" href="cvmx-higig_8h.html#acb926a64faa3b68cd10fcff9769c3d70">__cvmx_pki_pcam_higig</a>(node, pcfg.<a class="code" href="structcvmx__pki__pkind__config.html#a08a5640e52174b2f95160050ea93d6d0" title="Skip amount from front of packet to begin parsing at.">initial_style</a>, header_size);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     <span class="comment">/* BGX: Reduce Inter-frame gap from 12 to 8 bytes */</span>
<a name="l00650"></a>00650     ifg.<a class="code" href="unioncvmx__bgxx__smux__tx__ifg.html#a7ba980c7a9d5dbd0181aaad421bcefd9">u64</a> = 0;
<a name="l00651"></a>00651     ifg.<a class="code" href="unioncvmx__bgxx__smux__tx__ifg.html#acf934845b432c16a5b85828b1bb0651e">s</a>.<a class="code" href="structcvmx__bgxx__smux__tx__ifg_1_1cvmx__bgxx__smux__tx__ifg__s.html#a244e71c88bafdce274e925bdf107be8c">ifg1</a> = 4;
<a name="l00652"></a>00652     ifg.<a class="code" href="unioncvmx__bgxx__smux__tx__ifg.html#acf934845b432c16a5b85828b1bb0651e">s</a>.<a class="code" href="structcvmx__bgxx__smux__tx__ifg_1_1cvmx__bgxx__smux__tx__ifg__s.html#ae892d63db0a142db2e172573cf436cc7">ifg2</a> = 4;
<a name="l00653"></a>00653     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node, <a class="code" href="cvmx-bgxx-defs_8h.html#aa29b71613c33259e81e8191d3d3ba54b">CVMX_BGXX_SMUX_TX_IFG</a>(port, interface), ifg.<a class="code" href="unioncvmx__bgxx__smux__tx__ifg.html#a7ba980c7a9d5dbd0181aaad421bcefd9">u64</a>);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655     <span class="comment">/* BGX: Configure user-data length to HiGig2 header size */</span>
<a name="l00656"></a>00656     udd_skip.<a class="code" href="unioncvmx__bgxx__smux__rx__udd__skp.html#a72571a7a04c2c6fd8ef1b737d71dcb5a">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00657"></a>00657         <a class="code" href="cvmx-bgxx-defs_8h.html#abeea177a079b0d1a52149c6d83c19257">CVMX_BGXX_SMUX_RX_UDD_SKP</a>(port, interface));
<a name="l00658"></a>00658     udd_skip.<a class="code" href="unioncvmx__bgxx__smux__rx__udd__skp.html#a14a2bc3a3dab67c4e743b6bd0f265288">s</a>.<a class="code" href="structcvmx__bgxx__smux__rx__udd__skp_1_1cvmx__bgxx__smux__rx__udd__skp__s.html#aaa192ecaa369049b1ad8c2dbad06a7ee">fcssel</a> = 0;
<a name="l00659"></a>00659     udd_skip.<a class="code" href="unioncvmx__bgxx__smux__rx__udd__skp.html#a14a2bc3a3dab67c4e743b6bd0f265288">s</a>.<a class="code" href="structcvmx__bgxx__smux__rx__udd__skp_1_1cvmx__bgxx__smux__rx__udd__skp__s.html#aeed4a868dda8af8feae0b30006128c2a">len</a> = header_size;
<a name="l00660"></a>00660     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00661"></a>00661         <a class="code" href="cvmx-bgxx-defs_8h.html#abeea177a079b0d1a52149c6d83c19257">CVMX_BGXX_SMUX_RX_UDD_SKP</a>(port, interface), udd_skip.<a class="code" href="unioncvmx__bgxx__smux__rx__udd__skp.html#a72571a7a04c2c6fd8ef1b737d71dcb5a">u64</a>);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">/* BGX: Enable more idle skips for small IFG (SMU only) */</span>
<a name="l00664"></a>00664     misc_ctl.<a class="code" href="unioncvmx__bgxx__spux__misc__control.html#aebeb40d856213959d937e697ba594883">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00665"></a>00665         <a class="code" href="cvmx-bgxx-defs_8h.html#afb5187fbd58171264807bc6de37e0ac7">CVMX_BGXX_SPUX_MISC_CONTROL</a>(port, interface));
<a name="l00666"></a>00666     misc_ctl.<a class="code" href="unioncvmx__bgxx__spux__misc__control.html#ad2f0a9dd807ba6f73762c5c0c12635af">s</a>.<a class="code" href="structcvmx__bgxx__spux__misc__control_1_1cvmx__bgxx__spux__misc__control__s.html#ae1d2926f77565db4f682fd9eb26d9d44">skip_after_term</a> = 1;
<a name="l00667"></a>00667     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00668"></a>00668         <a class="code" href="cvmx-bgxx-defs_8h.html#afb5187fbd58171264807bc6de37e0ac7">CVMX_BGXX_SPUX_MISC_CONTROL</a>(port, interface), misc_ctl.<a class="code" href="unioncvmx__bgxx__spux__misc__control.html#aebeb40d856213959d937e697ba594883">u64</a>);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="comment">/* BGX HiGig2 control (SMU only) */</span>
<a name="l00671"></a>00671     hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#a33be4f144a2e8b61b7c8f9248ba066fd">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00672"></a>00672         <a class="code" href="cvmx-bgxx-defs_8h.html#aa4d276c6032af61988e4a5380b89158f">CVMX_BGXX_SMUX_HG2_CONTROL</a>(port, interface));
<a name="l00673"></a>00673     hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#ae9f7ab9c9d0df7374428e75e1ce62dee">s</a>.<a class="code" href="structcvmx__bgxx__smux__hg2__control_1_1cvmx__bgxx__smux__hg2__control__s.html#a2b89880cc711b18ee9a2626b3542b78d">hg2tx_en</a> = (enable_higig2) ? 1 : 0;
<a name="l00674"></a>00674     hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#ae9f7ab9c9d0df7374428e75e1ce62dee">s</a>.<a class="code" href="structcvmx__bgxx__smux__hg2__control_1_1cvmx__bgxx__smux__hg2__control__s.html#ae33ed162bcfba76fc0cbbd4943fa9d08">hg2rx_en</a> = (enable_higig2) ? 1 : 0;
<a name="l00675"></a>00675     hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#ae9f7ab9c9d0df7374428e75e1ce62dee">s</a>.<a class="code" href="structcvmx__bgxx__smux__hg2__control_1_1cvmx__bgxx__smux__hg2__control__s.html#acdf396fc535034f9314e36b9ef79a288">phys_en</a> = (enable_higig2) ? 1 : 0;
<a name="l00676"></a>00676     hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#ae9f7ab9c9d0df7374428e75e1ce62dee">s</a>.<a class="code" href="structcvmx__bgxx__smux__hg2__control_1_1cvmx__bgxx__smux__hg2__control__s.html#ace493a2dbb7118fd5f3274b50c290542">logl_en</a> = (enable_higig2) ? 1 : 0;
<a name="l00677"></a>00677     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00678"></a>00678         <a class="code" href="cvmx-bgxx-defs_8h.html#aa4d276c6032af61988e4a5380b89158f">CVMX_BGXX_SMUX_HG2_CONTROL</a>(port, interface), hg2_control.<a class="code" href="unioncvmx__bgxx__smux__hg2__control.html#a33be4f144a2e8b61b7c8f9248ba066fd">u64</a>);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="comment">/* BGX RX Control - Disable preamble checks */</span>
<a name="l00681"></a>00681     frm_ctl.<a class="code" href="unioncvmx__bgxx__smux__rx__frm__ctl.html#a4e62e64eb2a722c7fbe4ff22b5a340b1">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00682"></a>00682         <a class="code" href="cvmx-bgxx-defs_8h.html#a1662632590e01531075a8642d596ac3e">CVMX_BGXX_SMUX_RX_FRM_CTL</a>(port, interface));
<a name="l00683"></a>00683     frm_ctl.<a class="code" href="unioncvmx__bgxx__smux__rx__frm__ctl.html#a035c175c26214ad70af27afc66a94ace">s</a>.<a class="code" href="structcvmx__bgxx__smux__rx__frm__ctl_1_1cvmx__bgxx__smux__rx__frm__ctl__s.html#ab1233179d656164739d0fbd05a03f2de">pre_chk</a> = 0;
<a name="l00684"></a>00684     frm_ctl.<a class="code" href="unioncvmx__bgxx__smux__rx__frm__ctl.html#a035c175c26214ad70af27afc66a94ace">s</a>.<a class="code" href="structcvmx__bgxx__smux__rx__frm__ctl_1_1cvmx__bgxx__smux__rx__frm__ctl__s.html#a3fde483fb4e73b653cba6ab22d3d06a3">pre_strp</a> = 0;
<a name="l00685"></a>00685     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00686"></a>00686         <a class="code" href="cvmx-bgxx-defs_8h.html#a1662632590e01531075a8642d596ac3e">CVMX_BGXX_SMUX_RX_FRM_CTL</a>(port, interface), frm_ctl.<a class="code" href="unioncvmx__bgxx__smux__rx__frm__ctl.html#a4e62e64eb2a722c7fbe4ff22b5a340b1">u64</a>);
<a name="l00687"></a>00687 
<a name="l00688"></a>00688     <span class="comment">/* BGX TX Control */</span>
<a name="l00689"></a>00689     tx_ctl.<a class="code" href="unioncvmx__bgxx__smux__tx__ctl.html#a6a423ed9673e7d0583765a2638c2ca0b">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00690"></a>00690         <a class="code" href="cvmx-bgxx-defs_8h.html#ab09ae5f37d408ebeaf38b6183e0b73e2">CVMX_BGXX_SMUX_TX_CTL</a>(port, interface));
<a name="l00691"></a>00691     tx_ctl.<a class="code" href="unioncvmx__bgxx__smux__tx__ctl.html#a23b6eda92a8e9065d856eeb9e1e4edf3">s</a>.<a class="code" href="structcvmx__bgxx__smux__tx__ctl_1_1cvmx__bgxx__smux__tx__ctl__s.html#acb3af24474bdca79a833bea59cf2d00b">hg_en</a> = 1;
<a name="l00692"></a>00692     tx_ctl.<a class="code" href="unioncvmx__bgxx__smux__tx__ctl.html#a23b6eda92a8e9065d856eeb9e1e4edf3">s</a>.<a class="code" href="structcvmx__bgxx__smux__tx__ctl_1_1cvmx__bgxx__smux__tx__ctl__s.html#a892460e675f3c022d7589814dd502953">hg_pause_hgi</a> = (enable_higig2)? 1: 0;
<a name="l00693"></a>00693     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00694"></a>00694         <a class="code" href="cvmx-bgxx-defs_8h.html#ab09ae5f37d408ebeaf38b6183e0b73e2">CVMX_BGXX_SMUX_TX_CTL</a>(port, interface), tx_ctl.<a class="code" href="unioncvmx__bgxx__smux__tx__ctl.html#a6a423ed9673e7d0583765a2638c2ca0b">u64</a>);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     txa.<a class="code" href="unioncvmx__bgxx__smux__tx__append.html#a76f3229fe2f50dbe7da3f2f8a1168cf7">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00697"></a>00697         <a class="code" href="cvmx-bgxx-defs_8h.html#a6bd0131ceb8d04c0afc50c321baae20b">CVMX_BGXX_SMUX_TX_APPEND</a>(port, interface));
<a name="l00698"></a>00698     txa.<a class="code" href="unioncvmx__bgxx__smux__tx__append.html#ab07ce1ba878c169fdcf61d046bee8492">s</a>.<a class="code" href="structcvmx__bgxx__smux__tx__append_1_1cvmx__bgxx__smux__tx__append__s.html#a65c803bf6d655f55c22fdb592f36b8fc">preamble</a> = 0;
<a name="l00699"></a>00699     <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00700"></a>00700         <a class="code" href="cvmx-bgxx-defs_8h.html#a6bd0131ceb8d04c0afc50c321baae20b">CVMX_BGXX_SMUX_TX_APPEND</a>(port, interface), txa.<a class="code" href="unioncvmx__bgxx__smux__tx__append.html#a76f3229fe2f50dbe7da3f2f8a1168cf7">u64</a>);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment">/* Disable standard flow control for HiGig2 */</span>
<a name="l00703"></a>00703     <span class="keywordflow">if</span> (enable_higig2) {
<a name="l00704"></a>00704         <a class="code" href="unioncvmx__bgxx__smux__cbfc__ctl.html" title="cvmx_bgx::_smu::_cbfc_ctl">cvmx_bgxx_smux_cbfc_ctl_t</a> cbfc_ctl;
<a name="l00705"></a>00705         cbfc_ctl.<a class="code" href="unioncvmx__bgxx__smux__cbfc__ctl.html#a16cd95d527abb0f4cbe5ef540488af08">u64</a> = <a class="code" href="cvmx-access_8h.html#a2b50ee7713f0744b1fef03cfa4c1b670">cvmx_read_csr_node</a>(node,
<a name="l00706"></a>00706             <a class="code" href="cvmx-bgxx-defs_8h.html#a9689e6840958d2e404a0d6b94332e42b">CVMX_BGXX_SMUX_CBFC_CTL</a>(port, interface));
<a name="l00707"></a>00707         cbfc_ctl.<a class="code" href="unioncvmx__bgxx__smux__cbfc__ctl.html#a1370ef36678df0ea0b6e3d40ffd65f83">s</a>.<a class="code" href="structcvmx__bgxx__smux__cbfc__ctl_1_1cvmx__bgxx__smux__cbfc__ctl__s.html#a7b7764da34b7b08ba0876e40d5634572">rx_en</a> = 0;
<a name="l00708"></a>00708         cbfc_ctl.<a class="code" href="unioncvmx__bgxx__smux__cbfc__ctl.html#a1370ef36678df0ea0b6e3d40ffd65f83">s</a>.<a class="code" href="structcvmx__bgxx__smux__cbfc__ctl_1_1cvmx__bgxx__smux__cbfc__ctl__s.html#a82afcab11e87aed06229e5d09183f971">tx_en</a> = 0;
<a name="l00709"></a>00709         <a class="code" href="cvmx-access_8h.html#a16bdc1b4b931bdd49740231c004c7ef4">cvmx_write_csr_node</a>(node,
<a name="l00710"></a>00710             <a class="code" href="cvmx-bgxx-defs_8h.html#a9689e6840958d2e404a0d6b94332e42b">CVMX_BGXX_SMUX_CBFC_CTL</a>(port, interface),
<a name="l00711"></a>00711             cbfc_ctl.<a class="code" href="unioncvmx__bgxx__smux__cbfc__ctl.html#a16cd95d527abb0f4cbe5ef540488af08">u64</a>);
<a name="l00712"></a>00712     }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714     <span class="comment">/* Configure PKO */</span>
<a name="l00715"></a>00715 
<a name="l00716"></a>00716     <span class="comment">/*</span>
<a name="l00717"></a>00717 <span class="comment">     * NOTE:</span>
<a name="l00718"></a>00718 <span class="comment">     * PKO3 has only a global min packet register,</span>
<a name="l00719"></a>00719 <span class="comment">     * which is not appropriate for HiGig.</span>
<a name="l00720"></a>00720 <span class="comment">     */</span>
<a name="l00721"></a>00721 
<a name="l00722"></a>00722     <span class="comment">/*</span>
<a name="l00723"></a>00723 <span class="comment">     * FIXME:</span>
<a name="l00724"></a>00724 <span class="comment">     * HiGig QoS not implemented yet, may require PKI microcode fix.</span>
<a name="l00725"></a>00725 <span class="comment">     */</span>
<a name="l00726"></a>00726     <span class="keywordflow">return</span> 0;
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 <span class="comment"></span>
<a name="l00729"></a>00729 <span class="comment">/**</span>
<a name="l00730"></a>00730 <span class="comment"> * Initialize the HiGig aspects of a XAUI interface. This function</span>
<a name="l00731"></a>00731 <span class="comment"> * should be called before the cvmx-helper generic init.</span>
<a name="l00732"></a>00732 <span class="comment"> *</span>
<a name="l00733"></a>00733 <span class="comment"> * @param interface Interface that this operation applies to</span>
<a name="l00734"></a>00734 <span class="comment"> * @param port is the interface port the operation applies to</span>
<a name="l00735"></a>00735 <span class="comment"> * @param enable_higig2</span>
<a name="l00736"></a>00736 <span class="comment"> *                  Non zero to enable HiGig2 support. Zero to support HiGig</span>
<a name="l00737"></a>00737 <span class="comment"> *                  and HiGig+.</span>
<a name="l00738"></a>00738 <span class="comment"> *</span>
<a name="l00739"></a>00739 <span class="comment"> * @return Zero on success, negative on failure</span>
<a name="l00740"></a>00740 <span class="comment"> *</span>
<a name="l00741"></a>00741 <span class="comment"> * NOTE:</span>
<a name="l00742"></a>00742 <span class="comment"> * This function name and signature has changed from previous releases</span>
<a name="l00743"></a>00743 <span class="comment"> * to support Octeon-3, where each interface may have up to 4 ports,</span>
<a name="l00744"></a>00744 <span class="comment"> * and each may be individually enabled to accept the HiGig/HiGig2 custom</span>
<a name="l00745"></a>00745 <span class="comment"> * frame format.</span>
<a name="l00746"></a>00746 <span class="comment"> */</span>
<a name="l00747"></a><a class="code" href="cvmx-higig_8h.html#a588d39e20211ba9976439688c837aa41">00747</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="cvmx-higig_8h.html#a588d39e20211ba9976439688c837aa41" title="Initialize the HiGig aspects of a XAUI interface.">cvmx_higig_init</a>(<span class="keywordtype">int</span> interface, <span class="keywordtype">int</span> port, <span class="keywordtype">int</span> enable_higig2)
<a name="l00748"></a>00748 {
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (<a class="code" href="octeon-feature_8h.html#aff993843ac5c34fbf4ce933f7274e2f9">octeon_has_feature</a>(<a class="code" href="octeon-feature_8h.html#ae50822e9c863ca2dea27ff57d39ba3d7a26ef4abb4a4fcbba59ae3fd0553cbcab" title="Octeon has PKI block.">OCTEON_FEATURE_PKI</a>)) {
<a name="l00751"></a>00751         <span class="keywordflow">return</span> <a class="code" href="cvmx-higig_8h.html#a3229c79885bd038e8751e62219180898">cvmx_higig_init_o3</a>(interface, port, enable_higig2);
<a name="l00752"></a>00752     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="octeon-model_8h.html#a9234ac9e9f35fafd7fe5eedd37c9b552">OCTEON_IS_MODEL</a>(<a class="code" href="octeon-model_8h.html#ad28aa505bb4f34bb5f894ca14a8b7ba3">OCTEON_CN68XX</a>)) {
<a name="l00753"></a>00753         <a class="code" href="cvmx-warn_8h.html#a9265e9aa6f9df93b7d821006ae64fa1a">cvmx_warn_if</a>(port != 0, <span class="stringliteral">&quot;Interface port range exceeded&quot;</span>);
<a name="l00754"></a>00754         <span class="keywordflow">return</span> <a class="code" href="cvmx-higig_8h.html#a5272793f330e208a91118e035aae11f1">cvmx_higig_init_o68</a>(interface, enable_higig2);
<a name="l00755"></a>00755     } <span class="keywordflow">else</span> {
<a name="l00756"></a>00756         <a class="code" href="cvmx-warn_8h.html#a9265e9aa6f9df93b7d821006ae64fa1a">cvmx_warn_if</a>(port != 0, <span class="stringliteral">&quot;Interface port range exceeded&quot;</span>);
<a name="l00757"></a>00757         <span class="keywordflow">return</span> <a class="code" href="cvmx-higig_8h.html#a5cd93a2ad4c90f299a331ade527e048f">cvmx_higig_init_o1</a>(interface, enable_higig2);
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762 <span class="preprocessor">#ifdef  __cplusplus</span>
<a name="l00763"></a>00763 <span class="preprocessor"></span><span class="comment">/* *INDENT-OFF* */</span>
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 <span class="comment">/* *INDENT-ON* */</span>
<a name="l00766"></a>00766 <span class="preprocessor">#endif</span>
<a name="l00767"></a>00767 <span class="preprocessor"></span>
<a name="l00768"></a>00768 <span class="preprocessor">#endif //  __CVMX_HIGIG_H__</span>
<a name="l00769"></a>00769 <span class="preprocessor"></span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
