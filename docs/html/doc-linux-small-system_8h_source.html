<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: doc-linux-small-system.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>doc-linux-small-system.h</h1><a href="doc-linux-small-system_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************license start************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * OCTEON SDK</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2007 Cavium Inc.. All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This file, which is part of the OCTEON SDK from Cavium Inc.,</span>
<a name="l00007"></a>00007 <span class="comment"> * contains proprietary and confidential information of Cavium Inc. and</span>
<a name="l00008"></a>00008 <span class="comment"> * its suppliers.</span>
<a name="l00009"></a>00009 <span class="comment"> * Contact Cavium Inc. at info@cavium.com for more information.</span>
<a name="l00010"></a>00010 <span class="comment"> **********************license end**************************************/</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">/**</span>
<a name="l00013"></a>00013 <span class="comment"> * @file</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Octeon Linux for Small Systems documentation source.</span>
<a name="l00016"></a>00016 <span class="comment"> * @ref linux_small</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/**</span>
<a name="l00020"></a>00020 <span class="comment"> @page linux_small Linux on Small OCTEON Systems</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">@section linux_small_intro 1. Introduction</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">Running Linux on OCTEON systems with 256MB of memory or less may require a</span>
<a name="l00025"></a>00025 <span class="comment">slightly different setup than the SDK provides.  In these systems, the</span>
<a name="l00026"></a>00026 <span class="comment">normal kernel configuration wastes memory on options normally not used in</span>
<a name="l00027"></a>00027 <span class="comment">these systems. Smaller systems can gain access to this memory using a</span>
<a name="l00028"></a>00028 <span class="comment">different kernel setup.</span>
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">- @ref linux_small_intro</span>
<a name="l00031"></a>00031 <span class="comment">- @ref linux_small_kernel_memory_saving_tips</span>
<a name="l00032"></a>00032 <span class="comment">- @ref linux_small_flash_layout</span>
<a name="l00033"></a>00033 <span class="comment">- @ref linux_small_kernel_in_flash</span>
<a name="l00034"></a>00034 <span class="comment">- @ref linux_small_rootfs</span>
<a name="l00035"></a>00035 <span class="comment">- @ref linux_small_cramfs_rootfs</span>
<a name="l00036"></a>00036 <span class="comment">- @ref linux_small_usb_rootfs</span>
<a name="l00037"></a>00037 <span class="comment">- @ref linux_small_shrink_rootfs</span>
<a name="l00038"></a>00038 <span class="comment">- @ref linux_small_final_boot</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">@section linux_small_kernel_memory_saving_tips 2. Kernel memory saving tips</span>
<a name="l00041"></a>00041 <span class="comment"></span>
<a name="l00042"></a>00042 <span class="comment">Here are some simple tips to save memory in the Linux kernel.</span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">- Disable SMP support on single CPU systems (Saves 512KB)</span>
<a name="l00045"></a>00045 <span class="comment">    - Kernel type -&gt;</span>
<a name="l00046"></a>00046 <span class="comment">    [ ] Multi-Processing support</span>
<a name="l00047"></a>00047 <span class="comment">- Use FLATMEM instead of SPARSEMEM (Saves 40KB)</span>
<a name="l00048"></a>00048 <span class="comment">    - Kernel type -&gt;</span>
<a name="l00049"></a>00049 <span class="comment">    Memory model -&gt;</span>
<a name="l00050"></a>00050 <span class="comment">    Flat Memory</span>
<a name="l00051"></a>00051 <span class="comment">- Disable unneeded drivers</span>
<a name="l00052"></a>00052 <span class="comment">- Disable unneeded network options</span>
<a name="l00053"></a>00053 <span class="comment">- Disable kernel debug information</span>
<a name="l00054"></a>00054 <span class="comment">    - Kernel hacking -&gt;</span>
<a name="l00055"></a>00055 <span class="comment">    [ ] Kernel debugging</span>
<a name="l00056"></a>00056 <span class="comment">- Disable kernel symbols (Saves 20KB)</span>
<a name="l00057"></a>00057 <span class="comment">    - General setup -&gt;</span>
<a name="l00058"></a>00058 <span class="comment">    Configure standard kernel features (for small systems) -&gt;</span>
<a name="l00059"></a>00059 <span class="comment">    [ ]   Load all symbols for debugging/kksymoops</span>
<a name="l00060"></a>00060 <span class="comment">- Reduce the number of packet buffers allcoated by the etherent driver. Due to</span>
<a name="l00061"></a>00061 <span class="comment">alignment constraints, these buffers are very large and consume memory quickly.</span>
<a name="l00062"></a>00062 <span class="comment">The default is 1024 buffers.</span>
<a name="l00063"></a>00063 <span class="comment">    - Device Drivers ---&gt;</span>
<a name="l00064"></a>00064 <span class="comment">          [*] Network device support ---&gt;</span>
<a name="l00065"></a>00065 <span class="comment">              [*] Ethernet (1000 Mbit) ---&gt;</span>
<a name="l00066"></a>00066 <span class="comment">    (1024) Number of packet buffers (and work queue entries) for the Ethernet driver</span>
<a name="l00067"></a>00067 <span class="comment">- Disable Octeon specific drivers</span>
<a name="l00068"></a>00068 <span class="comment">        - Machine selection ---&gt;</span>
<a name="l00069"></a>00069 <span class="comment">        [ ] Octeon NAND driver</span>
<a name="l00070"></a>00070 <span class="comment">        [ ] Enable support for Octeon Serial Rapid IO</span>
<a name="l00071"></a>00071 <span class="comment">        [ ] Decode RSL interrupt conditions.</span>
<a name="l00072"></a>00072 <span class="comment">- Disable profiling support</span>
<a name="l00073"></a>00073 <span class="comment">    - General setup ---&gt;</span>
<a name="l00074"></a>00074 <span class="comment">    Configure standard kernel features (for small systems) -&gt;</span>
<a name="l00075"></a>00075 <span class="comment">        [ ] Profiling support (EXPERIMENTAL)</span>
<a name="l00076"></a>00076 <span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">@section linux_small_flash_layout 3. Setting up the boot flash</span>
<a name="l00078"></a>00078 <span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">Using the standard OCTEON bootloader, the first 2048KB  of flash is</span>
<a name="l00080"></a>00080 <span class="comment">reserved for the bootloader.  The last flash region is used for the</span>
<a name="l00081"></a>00081 <span class="comment">bootloader environment.  This leaves all flash in between available.</span>
<a name="l00082"></a>00082 <span class="comment">Normal systems divide this area into separate partitions for each major</span>
<a name="l00083"></a>00083 <span class="comment">system component.  For example, you may wish to divide an 8MB flash into</span>
<a name="l00084"></a>00084 <span class="comment">multiple partitions.</span>
<a name="l00085"></a>00085 <span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">@verbatim</span>
<a name="l00087"></a>00087 <span class="comment">    2048KB      Failsafe bootloader+Normal bootloader</span>
<a name="l00088"></a>00088 <span class="comment">    2MB     Compressed kernel</span>
<a name="l00089"></a>00089 <span class="comment">    3.5MB       cramfs root filesystem</span>
<a name="l00090"></a>00090 <span class="comment">    256KB       JFFS2 filesystem</span>
<a name="l00091"></a>00091 <span class="comment">    256KB       Bootloader environment</span>
<a name="l00092"></a>00092 <span class="comment">@endverbatim</span>
<a name="l00093"></a>00093 <span class="comment"></span>
<a name="l00094"></a>00094 <span class="comment">The kernel needs to know the flash layout.  This is controlled with the</span>
<a name="l00095"></a>00095 <span class="comment">kernel @b mtdparts command line option.  Here is the mtdparts option for</span>
<a name="l00096"></a>00096 <span class="comment">the above flash layout.  Note that the bootloader partitions are marked</span>
<a name="l00097"></a>00097 <span class="comment">read only for safety.</span>
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">@verbatim</span>
<a name="l00100"></a>00100 <span class="comment">bootoctlinux &lt;address&gt; mtdparts=phys_mapped_flash:2048k(bootloader)ro,2048k(kernel),3072k(cramfs),256k(jffs2),256k(bootloader_env)ro</span>
<a name="l00101"></a>00101 <span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">Check your partitioning:</span>
<a name="l00103"></a>00103 <span class="comment">    $ cat /proc/mtd</span>
<a name="l00104"></a>00104 <span class="comment">    dev:    size   erasesize  name</span>
<a name="l00105"></a>00105 <span class="comment">    mtd0: 00200000 00010000 &quot;bootloader&quot;</span>
<a name="l00106"></a>00106 <span class="comment">    mtd1: 00200000 00010000 &quot;kernel&quot;</span>
<a name="l00107"></a>00107 <span class="comment">    mtd2: 00300000 00010000 &quot;cramfs&quot;</span>
<a name="l00108"></a>00108 <span class="comment">    mtd3: 00040000 00010000 &quot;jffs2&quot;</span>
<a name="l00109"></a>00109 <span class="comment">    mtd4: 00040000 00010000 &quot;bootloader_env&quot;</span>
<a name="l00110"></a>00110 <span class="comment">@endverbatim</span>
<a name="l00111"></a>00111 <span class="comment"></span>
<a name="l00112"></a>00112 <span class="comment"></span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">@section linux_small_kernel_in_flash 4. Putting the kernel into flash</span>
<a name="l00115"></a>00115 <span class="comment"></span>
<a name="l00116"></a>00116 <span class="comment">In the previous section we setup a flash region for storing the kernel. This</span>
<a name="l00117"></a>00117 <span class="comment">region started at 2048KB and extended for 4MB. Since this region is smaller</span>
<a name="l00118"></a>00118 <span class="comment">than a normal kernel, lzma will be used to compress the kernel. The final</span>
<a name="l00119"></a>00119 <span class="comment">compressed image must be less than 2.0MB.</span>
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">@verbatim</span>
<a name="l00122"></a>00122 <span class="comment">    lzma -9 vmlinux.64</span>
<a name="l00123"></a>00123 <span class="comment">@endverbatim</span>
<a name="l00124"></a>00124 <span class="comment"></span>
<a name="l00125"></a>00125 <span class="comment">@note This is the kernel only, without any filesystem. This should have been</span>
<a name="l00126"></a>00126 <span class="comment">built using &lt;b&gt;make kernel-deb&lt;/b&gt; in the top level linux directory.</span>
<a name="l00127"></a>00127 <span class="comment"></span>
<a name="l00128"></a>00128 <span class="comment">As an example of how to get the kernel into flash, we are going to TFTP it</span>
<a name="l00129"></a>00129 <span class="comment">from a remote server. Here are the commands to TFTP the file from the server</span>
<a name="l00130"></a>00130 <span class="comment">192.168.16.39</span>
<a name="l00131"></a>00131 <span class="comment"></span>
<a name="l00132"></a>00132 <span class="comment">&lt;b&gt;Bootloader commands:&lt;/b&gt;</span>
<a name="l00133"></a>00133 <span class="comment">@verbatim</span>
<a name="l00134"></a>00134 <span class="comment">dhcp</span>
<a name="l00135"></a>00135 <span class="comment">setenv serverip 192.168.16.39</span>
<a name="l00136"></a>00136 <span class="comment">setenv autoload no</span>
<a name="l00137"></a>00137 <span class="comment">tftpboot $(loadaddr) vmlinux.64.lzma</span>
<a name="l00138"></a>00138 <span class="comment">@endverbatim</span>
<a name="l00139"></a>00139 <span class="comment"></span>
<a name="l00140"></a>00140 <span class="comment">The next step is to burn the kernel to flash. Be careful here, you can</span>
<a name="l00141"></a>00141 <span class="comment">mistakenly destroy the contents of the entire flash. First thing to do</span>
<a name="l00142"></a>00142 <span class="comment">is figure out the correct addresses and sizes for flash commands.</span>
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">- For an 8MB flash, the start address is 0x1f400000. This should always be</span>
<a name="l00145"></a>00145 <span class="comment">0x1fc00000 minus the size of the flash.</span>
<a name="l00146"></a>00146 <span class="comment">- The kernel region starts 2048KB into the flash, 0x1f400000+2048KB = 0x1f600000</span>
<a name="l00147"></a>00147 <span class="comment">- The kernel size is 2MB, 0x200000</span>
<a name="l00148"></a>00148 <span class="comment">- The kernel region ends 4MB into the flash, 0x1f400000+2048KB+2MB-1 = 0x1f7fffff</span>
<a name="l00149"></a>00149 <span class="comment">- We loaded the kernel image into memory at $(loadaddr)</span>
<a name="l00150"></a>00150 <span class="comment"></span>
<a name="l00151"></a>00151 <span class="comment">&lt;b&gt;Bootloader commands:&lt;/b&gt;</span>
<a name="l00152"></a>00152 <span class="comment">@verbatim</span>
<a name="l00153"></a>00153 <span class="comment">erase 0x1f600000 0x1f7fffff erase &lt;kernel flash start&gt; &lt;kernel flash end&gt;</span>
<a name="l00154"></a>00154 <span class="comment">cp.b $(fileaddr) 0x1f600000 0x200000  # cp.b &lt;memory image&gt; &lt;kernel flash start&gt; &lt;size&gt;</span>
<a name="l00155"></a>00155 <span class="comment">@endverbatim</span>
<a name="l00156"></a>00156 <span class="comment"></span>
<a name="l00157"></a>00157 <span class="comment"></span>
<a name="l00158"></a>00158 <span class="comment"></span>
<a name="l00159"></a>00159 <span class="comment">@section linux_small_rootfs 5. Handling the root filesystem</span>
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">You have a number of options for where the Linux root filesystem goes. The SDK</span>
<a name="l00162"></a>00162 <span class="comment">&lt;b&gt;make kernel&lt;/b&gt; target creates a kernel with the root filesystem embedded</span>
<a name="l00163"></a>00163 <span class="comment">inside the kernel. While this works well in development, production systems</span>
<a name="l00164"></a>00164 <span class="comment">need to store the filesystem separately from the kernel. Below, there are two</span>
<a name="l00165"></a>00165 <span class="comment">examples for you to build upon. One puts the filesystem in flash using cramfs,</span>
<a name="l00166"></a>00166 <span class="comment">the other puts it on a USB device. There are many other possibilities, these are</span>
<a name="l00167"></a>00167 <span class="comment">just two of the common choices.</span>
<a name="l00168"></a>00168 <span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment"></span>
<a name="l00170"></a>00170 <span class="comment"></span>
<a name="l00171"></a>00171 <span class="comment">@section linux_small_cramfs_rootfs 6. Using CRAMFS in flash for a root filesystem</span>
<a name="l00172"></a>00172 <span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">Before attempting to put a cramfs into flash, you will first need to build the</span>
<a name="l00174"></a>00174 <span class="comment">image. The embedded rootfs make system supports generating a cramfs for you.</span>
<a name="l00175"></a>00175 <span class="comment"></span>
<a name="l00176"></a>00176 <span class="comment">&lt;b&gt;Building the cramfs:&lt;/b&gt;</span>
<a name="l00177"></a>00177 <span class="comment">@verbatim</span>
<a name="l00178"></a>00178 <span class="comment">    cd linux/embedded_rootfs</span>
<a name="l00179"></a>00179 <span class="comment">    make -s cramfs</span>
<a name="l00180"></a>00180 <span class="comment">@endverbatim</span>
<a name="l00181"></a>00181 <span class="comment"></span>
<a name="l00182"></a>00182 <span class="comment">@note Invoke &apos;make menuconfig&apos; to disable unneeded packages to reduce the</span>
<a name="l00183"></a>00183 <span class="comment">size of the file system to fit in 3.5 MB. </span>
<a name="l00184"></a>00184 <span class="comment"></span>
<a name="l00185"></a>00185 <span class="comment">To load the resulting image, &lt;b&gt;rootfs.cramfs&lt;/b&gt;, into flash, we will use TFTP</span>
<a name="l00186"></a>00186 <span class="comment">just like we did for the kernel.</span>
<a name="l00187"></a>00187 <span class="comment"></span>
<a name="l00188"></a>00188 <span class="comment">&lt;b&gt;Bootloader commands:&lt;/b&gt;</span>
<a name="l00189"></a>00189 <span class="comment">@verbatim</span>
<a name="l00190"></a>00190 <span class="comment">dhcp</span>
<a name="l00191"></a>00191 <span class="comment">setenv serverip 192.168.16.39</span>
<a name="l00192"></a>00192 <span class="comment">setenv autoload no</span>
<a name="l00193"></a>00193 <span class="comment">tftpboot $(loadaddr) rootfs.cramfs</span>
<a name="l00194"></a>00194 <span class="comment">@endverbatim</span>
<a name="l00195"></a>00195 <span class="comment"></span>
<a name="l00196"></a>00196 <span class="comment">Now we update our address calculations for the rootfs flash area (4.0MB to 7.5MB).</span>
<a name="l00197"></a>00197 <span class="comment"></span>
<a name="l00198"></a>00198 <span class="comment">&lt;b&gt;Bootloader commands:&lt;/b&gt;</span>
<a name="l00199"></a>00199 <span class="comment">@verbatim</span>
<a name="l00200"></a>00200 <span class="comment">erase 0x1f800000 0x1fb7ffff # erase &lt;rootfs flash start&gt; &lt;rootfs flash end&gt;</span>
<a name="l00201"></a>00201 <span class="comment">cp.b $(fileaddr) 0x1f800000 0x380000 # cp.b &lt;memory image&gt; &lt;rootfs flash start&gt; &lt;size&gt;</span>
<a name="l00202"></a>00202 <span class="comment">@endverbatim</span>
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">When booting, specify &lt;b&gt;root=/dev/mtdblock2&lt;/b&gt; on the kernel command line.</span>
<a name="l00205"></a>00205 <span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment"></span>
<a name="l00207"></a>00207 <span class="comment">@section linux_small_usb_rootfs 7. Using USB for a root filesystem</span>
<a name="l00208"></a>00208 <span class="comment"></span>
<a name="l00209"></a>00209 <span class="comment">You can also put the root filesystem on a USB device. There are a number of</span>
<a name="l00210"></a>00210 <span class="comment">ways to configure a USB device, below shows simple sample to get you started.</span>
<a name="l00211"></a>00211 <span class="comment">When using USB as the filesystem, keep in mind you will need to pass the option</span>
<a name="l00212"></a>00212 <span class="comment">&lt;b&gt;rootdelay=5&lt;/b&gt; to the kernel. This tells the kernel to wait 5 seconds for</span>
<a name="l00213"></a>00213 <span class="comment">USB to stabilize before attempting to mount the filesystem. You may need to</span>
<a name="l00214"></a>00214 <span class="comment">tweak the delay for your system.</span>
<a name="l00215"></a>00215 <span class="comment"></span>
<a name="l00216"></a>00216 <span class="comment">First, use FDISK to partition the device. Here is the partition setup used in</span>
<a name="l00217"></a>00217 <span class="comment">this example.</span>
<a name="l00218"></a>00218 <span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">&lt;b&gt;The partition layout: fdisk -l /dev/sdb&lt;/b&gt;</span>
<a name="l00220"></a>00220 <span class="comment">@verbatim</span>
<a name="l00221"></a>00221 <span class="comment">Disk /dev/sdb: 259 MB, 259522560 bytes</span>
<a name="l00222"></a>00222 <span class="comment">8 heads, 62 sectors/track, 1021 cylinders</span>
<a name="l00223"></a>00223 <span class="comment">Units = cylinders of 496 * 512 = 253952 bytes</span>
<a name="l00224"></a>00224 <span class="comment"></span>
<a name="l00225"></a>00225 <span class="comment">   Device Boot      Start         End      Blocks   Id  System</span>
<a name="l00226"></a>00226 <span class="comment">/dev/sdb1               1        1021      253177   83  Linux</span>
<a name="l00227"></a>00227 <span class="comment">@endverbatim</span>
<a name="l00228"></a>00228 <span class="comment"></span>
<a name="l00229"></a>00229 <span class="comment">Create an EXT3 filesystem for the USB device using the embedded rootfs make</span>
<a name="l00230"></a>00230 <span class="comment">system.</span>
<a name="l00231"></a>00231 <span class="comment"></span>
<a name="l00232"></a>00232 <span class="comment">&lt;b&gt;Building the ext3:&lt;/b&gt;</span>
<a name="l00233"></a>00233 <span class="comment">@verbatim</span>
<a name="l00234"></a>00234 <span class="comment">    cd linux/embedded_rootfs</span>
<a name="l00235"></a>00235 <span class="comment">    make -s ext3</span>
<a name="l00236"></a>00236 <span class="comment">@endverbatim</span>
<a name="l00237"></a>00237 <span class="comment"></span>
<a name="l00238"></a>00238 <span class="comment">&lt;b&gt;Copy the filesystem to the USB device:&lt;/b&gt;</span>
<a name="l00239"></a>00239 <span class="comment">@verbatim</span>
<a name="l00240"></a>00240 <span class="comment">    cp rootfs.ext3 /dev/sdb1 # Copy the filesystem</span>
<a name="l00241"></a>00241 <span class="comment">    fsck -f /dev/sdb1        # Perform a full filesystem check</span>
<a name="l00242"></a>00242 <span class="comment">    resize2fs /dev/sdb1      # Resize to use the full partition</span>
<a name="l00243"></a>00243 <span class="comment">@endverbatim</span>
<a name="l00244"></a>00244 <span class="comment"></span>
<a name="l00245"></a>00245 <span class="comment">When booting, specify &lt;b&gt;rootdelay=5 root=/dev/sda1&lt;/b&gt; on the kernel command</span>
<a name="l00246"></a>00246 <span class="comment">line.</span>
<a name="l00247"></a>00247 <span class="comment"></span>
<a name="l00248"></a>00248 <span class="comment"></span>
<a name="l00249"></a>00249 <span class="comment">@section linux_small_shrink_rootfs 8. Tips to shrink the root filesystem size</span>
<a name="l00250"></a>00250 <span class="comment"></span>
<a name="l00251"></a>00251 <span class="comment">The absolute minimum packages required for a bootable OCTEON system are:</span>
<a name="l00252"></a>00252 <span class="comment"></span>
<a name="l00253"></a>00253 <span class="comment">- device-files</span>
<a name="l00254"></a>00254 <span class="comment"> + This creates all the /dev files.</span>
<a name="l00255"></a>00255 <span class="comment">- busybox</span>
<a name="l00256"></a>00256 <span class="comment"> + Busybox provides many command line utilities. It also supplies init.</span>
<a name="l00257"></a>00257 <span class="comment">- init-scripts</span>
<a name="l00258"></a>00258 <span class="comment"> + These are the minimum init and etc scripts needed to boot.</span>
<a name="l00259"></a>00259 <span class="comment">- libraries-*</span>
<a name="l00260"></a>00260 <span class="comment"> + Depending on the ABI chosen, you must have the appropriate shared</span>
<a name="l00261"></a>00261 <span class="comment">   libraries to support Busybox.</span>
<a name="l00262"></a>00262 <span class="comment">- final-cleanup</span>
<a name="l00263"></a>00263 <span class="comment"> + This sets the file ownership for the filesystem. It also strips all</span>
<a name="l00264"></a>00264 <span class="comment">   binaries and libraries.</span>
<a name="l00265"></a>00265 <span class="comment"></span>
<a name="l00266"></a>00266 <span class="comment">Below are the sizes for different formats of this minimal system.  These</span>
<a name="l00267"></a>00267 <span class="comment">minimal systems will fit inside of 8MB of flash.</span>
<a name="l00268"></a>00268 <span class="comment"></span>
<a name="l00269"></a>00269 <span class="comment">@verbatim</span>
<a name="l00270"></a>00270 <span class="comment">    initramfs kernel ELF        7.1M</span>
<a name="l00271"></a>00271 <span class="comment">    Gzipped initramfs kernel ELF    4.0M</span>
<a name="l00272"></a>00272 <span class="comment">    cramfs              2.6M</span>
<a name="l00273"></a>00273 <span class="comment">    squashfs            2.2M</span>
<a name="l00274"></a>00274 <span class="comment">@endverbatim</span>
<a name="l00275"></a>00275 <span class="comment"></span>
<a name="l00276"></a>00276 <span class="comment">The default configuration from Cavium Inc. includes all packages into</span>
<a name="l00277"></a>00277 <span class="comment">the root filesystem.  These will fit in 16MB of flash.  Here are the</span>
<a name="l00278"></a>00278 <span class="comment">resulting sizes for reference.</span>
<a name="l00279"></a>00279 <span class="comment"></span>
<a name="l00280"></a>00280 <span class="comment">@verbatim</span>
<a name="l00281"></a>00281 <span class="comment">    initramfs kernel ELF        16M</span>
<a name="l00282"></a>00282 <span class="comment">    Gzipped initramfs kernel ELF    12M</span>
<a name="l00283"></a>00283 <span class="comment">    cramfs              12M</span>
<a name="l00284"></a>00284 <span class="comment">    squashfs            11M</span>
<a name="l00285"></a>00285 <span class="comment">@endverbatim</span>
<a name="l00286"></a>00286 <span class="comment"></span>
<a name="l00287"></a>00287 <span class="comment">@section linux_small_final_boot 9. Booting Example</span>
<a name="l00288"></a>00288 <span class="comment"></span>
<a name="l00289"></a>00289 <span class="comment">The following boot commands boot a  lzma zipped kernel located 2MB into flash. </span>
<a name="l00290"></a>00290 <span class="comment">The filesystem is read from a cramfs in flash starting at 3.5MB.</span>
<a name="l00291"></a>00291 <span class="comment"></span>
<a name="l00292"></a>00292 <span class="comment">@verbatim</span>
<a name="l00293"></a>00293 <span class="comment">unlzma 0x1f600000 c00000</span>
<a name="l00294"></a>00294 <span class="comment">bootoctlinux c000000 root=/dev/mtdblock2 mtdparts=phys_mapped_flash:2048k(bootloader)ro,2048k(kernel),3584k(cramfs),256k(jffs2),256k(bootloader_env)ro</span>
<a name="l00295"></a>00295 <span class="comment">@endverbatim</span>
<a name="l00296"></a>00296 <span class="comment"></span>
<a name="l00297"></a>00297 <span class="comment">*/</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
