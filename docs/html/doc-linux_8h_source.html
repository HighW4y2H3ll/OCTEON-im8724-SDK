<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: doc-linux.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>doc-linux.h</h1><a href="doc-linux_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***********************license start************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * OCTEON SDK</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2017 Cavium Inc.. All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This file, which is part of the OCTEON SDK from Cavium Inc.,</span>
<a name="l00007"></a>00007 <span class="comment"> * contains proprietary and confidential information of Cavium Inc. and</span>
<a name="l00008"></a>00008 <span class="comment"> * its suppliers.</span>
<a name="l00009"></a>00009 <span class="comment"> * Contact Cavium Inc. at info@cavium.com for more information.</span>
<a name="l00010"></a>00010 <span class="comment"> **********************license end**************************************/</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">/**</span>
<a name="l00013"></a>00013 <span class="comment"> * @file</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * Octeon Linux documentation source.</span>
<a name="l00016"></a>00016 <span class="comment"> * @ref linux</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/**</span>
<a name="l00020"></a>00020 <span class="comment"> @page linux Linux on the OCTEON</span>
<a name="l00021"></a>00021 <span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">@section linux_intro 1. Introduction</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">Since the OCTEON cnMIPS cores are fully MIPS64r2 compliant processor</span>
<a name="l00025"></a>00025 <span class="comment">cores, each cnMIPS is capable of executing any of a variety of standard</span>
<a name="l00026"></a>00026 <span class="comment">operating system. This document provides details of executing Linux on</span>
<a name="l00027"></a>00027 <span class="comment">one or more cnMIPS cores. Although this document is Linux specific, the</span>
<a name="l00028"></a>00028 <span class="comment">general principals cover should apply to any operating system ported to</span>
<a name="l00029"></a>00029 <span class="comment">OCTEON.</span>
<a name="l00030"></a>00030 <span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">This document provides detailed information on the following aspects of</span>
<a name="l00032"></a>00032 <span class="comment">Linux on the Cavium Inc. OCTEON processor:</span>
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">- @ref linux_intro</span>
<a name="l00035"></a>00035 <span class="comment">- @ref linux_kernel</span>
<a name="l00036"></a>00036 <span class="comment">- @ref linux_userspace</span>
<a name="l00037"></a>00037 <span class="comment">- @ref linux_filesystem</span>
<a name="l00038"></a>00038 <span class="comment">- @ref linux_running_sim</span>
<a name="l00039"></a>00039 <span class="comment">- @ref linux_running_ebb6800</span>
<a name="l00040"></a>00040 <span class="comment">- @ref linux_cop2</span>
<a name="l00041"></a>00041 <span class="comment">- @ref linux_cvmseg</span>
<a name="l00042"></a>00042 <span class="comment">- @ref linux_mul</span>
<a name="l00043"></a>00043 <span class="comment">- @ref linux_tls</span>
<a name="l00044"></a>00044 <span class="comment">- @ref linux_mapped_kernel</span>
<a name="l00045"></a>00045 <span class="comment">- @ref linux_per_process_xkphys_access</span>
<a name="l00046"></a>00046 <span class="comment">- @ref linux_cvmx</span>
<a name="l00047"></a>00047 <span class="comment">- @ref linux_hotplug_cpu</span>
<a name="l00048"></a>00048 <span class="comment">- @ref linux_ethernet</span>
<a name="l00049"></a>00049 <span class="comment">- @ref linux_usb</span>
<a name="l00050"></a>00050 <span class="comment">- @ref linux_rng</span>
<a name="l00051"></a>00051 <span class="comment">- @ref linux_nfs_root</span>
<a name="l00052"></a>00052 <span class="comment">- @ref linux_initrd_root</span>
<a name="l00053"></a>00053 <span class="comment">- @ref linux_performance_counters</span>
<a name="l00054"></a>00054 <span class="comment">- @ref linux_kernel_debugging</span>
<a name="l00055"></a>00055 <span class="comment">- @ref linux_kernel_debugging_kgdb</span>
<a name="l00056"></a>00056 <span class="comment">- @ref linux_kernel_boot2</span>
<a name="l00057"></a>00057 <span class="comment">- @ref linux_kernel_boot2_pow_ethernet</span>
<a name="l00058"></a>00058 <span class="comment">- @ref linux_kernel_watchdog</span>
<a name="l00059"></a>00059 <span class="comment">- @ref linux_user_changes</span>
<a name="l00060"></a>00060 <span class="comment">- @ref linux_config_options</span>
<a name="l00061"></a>00061 <span class="comment">- @ref linux_octeon2</span>
<a name="l00062"></a>00062 <span class="comment">- @ref linux_ftrace</span>
<a name="l00063"></a>00063 <span class="comment">- @ref linux_randomize_va_space</span>
<a name="l00064"></a>00064 <span class="comment">- @ref linux_kexec</span>
<a name="l00065"></a>00065 <span class="comment">- @ref linux_kdump</span>
<a name="l00066"></a>00066 <span class="comment">- @ref linux_sample_log</span>
<a name="l00067"></a>00067 <span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">@section linux_kernel 2. The Kernel</span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">The Linux kernel, as configured for OCTEON, supports up to 32 way</span>
<a name="l00071"></a>00071 <span class="comment">SMP with 32 bit and 64 bit userspace support. In order to allow</span>
<a name="l00072"></a>00072 <span class="comment">application developers the most flexibility, the base kernel only</span>
<a name="l00073"></a>00073 <span class="comment">uses a bare minimum of OCTEON hardware units. Optional Linux</span>
<a name="l00074"></a>00074 <span class="comment">kernel drivers are available for many OCTEON hardware units. All</span>
<a name="l00075"></a>00075 <span class="comment">units not controlled by the base kernel or optional kernel</span>
<a name="l00076"></a>00076 <span class="comment">drivers, are available for application use.  The following is a</span>
<a name="l00077"></a>00077 <span class="comment">list of hardware resources reserved for Linux:</span>
<a name="l00078"></a>00078 <span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">-# Console UART</span>
<a name="l00080"></a>00080 <span class="comment"> + Linux uses the UART number passed from the bootloader to determine</span>
<a name="l00081"></a>00081 <span class="comment">   which serial port is used for the console. Which UART, and how many</span>
<a name="l00082"></a>00082 <span class="comment">   UARTs, are assigned Linux devices is dependent on several factors:</span>
<a name="l00083"></a>00083 <span class="comment">   - The Linux kernel will install drivers for all UARTs</span>
<a name="l00084"></a>00084 <span class="comment">        unless they are explicitly disabled by passing</span>
<a name="l00085"></a>00085 <span class="comment">        &apos;uartdisable=x,y&apos; on the kernel command line, where x</span>
<a name="l00086"></a>00086 <span class="comment">        an y are replaced with the numbers of the UARTs to</span>
<a name="l00087"></a>00087 <span class="comment">        disable.  The UART devices will be assigned in order</span>
<a name="l00088"></a>00088 <span class="comment">        to as many of /dev/ttyS0, /dev/ttyS1 and /dev/ttyS2 as</span>
<a name="l00089"></a>00089 <span class="comment">        are required.</span>
<a name="l00090"></a>00090 <span class="comment">   - If CONFIG_CAVIUM_GDB is selected, UART 1 will not</span>
<a name="l00091"></a>00091 <span class="comment">        have a kernel driver enabled so that it can be used by</span>
<a name="l00092"></a>00092 <span class="comment">        the debugger.  This has the same effect as passing</span>
<a name="l00093"></a>00093 <span class="comment">        &apos;uartdisable=1&apos; on the kernel command line.</span>
<a name="l00094"></a>00094 <span class="comment">   - If the bootloader passes 0 or 1 as the console UART</span>
<a name="l00095"></a>00095 <span class="comment">        and no other console is specified on the kernel</span>
<a name="l00096"></a>00096 <span class="comment">        command line, the kernel will use the corresponding</span>
<a name="l00097"></a>00097 <span class="comment">        device as its console.</span>
<a name="l00098"></a>00098 <span class="comment">   - Note that ttyS numbers change based on which OCTEON UARTs are</span>
<a name="l00099"></a>00099 <span class="comment">        assigned ttyS devices.</span>
<a name="l00100"></a>00100 <span class="comment">-# CIU and Interrupts 2, 3 and 4</span>
<a name="l00101"></a>00101 <span class="comment"> + The Linux kernel automatically retrieves the information</span>
<a name="l00102"></a>00102 <span class="comment">   about interrupt lines 2, 3 and 4 from the CIU/CIU2. These interrupts</span>
<a name="l00103"></a>00103 <span class="comment">   are passed onto the kernel using the symbolic names in the</span>
<a name="l00104"></a>00104 <span class="comment">   arch/mips/include/asm/mach-cavium-octeon/irq.h file. These map</span>
<a name="l00105"></a>00105 <span class="comment">   to the bits in the CIU/CIU2 interrupt summary registers.</span>
<a name="l00106"></a>00106 <span class="comment">-# Mailboxes</span>
<a name="l00107"></a>00107 <span class="comment"> + The CIU mailbox registers are used for inter core SMP</span>
<a name="l00108"></a>00108 <span class="comment">   scheduling messages. Cores not under Linux control are free to</span>
<a name="l00109"></a>00109 <span class="comment">   use mailboxes, but care should be taken not to modify the</span>
<a name="l00110"></a>00110 <span class="comment">   mailbox registers of cores in use by the Linux kernel.</span>
<a name="l00111"></a>00111 <span class="comment">-# TLB</span>
<a name="l00112"></a>00112 <span class="comment"> + All cores running Linux assume the TLB is under the complete control of</span>
<a name="l00113"></a>00113 <span class="comment">   the kernel. Applications may modify the TLB for cores not running Linux,</span>
<a name="l00114"></a>00114 <span class="comment">   but never of those actively running the kernel.</span>
<a name="l00115"></a>00115 <span class="comment">-# Interrupts and Exceptions Locations</span>
<a name="l00116"></a>00116 <span class="comment"> + The Cavium Inc. @ref bootloader provides a unique exception</span>
<a name="l00117"></a>00117 <span class="comment">   vector base address to each application image. Applications must read</span>
<a name="l00118"></a>00118 <span class="comment">   and use the MIPS exception base address here in order to insure core</span>
<a name="l00119"></a>00119 <span class="comment">   vectors don&apos;t overlap.</span>
<a name="l00120"></a>00120 <span class="comment"></span>
<a name="l00121"></a>00121 <span class="comment">@subsection linux_kernel_building Building the Linux Kernel</span>
<a name="l00122"></a>00122 <span class="comment"></span>
<a name="l00123"></a>00123 <span class="comment">The Cavium SDK provides a high level Makefile to simplify building</span>
<a name="l00124"></a>00124 <span class="comment">the Linux Kernel for different targets.</span>
<a name="l00125"></a>00125 <span class="comment"></span>
<a name="l00126"></a>00126 <span class="comment">Invoking make under linux directory without a target provides a help message.</span>
<a name="l00127"></a>00127 <span class="comment"></span>
<a name="l00128"></a>00128 <span class="comment">@verbatim</span>
<a name="l00129"></a>00129 <span class="comment">Supply the build target:</span>
<a name="l00130"></a>00130 <span class="comment">    kernel               - Build the Linux kernel supporting all Cavium OCTEON reference boards</span>
<a name="l00131"></a>00131 <span class="comment">    kernel-deb           - Linux kernel without the rootfs</span>
<a name="l00132"></a>00132 <span class="comment">    sim                  - OCTEON simulation environment</span>
<a name="l00133"></a>00133 <span class="comment">    setup-octeon2        - Enable config options for running on OCTEON II hardware</span>
<a name="l00134"></a>00134 <span class="comment">    setup-octeon2-sim    - Enable config options for running on OCTEON II simulation</span>
<a name="l00135"></a>00135 <span class="comment">    flash                - Copy kernel onto compact flash at mount /mnt/cf1</span>
<a name="l00136"></a>00136 <span class="comment">    strip                - Strip symbols out of the kernel image</span>
<a name="l00137"></a>00137 <span class="comment">    tftp                 - Copy a stripped kernel to /tftpboot</span>
<a name="l00138"></a>00138 <span class="comment">    test                 - Test an existing simulator build</span>
<a name="l00139"></a>00139 <span class="comment">    clean                - Remove all generated files and the KERNEL CONFIG</span>
<a name="l00140"></a>00140 <span class="comment"> </span>
<a name="l00141"></a>00141 <span class="comment">    link-kernel-se-files - Create links of all necessary files from simple</span>
<a name="l00142"></a>00142 <span class="comment">                           executive directory, required for building kernel</span>
<a name="l00143"></a>00143 <span class="comment">@endverbatim</span>
<a name="l00144"></a>00144 <span class="comment"></span>
<a name="l00145"></a>00145 <span class="comment">To build the kernel to run on OCTEON II models first invoke </span>
<a name="l00146"></a>00146 <span class="comment">&apos;make setup-octeon2/setup-octeon2-sim&apos;, to enable the proper config options.</span>
<a name="l00147"></a>00147 <span class="comment"></span>
<a name="l00148"></a>00148 <span class="comment">Invoke &apos;make kernel|sim&apos; to build the Linux kernel image.</span>
<a name="l00149"></a>00149 <span class="comment"></span>
<a name="l00150"></a>00150 <span class="comment">@section linux_userspace 3. Embedded User Environment</span>
<a name="l00151"></a>00151 <span class="comment"></span>
<a name="l00152"></a>00152 <span class="comment">Embedded Linux systems require a small root filesystem that can be put</span>
<a name="l00153"></a>00153 <span class="comment">inside of the kernel or a flash device. A standard Linux distribution,</span>
<a name="l00154"></a>00154 <span class="comment">Debian for example, takes hundreds of megabytes for a basic system. This</span>
<a name="l00155"></a>00155 <span class="comment">can&apos;t be used with devices that only have 8-16MB of boot flash. Cavium</span>
<a name="l00156"></a>00156 <span class="comment">Inc. supplies embedded_rootfs to fill this need. This filesystem</span>
<a name="l00157"></a>00157 <span class="comment">build system has the following features to support small systems:</span>
<a name="l00158"></a>00158 <span class="comment"></span>
<a name="l00159"></a>00159 <span class="comment">- Full cross compile of packages.</span>
<a name="l00160"></a>00160 <span class="comment"> + A standard x86 PC is used to build the filesystem. This can then be</span>
<a name="l00161"></a>00161 <span class="comment">   downloaded to the embedded target.</span>
<a name="l00162"></a>00162 <span class="comment">- Small size.</span>
<a name="l00163"></a>00163 <span class="comment"> + Each package provided by Cavium Inc. has been tailored to minimize</span>
<a name="l00164"></a>00164 <span class="comment">   the space required for the package. Executables and shared libraries are</span>
<a name="l00165"></a>00165 <span class="comment">   stripped of debugging symbols. Busybox replaces most command line</span>
<a name="l00166"></a>00166 <span class="comment">   utilities with smaller equivalents.</span>
<a name="l00167"></a>00167 <span class="comment">- Pluggable packages.</span>
<a name="l00168"></a>00168 <span class="comment"> + All packages can be added and removed using a GUI menuing system.</span>
<a name="l00169"></a>00169 <span class="comment">   Dependencies between packages are respected. If you install a package</span>
<a name="l00170"></a>00170 <span class="comment">   requiring 64bit libraries, the 64bit libraries are automatically</span>
<a name="l00171"></a>00171 <span class="comment">   selected. No existing files need to be modified to add packages.</span>
<a name="l00172"></a>00172 <span class="comment">- Simplified init scripts.</span>
<a name="l00173"></a>00173 <span class="comment"> + A desktop Linux system using System V init uses a large number of</span>
<a name="l00174"></a>00174 <span class="comment">   programs that are unneeded in an embedded device. This complicated</span>
<a name="l00175"></a>00175 <span class="comment">   system has been replaced with a single, simple @b rc script.</span>
<a name="l00176"></a>00176 <span class="comment">- Multiple filesystem formats.</span>
<a name="l00177"></a>00177 <span class="comment"> + The build system supports creating a initramfs, cramfs, squashfs, ext3,</span>
<a name="l00178"></a>00178 <span class="comment">   ext2, and a NFS based root filesystem.</span>
<a name="l00179"></a>00179 <span class="comment">- OCTEON II libraries.</span>
<a name="l00180"></a>00180 <span class="comment"> + OCTEON II has additional instructions and requires separate library.</span>
<a name="l00181"></a>00181 <span class="comment">   It is configurable through GUI menuing system to unselect installing</span>
<a name="l00182"></a>00182 <span class="comment">   these libraries for a specific ABI.</span>
<a name="l00183"></a>00183 <span class="comment"></span>
<a name="l00184"></a>00184 <span class="comment">@subsection linux_userspace_build_rootfs Building the Filesystem</span>
<a name="l00185"></a>00185 <span class="comment"></span>
<a name="l00186"></a>00186 <span class="comment">The top level Linux makefile automatically build the embedded root</span>
<a name="l00187"></a>00187 <span class="comment">filesystem when you invoke the @b kernel  and @b sim targets. If you would</span>
<a name="l00188"></a>00188 <span class="comment">like to build the filesystem independently from the kernel, execute make in</span>
<a name="l00189"></a>00189 <span class="comment">the linux/embedded_rootfs directory. Make without a target provides a help</span>
<a name="l00190"></a>00190 <span class="comment">message.</span>
<a name="l00191"></a>00191 <span class="comment"></span>
<a name="l00192"></a>00192 <span class="comment">@verbatim</span>
<a name="l00193"></a>00193 <span class="comment">    $ make</span>
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">    menuconfig        - Configure the packages for the filesystem (GUI)</span>
<a name="l00196"></a>00196 <span class="comment">    config            - Configure the packages for the filesystem (Command line)</span>
<a name="l00197"></a>00197 <span class="comment">    oldconfig         - Check the existing config file</span>
<a name="l00198"></a>00198 <span class="comment">    all               - Build the filesystem</span>
<a name="l00199"></a>00199 <span class="comment">    squashfs          - Package the filesystem into Squashfs</span>
<a name="l00200"></a>00200 <span class="comment">    cramfs            - Package the filesystem into Cramfs</span>
<a name="l00201"></a>00201 <span class="comment">    ext3              - Package the filesystem into Ext3</span>
<a name="l00202"></a>00202 <span class="comment">    ext2              - Package the filesystem into Ext2</span>
<a name="l00203"></a>00203 <span class="comment">    initramfs         - Use the CPIO archive as an initramfs</span>
<a name="l00204"></a>00204 <span class="comment">    clean             - Delete the builds and all filesystem files</span>
<a name="l00205"></a>00205 <span class="comment">    clean-root        - Delete the filesystem files leaving the builds</span>
<a name="l00206"></a>00206 <span class="comment">    distclean         - Delete all generated files, including the config</span>
<a name="l00207"></a>00207 <span class="comment"></span>
<a name="l00208"></a>00208 <span class="comment">    Currently configured packages:</span>
<a name="l00209"></a>00209 <span class="comment">    kernel-modules device-files busybox init-scripts module-init-tools libpcap</span>
<a name="l00210"></a>00210 <span class="comment">    octeon-libraries-n32 octeon2-libraries-n32 octeon-libraries-64</span>
<a name="l00211"></a>00211 <span class="comment">    octeon2-libraries-64 readline openssl zlib popt lzo bridge-utils</span>
<a name="l00212"></a>00212 <span class="comment">    ethtool mii-tool net-tools tcpdump iproute2 iputils strace schedtool</span>
<a name="l00213"></a>00213 <span class="comment">    oprofile bootoct oct-linux-identify oct-linux-mdio</span>
<a name="l00214"></a>00214 <span class="comment">    oct-linux-jtg load-llm octeon-remote-utils htlbremap toolchain-utils gdb</span>
<a name="l00215"></a>00215 <span class="comment">    mtd-tools sdk-examples intercept-example iozone rsync lockstat pciutils</span>
<a name="l00216"></a>00216 <span class="comment">    libhugetlbfs testsuite final-cleanup</span>
<a name="l00217"></a>00217 <span class="comment">@endverbatim</span>
<a name="l00218"></a>00218 <span class="comment"></span>
<a name="l00219"></a>00219 <span class="comment">For reference, the top level Linux @b kernel target performs a</span>
<a name="l00220"></a>00220 <span class="comment">&quot;make -s all initramfs&quot;. This creates a kernel with the filesystem inside</span>
<a name="l00221"></a>00221 <span class="comment">the ELF file with the kernel. Having the filesystem inside the kernel works</span>
<a name="l00222"></a>00222 <span class="comment">well with TFTP and compact flash in a development style environment. The top</span>
<a name="l00223"></a>00223 <span class="comment">level Linux @b sim target performs &quot;make -s all ext2&quot;. The simulator uses an</span>
<a name="l00224"></a>00224 <span class="comment">ext2 filesystem directly loaded into simulator memory.</span>
<a name="l00225"></a>00225 <span class="comment"></span>
<a name="l00226"></a>00226 <span class="comment">@subsection linux_userspace_force_build Forcing a Filesystem Build</span>
<a name="l00227"></a>00227 <span class="comment"></span>
<a name="l00228"></a>00228 <span class="comment">When a build of the root filesystem completes, it creates a file</span>
<a name="l00229"></a>00229 <span class="comment">&lt;b&gt;.root_complete&lt;/b&gt;. This is used as an optimization to prevent kernel builds</span>
<a name="l00230"></a>00230 <span class="comment">from building the filesystem repeatedly. The build system attempts to check</span>
<a name="l00231"></a>00231 <span class="comment">for makefile or configuration changes, but sometimes it misses changes that</span>
<a name="l00232"></a>00232 <span class="comment">have occurred in packages. If this happens, simply delete the</span>
<a name="l00233"></a>00233 <span class="comment">&lt;b&gt;.root_complete&lt;/b&gt; file to force a filesystem to rebuild on the next make.</span>
<a name="l00234"></a>00234 <span class="comment"></span>
<a name="l00235"></a>00235 <span class="comment">@subsection linux_userspace_shrink_rootfs Tips to shrink size</span>
<a name="l00236"></a>00236 <span class="comment"></span>
<a name="l00237"></a>00237 <span class="comment">This sections has moved to @ref linux_small - @ref linux_small_shrink_rootfs.</span>
<a name="l00238"></a>00238 <span class="comment"></span>
<a name="l00239"></a>00239 <span class="comment">@subsection linux_userspace_install_rootfs Installing in Flash</span>
<a name="l00240"></a>00240 <span class="comment"></span>
<a name="l00241"></a>00241 <span class="comment">This sections has moved to @ref linux_small - @ref linux_small_flash_layout.</span>
<a name="l00242"></a>00242 <span class="comment"></span>
<a name="l00243"></a>00243 <span class="comment">@subsection linux_userspace_add_pkg How to Add a Package</span>
<a name="l00244"></a>00244 <span class="comment"></span>
<a name="l00245"></a>00245 <span class="comment">The embedded rootfs make system is designed to allow packages to be added</span>
<a name="l00246"></a>00246 <span class="comment">easily. By adding two files to the package directories, the new package will</span>
<a name="l00247"></a>00247 <span class="comment">appear in the configuration menu and be built as part of the filesystem.</span>
<a name="l00248"></a>00248 <span class="comment">Under pkg_kconfig, you need to add a menu entry for the package. You then</span>
<a name="l00249"></a>00249 <span class="comment">add the package&apos;s makefile under pkg_makefiles. As an example, the files</span>
<a name="l00250"></a>00250 <span class="comment">below are for strace.</span>
<a name="l00251"></a>00251 <span class="comment"></span>
<a name="l00252"></a>00252 <span class="comment">&lt;b&gt;pkg_kconfig/70-strace.kconfig&lt;/b&gt;</span>
<a name="l00253"></a>00253 <span class="comment">@verbatim</span>
<a name="l00254"></a>00254 <span class="comment">    config CONFIG_strace</span>
<a name="l00255"></a>00255 <span class="comment">        bool &quot;strace&quot;</span>
<a name="l00256"></a>00256 <span class="comment">        default y</span>
<a name="l00257"></a>00257 <span class="comment">        help</span>
<a name="l00258"></a>00258 <span class="comment">            From the strace homepage:</span>
<a name="l00259"></a>00259 <span class="comment">            Strace is a system call trace, i.e. a debugging tool which</span>
<a name="l00260"></a>00260 <span class="comment">            prints out a trace of all the system calls made by a another</span>
<a name="l00261"></a>00261 <span class="comment">            process/program. The program to be traced need not be recompiled</span>
<a name="l00262"></a>00262 <span class="comment">            for this, so you can use it on binaries for which you don&apos;t have</span>
<a name="l00263"></a>00263 <span class="comment">            source.</span>
<a name="l00264"></a>00264 <span class="comment"></span>
<a name="l00265"></a>00265 <span class="comment">            System calls and signals are events that happen at the</span>
<a name="l00266"></a>00266 <span class="comment">            user/kernel interface. A close examination of this boundary is</span>
<a name="l00267"></a>00267 <span class="comment">            very useful for bug isolation, sanity checking and attempting</span>
<a name="l00268"></a>00268 <span class="comment">            to capture race conditions</span>
<a name="l00269"></a>00269 <span class="comment">@endverbatim</span>
<a name="l00270"></a>00270 <span class="comment"></span>
<a name="l00271"></a>00271 <span class="comment">    @note The sort order of the files in pkg_kconfig control the order they</span>
<a name="l00272"></a>00272 <span class="comment">        appear in the menu. For simplicity we use a number prefex to control</span>
<a name="l00273"></a>00273 <span class="comment">        ordering.</span>
<a name="l00274"></a>00274 <span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">&lt;b&gt;pkg_makefiles/strace.mk&lt;/b&gt;</span>
<a name="l00276"></a>00276 <span class="comment">@verbatim</span>
<a name="l00277"></a>00277 <span class="comment">PKG:=strace</span>
<a name="l00278"></a>00278 <span class="comment">VERSION:=4.5.14</span>
<a name="l00279"></a>00279 <span class="comment">DIR:=${PKG}-${VERSION}</span>
<a name="l00280"></a>00280 <span class="comment"></span>
<a name="l00281"></a>00281 <span class="comment">.PHONY: all</span>
<a name="l00282"></a>00282 <span class="comment">all: build install</span>
<a name="l00283"></a>00283 <span class="comment"></span>
<a name="l00284"></a>00284 <span class="comment">.PHONY: build</span>
<a name="l00285"></a>00285 <span class="comment">build: ${DIR} ${DIR}/Makefile</span>
<a name="l00286"></a>00286 <span class="comment">    ${MAKE} -C ${DIR}</span>
<a name="l00287"></a>00287 <span class="comment"></span>
<a name="l00288"></a>00288 <span class="comment">${DIR}/Makefile:</span>
<a name="l00289"></a>00289 <span class="comment">    cd ${DIR} &amp;&amp; ./configure --host=${CROSS} CFLAGS=&quot;${CFLAGS}&quot; LDFLAGS=&quot;${TOOLCHAIN_ABI}&quot;</span>
<a name="l00290"></a>00290 <span class="comment"></span>
<a name="l00291"></a>00291 <span class="comment">.PHONY: install</span>
<a name="l00292"></a>00292 <span class="comment">install: ${DIR}</span>
<a name="l00293"></a>00293 <span class="comment">    mkdir -p ${ROOT}/usr/bin</span>
<a name="l00294"></a>00294 <span class="comment">    ${STRIP} -o ${ROOT}/usr/bin/strace ${DIR}/strace</span>
<a name="l00295"></a>00295 <span class="comment"></span>
<a name="l00296"></a>00296 <span class="comment">${DIR}:</span>
<a name="l00297"></a>00297 <span class="comment">    tar -jxf ${STORAGE}/${PKG}-${VERSION}.tar.bz2</span>
<a name="l00298"></a>00298 <span class="comment">    cd ${DIR} &amp;&amp; patch -p0 &lt; ${STORAGE}/strace.patch</span>
<a name="l00299"></a>00299 <span class="comment">@endverbatim</span>
<a name="l00300"></a>00300 <span class="comment"></span>
<a name="l00301"></a>00301 <span class="comment">    &lt;b&gt;Notes on makefiles for packages&lt;/b&gt;</span>
<a name="l00302"></a>00302 <span class="comment"></span>
<a name="l00303"></a>00303 <span class="comment">-# The make file is run in &lt;b&gt;linux/embedded_rootfs/build&lt;/b&gt;</span>
<a name="l00304"></a>00304 <span class="comment">-# Libraries need to be place in /usr/lib32 or /usr/lib64. The directory</span>
<a name="l00305"></a>00305 <span class="comment">    /usr/lib is not searched since it is for Mips O32 libraries.</span>
<a name="l00306"></a>00306 <span class="comment">-# Use strip on all executables and libraries to save space.</span>
<a name="l00307"></a>00307 <span class="comment">-# The following variables are export to the makefile:</span>
<a name="l00308"></a>00308 <span class="comment"> + ROOT = The directory where the filesystem is being created.</span>
<a name="l00309"></a>00309 <span class="comment"> + STORAGE = linux/embedded_rootfs/storage</span>
<a name="l00310"></a>00310 <span class="comment"> + SOURCE_DIR = linux/embedded_rootfs/source</span>
<a name="l00311"></a>00311 <span class="comment"> + ETC_FILES = linux/embedded_rootfs/etc-files</span>
<a name="l00312"></a>00312 <span class="comment"> + KERNEL_DIR = The location of the kernel source</span>
<a name="l00313"></a>00313 <span class="comment"> + CROSS = mips64-octeon-linux-gnu</span>
<a name="l00314"></a>00314 <span class="comment"> + CC = mips64-octeon-linux-gnu-gcc</span>
<a name="l00315"></a>00315 <span class="comment"> + CXX = mips64-octeon-linux-gnu-g++</span>
<a name="l00316"></a>00316 <span class="comment"> + LD = mips64-octeon-linux-gnu-ld</span>
<a name="l00317"></a>00317 <span class="comment"> + AR = mips64-octeon-linux-gnu-ar</span>
<a name="l00318"></a>00318 <span class="comment"> + RANLIB = mips64-octeon-linux-gnu-ranlib</span>
<a name="l00319"></a>00319 <span class="comment"> + STRIP = mips64-octeon-linux-gnu-strip</span>
<a name="l00320"></a>00320 <span class="comment"> + CFLAGS = Recommended C flags</span>
<a name="l00321"></a>00321 <span class="comment"> + CXXFLAGS = Recommended C++ flags</span>
<a name="l00322"></a>00322 <span class="comment"> + TOOLCHAIN_ABI = The current build ABI. Can be either &lt;b&gt;-mabi=n32&lt;/b&gt;</span>
<a name="l00323"></a>00323 <span class="comment">   or &lt;b&gt;-mabi=64&lt;/b&gt;.</span>
<a name="l00324"></a>00324 <span class="comment"> + LDFLAGS = -melf32btsmipn32 or -melf64btsmip</span>
<a name="l00325"></a>00325 <span class="comment"> + OCTEON_EXTRA_CFLAGS = The current build instruction set. Can be</span>
<a name="l00326"></a>00326 <span class="comment">   either &lt;b&gt;-march=octeon&lt;/b&gt; or &lt;b&gt;-march=octeon2&lt;/b&gt;.</span>
<a name="l00327"></a>00327 <span class="comment"> + LIBDIR = The directory to install libraries</span>
<a name="l00328"></a>00328 <span class="comment"></span>
<a name="l00329"></a>00329 <span class="comment">@subsection linux_userspace_init_seq Userspace init Sequence</span>
<a name="l00330"></a>00330 <span class="comment"></span>
<a name="l00331"></a>00331 <span class="comment">In order to simplify embedded Linux development, the userspace</span>
<a name="l00332"></a>00332 <span class="comment">initialization scripts have been simplified down into one shell script.</span>
<a name="l00333"></a>00333 <span class="comment">The userspace initialization process is as follows:</span>
<a name="l00334"></a>00334 <span class="comment"></span>
<a name="l00335"></a>00335 <span class="comment">-# Linux kernel mounts the root filesystem.</span>
<a name="l00336"></a>00336 <span class="comment">-# The kernel starts the first user process @b /sbin/init provided by</span>
<a name="l00337"></a>00337 <span class="comment">    Busybox.</span>
<a name="l00338"></a>00338 <span class="comment">-# @b /sbin/init reads @b /etc/inittab</span>
<a name="l00339"></a>00339 <span class="comment">    (From the SDK: @b linux/embedded_rootfs/etc-files/inittab).</span>
<a name="l00340"></a>00340 <span class="comment">-# @b /etc/inittab starts the shell script @b /sbin/rc</span>
<a name="l00341"></a>00341 <span class="comment">    (From the SDK: @b linux/embedded_rootfs/etc-files/rc).</span>
<a name="l00342"></a>00342 <span class="comment">-# @b /sbin/rc mounts the kernel pseudo filesystems @b /proc, @b /dev/shm,</span>
<a name="l00343"></a>00343 <span class="comment">    and @b /dev/pts.</span>
<a name="l00344"></a>00344 <span class="comment">-# @b /sbin/rc brings up the loopback network device with the IP address</span>
<a name="l00345"></a>00345 <span class="comment">    127.0.0.1.</span>
<a name="l00346"></a>00346 <span class="comment">-# @b /sbin/rc starts @b syslogd provided by Busybox.</span>
<a name="l00347"></a>00347 <span class="comment">-# @b /sbin/rc starts @b telnetd provided by Busybox.</span>
<a name="l00348"></a>00348 <span class="comment">-# @b /sbin/rc exits returning control in @b /sbin/init.</span>
<a name="l00349"></a>00349 <span class="comment">-# @b /etc/inittab tells @b /sbin/init to spawn an interactive shell.</span>
<a name="l00350"></a>00350 <span class="comment">-# The user interactive shell prompt appears.</span>
<a name="l00351"></a>00351 <span class="comment"></span>
<a name="l00352"></a>00352 <span class="comment">@section linux_filesystem 4. Loading The Filesystem</span>
<a name="l00353"></a>00353 <span class="comment"></span>
<a name="l00354"></a>00354 <span class="comment">@b OCTEON @b Simulator</span>
<a name="l00355"></a>00355 <span class="comment"></span>
<a name="l00356"></a>00356 <span class="comment">Since OCTEON simulation environment does not provide a virtual disk</span>
<a name="l00357"></a>00357 <span class="comment">device, the root filesystem is loaded from a fixed address (@b 0x40000000)</span>
<a name="l00358"></a>00358 <span class="comment">in simulated ram. The linux kernel configures a MTD block device</span>
<a name="l00359"></a>00359 <span class="comment">(@b /dev/mtdblock0) and mounts the filesystem from memory. The default</span>
<a name="l00360"></a>00360 <span class="comment">configuration limits the in memory filesystem to 1GB.</span>
<a name="l00361"></a>00361 <span class="comment"></span>
<a name="l00362"></a>00362 <span class="comment">@b EBB68XX @b Hardware @b Reference @b Board</span>
<a name="l00363"></a>00363 <span class="comment"></span>
<a name="l00364"></a>00364 <span class="comment">The filesystem is built directly into the kernel as an initramfs image. After</span>
<a name="l00365"></a>00365 <span class="comment">the kernel boot, the initial contents of the filesystem are extracted into</span>
<a name="l00366"></a>00366 <span class="comment">a memory based filesystem (tmpfs). Once the extraction is complete,</span>
<a name="l00367"></a>00367 <span class="comment">/init is called.</span>
<a name="l00368"></a>00368 <span class="comment"></span>
<a name="l00369"></a>00369 <span class="comment">@b Contents @b of @b the @b Filesystem</span>
<a name="l00370"></a>00370 <span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment">The default filesystem is built from scratch under @b linux/embedded_rootfs.</span>
<a name="l00372"></a>00372 <span class="comment">Performing a @b make @b ext2 in this directory will build the filesystem.</span>
<a name="l00373"></a>00373 <span class="comment"></span>
<a name="l00374"></a>00374 <span class="comment">@note Performing a couple of the commands needed to build the root</span>
<a name="l00375"></a>00375 <span class="comment">    filesystem requires root privileges. The Makefile uses the @b sudo</span>
<a name="l00376"></a>00376 <span class="comment">    command to perform these steps. Insure that @b sudo is configured</span>
<a name="l00377"></a>00377 <span class="comment">    properly for your user. For example, @b sudo @b ls should work.</span>
<a name="l00378"></a>00378 <span class="comment"></span>
<a name="l00379"></a>00379 <span class="comment">The Makefile copies each of</span>
<a name="l00380"></a>00380 <span class="comment">the simple executive examples supporting Linux is copied into @b /examples</span>
<a name="l00381"></a>00381 <span class="comment">in the filesystem. See the documentation for each example for directions on</span>
<a name="l00382"></a>00382 <span class="comment">how to run it.</span>
<a name="l00383"></a>00383 <span class="comment"></span>
<a name="l00384"></a>00384 <span class="comment">@section linux_running_sim 5. Running Linux on the Simulator</span>
<a name="l00385"></a>00385 <span class="comment"></span>
<a name="l00386"></a>00386 <span class="comment">The SDK provides the shell script @b oct-linux to simplify the execution</span>
<a name="l00387"></a>00387 <span class="comment">of Linux on the simulator. It is simply a convenience wrapper around @b</span>
<a name="l00388"></a>00388 <span class="comment">oct-sim. In most case you will start linux with the following command</span>
<a name="l00389"></a>00389 <span class="comment">line:</span>
<a name="l00390"></a>00390 <span class="comment"></span>
<a name="l00391"></a>00391 <span class="comment">@code</span>
<a name="l00392"></a>00392 <span class="comment">$ oct-linux -quiet -noperf -numcores=#</span>
<a name="l00393"></a>00393 <span class="comment">@endcode</span>
<a name="l00394"></a>00394 <span class="comment"></span>
<a name="l00395"></a>00395 <span class="comment">The options &quot;-quiet&quot; and &quot;-noperf&quot; are not strictly needed, but greatly</span>
<a name="l00396"></a>00396 <span class="comment">increase the simulation speed. The number of cores running Linux can be</span>
<a name="l00397"></a>00397 <span class="comment">controlled by the &quot;-numcores&quot; argument. Here is a listing of the @b oct-linux</span>
<a name="l00398"></a>00398 <span class="comment">script and a description of each of its parts.</span>
<a name="l00399"></a>00399 <span class="comment"></span>
<a name="l00400"></a>00400 <span class="comment">@code</span>
<a name="l00401"></a>00401 <span class="comment">#!/bin/bash</span>
<a name="l00402"></a>00402 <span class="comment"></span>
<a name="l00403"></a>00403 <span class="comment">memory=384</span>
<a name="l00404"></a>00404 <span class="comment">uart=2020</span>
<a name="l00405"></a>00405 <span class="comment">packet_port=2000</span>
<a name="l00406"></a>00406 <span class="comment"></span>
<a name="l00407"></a>00407 <span class="comment">oct-sim linux/vmlinux.64 -envfile=u-boot-env -memsize=${memory} \</span>
<a name="l00408"></a>00408 <span class="comment">    -uart0=${uart} -serve=${packet_port} \</span>
<a name="l00409"></a>00409 <span class="comment">    -ld0x40000000:embedded_rootfs/rootfs.ext2 $*</span>
<a name="l00410"></a>00410 <span class="comment">@endcode</span>
<a name="l00411"></a>00411 <span class="comment"></span>
<a name="l00412"></a>00412 <span class="comment">- oct-sim</span>
<a name="l00413"></a>00413 <span class="comment"> + The SDK script for executing the OCTEON simulator</span>
<a name="l00414"></a>00414 <span class="comment">- linux/vmlinux.64</span>
<a name="l00415"></a>00415 <span class="comment"> + The Linux kernel packaged as a 64 bit elf binary.</span>
<a name="l00416"></a>00416 <span class="comment">- -envfile=u-boot-env</span>
<a name="l00417"></a>00417 <span class="comment"> + @ref bootloader environment to automatically start Linux. It contains</span>
<a name="l00418"></a>00418 <span class="comment">        the single line: bootcmd=bootoctlinux 0x10000000</span>
<a name="l00419"></a>00419 <span class="comment">- -memsize=${memory}</span>
<a name="l00420"></a>00420 <span class="comment"> + Set the amount of simulated memory</span>
<a name="l00421"></a>00421 <span class="comment">- -uart0=${uart}</span>
<a name="l00422"></a>00422 <span class="comment"> + The TCP/IP port the simulator will listen on for uart connections</span>
<a name="l00423"></a>00423 <span class="comment">- -serve=${packet_port}</span>
<a name="l00424"></a>00424 <span class="comment"> + The TCP/IP port the simulator will listen for @b oct-packet-io to</span>
<a name="l00425"></a>00425 <span class="comment">        connect to.</span>
<a name="l00426"></a>00426 <span class="comment">- -ld0x40000000:embedded_rootfs/rootfs.ext2</span>
<a name="l00427"></a>00427 <span class="comment"> + Load the filesystem binary into simulated ram at the expected MTD</span>
<a name="l00428"></a>00428 <span class="comment">        address.</span>
<a name="l00429"></a>00429 <span class="comment">- $*</span>
<a name="l00430"></a>00430 <span class="comment"> + Any arguments supplied by the user.</span>
<a name="l00431"></a>00431 <span class="comment"></span>
<a name="l00432"></a>00432 <span class="comment">Once Linux is running in the simulator you will start seeing the following</span>
<a name="l00433"></a>00433 <span class="comment">messages from the simulator:</span>
<a name="l00434"></a>00434 <span class="comment"></span>
<a name="l00435"></a>00435 <span class="comment">@verbatim</span>
<a name="l00436"></a>00436 <span class="comment">waiting for a connection to uart 0 1</span>
<a name="l00437"></a>00437 <span class="comment">waiting for a connection to uart 0 2</span>
<a name="l00438"></a>00438 <span class="comment">waiting for a connection to uart 0 3</span>
<a name="l00439"></a>00439 <span class="comment">waiting for a connection to uart 0 4</span>
<a name="l00440"></a>00440 <span class="comment">@endverbatim</span>
<a name="l00441"></a>00441 <span class="comment"></span>
<a name="l00442"></a>00442 <span class="comment">At this time you need to connect to the simulator using TCP to get the uart</span>
<a name="l00443"></a>00443 <span class="comment">data. The standard program @b telnet works well for this. In another</span>
<a name="l00444"></a>00444 <span class="comment">terminal issue the following command:</span>
<a name="l00445"></a>00445 <span class="comment"></span>
<a name="l00446"></a>00446 <span class="comment">@code</span>
<a name="l00447"></a>00447 <span class="comment">$ telnet localhost 2020</span>
<a name="l00448"></a>00448 <span class="comment">@endcode</span>
<a name="l00449"></a>00449 <span class="comment"></span>
<a name="l00450"></a>00450 <span class="comment">You should now see the Linux boot messages followed by userspace</span>
<a name="l00451"></a>00451 <span class="comment">initialization. After all this is complete, an interactive shell will</span>
<a name="l00452"></a>00452 <span class="comment">appear.</span>
<a name="l00453"></a>00453 <span class="comment"></span>
<a name="l00454"></a>00454 <span class="comment">@note Once Linux boots to a shell prompt, it can be useful to change</span>
<a name="l00455"></a>00455 <span class="comment"> telnet to character mode instead of line mode. In the telnet session</span>
<a name="l00456"></a>00456 <span class="comment"> press &lt;b&gt;Control-]&lt;/b&gt; and enter @b mode @b char at the prompt.  Then</span>
<a name="l00457"></a>00457 <span class="comment"> hit enter a few times. Shell tab completion, Control-C, and other</span>
<a name="l00458"></a>00458 <span class="comment"> interactive aspects should now work.</span>
<a name="l00459"></a>00459 <span class="comment"></span>
<a name="l00460"></a>00460 <span class="comment">@section linux_running_ebb6800 6. Running Linux on the EBB68XX Hardware</span>
<a name="l00461"></a>00461 <span class="comment"></span>
<a name="l00462"></a>00462 <span class="comment">Build Linux for the EBB68XX.</span>
<a name="l00463"></a>00463 <span class="comment">@verbatim</span>
<a name="l00464"></a>00464 <span class="comment">$ cd $(OCTEON_ROOT)/linux</span>
<a name="l00465"></a>00465 <span class="comment">$ make -s clean</span>
<a name="l00466"></a>00466 <span class="comment">$ make -s kernel</span>
<a name="l00467"></a>00467 <span class="comment">@endverbatim</span>
<a name="l00468"></a>00468 <span class="comment"></span>
<a name="l00469"></a>00469 <span class="comment">Copy the Linux kernel to a compact flash.</span>
<a name="l00470"></a>00470 <span class="comment">@verbatim</span>
<a name="l00471"></a>00471 <span class="comment">$ mkdir -p /mnt/usb</span>
<a name="l00472"></a>00472 <span class="comment">$ fdisk -l /dev/sda         # Only needed on some Kernel 2.6 systems</span>
<a name="l00473"></a>00473 <span class="comment">$ mount /dev/sda1 /mnt/usb</span>
<a name="l00474"></a>00474 <span class="comment">$ mips64-octeon-linux-gnu-strip -o /mnt/usb/vmlinux.64 kernel/linux/vmlinux.64</span>
<a name="l00475"></a>00475 <span class="comment">$ umount /mnt/usb</span>
<a name="l00476"></a>00476 <span class="comment">@endverbatim</span>
<a name="l00477"></a>00477 <span class="comment"></span>
<a name="l00478"></a>00478 <span class="comment">Put the compact flash into the EBB68XX and reset the board. At the</span>
<a name="l00479"></a>00479 <span class="comment">bootloader prompt load linux.</span>
<a name="l00480"></a>00480 <span class="comment">@verbatim</span>
<a name="l00481"></a>00481 <span class="comment">Octeon ebb6800# fatload ide 0 $(loadaddr) vmlinux.64</span>
<a name="l00482"></a>00482 <span class="comment">Octeon ebb6800# bootoctlinux $(fileaddr)</span>
<a name="l00483"></a>00483 <span class="comment">@endverbatim</span>
<a name="l00484"></a>00484 <span class="comment"></span>
<a name="l00485"></a>00485 <span class="comment">@note Most bootloaders have an alias for this: run linux_cf</span>
<a name="l00486"></a>00486 <span class="comment"></span>
<a name="l00487"></a>00487 <span class="comment">All arguments on the @b bootoctlinux command are passed to the Linux</span>
<a name="l00488"></a>00488 <span class="comment">kernel. Two options are used frequently: &lt;b&gt;mem=&lt;/b&gt; and &lt;b&gt;root=&lt;/b&gt;.</span>
<a name="l00489"></a>00489 <span class="comment"></span>
<a name="l00490"></a>00490 <span class="comment">- &lt;b&gt;mem=&lt;/b&gt; is used to set how much memory the Linux kernel uses in</span>
<a name="l00491"></a>00491 <span class="comment">    megabytes. Setting it to 0 will use all available memory.</span>
<a name="l00492"></a>00492 <span class="comment">- &lt;b&gt;root=&lt;/b&gt; is used to set the device for the root filesystem. This is</span>
<a name="l00493"></a>00493 <span class="comment">    used with Debian to set the filesystem to the compact flash.</span>
<a name="l00494"></a>00494 <span class="comment">    (root=/dev/sda2).</span>
<a name="l00495"></a>00495 <span class="comment"></span>
<a name="l00496"></a>00496 <span class="comment">@section linux_cop2 7. Process Context and Coprocessor 2</span>
<a name="l00497"></a>00497 <span class="comment"></span>
<a name="l00498"></a>00498 <span class="comment">Linux on the OCTEON saves and restores coprocessor 2 (COP2) so that it may</span>
<a name="l00499"></a>00499 <span class="comment">be used freely by userspace applications.</span>
<a name="l00500"></a>00500 <span class="comment"></span>
<a name="l00501"></a>00501 <span class="comment">In order to improve performance, Linux disables COP2 by default. COP2 is</span>
<a name="l00502"></a>00502 <span class="comment">only enabled when a task attempts to perform a COP2 operation. At this</span>
<a name="l00503"></a>00503 <span class="comment">time, the kernel enables COP2 and restores any saved state. Here is a</span>
<a name="l00504"></a>00504 <span class="comment">description of kernel COP2 processing:</span>
<a name="l00505"></a>00505 <span class="comment"></span>
<a name="l00506"></a>00506 <span class="comment">-# COP2 is disabled using COP0 Status[CU2].</span>
<a name="l00507"></a>00507 <span class="comment">-# Application runs and executes a COP2 instruction.</span>
<a name="l00508"></a>00508 <span class="comment">-# Kernel receives an illegal COP2 access exception.</span>
<a name="l00509"></a>00509 <span class="comment">-# Kernel enables COP2 and initializes its state.</span>
<a name="l00510"></a>00510 <span class="comment">-# Kernel returns control to the application.</span>
<a name="l00511"></a>00511 <span class="comment">-# Application continues processing, performing any number of COP2</span>
<a name="l00512"></a>00512 <span class="comment">  instructions.</span>
<a name="l00513"></a>00513 <span class="comment">-# Application stops processing and returns to kernel context. This can</span>
<a name="l00514"></a>00514 <span class="comment">  occur through a interrupt, exception, or syscall.</span>
<a name="l00515"></a>00515 <span class="comment">-# Kernel performs a context switch by calling @b resume.</span>
<a name="l00516"></a>00516 <span class="comment">-# The assembly function @b resume checks if COP0 Status[CU2] has enabled</span>
<a name="l00517"></a>00517 <span class="comment">  COP2. If so, it calls @b octeon_cop2_save to save COP2 state.</span>
<a name="l00518"></a>00518 <span class="comment">-# COP2 is again disabled using COP0 Status[CU2].</span>
<a name="l00519"></a>00519 <span class="comment">-# Normal kernel processing continues.</span>
<a name="l00520"></a>00520 <span class="comment">-# Control returns to the application. Note that COP2 is still disabled.</span>
<a name="l00521"></a>00521 <span class="comment">-# Application continues processing until reaching a COP2 instruction.</span>
<a name="l00522"></a>00522 <span class="comment">-# Kernel receives an illegal COP2 access exception.</span>
<a name="l00523"></a>00523 <span class="comment">-# Kernel enables COP2 and restores its state.</span>
<a name="l00524"></a>00524 <span class="comment">-# Kernel returns control to the application.</span>
<a name="l00525"></a>00525 <span class="comment"></span>
<a name="l00526"></a>00526 <span class="comment">Kernel use of COP2 is normally disabled since it can corrupt the userspace</span>
<a name="l00527"></a>00527 <span class="comment">state. In order to access COP2 from inside the kernel, you must wrap your</span>
<a name="l00528"></a>00528 <span class="comment">COP2 code with calls to the functions &lt;b&gt;octeon_crypto_enable()&lt;/b&gt; and</span>
<a name="l00529"></a>00529 <span class="comment">&lt;b&gt;octeon_crypto_disable()&lt;/b&gt;. The following is a simplified</span>
<a name="l00530"></a>00530 <span class="comment">example:</span>
<a name="l00531"></a>00531 <span class="comment">@code</span>
<a name="l00532"></a>00532 <span class="comment">    #include &lt;asm/octeon/octeon-crypto.h&gt;</span>
<a name="l00533"></a>00533 <span class="comment"></span>
<a name="l00534"></a>00534 <span class="comment">    void do_kernel_crypto(...)</span>
<a name="l00535"></a>00535 <span class="comment">    {</span>
<a name="l00536"></a>00536 <span class="comment">        struct octeon_cop2_state state;</span>
<a name="l00537"></a>00537 <span class="comment">        unsigned long flags;</span>
<a name="l00538"></a>00538 <span class="comment"></span>
<a name="l00539"></a>00539 <span class="comment">        flags = octeon_crypto_enable(&amp;state);</span>
<a name="l00540"></a>00540 <span class="comment"></span>
<a name="l00541"></a>00541 <span class="comment">        COP2 accesses</span>
<a name="l00542"></a>00542 <span class="comment"></span>
<a name="l00543"></a>00543 <span class="comment">        octeon_crypto_disable(&amp;state, flags);</span>
<a name="l00544"></a>00544 <span class="comment">    }</span>
<a name="l00545"></a>00545 <span class="comment">@endcode</span>
<a name="l00546"></a>00546 <span class="comment"></span>
<a name="l00547"></a>00547 <span class="comment">The key issues to remember with kernel level COP2 access are:</span>
<a name="l00548"></a>00548 <span class="comment"></span>
<a name="l00549"></a>00549 <span class="comment">-# The structure octeon_cop2_state normally must be store on the stack.</span>
<a name="l00550"></a>00550 <span class="comment">  Most functions in the kernel are reentrant as they can be called on</span>
<a name="l00551"></a>00551 <span class="comment">  behalf of a process, in softirq, and from an interrupt.</span>
<a name="l00552"></a>00552 <span class="comment">-# The &quot;flags&quot; parameter must be passed unchanged to</span>
<a name="l00553"></a>00553 <span class="comment">  octeon_crypto_disable(). This &quot;flags&quot; is independent of local_irq_save()</span>
<a name="l00554"></a>00554 <span class="comment">  and local_irq_restore() which also tend to use a &quot;flags&quot; parameter. If</span>
<a name="l00555"></a>00555 <span class="comment">  you need interrupts disabled you must call these independent of the</span>
<a name="l00556"></a>00556 <span class="comment">  COP2 enable / disable.</span>
<a name="l00557"></a>00557 <span class="comment">-# It is possible for COP2 to be enabled outside of regions surrounded by</span>
<a name="l00558"></a>00558 <span class="comment">  these functions. It is unsafe to use COP2 in this instance. All kernel</span>
<a name="l00559"></a>00559 <span class="comment">  COP2 must be surrounded by these calls.</span>
<a name="l00560"></a>00560 <span class="comment">-# COP2 will only be saved if necessary. Sometimes calls to these functions</span>
<a name="l00561"></a>00561 <span class="comment">  will not update the state parameter.</span>
<a name="l00562"></a>00562 <span class="comment">-# octeon_crypto_enable() and octeon_crypto_disable() are only</span>
<a name="l00563"></a>00563 <span class="comment">  available if you configure your kernel with</span>
<a name="l00564"></a>00564 <span class="comment">  CONFIG_CAVIUM_OCTEON_KERNEL_CRYPTO.</span>
<a name="l00565"></a>00565 <span class="comment"></span>
<a name="l00566"></a>00566 <span class="comment">@section linux_cvmseg 8. Process Context and CVMSEG (Local Scratch Memory)</span>
<a name="l00567"></a>00567 <span class="comment"></span>
<a name="l00568"></a>00568 <span class="comment">Userspace state in CVMSEG is saved and restored on context</span>
<a name="l00569"></a>00569 <span class="comment">switch. This allows any application to use the CVMSEG memory. Here is</span>
<a name="l00570"></a>00570 <span class="comment">a description of kernel CVMSEG processing:</span>
<a name="l00571"></a>00571 <span class="comment"></span>
<a name="l00572"></a>00572 <span class="comment">-# On boot CVMSEG size is set using CvmMemCtl[LMEMSZ] =</span>
<a name="l00573"></a>00573 <span class="comment"> CONFIG_CAVIUM_OCTEON_EXTRA_CVMSEG + lines used by kernel.</span>
<a name="l00574"></a>00574 <span class="comment">-# Kernel access to CVMSEG is enabled using CvmMemCtl[CVMSEGENAK] = 1.</span>
<a name="l00575"></a>00575 <span class="comment">-# User access to CVMSEG is disabled using CvmMemCtl[CVMSEGENAU] = 0.</span>
<a name="l00576"></a>00576 <span class="comment">-# Applications runs and executes an access to CVMSEG. This could be a</span>
<a name="l00577"></a>00577 <span class="comment">  load, store, or an asynchronous IOBDMA.</span>
<a name="l00578"></a>00578 <span class="comment">-# Kernel receives an invalid memory reference exception.</span>
<a name="l00579"></a>00579 <span class="comment">-# In @b do_ade(), the kernel determines the address is in CVMSEG.</span>
<a name="l00580"></a>00580 <span class="comment">-# The kernel enables user access to CVMSEG using CvmMemCtl[CVMSEGENAU] = 1.</span>
<a name="l00581"></a>00581 <span class="comment">-# Kernel returns control to the application.</span>
<a name="l00582"></a>00582 <span class="comment">-# Application continues processing, performing any number of CVMSEG</span>
<a name="l00583"></a>00583 <span class="comment">  accesses.</span>
<a name="l00584"></a>00584 <span class="comment">-# Application stops processing and returns to kernel context. This can</span>
<a name="l00585"></a>00585 <span class="comment">  occur through a interrupt, exception, or syscall.</span>
<a name="l00586"></a>00586 <span class="comment">-# Kernel performs a context switch by calling @b resume.</span>
<a name="l00587"></a>00587 <span class="comment">-# The assembly function @b resume checks if COP0 CvmMemCtl[CVMSEGENAU] has</span>
<a name="l00588"></a>00588 <span class="comment">  enabled CVMSEG. If so, it saves CVMSEG state.</span>
<a name="l00589"></a>00589 <span class="comment">-# CVMSEG is again disabled using COP0 CvmMemCtl[CVMSEGENAU].</span>
<a name="l00590"></a>00590 <span class="comment">-# Normal kernel processing continues.</span>
<a name="l00591"></a>00591 <span class="comment">-# Control returns to the application. Note that CVMSEG is still disabled.</span>
<a name="l00592"></a>00592 <span class="comment">-# Application continues processing until reaching a CVMSEG access.</span>
<a name="l00593"></a>00593 <span class="comment">-# Kernel receives an invalid memory reference exception.</span>
<a name="l00594"></a>00594 <span class="comment">-# In @b do_ade(), the kernel determines the address is in CVMSEG.</span>
<a name="l00595"></a>00595 <span class="comment">-# The kernel restore CVMSEG context and enables user access to CVMSEG</span>
<a name="l00596"></a>00596 <span class="comment">  using CvmMemCtl[CVMSEGENAU] = 1.</span>
<a name="l00597"></a>00597 <span class="comment">-# Kernel returns control to the application.</span>
<a name="l00598"></a>00598 <span class="comment"></span>
<a name="l00599"></a>00599 <span class="comment">Kernel use of CVMSEG must always save and restore any changes that it</span>
<a name="l00600"></a>00600 <span class="comment">makes. It must issue a SYNCIOBDMA to make sure all asynchronous operations</span>
<a name="l00601"></a>00601 <span class="comment">are complete before the save and before the restore.</span>
<a name="l00602"></a>00602 <span class="comment"></span>
<a name="l00603"></a>00603 <span class="comment">@section linux_mul 9. Process Context and the Multiply Unit</span>
<a name="l00604"></a>00604 <span class="comment"></span>
<a name="l00605"></a>00605 <span class="comment">The extended multiply unit context is saved in SAVE_SOME and restore in</span>
<a name="l00606"></a>00606 <span class="comment">RESTORE_SOME(stackframe.h). This occurs every time the processor switches</span>
<a name="l00607"></a>00607 <span class="comment">from user to kernel context due to an interrupt, exception, or syscall. The</span>
<a name="l00608"></a>00608 <span class="comment">multiply unit may be freely used from user and kernel space.</span>
<a name="l00609"></a>00609 <span class="comment"></span>
<a name="l00610"></a>00610 <span class="comment">@section linux_tls 10. Accelerated Thread Local Storage (TLS) Access</span>
<a name="l00611"></a>00611 <span class="comment"></span>
<a name="l00612"></a>00612 <span class="comment">On the Mips architecture, Linux implements thread local storage</span>
<a name="l00613"></a>00613 <span class="comment">(TLS) using hardware register 29. GCC and Glibc use the</span>
<a name="l00614"></a>00614 <span class="comment">instruction &lt;b&gt;rdhwr v1, $29&lt;/b&gt; to get the current value of the</span>
<a name="l00615"></a>00615 <span class="comment">thread pointer. Since hardware register 29 doesn&apos;t exist on most</span>
<a name="l00616"></a>00616 <span class="comment">Mips processors (including OCTEON and OCTEON Plus), the kernel</span>
<a name="l00617"></a>00617 <span class="comment">traps this instruction with a Reserved Instruction Exception. The</span>
<a name="l00618"></a>00618 <span class="comment">exception handler emulates the rdhwr instruction and places the</span>
<a name="l00619"></a>00619 <span class="comment">current thread pointer in &quot;v1&quot;. The overhead in emulating this non</span>
<a name="l00620"></a>00620 <span class="comment">existent hardware register is very high.  Because OCTEON II</span>
<a name="l00621"></a>00621 <span class="comment">processor does implement hardware register 29, there is no added</span>
<a name="l00622"></a>00622 <span class="comment">overhead for it to execute the &lt;b&gt;rdhwr v1, $29&lt;/b&gt; instructions.</span>
<a name="l00623"></a>00623 <span class="comment"></span>
<a name="l00624"></a>00624 <span class="comment">On OCTEON, use of k0 and CVMSEG provide a much faster access to the thread</span>
<a name="l00625"></a>00625 <span class="comment">pointer. Using a combination of the two, OCTEON Linux accesses the thread</span>
<a name="l00626"></a>00626 <span class="comment">pointer using a single dual issueable instruction. Applications heavily</span>
<a name="l00627"></a>00627 <span class="comment">using TLS and threads will receive a major performance boost. The normal</span>
<a name="l00628"></a>00628 <span class="comment">Mips instruction emulation, talking many hundreds of cycles, is replaced</span>
<a name="l00629"></a>00629 <span class="comment">with a single cycle local access. Support for the improved access is part</span>
<a name="l00630"></a>00630 <span class="comment">of the Cavium supplied toolchain.</span>
<a name="l00631"></a>00631 <span class="comment"></span>
<a name="l00632"></a>00632 <span class="comment">If you are using a non Cavium toolchain, or a toolchain prior to SDK 1.5,</span>
<a name="l00633"></a>00633 <span class="comment">the kernel supports dynamically replacing instructions in userspace with</span>
<a name="l00634"></a>00634 <span class="comment">the faster access method. Instruction replacement is disabled on boot. It</span>
<a name="l00635"></a>00635 <span class="comment">can be controlled by writing a mode to</span>
<a name="l00636"></a>00636 <span class="comment">&lt;b&gt;/sys/module/traps/parameters/thread_pointer_mode&lt;/b&gt;. The supported</span>
<a name="l00637"></a>00637 <span class="comment">modes are:</span>
<a name="l00638"></a>00638 <span class="comment"></span>
<a name="l00639"></a>00639 <span class="comment"> - 0 - Use the normal kernel emulation without any changes.</span>
<a name="l00640"></a>00640 <span class="comment"> - 1 - Replace emulated instructions with direct accesses to the thread</span>
<a name="l00641"></a>00641 <span class="comment">   register.</span>
<a name="l00642"></a>00642 <span class="comment"> - 2 - Replace emulated instructions and log the replacement PC.</span>
<a name="l00643"></a>00643 <span class="comment"> - 3 - Replace emulated instructions with break instructions. This will</span>
<a name="l00644"></a>00644 <span class="comment">   cause programs to fail, but makes it easy to stop gdb on the</span>
<a name="l00645"></a>00645 <span class="comment">   instruction.</span>
<a name="l00646"></a>00646 <span class="comment"></span>
<a name="l00647"></a>00647 <span class="comment">In implementing fast TLS access, OCTEON uses the k0 register in userspace</span>
<a name="l00648"></a>00648 <span class="comment">and the highest allocated CVMSEG address. It is normally not valid to use</span>
<a name="l00649"></a>00649 <span class="comment">the k0 register in userspace, so this will not affect userspace programs.</span>
<a name="l00650"></a>00650 <span class="comment">The CVMSEG usage will cause problems for applications that use the same</span>
<a name="l00651"></a>00651 <span class="comment">address as the kernel. In the case of a conflict, TLS will continue to</span>
<a name="l00652"></a>00652 <span class="comment">function properly, but any data the application has placed in the last</span>
<a name="l00653"></a>00653 <span class="comment">CVMSEG address will be corrupted.</span>
<a name="l00654"></a>00654 <span class="comment"></span>
<a name="l00655"></a>00655 <span class="comment">Starting with SDK 2.0, if the Cavium toolchain is generating code</span>
<a name="l00656"></a>00656 <span class="comment">for OCTEON II processors (by passing -march=octeon2 to the</span>
<a name="l00657"></a>00657 <span class="comment">compiler), the standard TLS access using &lt;b&gt;rdhwr v1, $29&lt;/b&gt; is</span>
<a name="l00658"></a>00658 <span class="comment">generated.  However by default, when generating code for OCTEON and OCTEON</span>
<a name="l00659"></a>00659 <span class="comment">Plus processors, the accelerated TLS access using k0 is used.</span>
<a name="l00660"></a>00660 <span class="comment"></span>
<a name="l00661"></a>00661 <span class="comment">@section linux_mapped_kernel 11. Running the Linux kernel in mapped memory.</span>
<a name="l00662"></a>00662 <span class="comment"></span>
<a name="l00663"></a>00663 <span class="comment">The default configuration of the Linux kernel places the kernel in</span>
<a name="l00664"></a>00664 <span class="comment">unmapped memory, and any loadable kernel modules are in a mapped</span>
<a name="l00665"></a>00665 <span class="comment">memory region.  This separation of the kernel and modules requires</span>
<a name="l00666"></a>00666 <span class="comment">that a less efficient function calling mechanism be used in the</span>
<a name="l00667"></a>00667 <span class="comment">kernel modules than in the kernel itself, resulting in a decrease</span>
<a name="l00668"></a>00668 <span class="comment">in performance for some code.</span>
<a name="l00669"></a>00669 <span class="comment"></span>
<a name="l00670"></a>00670 <span class="comment">The optional CONFIG_MAPPED_KERNEL kernel configuration parameter</span>
<a name="l00671"></a>00671 <span class="comment">causes the kernel to be run in the mapped memory region.  It also</span>
<a name="l00672"></a>00672 <span class="comment">builds the kernel modules with the same efficient function calling</span>
<a name="l00673"></a>00673 <span class="comment">mechanism used in the main kernel.  The result can be increased</span>
<a name="l00674"></a>00674 <span class="comment">performance, however one TLB entry on each core is used for the</span>
<a name="l00675"></a>00675 <span class="comment">kernel mapping, thus reducing the number of TLB entries available</span>
<a name="l00676"></a>00676 <span class="comment">for normal use.  Reducing the number of available TLB entries in</span>
<a name="l00677"></a>00677 <span class="comment">this manner, might cause a reduction in performance, so</span>
<a name="l00678"></a>00678 <span class="comment">benchmarking of the intended workload should be done to determine</span>
<a name="l00679"></a>00679 <span class="comment">if CONFIG_MAPPED_KERNEL actually improves performance for the case</span>
<a name="l00680"></a>00680 <span class="comment">in question.</span>
<a name="l00681"></a>00681 <span class="comment"></span>
<a name="l00682"></a>00682 <span class="comment">@subsection Booting Two separate mapped kernels.</span>
<a name="l00683"></a>00683 <span class="comment"></span>
<a name="l00684"></a>00684 <span class="comment">OCTEON Linux can be configured to run two separate mapped kernels with each</span>
<a name="l00685"></a>00685 <span class="comment">kernel using separate uart for their respective consoles. The procedure</span>
<a name="l00686"></a>00686 <span class="comment">for building two separate kernels is the same as mentioned in @ref linux_kernel_boot2</span>
<a name="l00687"></a>00687 <span class="comment">section. Also enable CONFIG_MAPPED_KERNEL config option, while building both</span>
<a name="l00688"></a>00688 <span class="comment">the kernels.</span>
<a name="l00689"></a>00689 <span class="comment"></span>
<a name="l00690"></a>00690 <span class="comment">Both the images are linked at the same virtual address, and the bootloader</span>
<a name="l00691"></a>00691 <span class="comment">makes sure it allocates separate physical memory while loading them.</span>
<a name="l00692"></a>00692 <span class="comment"></span>
<a name="l00693"></a>00693 <span class="comment">@section linux_per_process_xkphys_access 12. Per-process access control for XKPHYS</span>
<a name="l00694"></a>00694 <span class="comment"></span>
<a name="l00695"></a>00695 <span class="comment">There are certain applications (like Simple Executive applications running in</span>
<a name="l00696"></a>00696 <span class="comment">Linux userspace) that require direct access to XKPHYS memory and IO spaces. By</span>
<a name="l00697"></a>00697 <span class="comment">default access to XKPHYS segments is disabled for all applications. Applications</span>
<a name="l00698"></a>00698 <span class="comment">which need to access these segments need to call sysmips() system call to enable</span>
<a name="l00699"></a>00699 <span class="comment">access.</span>
<a name="l00700"></a>00700 <span class="comment"></span>
<a name="l00701"></a>00701 <span class="comment">To enable access to XKPHYS memory space the application needs to call sysmips as</span>
<a name="l00702"></a>00702 <span class="comment">follows:</span>
<a name="l00703"></a>00703 <span class="comment"></span>
<a name="l00704"></a>00704 <span class="comment">@code</span>
<a name="l00705"></a>00705 <span class="comment">sysmips(MIPS_CAVIUM_XKPHYS_WRITE, getpid(), 1, 0);</span>
<a name="l00706"></a>00706 <span class="comment">@endcode</span>
<a name="l00707"></a>00707 <span class="comment"></span>
<a name="l00708"></a>00708 <span class="comment">To enable access to XKPHYS IO space:</span>
<a name="l00709"></a>00709 <span class="comment"></span>
<a name="l00710"></a>00710 <span class="comment">@code</span>
<a name="l00711"></a>00711 <span class="comment">sysmips(MIPS_CAVIUM_XKPHYS_WRITE, getpid(), 2, 0);</span>
<a name="l00712"></a>00712 <span class="comment">@endcode</span>
<a name="l00713"></a>00713 <span class="comment"></span>
<a name="l00714"></a>00714 <span class="comment">To enable access to both XKPHYS memory and IO space:</span>
<a name="l00715"></a>00715 <span class="comment"></span>
<a name="l00716"></a>00716 <span class="comment">@code</span>
<a name="l00717"></a>00717 <span class="comment">sysmips(MIPS_CAVIUM_XKPHYS_WRITE, getpid(), 3, 0);</span>
<a name="l00718"></a>00718 <span class="comment">@endcode</span>
<a name="l00719"></a>00719 <span class="comment"></span>
<a name="l00720"></a>00720 <span class="comment">The kernel also provides config options for enabling XKPHYS access for all</span>
<a name="l00721"></a>00721 <span class="comment">processes without requiring them to call sysmips(). Using these config options is</span>
<a name="l00722"></a>00722 <span class="comment">not recommended. See section 23 below for a complete list of OCTEON specific</span>
<a name="l00723"></a>00723 <span class="comment">config options.</span>
<a name="l00724"></a>00724 <span class="comment"></span>
<a name="l00725"></a>00725 <span class="comment">@section linux_cvmx 13. Co-existing with Simple Executive Applications</span>
<a name="l00726"></a>00726 <span class="comment"></span>
<a name="l00727"></a>00727 <span class="comment">If Linux is running on a subset of the OCTEON cores, it can co-exist with</span>
<a name="l00728"></a>00728 <span class="comment">other operating systems and simple executive applications. Internally</span>
<a name="l00729"></a>00729 <span class="comment">Linux uses the simple executive libraries for memory management,</span>
<a name="l00730"></a>00730 <span class="comment">synchronization, and hardware access. For example, all memory used by Linux</span>
<a name="l00731"></a>00731 <span class="comment">is allocated using the simple executive function cvmx_bootmem_alloc(). So</span>
<a name="l00732"></a>00732 <span class="comment">long as each application / operating system uses the appropriate CVMX</span>
<a name="l00733"></a>00733 <span class="comment">library calls for memory management and synchronization, each core can</span>
<a name="l00734"></a>00734 <span class="comment">perform a completely independent task. All cores must cooperate for all</span>
<a name="l00735"></a>00735 <span class="comment">shared hardware configuration. The @ref bootloader documentation provides</span>
<a name="l00736"></a>00736 <span class="comment">details about loading and starting multiple operating systems /</span>
<a name="l00737"></a>00737 <span class="comment">applications. Here is a list of general guidelines:</span>
<a name="l00738"></a>00738 <span class="comment"></span>
<a name="l00739"></a>00739 <span class="comment">-# Allocate shared memory using cvmx_bootmem_alloc(). This function</span>
<a name="l00740"></a>00740 <span class="comment">   provides the needed synchronization so that no applications get</span>
<a name="l00741"></a>00741 <span class="comment">   overlapping memory.</span>
<a name="l00742"></a>00742 <span class="comment">-# Keep core dependencies generic. Instead of allocating cores by core ID,</span>
<a name="l00743"></a>00743 <span class="comment">   use cvmx_sysinfo_get() to get the bitmask of cores actually running</span>
<a name="l00744"></a>00744 <span class="comment">   your application. Use cvmx_sysinfo_t::core_mask to determine how many cores are</span>
<a name="l00745"></a>00745 <span class="comment">   running your application, and use cvmx_is_init_core() to select</span>
<a name="l00746"></a>00746 <span class="comment">   the core for initialization tasks.</span>
<a name="l00747"></a>00747 <span class="comment">-# Choose a single application to perform hardware initialization. Many</span>
<a name="l00748"></a>00748 <span class="comment">   initialization tasks must only be performed once.</span>
<a name="l00749"></a>00749 <span class="comment">-# Use OCTEON hardware for inter application communication. The POW with</span>
<a name="l00750"></a>00750 <span class="comment">   groups and the FAU unit provide fast hardware based messaging.</span>
<a name="l00751"></a>00751 <span class="comment"></span>
<a name="l00752"></a>00752 <span class="comment">@section linux_hotplug_cpu 14. Linux Hot-Plug CPU.</span>
<a name="l00753"></a>00753 <span class="comment"></span>
<a name="l00754"></a>00754 <span class="comment">If the kernel is built with the CONFIG_HOTPLUG_CPU kernel</span>
<a name="l00755"></a>00755 <span class="comment">configuration parameter, OCTEON CPU cores can be removed from the</span>
<a name="l00756"></a>00756 <span class="comment">set of cores used by the Linux kernel. This also allows adding </span>
<a name="l00757"></a>00757 <span class="comment">new cores to the existing set of cores. </span>
<a name="l00758"></a>00758 <span class="comment"></span>
<a name="l00759"></a>00759 <span class="comment">See &lt;b&gt;linux/kernel/linux/Documentation/cpu-hotplug.txt&lt;/b&gt; for details.</span>
<a name="l00760"></a>00760 <span class="comment"></span>
<a name="l00761"></a>00761 <span class="comment">Cores removed from Linux can then be used to run Simple Executive applications  </span>
<a name="l00762"></a>00762 <span class="comment">(linux_user_bootoct).</span>
<a name="l00763"></a>00763 <span class="comment"></span>
<a name="l00764"></a>00764 <span class="comment">@section linux_ethernet 15. Kernel Ethernet Drivers</span>
<a name="l00765"></a>00765 <span class="comment"></span>
<a name="l00766"></a>00766 <span class="comment">@subsection octeon_ethernet_driver PIP/IPD/PKO driver for OCTEON and OCTEON II</span>
<a name="l00767"></a>00767 <span class="comment"></span>
<a name="l00768"></a>00768 <span class="comment"></span>
<a name="l00769"></a>00769 <span class="comment">An ethernet driver module is available in the kernel to support OCTEON</span>
<a name="l00770"></a>00770 <span class="comment">using the SGMII interfaces or SPI4 with a SPI4000 daughter card or XAUI</span>
<a name="l00771"></a>00771 <span class="comment">interfaces. SGMII ports show up as ethernet devices @b eth0 through @b eth4,</span>
<a name="l00772"></a>00772 <span class="comment">SPI4000 ports are devices @b spi0 through @b spi9 and XAUI port show up</span>
<a name="l00773"></a>00773 <span class="comment">as ethernet device @b xaui0. The interfaces vary based on which OCTEON</span>
<a name="l00774"></a>00774 <span class="comment">model is being used.</span>
<a name="l00775"></a>00775 <span class="comment"></span>
<a name="l00776"></a>00776 <span class="comment">In order to configure different modes of operation, the ethernet driver</span>
<a name="l00777"></a>00777 <span class="comment">module supports a number of module parameters for controlling its</span>
<a name="l00778"></a>00778 <span class="comment">configuration. These are set when you &lt;b&gt;modprobe&lt;/b&gt; the ethernet driver.</span>
<a name="l00779"></a>00779 <span class="comment"></span>
<a name="l00780"></a>00780 <span class="comment">@verbatim</span>
<a name="l00781"></a>00781 <span class="comment">    $ modprobe octeon-ethernet [param=value ...]</span>
<a name="l00782"></a>00782 <span class="comment">@endverbatim</span>
<a name="l00783"></a>00783 <span class="comment"></span>
<a name="l00784"></a>00784 <span class="comment">- num_packet_buffers</span>
<a name="l00785"></a>00785 <span class="comment"> + Number of packet buffers to allocate and store in the</span>
<a name="l00786"></a>00786 <span class="comment">   FPA. By default, 1024 packet buffers are used.</span>
<a name="l00787"></a>00787 <span class="comment">- pow_receive_group</span>
<a name="l00788"></a>00788 <span class="comment"> + POW group to receive packets from. All ethernet hardware</span>
<a name="l00789"></a>00789 <span class="comment">   will be configured to send incoming packets to this POW</span>
<a name="l00790"></a>00790 <span class="comment">   group. Also any other software can submit packets to this</span>
<a name="l00791"></a>00791 <span class="comment">   group for the kernel to process.</span>
<a name="l00792"></a>00792 <span class="comment">- disable_core_queueing</span>
<a name="l00793"></a>00793 <span class="comment"> + When set the networking core&apos;s tx_queue_len is set to zero.  This</span>
<a name="l00794"></a>00794 <span class="comment">   allows packets to be sent without lock contention in the packet</span>
<a name="l00795"></a>00795 <span class="comment">   scheduler resulting in some cases in improved throughput.</span>
<a name="l00796"></a>00796 <span class="comment">- max_rx_cpus</span>
<a name="l00797"></a>00797 <span class="comment"> + The maximum number of CPUs to use for packet reception.</span>
<a name="l00798"></a>00798 <span class="comment">   Use -1 to use all available CPUs.</span>
<a name="l00799"></a>00799 <span class="comment">- rx_napi_weight</span>
<a name="l00800"></a>00800 <span class="comment"> + The NAPI WEIGHT parameter.</span>
<a name="l00801"></a>00801 <span class="comment"></span>
<a name="l00802"></a>00802 <span class="comment">The ethernet module assumes the OCTEON hardware needs to be initialized</span>
<a name="l00803"></a>00803 <span class="comment">before use. It configures the POW, FPA, CIU, PIP, IPD, PKO, and the FAU.</span>
<a name="l00804"></a>00804 <span class="comment">It uses a configuration very similar to the one supplied by</span>
<a name="l00805"></a>00805 <span class="comment">cvmx_helper_initialize_fpa() and cvmx_helper_initialize_packet_io_global().</span>
<a name="l00806"></a>00806 <span class="comment"></span>
<a name="l00807"></a>00807 <span class="comment">When the driver is in use, applications must not reconfigure the hardware.</span>
<a name="l00808"></a>00808 <span class="comment">All packets in POW group @b 15 will be processed by the kernel. Applications</span>
<a name="l00809"></a>00809 <span class="comment">running in user mode or in the simple executive standalone</span>
<a name="l00810"></a>00810 <span class="comment">environment may use this group to forward packets to the kernel for</span>
<a name="l00811"></a>00811 <span class="comment">processing.</span>
<a name="l00812"></a>00812 <span class="comment"></span>
<a name="l00813"></a>00813 <span class="comment">The ethernet driver, along with @b oct-packet-io, can be used to connect the</span>
<a name="l00814"></a>00814 <span class="comment">OCTEON simulator onto a real ethernet device. This allows the simulator</span>
<a name="l00815"></a>00815 <span class="comment">virtual machine to appear on a network just like real hardware. Here are</span>
<a name="l00816"></a>00816 <span class="comment">the steps required:</span>
<a name="l00817"></a>00817 <span class="comment"></span>
<a name="l00818"></a>00818 <span class="comment">-# In the simulated Linux, use ifconfig to set the MAC address to match the</span>
<a name="l00819"></a>00819 <span class="comment"> address of the ethernet card used for a bridge. If you&apos;re willing to</span>
<a name="l00820"></a>00820 <span class="comment"> run the ethernet card in promiscuous mode this isn&apos;t necessary.</span>
<a name="l00821"></a>00821 <span class="comment"> @code</span>
<a name="l00822"></a>00822 <span class="comment">    simulator$ ifconfig eth0 hw ether XX:XX:XX:XX:XX:XX</span>
<a name="l00823"></a>00823 <span class="comment"> @endcode</span>
<a name="l00824"></a>00824 <span class="comment">-# Make sure the ethernet device is up. It doesn&apos;t have to have an IP</span>
<a name="l00825"></a>00825 <span class="comment"> address. You may also want to put it in promiscuous mode.</span>
<a name="l00826"></a>00826 <span class="comment"> @code</span>
<a name="l00827"></a>00827 <span class="comment">    host$ ifconfig ??? up</span>
<a name="l00828"></a>00828 <span class="comment"> @endcode</span>
<a name="l00829"></a>00829 <span class="comment">-# Use @b oct-packet-io to bridge ethernet packets into the simulator.</span>
<a name="l00830"></a>00830 <span class="comment"> Specify &quot;-o /dev/null&quot; to disable the logging of all packets coming</span>
<a name="l00831"></a>00831 <span class="comment"> out of the simulator. Note that bridging requires @b root @b privileges.</span>
<a name="l00832"></a>00832 <span class="comment"> @code</span>
<a name="l00833"></a>00833 <span class="comment">    host$ sudo oct-packet-io -p 2000 -b 0:???</span>
<a name="l00834"></a>00834 <span class="comment"> @endcode</span>
<a name="l00835"></a>00835 <span class="comment">-# In the simulator assign the ethernet a valid IP address. If you have a</span>
<a name="l00836"></a>00836 <span class="comment"> DHCP server, you may be able to use @b udhcpc to get an address. For @b</span>
<a name="l00837"></a>00837 <span class="comment"> udhcpc to work the interface must be @b up.</span>
<a name="l00838"></a>00838 <span class="comment"> @code</span>
<a name="l00839"></a>00839 <span class="comment">    simulator$ ifconfig eth0 192.168.1.100</span>
<a name="l00840"></a>00840 <span class="comment"></span>
<a name="l00841"></a>00841 <span class="comment">    or</span>
<a name="l00842"></a>00842 <span class="comment"></span>
<a name="l00843"></a>00843 <span class="comment">    simulator$ ifconfig eth0 up</span>
<a name="l00844"></a>00844 <span class="comment">    simulator$ udhcpc -n -q -i eth0</span>
<a name="l00845"></a>00845 <span class="comment"> @endcode</span>
<a name="l00846"></a>00846 <span class="comment">-# Ping the simulator. it should now be possible to ping the simulator</span>
<a name="l00847"></a>00847 <span class="comment"> from another host.</span>
<a name="l00848"></a>00848 <span class="comment"> @code</span>
<a name="l00849"></a>00849 <span class="comment">    host2$ ping 192.168.1.100</span>
<a name="l00850"></a>00850 <span class="comment"> @endcode</span>
<a name="l00851"></a>00851 <span class="comment">-# Telnet to the simulator. Assuming everything is working, you should be</span>
<a name="l00852"></a>00852 <span class="comment"> able to telnet to the simulator and get a shell prompt.</span>
<a name="l00853"></a>00853 <span class="comment"> @code</span>
<a name="l00854"></a>00854 <span class="comment">    host2$ telnet 192.168.1.100</span>
<a name="l00855"></a>00855 <span class="comment"> @endcode</span>
<a name="l00856"></a>00856 <span class="comment"></span>
<a name="l00857"></a>00857 <span class="comment">@note Since the packet interface used for bridging bypasses routing, the</span>
<a name="l00858"></a>00858 <span class="comment"> local host cannot reach the simulator. In order for the localhost to be</span>
<a name="l00859"></a>00859 <span class="comment"> able to reach the simulator, it must have two ethernet cards. The second</span>
<a name="l00860"></a>00860 <span class="comment"> card can then be dedicated to the simulator.</span>
<a name="l00861"></a>00861 <span class="comment"></span>
<a name="l00862"></a>00862 <span class="comment">The simulated environment is much slower than real hardware. Some protocols</span>
<a name="l00863"></a>00863 <span class="comment">may not function correctly due to timeouts and slow data transfer. NFS,</span>
<a name="l00864"></a>00864 <span class="comment">HTTP, telnet, and ssh have all been successfully tested.</span>
<a name="l00865"></a>00865 <span class="comment"></span>
<a name="l00866"></a>00866 <span class="comment">@subsection octeon3_ethernet_driver PKI/PKO driver for OCTEON III</span>
<a name="l00867"></a>00867 <span class="comment"></span>
<a name="l00868"></a>00868 <span class="comment">cn78xx, cn76xx, cn73xx and cnf75xx OCTEON III processors use a separate driver</span>
<a name="l00869"></a>00869 <span class="comment">to support Ethernet interfaces.  Each port will show up as @b eth0</span>
<a name="l00870"></a>00870 <span class="comment">through @b ethX.</span>
<a name="l00871"></a>00871 <span class="comment"></span>
<a name="l00872"></a>00872 <span class="comment">There are several module parameters that may be changed, although the</span>
<a name="l00873"></a>00873 <span class="comment">default values should give good performance.</span>
<a name="l00874"></a>00874 <span class="comment"></span>
<a name="l00875"></a>00875 <span class="comment">@verbatim</span>
<a name="l00876"></a>00876 <span class="comment">    $ modprobe octeon3-ethernet [param=value ...]</span>
<a name="l00877"></a>00877 <span class="comment">@endverbatim</span>
<a name="l00878"></a>00878 <span class="comment"></span>
<a name="l00879"></a>00879 <span class="comment">- recycle_skbs</span>
<a name="l00880"></a>00880 <span class="comment"> + When set, allow hardware assisted reuse of packet buffers when forwarding packets.</span>
<a name="l00881"></a>00881 <span class="comment">- use_tx_queues</span>
<a name="l00882"></a>00882 <span class="comment"> + When clear, the networking core&apos;s tx_queue_len is set to zero.  This</span>
<a name="l00883"></a>00883 <span class="comment">   allows packets to be sent without lock contention in the packet</span>
<a name="l00884"></a>00884 <span class="comment">   scheduler resulting in some cases in improved throughput.</span>
<a name="l00885"></a>00885 <span class="comment">- wait_pko_response</span>
<a name="l00886"></a>00886 <span class="comment"> + Wait for response after each pko command.</span>
<a name="l00887"></a>00887 <span class="comment">- num_packet_buffers</span>
<a name="l00888"></a>00888 <span class="comment"> + Number of packet buffers to allocate per port.</span>
<a name="l00889"></a>00889 <span class="comment">- packet_buffer_size</span>
<a name="l00890"></a>00890 <span class="comment"> + Size of each RX packet buffer.</span>
<a name="l00891"></a>00891 <span class="comment">- rx_contexts</span>
<a name="l00892"></a>00892 <span class="comment"> + Number of RX threads per port.</span>
<a name="l00893"></a>00893 <span class="comment"></span>
<a name="l00894"></a>00894 <span class="comment">@subsection linux_mgmt Management port Ethernet drivers</span>
<a name="l00895"></a>00895 <span class="comment"></span>
<a name="l00896"></a>00896 <span class="comment">In addition to the main Ethernet ports mentioned above, all </span>
<a name="l00897"></a>00897 <span class="comment">OCTEON/OCTEON II/OCTEON III processors have additional MII</span>
<a name="l00898"></a>00898 <span class="comment">or RGMII Ethernet ports.  These are controlled by the octeon_mgmt</span>
<a name="l00899"></a>00899 <span class="comment">Ethernet driver and will be named mgmt0 and mgmt1 (if present).</span>
<a name="l00900"></a>00900 <span class="comment">The driver is selected with the CONFIG_OCTEON_MGMT_ETHERNET kernel</span>
<a name="l00901"></a>00901 <span class="comment">configuration parameter.  There are no user settable parameters</span>
<a name="l00902"></a>00902 <span class="comment">for this driver.</span>
<a name="l00903"></a>00903 <span class="comment"></span>
<a name="l00904"></a>00904 <span class="comment">@subsection octeon_pow_ethernet POW Ethernet drivers</span>
<a name="l00905"></a>00905 <span class="comment"></span>
<a name="l00906"></a>00906 <span class="comment">The octeon_pow_ethernet creates network devices that send and</span>
<a name="l00907"></a>00907 <span class="comment">receive packets to and from POW/SSO groups.  These can be used for</span>
<a name="l00908"></a>00908 <span class="comment">communicating with CVMX applications as well as other Linux kernel</span>
<a name="l00909"></a>00909 <span class="comment">instances.</span>
<a name="l00910"></a>00910 <span class="comment"></span>
<a name="l00911"></a>00911 <span class="comment">@verbatim</span>
<a name="l00912"></a>00912 <span class="comment">    $ modprobe octeon-pow-ethernet [param=value ...]</span>
<a name="l00913"></a>00913 <span class="comment">@endverbatim</span>
<a name="l00914"></a>00914 <span class="comment"></span>
<a name="l00915"></a>00915 <span class="comment">-# receive_group</span>
<a name="l00916"></a>00916 <span class="comment"> + POW group from which to receive packets on the oct0 interface.</span>
<a name="l00917"></a>00917 <span class="comment">-# broadcast_groups</span>
<a name="l00918"></a>00918 <span class="comment"> + POW group mask to send broadcasts to.</span>
<a name="l00919"></a>00919 <span class="comment">-# ptp_rx_group (optional)</span>
<a name="l00920"></a>00920 <span class="comment"> + POW group from which to receive packets on for the pow0</span>
<a name="l00921"></a>00921 <span class="comment">   interface.  This a a Point-to-Point mode interface that</span>
<a name="l00922"></a>00922 <span class="comment">   always sends and receives from exactly the POW groups</span>
<a name="l00923"></a>00923 <span class="comment">   specified.</span>
<a name="l00924"></a>00924 <span class="comment">-# ptp_tx_group (optional)</span>
<a name="l00925"></a>00925 <span class="comment"> + POW group to send packets to for the pow0 interface.</span>
<a name="l00926"></a>00926 <span class="comment">-# reverse_endian</span>
<a name="l00927"></a>00927 <span class="comment"> + If a mix of big/little-endian code is running, set</span>
<a name="l00928"></a>00928 <span class="comment">   reverse_endian=1 on one side only.</span>
<a name="l00929"></a>00929 <span class="comment">CN7XXX only:</span>
<a name="l00930"></a>00930 <span class="comment">-# pki_packet_pool</span>
<a name="l00931"></a>00931 <span class="comment"> + On CN7XXX devices this specifies the fpa pool to use for packet</span>
<a name="l00932"></a>00932 <span class="comment">   allocation. This argument should be supplied by the remote executable</span>
<a name="l00933"></a>00933 <span class="comment">   for SE applications. See sdk/examples/linux-filter/README.txt for</span>
<a name="l00934"></a>00934 <span class="comment">   more information.</span>
<a name="l00935"></a>00935 <span class="comment"></span>
<a name="l00936"></a>00936 <span class="comment">@section linux_usb 16. Kernel USB Drivers</span>
<a name="l00937"></a>00937 <span class="comment"></span>
<a name="l00938"></a>00938 <span class="comment">Some OCTEON processors have Universal Serial Bus (USB) ports.  The</span>
<a name="l00939"></a>00939 <span class="comment">cn3XXX and cn5XXX OCTEON processors with USB use the octeon-hcd</span>
<a name="l00940"></a>00940 <span class="comment">driver, cn6XXX OCTEON processors use standard ehci/ohci</span>
<a name="l00941"></a>00941 <span class="comment">drivers, and cn7xxx OCTEON processors use standard xhci driver. </span>
<a name="l00942"></a>00942 <span class="comment"></span>
<a name="l00943"></a>00943 <span class="comment">@subsection linux_usb_dwc_otg cn3XXX and cn5XXX USB</span>
<a name="l00944"></a>00944 <span class="comment"></span>
<a name="l00945"></a>00945 <span class="comment">The octeon-hcd driver is selected with the CONFIG_USB_OCTEON_HCD</span>
<a name="l00946"></a>00946 <span class="comment">kernel configuration parameter.</span>
<a name="l00947"></a>00947 <span class="comment"></span>
<a name="l00948"></a>00948 <span class="comment">@subsection linux_usb_ehci cn6XXX USB</span>
<a name="l00949"></a>00949 <span class="comment"></span>
<a name="l00950"></a>00950 <span class="comment">The ehci/ohci USB blocks on cn6XXX OCTEON processors use the standard</span>
<a name="l00951"></a>00951 <span class="comment">Linux EHCI and OHCI drivers, however additional OCTEON specific</span>
<a name="l00952"></a>00952 <span class="comment">interface options must also be selected to enable these drivers to</span>
<a name="l00953"></a>00953 <span class="comment">work with OCTEON II processors.  To enable these drivers, first select</span>
<a name="l00954"></a>00954 <span class="comment">the CONFIG_USB_EHCI_HCD and CONFIG_USB_OHCI_HCD options, then select</span>
<a name="l00955"></a>00955 <span class="comment">CONFIG_USB_OCTEON_EHCI and CONFIG_USB_OCTEON_OHCI.</span>
<a name="l00956"></a>00956 <span class="comment"></span>
<a name="l00957"></a>00957 <span class="comment">@subsection linux_usb_xhci cn7XXX USB</span>
<a name="l00958"></a>00958 <span class="comment"></span>
<a name="l00959"></a>00959 <span class="comment">The xhci USB blocks on cn7XXX OCTEON processors use the standard</span>
<a name="l00960"></a>00960 <span class="comment">Linux XHCI driver, however additional OCTEON specific interface option</span>
<a name="l00961"></a>00961 <span class="comment">must also be selected to enable this driver to work with OCTEON III</span>
<a name="l00962"></a>00962 <span class="comment">processors.  To enable these drivers, first select the</span>
<a name="l00963"></a>00963 <span class="comment">CONFIG_USB_XHCI_HCD option, then select CONFIG_USB_XHCI_HCD_OCTEON.</span>
<a name="l00964"></a>00964 <span class="comment"></span>
<a name="l00965"></a>00965 <span class="comment">@section linux_rng 17. Kernel Random Number Generator (RNG) Driver</span>
<a name="l00966"></a>00966 <span class="comment"></span>
<a name="l00967"></a>00967 <span class="comment">The octeon-rng driver ties the OCTEON processor&apos;s hardware random</span>
<a name="l00968"></a>00968 <span class="comment">number generator into the standard Linux kernel RNG framework.  This</span>
<a name="l00969"></a>00969 <span class="comment">driver is selected with the CONFIG_HW_RANDOM_OCTEON kernel</span>
<a name="l00970"></a>00970 <span class="comment">configuration parameter.</span>
<a name="l00971"></a>00971 <span class="comment"></span>
<a name="l00972"></a>00972 <span class="comment">@section linux_nfs_root 18. Configuring NFS Root Filesystem</span>
<a name="l00973"></a>00973 <span class="comment"></span>
<a name="l00974"></a>00974 <span class="comment">Configuring the OCTEON Linux kernel to use NFS as the root filesystem</span>
<a name="l00975"></a>00975 <span class="comment">can be more complicated than normal since the ethernet driver is a</span>
<a name="l00976"></a>00976 <span class="comment">module. In order to use a NFS root filesystem, you must have an</span>
<a name="l00977"></a>00977 <span class="comment">initramfs that loads the ethernet module and does a pivot root. The</span>
<a name="l00978"></a>00978 <span class="comment">embedded rootfs supplied with the SDK already has all the setup</span>
<a name="l00979"></a>00979 <span class="comment">required to do this. In order to enable it, you must enable NFS in the</span>
<a name="l00980"></a>00980 <span class="comment">configuration system.</span>
<a name="l00981"></a>00981 <span class="comment"></span>
<a name="l00982"></a>00982 <span class="comment">@verbatim</span>
<a name="l00983"></a>00983 <span class="comment">    $ cd linux/embedded_rootfs</span>
<a name="l00984"></a>00984 <span class="comment">    $ make menuconfig</span>
<a name="l00985"></a>00985 <span class="comment">    NFS Root filesystem  ---&gt;</span>
<a name="l00986"></a>00986 <span class="comment">    [*] Change root to a NFS filesystem</span>
<a name="l00987"></a>00987 <span class="comment">    (eth0) Network device</span>
<a name="l00988"></a>00988 <span class="comment">    [*]   Use DHCP to get the IP address, gateway, and DNS server</span>
<a name="l00989"></a>00989 <span class="comment">    (10.0.0.1:/home/debian_rootfs) NFS server path</span>
<a name="l00990"></a>00990 <span class="comment">    (nolock,rw) NFS mount options</span>
<a name="l00991"></a>00991 <span class="comment">@endverbatim</span>
<a name="l00992"></a>00992 <span class="comment"></span>
<a name="l00993"></a>00993 <span class="comment">@note Long delays when logging in are normally caused by the reverse</span>
<a name="l00994"></a>00994 <span class="comment">  lookup of your host name. Make sure it will succeed or it doesn&apos;t</span>
<a name="l00995"></a>00995 <span class="comment">  have a DNS server.</span>
<a name="l00996"></a>00996 <span class="comment"></span>
<a name="l00997"></a>00997 <span class="comment">@section linux_initrd_root 19. Configuring a separate initrd or initramfs Root Filesystem</span>
<a name="l00998"></a>00998 <span class="comment"></span>
<a name="l00999"></a>00999 <span class="comment">The default Linux kernel when you invoke &apos;make @b kernel&apos; will contain an embedded root</span>
<a name="l01000"></a>01000 <span class="comment">filesystem.  It is also possible to package this filesystem separately from the kernel image.</span>
<a name="l01001"></a>01001 <span class="comment">It is then loaded into a separate memory region from the kernel.</span>
<a name="l01002"></a>01002 <span class="comment"></span>
<a name="l01003"></a>01003 <span class="comment">First build the kernel, and copy it to the tftp directory.</span>
<a name="l01004"></a>01004 <span class="comment"></span>
<a name="l01005"></a>01005 <span class="comment">@verbatim</span>
<a name="l01006"></a>01006 <span class="comment">    $ cd linux</span>
<a name="l01007"></a>01007 <span class="comment">    $ make kernel-deb</span>
<a name="l01008"></a>01008 <span class="comment">    .</span>
<a name="l01009"></a>01009 <span class="comment">    .</span>
<a name="l01010"></a>01010 <span class="comment">    .</span>
<a name="l01011"></a>01011 <span class="comment">    $ cp kernel/linux/vmlinux.64 /var/lib/tftpboot/</span>
<a name="l01012"></a>01012 <span class="comment">@endverbatim</span>
<a name="l01013"></a>01013 <span class="comment"></span>
<a name="l01014"></a>01014 <span class="comment">Then built the root filesystem image and copy it to the tftp</span>
<a name="l01015"></a>01015 <span class="comment">directory.  We also need to calculate the size of the memory area</span>
<a name="l01016"></a>01016 <span class="comment">needed to hold the</span>
<a name="l01017"></a>01017 <span class="comment"></span>
<a name="l01018"></a>01018 <span class="comment">@verbatim</span>
<a name="l01019"></a>01019 <span class="comment">    $ cd linux/embedded_rootfs</span>
<a name="l01020"></a>01020 <span class="comment">    $ make all ext3</span>
<a name="l01021"></a>01021 <span class="comment">    .</span>
<a name="l01022"></a>01022 <span class="comment">    .</span>
<a name="l01023"></a>01023 <span class="comment">    .</span>
<a name="l01024"></a>01024 <span class="comment">    $ ls -l rootfs.ext3 | gawk -- &apos;{printf &quot;%x\n&quot;, ($5 + 0x10000) - ($5 % 0x10000)}&apos;</span>
<a name="l01025"></a>01025 <span class="comment">    b110000</span>
<a name="l01026"></a>01026 <span class="comment">    $ cp rootfs.ext3 /tftpboot/</span>
<a name="l01027"></a>01027 <span class="comment">@endverbatim</span>
<a name="l01028"></a>01028 <span class="comment"></span>
<a name="l01029"></a>01029 <span class="comment">Now we are ready to boot the board.  This part takes some manual</span>
<a name="l01030"></a>01030 <span class="comment">calculations.  We need to find a free memory region in the lower</span>
<a name="l01031"></a>01031 <span class="comment">4GB of memory that can hold the initramfs.  The block should be</span>
<a name="l01032"></a>01032 <span class="comment">aligned on a 64KB boundary.  Looking at the results of the</span>
<a name="l01033"></a>01033 <span class="comment">&apos;freeprint&apos; command, we see that it will fit at 0x81d0000, so we</span>
<a name="l01034"></a>01034 <span class="comment">create a named block called &apos;my_initrd&apos; at that location with the</span>
<a name="l01035"></a>01035 <span class="comment">proper size (0xb110000 from above).  Then we load the initramfs</span>
<a name="l01036"></a>01036 <span class="comment">image into this named block with the tftpboot command specifying</span>
<a name="l01037"></a>01037 <span class="comment">the address of the named block.  The bootloader prints a WARNING</span>
<a name="l01038"></a>01038 <span class="comment">message, but we can disregard it, because we know we are loading</span>
<a name="l01039"></a>01039 <span class="comment">data to our named block.</span>
<a name="l01040"></a>01040 <span class="comment"></span>
<a name="l01041"></a>01041 <span class="comment">We pass the kernel command line argument &apos;rd_name=my_initrd&apos; to</span>
<a name="l01042"></a>01042 <span class="comment">indicate the name of the memory block to the kernel.</span>
<a name="l01043"></a>01043 <span class="comment"></span>
<a name="l01044"></a>01044 <span class="comment">@verbatim</span>
<a name="l01045"></a>01045 <span class="comment"></span>
<a name="l01046"></a>01046 <span class="comment">Octeon ebb6800# dhcp   </span>
<a name="l01047"></a>01047 <span class="comment">Node 0 Interface 0 has 1 ports (RXAUI)</span>
<a name="l01048"></a>01048 <span class="comment">    Node 0 Interface 1 has 1 ports (RXAUI)</span>
<a name="l01049"></a>01049 <span class="comment">    Node 0 Interface 2 has 4 ports (SGMII)</span>
<a name="l01050"></a>01050 <span class="comment">    Node 0 Interface 7 has 32 ports (NPI)</span>
<a name="l01051"></a>01051 <span class="comment">    Node 0 Interface 8 has 8 ports (LOOP)</span>
<a name="l01052"></a>01052 <span class="comment">    BOOTP broadcast 1</span>
<a name="l01053"></a>01053 <span class="comment">    octeth4: Up 1000 Mbps Full duplex (port 2592) (SGMII)</span>
<a name="l01054"></a>01054 <span class="comment">    DHCP client bound to address 10.91.205.222</span>
<a name="l01055"></a>01055 <span class="comment"></span>
<a name="l01056"></a>01056 <span class="comment">Octeon ebb6800# freeprint</span>
<a name="l01057"></a>01057 <span class="comment"></span>
<a name="l01058"></a>01058 <span class="comment"></span>
<a name="l01059"></a>01059 <span class="comment"></span>
<a name="l01060"></a>01060 <span class="comment">Printing bootmem block list, descriptor: 0x6c108, head is 0xf100000</span>
<a name="l01061"></a>01061 <span class="comment">Descriptor version: 3.0</span>
<a name="l01062"></a>01062 <span class="comment">Block address: 0x0f100000, size: 0x00e2ac90, next: 0x0ffeb640</span>
<a name="l01063"></a>01063 <span class="comment">Block address: 0x0ffeb640, size: 0x00000020, next: 0x0ffebed0</span>
<a name="l01064"></a>01064 <span class="comment">Block address: 0x0ffebed0, size: 0x00000010, next: 0x30000000</span>
<a name="l01065"></a>01065 <span class="comment">Block address: 0x30000000, size: 0x1df000000, next: 0x00000000</span>
<a name="l01066"></a>01066 <span class="comment"></span>
<a name="l01067"></a>01067 <span class="comment">Octeon ebb6800# namedalloc myinitrd 0xb110000 0x30000000 </span>
<a name="l01068"></a>01068 <span class="comment">Allocated 0xb110000 bytes at address: 0x30000000, name: myinitrd</span>
<a name="l01069"></a>01069 <span class="comment"></span>
<a name="l01070"></a>01070 <span class="comment"></span>
<a name="l01071"></a>01071 <span class="comment">Octeon ebb6800# tftp 0x30000000 rootfs.ext3</span>
<a name="l01072"></a>01072 <span class="comment">Node 0 Interface 0 has 1 ports (RXAUI)</span>
<a name="l01073"></a>01073 <span class="comment">Node 0 Interface 1 has 1 ports (RXAUI)</span>
<a name="l01074"></a>01074 <span class="comment">Node 0 Interface 2 has 4 ports (SGMII)</span>
<a name="l01075"></a>01075 <span class="comment">Node 0 Interface 8 has 8 ports (LOOP)</span>
<a name="l01076"></a>01076 <span class="comment">Using octeth4 device</span>
<a name="l01077"></a>01077 <span class="comment">TFTP from server 10.91.205.197; our IP address is 10.91.205.222</span>
<a name="l01078"></a>01078 <span class="comment">Filename &apos;rootfs.ext3&apos;.</span>
<a name="l01079"></a>01079 <span class="comment">Load address: 0x30000000</span>
<a name="l01080"></a>01080 <span class="comment">Loading: octeth4: Down (port 2592) (SGMII)</span>
<a name="l01081"></a>01081 <span class="comment">T T octeth4: Up 1000 Mbps Full duplex (port 2592) (SGMII)</span>
<a name="l01082"></a>01082 <span class="comment">T #################################################################</span>
<a name="l01083"></a>01083 <span class="comment">        #####################################</span>
<a name="l01084"></a>01084 <span class="comment">         3.2 MiB/s</span>
<a name="l01085"></a>01085 <span class="comment">done</span>
<a name="l01086"></a>01086 <span class="comment">Bytes transferred = 185597952 (b100000 hex)</span>
<a name="l01087"></a>01087 <span class="comment"></span>
<a name="l01088"></a>01088 <span class="comment"></span>
<a name="l01089"></a>01089 <span class="comment">Octeon ebb6800# tftp $(loadaddr) vm_deb.64</span>
<a name="l01090"></a>01090 <span class="comment">Using octeth4 device</span>
<a name="l01091"></a>01091 <span class="comment">TFTP from server 10.91.205.197; our IP address is 10.91.205.222</span>
<a name="l01092"></a>01092 <span class="comment">Filename &apos;vm_deb.64&apos;.</span>
<a name="l01093"></a>01093 <span class="comment">Load address: 0x20000000</span>
<a name="l01094"></a>01094 <span class="comment">Loading: #################################################################</span>
<a name="l01095"></a>01095 <span class="comment">   #################################################################</span>
<a name="l01096"></a>01096 <span class="comment">         #################################################################</span>
<a name="l01097"></a>01097 <span class="comment">         #################################################################</span>
<a name="l01098"></a>01098 <span class="comment">         #################################################################</span>
<a name="l01099"></a>01099 <span class="comment">         ###########################################################</span>
<a name="l01100"></a>01100 <span class="comment">         4.3 MiB/s</span>
<a name="l01101"></a>01101 <span class="comment">done</span>
<a name="l01102"></a>01102 <span class="comment">Bytes transferred = 129914968 (7be5858 hex)</span>
<a name="l01103"></a>01103 <span class="comment"></span>
<a name="l01104"></a>01104 <span class="comment"></span>
<a name="l01105"></a>01105 <span class="comment">Octeon ebb6800# bootoctl $(loadaddr) numcores=$(numcores) endbootargs rw mem=0 rd_name=myinitrd</span>
<a name="l01106"></a>01106 <span class="comment">argv[2]: numcores=32</span>
<a name="l01107"></a>01107 <span class="comment">argv[3]: endbootargs</span>
<a name="l01108"></a>01108 <span class="comment">Allocating memory for ELF segment: addr: 0xffffffff80800000 (adjusted to: 0x800000), size 0xc6f730</span>
<a name="l01109"></a>01109 <span class="comment">## Loading big-endian Linux kernel with entry point: 0xffffffff80f79310 ...</span>
<a name="l01110"></a>01110 <span class="comment">Bootloader: Done loading app on coremask:</span>
<a name="l01111"></a>01111 <span class="comment"> 0xffffffff</span>
<a name="l01112"></a>01112 <span class="comment">Starting cores:</span>
<a name="l01113"></a>01113 <span class="comment"> 0xffffffff</span>
<a name="l01114"></a>01114 <span class="comment">Linux version 4.9.52-Cavium-Octeon+ (root@gshankar-OptiPlex-3046) (gcc version 4.7.0 (Cavium Inc. Version: SDK_BUILD build 51) ) #6 SMP Tue Oct 17 12:22:52 IST 2017</span>
<a name="l01115"></a>01115 <span class="comment">CVMSEG size: 2 cache lines (256 bytes)</span>
<a name="l01116"></a>01116 <span class="comment">Cavium Inc. SDK-5.1.0-prerelease</span>
<a name="l01117"></a>01117 <span class="comment">bootconsole [early0] enabled</span>
<a name="l01118"></a>01118 <span class="comment">CPU0 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l01119"></a>01119 <span class="comment">Checking for the multiply/shift bug... no.</span>
<a name="l01120"></a>01120 <span class="comment">Checking for the daddiu bug... no.</span>
<a name="l01121"></a>01121 <span class="comment">Determined physical RAM map:</span>
<a name="l01122"></a>01122 <span class="comment"> memory: 000000000b110000 @ 0000000030000000 (usable after init)</span>
<a name="l01123"></a>01123 <span class="comment"> memory: 000000000feff000 @ 00000000f0001000 (usable)</span>
<a name="l01124"></a>01124 <span class="comment"> memory: 000000006fd00000 @ 0000000080300000 (usable)</span>
<a name="l01125"></a>01125 <span class="comment"> memory: 000000010efff000 @ 0000000100001000 (usable)</span>
<a name="l01126"></a>01126 <span class="comment"> memory: 0000000044c00000 @ 000000003b300000 (usable)</span>
<a name="l01127"></a>01127 <span class="comment"> memory: 0000000010000000 @ 0000000020000000 (usable)</span>
<a name="l01128"></a>01128 <span class="comment"> memory: 000000000e400000 @ 0000000001800000 (usable)</span>
<a name="l01129"></a>01129 <span class="comment"> memory: 0000000000400000 @ 0000000000400000 (usable)</span>
<a name="l01130"></a>01130 <span class="comment"> memory: 0000000000a89000 @ 0000000000800000 (kernel data and code)</span>
<a name="l01131"></a>01131 <span class="comment"> memory: 0000000000140000 @ 0000000001330000 (kernel data and code)</span>
<a name="l01132"></a>01132 <span class="comment"> memory: 00000000000a7000 @ 0000000001289000 (usable after init)</span>
<a name="l01133"></a>01133 <span class="comment">Initial ramdisk at: 0x8000000030000000 (185663488 bytes)</span>
<a name="l01134"></a>01134 <span class="comment">Using passed Device Tree &lt;800000000fce4800&gt;.</span>
<a name="l01135"></a>01135 <span class="comment">Using passed Device Tree.</span>
<a name="l01136"></a>01136 <span class="comment">software IO TLB [mem 0x08823000-0x0c823000] (64MB) mapped at [8000000008823000-800000000c822fff]</span>
<a name="l01137"></a>01137 <span class="comment">Primary instruction cache 37kB, virtually tagged, 37 way, 8 sets, linesize 128 bytes.</span>
<a name="l01138"></a>01138 <span class="comment">.</span>
<a name="l01139"></a>01139 <span class="comment">.</span>
<a name="l01140"></a>01140 <span class="comment">.</span>
<a name="l01141"></a>01141 <span class="comment">@endverbatim</span>
<a name="l01142"></a>01142 <span class="comment"></span>
<a name="l01143"></a>01143 <span class="comment">@section linux_performance_counters 20. OCTEON Performance Counters</span>
<a name="l01144"></a>01144 <span class="comment"></span>
<a name="l01145"></a>01145 <span class="comment">The OCTEON performance counters are available through @b /proc/octeon_perf.</span>
<a name="l01146"></a>01146 <span class="comment">Through this interface you can control the two performance counters per</span>
<a name="l01147"></a>01147 <span class="comment">core and the four performance counters available in the L2 controller. Here</span>
<a name="l01148"></a>01148 <span class="comment">is some sample output from /proc/octeon/perf</span>
<a name="l01149"></a>01149 <span class="comment"></span>
<a name="l01150"></a>01150 <span class="comment">@verbatim</span>
<a name="l01151"></a>01151 <span class="comment">octeon:~# cat /proc/octeon_perf</span>
<a name="l01152"></a>01152 <span class="comment">                 sissue           dissue</span>
<a name="l01153"></a>01153 <span class="comment">CPU 0:        211717427        180982164</span>
<a name="l01154"></a>01154 <span class="comment">CPU 1:        211487633        180958893</span>
<a name="l01155"></a>01155 <span class="comment">CPU 2:        211465061        180883863</span>
<a name="l01156"></a>01156 <span class="comment">CPU 3:        211412737        180907337</span>
<a name="l01157"></a>01157 <span class="comment">CPU 4:        211456437        180956208</span>
<a name="l01158"></a>01158 <span class="comment">CPU 5:        211416750        180913876</span>
<a name="l01159"></a>01159 <span class="comment">CPU 6:        211500423        180923920</span>
<a name="l01160"></a>01160 <span class="comment">CPU 7:        211452287        180942579</span>
<a name="l01161"></a>01161 <span class="comment">CPU 8:        211397832        180903745</span>
<a name="l01162"></a>01162 <span class="comment">CPU 9:        211441735        180934627</span>
<a name="l01163"></a>01163 <span class="comment">CPU10:        211487240        180979999</span>
<a name="l01164"></a>01164 <span class="comment">CPU11:        211439250        180933492</span>
<a name="l01165"></a>01165 <span class="comment">CPU12:        211441315        180941196</span>
<a name="l01166"></a>01166 <span class="comment">CPU13:        211435641        180931735</span>
<a name="l01167"></a>01167 <span class="comment">CPU14:        211469154        180958894</span>
<a name="l01168"></a>01168 <span class="comment"></span>
<a name="l01169"></a>01169 <span class="comment">imiss: 3634</span>
<a name="l01170"></a>01170 <span class="comment">ihit: 98044</span>
<a name="l01171"></a>01171 <span class="comment">dmiss: 7570</span>
<a name="l01172"></a>01172 <span class="comment">dhit: 786474</span>
<a name="l01173"></a>01173 <span class="comment"></span>
<a name="l01174"></a>01174 <span class="comment">Configuration of the performance counters is controller by writing</span>
<a name="l01175"></a>01175 <span class="comment">one of the following values to:</span>
<a name="l01176"></a>01176 <span class="comment">    /sys/module/perf_counters/parameters/counter{0,1}</span>
<a name="l01177"></a>01177 <span class="comment">    /sys/module/perf_counters/parameters/l2counter{0-3}</span>
<a name="l01178"></a>01178 <span class="comment"></span>
<a name="l01179"></a>01179 <span class="comment">Possible CPU counters:</span>
<a name="l01180"></a>01180 <span class="comment">    none clk issue ret nissue sissue dissue ifi</span>
<a name="l01181"></a>01181 <span class="comment">    br brmis j jmis replay iuna trap</span>
<a name="l01182"></a>01182 <span class="comment">    uuload uustore uload ustore ec mc cc csrc</span>
<a name="l01183"></a>01183 <span class="comment">    cfetch cpref ica ii ip cimiss</span>
<a name="l01184"></a>01184 <span class="comment">    wbuf wdat wbufld wbuffl wbuftr badd baddl2 bfill</span>
<a name="l01185"></a>01185 <span class="comment">    ddids idids didna lds lmlds iolds dmlds</span>
<a name="l01186"></a>01186 <span class="comment">    sts lmsts iosts iobdma dtlb dtlbad itlb</span>
<a name="l01187"></a>01187 <span class="comment">    sync synciob syncw</span>
<a name="l01188"></a>01188 <span class="comment"></span>
<a name="l01189"></a>01189 <span class="comment">Possible L2 counters:</span>
<a name="l01190"></a>01190 <span class="comment">    cycles imiss ihit dmiss</span>
<a name="l01191"></a>01191 <span class="comment">    dhit miss hit victim-buffer-hit</span>
<a name="l01192"></a>01192 <span class="comment">    lfb-nq-index-conflict tag-probe tag-update tag-probe-completed</span>
<a name="l01193"></a>01193 <span class="comment">    tag-dirty-victim data-store-nop data-store-read data-store-write</span>
<a name="l01194"></a>01194 <span class="comment">    memory-fill-data-valid memory-write-request memory-read-request memory-write-data-valid</span>
<a name="l01195"></a>01195 <span class="comment">    xmc-nop xmc-ldt xmc-ldi xmc-ldd</span>
<a name="l01196"></a>01196 <span class="comment">    xmc-stf xmc-stt xmc-stp xmc-stc</span>
<a name="l01197"></a>01197 <span class="comment">    xmc-dwb xmc-pl2 xmc-psl1 xmc-iobld</span>
<a name="l01198"></a>01198 <span class="comment">    xmc-iobst xmc-iobdma xmc-iobrsp xmd-bus-valid</span>
<a name="l01199"></a>01199 <span class="comment">    xmd-bus-valid-dst-l2c xmd-bus-valid-dst-iob xmd-bus-valid-dst-pp rsc-nop</span>
<a name="l01200"></a>01200 <span class="comment">    rsc-stdn rsc-fill rsc-refl rsc-stin</span>
<a name="l01201"></a>01201 <span class="comment">    rsc-scin rsc-scfl rsc-scdn rsd-data-valid</span>
<a name="l01202"></a>01202 <span class="comment">    rsd-data-valid-fill rsd-data-valid-strsp rsd-data-valid-refl lrf-req</span>
<a name="l01203"></a>01203 <span class="comment">    dt-rd-alloc dt-wr-inva</span>
<a name="l01204"></a>01204 <span class="comment">Warning: Counter configuration doesn&apos;t update till you access /proc/octeon_perf.</span>
<a name="l01205"></a>01205 <span class="comment">@endverbatim</span>
<a name="l01206"></a>01206 <span class="comment"></span>
<a name="l01207"></a>01207 <span class="comment">NOTE: The L2 performance counter events are different in OCTEON II chips. See</span>
<a name="l01208"></a>01208 <span class="comment">      below for a list of supported events.</span>
<a name="l01209"></a>01209 <span class="comment"></span>
<a name="l01210"></a>01210 <span class="comment">Configuration of the performance counters is controller by writing the</span>
<a name="l01211"></a>01211 <span class="comment">desired counter name to the /sys parameter for each counter. The possible</span>
<a name="l01212"></a>01212 <span class="comment">counter types are:</span>
<a name="l01213"></a>01213 <span class="comment"></span>
<a name="l01214"></a>01214 <span class="comment">Counter Control Files</span>
<a name="l01215"></a>01215 <span class="comment">- /sys/module/perf_counters/parameters/counter{0,1}</span>
<a name="l01216"></a>01216 <span class="comment">- /sys/module/perf_counters/parameters/l2counter{0-3}</span>
<a name="l01217"></a>01217 <span class="comment"></span>
<a name="l01218"></a>01218 <span class="comment">Core Counters</span>
<a name="l01219"></a>01219 <span class="comment">- none - Turn off the performance counter</span>
<a name="l01220"></a>01220 <span class="comment">- clk - Conditionally clocked cycles (as opposed to count/cvm_count which count even with no clocks)</span>
<a name="l01221"></a>01221 <span class="comment">- issue - Instructions issued but not retired</span>
<a name="l01222"></a>01222 <span class="comment">- ret - Instructions retired</span>
<a name="l01223"></a>01223 <span class="comment">- nissue - Cycles no issue</span>
<a name="l01224"></a>01224 <span class="comment">- sissue - Cycles single issue</span>
<a name="l01225"></a>01225 <span class="comment">- dissue - Cycles dual issue</span>
<a name="l01226"></a>01226 <span class="comment">- ifi - Cycle ifetch issued (but not necessarily commit to pp_mem)</span>
<a name="l01227"></a>01227 <span class="comment">- br - Branches retired</span>
<a name="l01228"></a>01228 <span class="comment">- brmis - Branch mispredicts</span>
<a name="l01229"></a>01229 <span class="comment">- j - Jumps retired</span>
<a name="l01230"></a>01230 <span class="comment">- jmis - Jumps mispredicted</span>
<a name="l01231"></a>01231 <span class="comment">- replay - Mem Replays</span>
<a name="l01232"></a>01232 <span class="comment">- iuna - Cycles idle due to unaligned_replays</span>
<a name="l01233"></a>01233 <span class="comment">- trap - trap_6a signal</span>
<a name="l01234"></a>01234 <span class="comment">- uuload - Unexpected unaligned loads (REPUN=1)</span>
<a name="l01235"></a>01235 <span class="comment">- uustore - Unexpected unaligned store (REPUN=1)</span>
<a name="l01236"></a>01236 <span class="comment">- uload - Unaligned loads (REPUN=1 or USEUN=1)</span>
<a name="l01237"></a>01237 <span class="comment">- ustore - Unaligned store (REPUN=1 or USEUN=1)</span>
<a name="l01238"></a>01238 <span class="comment">- ec - Exec clocks(must set CvmCtl[DISCE] for accurate timing)</span>
<a name="l01239"></a>01239 <span class="comment">- mc - Mul clocks(must set CvmCtl[DISCE] for accurate timing)</span>
<a name="l01240"></a>01240 <span class="comment">- cc - Crypto clocks(must set CvmCtl[DISCE] for accurate timing)</span>
<a name="l01241"></a>01241 <span class="comment">- csrc - Issue_csr clocks(must set CvmCtl[DISCE] for accurate timing)</span>
<a name="l01242"></a>01242 <span class="comment">- cfetch - Icache committed fetches (demand+prefetch)</span>
<a name="l01243"></a>01243 <span class="comment">- cpref - Icache committed prefetches</span>
<a name="l01244"></a>01244 <span class="comment">- ica - Icache aliases</span>
<a name="l01245"></a>01245 <span class="comment">- ii - Icache invalidates</span>
<a name="l01246"></a>01246 <span class="comment">- ip - Icache parity error</span>
<a name="l01247"></a>01247 <span class="comment">- cimiss - Cycles idle due to imiss (must set CvmCtl[DISCE] for accurate timing)</span>
<a name="l01248"></a>01248 <span class="comment">- wbuf - Number of write buffer entries created</span>
<a name="l01249"></a>01249 <span class="comment">- wdat - Number of write buffer data cycles used (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01250"></a>01250 <span class="comment">- wbufld - Number of write buffer entries forced out by loads</span>
<a name="l01251"></a>01251 <span class="comment">- wbuffl - Number of cycles that there was no available write buffer entry (may need to set CvmCtl[DISCE] and CvmMemCtl[MCLK] for accurate counts)</span>
<a name="l01252"></a>01252 <span class="comment">- wbuftr - Number of stores that found no available write buffer entries</span>
<a name="l01253"></a>01253 <span class="comment">- badd - Number of address bus cycles used (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01254"></a>01254 <span class="comment">- baddl2 - Number of address bus cycles not reflected (i.e. destined for L2) (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01255"></a>01255 <span class="comment">- bfill - Number of fill bus cycles used (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01256"></a>01256 <span class="comment">- ddids - Number of Dstream DIDs created</span>
<a name="l01257"></a>01257 <span class="comment">- idids - Number of Istream DIDs created</span>
<a name="l01258"></a>01258 <span class="comment">- didna - Number of cycles that no DIDs were available (may need to set CvmCtl[DISCE] and CvmMemCtl[MCLK] for accurate counts)</span>
<a name="l01259"></a>01259 <span class="comment">- lds - Number of load issues</span>
<a name="l01260"></a>01260 <span class="comment">- lmlds - Number of local memory load</span>
<a name="l01261"></a>01261 <span class="comment">- iolds - Number of I/O load issues</span>
<a name="l01262"></a>01262 <span class="comment">- dmlds - Number of loads that were not prefetches and missed in the cache</span>
<a name="l01263"></a>01263 <span class="comment">- sts - Number of store issues</span>
<a name="l01264"></a>01264 <span class="comment">- lmsts - Number of local memory store issues</span>
<a name="l01265"></a>01265 <span class="comment">- iosts - Number of I/O store issues</span>
<a name="l01266"></a>01266 <span class="comment">- iobdma - Number of IOBDMAs</span>
<a name="l01267"></a>01267 <span class="comment">- dtlb - Number of dstream TLB refill, invalid, or modified exceptions</span>
<a name="l01268"></a>01268 <span class="comment">- dtlbad - Number of dstream TLB address errors</span>
<a name="l01269"></a>01269 <span class="comment">- itlb - Number of istream TLB refill, invalid, or address error exceptions</span>
<a name="l01270"></a>01270 <span class="comment">- sync - Number of SYNC stall cycles (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01271"></a>01271 <span class="comment">- synciob - Number of SYNCIOBDMA stall cycles (may need to set CvmCtl[DISCE] for accurate counts)</span>
<a name="l01272"></a>01272 <span class="comment">- syncw - Number of SYNCWs</span>
<a name="l01273"></a>01273 <span class="comment"></span>
<a name="l01274"></a>01274 <span class="comment">Available in OCTEON II and OCTEON III</span>
<a name="l01275"></a>01275 <span class="comment"></span>
<a name="l01276"></a>01276 <span class="comment">- eretmis - D/eret mispredicts</span>
<a name="l01277"></a>01277 <span class="comment">- likmis - Branch likely mispredicts</span>
<a name="l01278"></a>01278 <span class="comment">- hazard-trap - Hazard traps due to *MTC0 to CvmCtl, Perf counter control, EntryHi, or CvmMemCtl registers</span>
<a name="l01279"></a>01279 <span class="comment"></span>
<a name="l01280"></a>01280 <span class="comment">L2 Counters</span>
<a name="l01281"></a>01281 <span class="comment">- cycles - Cycles</span>
<a name="l01282"></a>01282 <span class="comment">- imiss - L2 Instruction Miss</span>
<a name="l01283"></a>01283 <span class="comment">- ihit - L2 Instruction Hit</span>
<a name="l01284"></a>01284 <span class="comment">- dmiss - L2 Data Miss</span>
<a name="l01285"></a>01285 <span class="comment">- dhit - L2 Data Hit</span>
<a name="l01286"></a>01286 <span class="comment">- miss - L2 Miss (I/D)</span>
<a name="l01287"></a>01287 <span class="comment">- hit - L2 Hit (I/D)</span>
<a name="l01288"></a>01288 <span class="comment">- victim-buffer-hit - L2 Victim Buffer Hit (Retry Probe)</span>
<a name="l01289"></a>01289 <span class="comment">- lfb-nq-index-conflict - LFB-NQ Index Conflict</span>
<a name="l01290"></a>01290 <span class="comment">- tag-probe - L2 Tag Probe (issued - could be VB-Retried)</span>
<a name="l01291"></a>01291 <span class="comment">- tag-update - L2 Tag Update (completed). Note: Some CMD types do not update</span>
<a name="l01292"></a>01292 <span class="comment">- tag-probe-completed - L2 Tag Probe Completed (beyond VB-RTY window)</span>
<a name="l01293"></a>01293 <span class="comment">- tag-dirty-victim - L2 Tag Dirty Victim</span>
<a name="l01294"></a>01294 <span class="comment">- data-store-nop - L2 Data Store NOP</span>
<a name="l01295"></a>01295 <span class="comment">- data-store-read - L2 Data Store READ</span>
<a name="l01296"></a>01296 <span class="comment">- data-store-write - L2 Data Store WRITE</span>
<a name="l01297"></a>01297 <span class="comment">- memory-fill-data-valid - Memory Fill Data valid</span>
<a name="l01298"></a>01298 <span class="comment">- memory-write-request - Memory Write Request</span>
<a name="l01299"></a>01299 <span class="comment">- memory-read-request - Memory Read Request</span>
<a name="l01300"></a>01300 <span class="comment">- memory-write-data-valid - Memory Write Data valid</span>
<a name="l01301"></a>01301 <span class="comment">- xmc-nop - XMC NOP</span>
<a name="l01302"></a>01302 <span class="comment">- xmc-ldt - XMC LDT</span>
<a name="l01303"></a>01303 <span class="comment">- xmc-ldi - XMC LDI</span>
<a name="l01304"></a>01304 <span class="comment">- xmc-ldd - XMC LDD</span>
<a name="l01305"></a>01305 <span class="comment">- xmc-stf - XMC STF</span>
<a name="l01306"></a>01306 <span class="comment">- xmc-stt - XMC STT</span>
<a name="l01307"></a>01307 <span class="comment">- xmc-stp - XMC STP</span>
<a name="l01308"></a>01308 <span class="comment">- xmc-stc - XMC STC</span>
<a name="l01309"></a>01309 <span class="comment">- xmc-dwb - XMC DWB</span>
<a name="l01310"></a>01310 <span class="comment">- xmc-pl2 - XMC PL2</span>
<a name="l01311"></a>01311 <span class="comment">- xmc-psl1 - XMC PSL1</span>
<a name="l01312"></a>01312 <span class="comment">- xmc-iobld - XMC IOBLD</span>
<a name="l01313"></a>01313 <span class="comment">- xmc-iobst - XMC IOBST</span>
<a name="l01314"></a>01314 <span class="comment">- xmc-iobdma - XMC IOBDMA</span>
<a name="l01315"></a>01315 <span class="comment">- xmc-iobrsp - XMC IOBRSP</span>
<a name="l01316"></a>01316 <span class="comment">- xmd-bus-valid - XMD Bus valid (all)</span>
<a name="l01317"></a>01317 <span class="comment">- xmd-bus-valid-dst-l2c - XMD Bus valid (DST=L2C) Memory</span>
<a name="l01318"></a>01318 <span class="comment">- xmd-bus-valid-dst-iob - XMD Bus valid (DST=IOB) REFL Data</span>
<a name="l01319"></a>01319 <span class="comment">- xmd-bus-valid-dst-pp - XMD Bus valid (DST=PP) IOBRSP Data</span>
<a name="l01320"></a>01320 <span class="comment">- rsc-nop - RSC NOP</span>
<a name="l01321"></a>01321 <span class="comment">- rsc-stdn - RSC STDN</span>
<a name="l01322"></a>01322 <span class="comment">- rsc-fill - RSC FILL</span>
<a name="l01323"></a>01323 <span class="comment">- rsc-refl - RSC REFL</span>
<a name="l01324"></a>01324 <span class="comment">- rsc-stin - RSC STIN</span>
<a name="l01325"></a>01325 <span class="comment">- rsc-scin - RSC SCIN</span>
<a name="l01326"></a>01326 <span class="comment">- rsc-scfl - RSC SCFL</span>
<a name="l01327"></a>01327 <span class="comment">- rsc-scdn - RSC SCDN</span>
<a name="l01328"></a>01328 <span class="comment">- rsd-data-valid - RSD Data Valid</span>
<a name="l01329"></a>01329 <span class="comment">- rsd-data-valid-fill - RSD Data Valid (FILL)</span>
<a name="l01330"></a>01330 <span class="comment">- rsd-data-valid-strsp - RSD Data Valid (STRSP)</span>
<a name="l01331"></a>01331 <span class="comment">- rsd-data-valid-refl - RSD Data Valid (REFL)</span>
<a name="l01332"></a>01332 <span class="comment">- lrf-req - LRF-REQ (LFB-NQ)</span>
<a name="l01333"></a>01333 <span class="comment">- dt-rd-alloc - DT RD-ALLOC</span>
<a name="l01334"></a>01334 <span class="comment">- dt-wr-inva - DT WR-INVA</span>
<a name="l01335"></a>01335 <span class="comment"></span>
<a name="l01336"></a>01336 <span class="comment">L2 Counters in OCTEON II chips</span>
<a name="l01337"></a>01337 <span class="comment"></span>
<a name="l01338"></a>01338 <span class="comment">- none - None</span>
<a name="l01339"></a>01339 <span class="comment">- hit - L2 Tag Hit</span>
<a name="l01340"></a>01340 <span class="comment">- miss - L2 Tag Miss</span>
<a name="l01341"></a>01341 <span class="comment">- no-alloc - L2 Tag NoAlloc (forced no-allocate)</span>
<a name="l01342"></a>01342 <span class="comment">- victim - L2 Tag Victim</span>
<a name="l01343"></a>01343 <span class="comment">- sc-fail - SC Fail</span>
<a name="l01344"></a>01344 <span class="comment">- sc-pass - SC Pass</span>
<a name="l01345"></a>01345 <span class="comment">- lfb-valid - LFB Occupancy (each cycle adds \# of LFBs valid)</span>
<a name="l01346"></a>01346 <span class="comment">- lfb-wait-lfb - LFB Wait LFB (each cycle adds \# of LFBs waiting for other LFBs)</span>
<a name="l01347"></a>01347 <span class="comment">- lfb-wait-vab - LFB Wait VAB (each cycle adds \# of LFBs waiting for VAB)</span>
<a name="l01348"></a>01348 <span class="comment">- quad0-index - Quad 0 index bus inuse</span>
<a name="l01349"></a>01349 <span class="comment">- quad0-read - Quad 0 read data bus inuse</span>
<a name="l01350"></a>01350 <span class="comment">- quad0-bank - Quad 0 \# banks inuse (0-4/cycle)</span>
<a name="l01351"></a>01351 <span class="comment">- quad0-wdat - Quad 0 wdat flops inuse (0-4/cycle)</span>
<a name="l01352"></a>01352 <span class="comment">- quad1-index - Quad 1 index bus inuse</span>
<a name="l01353"></a>01353 <span class="comment">- quad1-read - Quad 1 read data bus inuse</span>
<a name="l01354"></a>01354 <span class="comment">- quad1-bank - Quad 1 \# banks inuse (0-4/cycle)</span>
<a name="l01355"></a>01355 <span class="comment">- quad1-wdat - Quad 1 wdat flops inuse (0-4/cycle)</span>
<a name="l01356"></a>01356 <span class="comment">- quad2-index - Quad 2 index bus inuse</span>
<a name="l01357"></a>01357 <span class="comment">- quad2-read - Quad 2 read data bus inuse</span>
<a name="l01358"></a>01358 <span class="comment">- quad2-bank - Quad 2 \# banks inuse (0-4/cycle)</span>
<a name="l01359"></a>01359 <span class="comment">- quad2-wdat - Quad 2 wdat flops inuse (0-4/cycle)</span>
<a name="l01360"></a>01360 <span class="comment">- quad3-index - Quad 3 index bus inuse</span>
<a name="l01361"></a>01361 <span class="comment">- quad3-read - Quad 3 read data bus inuse</span>
<a name="l01362"></a>01362 <span class="comment">- quad3-bank - Quad 3 \# banks inuse (0-4/cycle)</span>
<a name="l01363"></a>01363 <span class="comment">- quad3-wdat - Quad 3 wdat flops inuse (0-4/cycle)</span>
<a name="l01364"></a>01364 <span class="comment"></span>
<a name="l01365"></a>01365 <span class="comment">After you change which counter that is displayed, you need to cat</span>
<a name="l01366"></a>01366 <span class="comment">/proc/octeon_perf twice to make sure the new value is used. The first one</span>
<a name="l01367"></a>01367 <span class="comment">show the results from the old counter and sets the new counter to zero. The</span>
<a name="l01368"></a>01368 <span class="comment">second one displays the new counter.</span>
<a name="l01369"></a>01369 <span class="comment"></span>
<a name="l01370"></a>01370 <span class="comment">Here is an example setting up the L2 control to count cache missies:</span>
<a name="l01371"></a>01371 <span class="comment"></span>
<a name="l01372"></a>01372 <span class="comment">@verbatim</span>
<a name="l01373"></a>01373 <span class="comment">octeon:~# echo imiss &gt; /sys/module/perf_counters/parameters/l2counter0</span>
<a name="l01374"></a>01374 <span class="comment">octeon:~# echo ihit &gt; /sys/module/perf_counters/parameters/l2counter1</span>
<a name="l01375"></a>01375 <span class="comment">octeon:~# echo dmiss &gt; /sys/module/perf_counters/parameters/l2counter2</span>
<a name="l01376"></a>01376 <span class="comment">octeon:~# echo dhit &gt; /sys/module/perf_counters/parameters/l2counter3</span>
<a name="l01377"></a>01377 <span class="comment">@endverbatim</span>
<a name="l01378"></a>01378 <span class="comment"></span>
<a name="l01379"></a>01379 <span class="comment">@section linux_kernel_debugging 21. Debugging the Kernel</span>
<a name="l01380"></a>01380 <span class="comment"></span>
<a name="l01381"></a>01381 <span class="comment">The OCTEON Multicore debugger @b mipsisa64-octeon-elf-gdb may be used to</span>
<a name="l01382"></a>01382 <span class="comment">debug the Linux kernel. The standalone simple executive debugging</span>
<a name="l01383"></a>01383 <span class="comment">extensions provide improved debugging over standard KGDB.</span>
<a name="l01384"></a>01384 <span class="comment"></span>
<a name="l01385"></a>01385 <span class="comment">Three GDB state variables control support for multicore debugging.  These</span>
<a name="l01386"></a>01386 <span class="comment">variables are @b active-cores, @b focus, and @b step-all.  The standard GDB</span>
<a name="l01387"></a>01387 <span class="comment">set and show commands access these variables.  A description of each</span>
<a name="l01388"></a>01388 <span class="comment">variable&apos;s affect on the debugging environment is listed below:</span>
<a name="l01389"></a>01389 <span class="comment"></span>
<a name="l01390"></a>01390 <span class="comment">- active-cores:</span>
<a name="l01391"></a>01391 <span class="comment">   This is a comma separated list of cores under active control of the</span>
<a name="l01392"></a>01392 <span class="comment">   debugger. Cores in this list will stop if any other core hits a</span>
<a name="l01393"></a>01393 <span class="comment">   breakpoint. Cores not in this list will only stop if they hit a</span>
<a name="l01394"></a>01394 <span class="comment">   breakpoint. Note that although cores not in active-cores do not</span>
<a name="l01395"></a>01395 <span class="comment">   stop when other cores hit a breakpoint, they do suffer a</span>
<a name="l01396"></a>01396 <span class="comment">   performance hit. As a convenience, setting the active cores to an</span>
<a name="l01397"></a>01397 <span class="comment">   empty string with &lt;b&gt;&quot;set active-cores&quot;&lt;/b&gt; is interpreted as</span>
<a name="l01398"></a>01398 <span class="comment">   setting all cores active.</span>
<a name="l01399"></a>01399 <span class="comment"></span>
<a name="l01400"></a>01400 <span class="comment">@code</span>
<a name="l01401"></a>01401 <span class="comment">(Core#0-gdb) set active-cores 0,1</span>
<a name="l01402"></a>01402 <span class="comment">(Core#0-gdb) show active-cores</span>
<a name="l01403"></a>01403 <span class="comment">The cores stopped on execution of a breakpoint by another core is &quot;0,1&quot;.</span>
<a name="l01404"></a>01404 <span class="comment">(Core#0-gdb) set active-cores</span>
<a name="l01405"></a>01405 <span class="comment">(Core#0-gdb) show active-cores</span>
<a name="l01406"></a>01406 <span class="comment">The cores stopped on execution of a breakpoint by another core is</span>
<a name="l01407"></a>01407 <span class="comment">&quot;0,1,2,3,4,6,7,8,9,10,11,12,13,14,15&quot;.</span>
<a name="l01408"></a>01408 <span class="comment">(Core#0-gdb)</span>
<a name="l01409"></a>01409 <span class="comment">@endcode</span>
<a name="l01410"></a>01410 <span class="comment"></span>
<a name="l01411"></a>01411 <span class="comment">- focus:</span>
<a name="l01412"></a>01412 <span class="comment">   This is the index (0-15) of the core directly interacting with the</span>
<a name="l01413"></a>01413 <span class="comment">   debugger. Data operations (r/w memory, registers) are performed in</span>
<a name="l01414"></a>01414 <span class="comment">   the focus core&apos;s context. Only cores currently stopped in a debug</span>
<a name="l01415"></a>01415 <span class="comment">   exception may become the focus core. This means making a non-active</span>
<a name="l01416"></a>01416 <span class="comment">   core the focus generally requires a breakpoint or changing the</span>
<a name="l01417"></a>01417 <span class="comment">   active-cores to include it. The GDB prompt will show the current</span>
<a name="l01418"></a>01418 <span class="comment">   focus core. Note that the focus core may change if another core</span>
<a name="l01419"></a>01419 <span class="comment">   hits a breakpoint. The core to hit a breakpoint first automatically</span>
<a name="l01420"></a>01420 <span class="comment">   becomes the focus core.</span>
<a name="l01421"></a>01421 <span class="comment"></span>
<a name="l01422"></a>01422 <span class="comment">@code</span>
<a name="l01423"></a>01423 <span class="comment">(Core#0-gdb) show focus</span>
<a name="l01424"></a>01424 <span class="comment">The focus core of debugger operations is 0.</span>
<a name="l01425"></a>01425 <span class="comment">(Core#0-gdb) set focus 5</span>
<a name="l01426"></a>01426 <span class="comment">(Core#5-gdb) show focus</span>
<a name="l01427"></a>01427 <span class="comment">The focus core of debugger operations is 5.</span>
<a name="l01428"></a>01428 <span class="comment">(Core#5-gdb)</span>
<a name="l01429"></a>01429 <span class="comment">@endcode</span>
<a name="l01430"></a>01430 <span class="comment"></span>
<a name="l01431"></a>01431 <span class="comment">- step-all:</span>
<a name="l01432"></a>01432 <span class="comment">   This GDB variable controls the cores action when the</span>
<a name="l01433"></a>01433 <span class="comment">   commands step, step instruction, and continue are executed. By</span>
<a name="l01434"></a>01434 <span class="comment">   default (step-all off) only the focus core performs the</span>
<a name="l01435"></a>01435 <span class="comment">   operations. Execution of other cores occurs only if step-all is</span>
<a name="l01436"></a>01436 <span class="comment">   on. Note that cores not in the active-cores list currently stopped</span>
<a name="l01437"></a>01437 <span class="comment">   will continue execution under any step command with step-all</span>
<a name="l01438"></a>01438 <span class="comment">   enabled.</span>
<a name="l01439"></a>01439 <span class="comment"></span>
<a name="l01440"></a>01440 <span class="comment">@code</span>
<a name="l01441"></a>01441 <span class="comment">(Core#5-gdb) show step-all</span>
<a name="l01442"></a>01442 <span class="comment">Step commands affect all cores is off.</span>
<a name="l01443"></a>01443 <span class="comment">(Core#5-gdb) set step-all on</span>
<a name="l01444"></a>01444 <span class="comment">(Core#5-gdb) show step-all</span>
<a name="l01445"></a>01445 <span class="comment">Step commands affect all cores is on.</span>
<a name="l01446"></a>01446 <span class="comment">(Core#5-gdb)</span>
<a name="l01447"></a>01447 <span class="comment">@endcode</span>
<a name="l01448"></a>01448 <span class="comment"></span>
<a name="l01449"></a>01449 <span class="comment">In order to debug the Linux kernel, the following steps are required:</span>
<a name="l01450"></a>01450 <span class="comment"></span>
<a name="l01451"></a>01451 <span class="comment">-# For the EBB68XX, you will need two serial port connections to the</span>
<a name="l01452"></a>01452 <span class="comment">   board. Connect the two serial ports by the LED display to the host</span>
<a name="l01453"></a>01453 <span class="comment">   PC using null modem cables. The first should already be hooked up</span>
<a name="l01454"></a>01454 <span class="comment">   for use with Minicom as a console. The second will be used for the</span>
<a name="l01455"></a>01455 <span class="comment">   debugger traffic.</span>
<a name="l01456"></a>01456 <span class="comment">-# Build the kernel with debugging support.</span>
<a name="l01457"></a>01457 <span class="comment">    @verbatim</span>
<a name="l01458"></a>01458 <span class="comment">    $ cd linux</span>
<a name="l01459"></a>01459 <span class="comment">    $ make -s [sim|kernel]-config</span>
<a name="l01460"></a>01460 <span class="comment">    $ cd kernel/linux</span>
<a name="l01461"></a>01461 <span class="comment">    $ make menuconfig</span>
<a name="l01462"></a>01462 <span class="comment">    Device Drivers  ---&gt;</span>
<a name="l01463"></a>01463 <span class="comment">        [*] Watchdog Timer Support ---&gt;</span>
<a name="l01464"></a>01464 <span class="comment">            &lt; &gt; Cavium OCTEON SOC family Watchdog Timer</span>
<a name="l01465"></a>01465 <span class="comment">    Kernel hacking  ---&gt;</span>
<a name="l01466"></a>01466 <span class="comment">        [ ] Remote GDB kernel debugging</span>
<a name="l01467"></a>01467 <span class="comment">        [*] Remote GDB debugging using the Cavium Inc. Multicore GDB</span>
<a name="l01468"></a>01468 <span class="comment">    $ cd ../..</span>
<a name="l01469"></a>01469 <span class="comment">    $ make -s [sim|kernel]</span>
<a name="l01470"></a>01470 <span class="comment">    @endverbatim</span>
<a name="l01471"></a>01471 <span class="comment">   NOTE: When debugging kernel on CN6XXX OCTEON model, disable CONFIG_I2C </span>
<a name="l01472"></a>01472 <span class="comment">         kernel config option, as the kernel should not be interrupted </span>
<a name="l01473"></a>01473 <span class="comment">         while scanning TWSI bus.</span>
<a name="l01474"></a>01474 <span class="comment">   @verbatim</span>
<a name="l01475"></a>01475 <span class="comment">   $ cd kernel/linux</span>
<a name="l01476"></a>01476 <span class="comment">   $ make menuconfig</span>
<a name="l01477"></a>01477 <span class="comment">   Device Driver   ---&gt;</span>
<a name="l01478"></a>01478 <span class="comment">       &lt; &gt; I2C Support ---&gt;</span>
<a name="l01479"></a>01479 <span class="comment">   @endverbatim</span>
<a name="l01480"></a>01480 <span class="comment">-# Start the Linux kernel.</span>
<a name="l01481"></a>01481 <span class="comment"> + OCTEON Simulator</span>
<a name="l01482"></a>01482 <span class="comment">   @verbatim</span>
<a name="l01483"></a>01483 <span class="comment">   $ cd kernel/linux</span>
<a name="l01484"></a>01484 <span class="comment">   $ ./oct-linux -quiet -noperf -uart1=2021</span>
<a name="l01485"></a>01485 <span class="comment">   terminal 2 $ telnet localhost 2020</span>
<a name="l01486"></a>01486 <span class="comment">   @endverbatim</span>
<a name="l01487"></a>01487 <span class="comment"> + EBB68XX Hardware Reference Board</span>
<a name="l01488"></a>01488 <span class="comment">   Copy the Linux kernel to a compact flash.</span>
<a name="l01489"></a>01489 <span class="comment">   @verbatim</span>
<a name="l01490"></a>01490 <span class="comment">   $ mkdir -p /mnt/usb</span>
<a name="l01491"></a>01491 <span class="comment">   $ fdisk -l /dev/sda         # Only needed on some Kernel 2.6 systems</span>
<a name="l01492"></a>01492 <span class="comment">   $ mount /dev/sda1 /mnt/usb</span>
<a name="l01493"></a>01493 <span class="comment">   $ mips64-octeon-linux-gnu-strip -o /mnt/usb/vmlinux.64 kernel/linux/vmlinux.64</span>
<a name="l01494"></a>01494 <span class="comment">   $ umount /mnt/usb</span>
<a name="l01495"></a>01495 <span class="comment">   @endverbatim</span>
<a name="l01496"></a>01496 <span class="comment">   Put the compact flash into the EBB68XX and reset the board. At the</span>
<a name="l01497"></a>01497 <span class="comment">   bootloader prompt load linux.</span>
<a name="l01498"></a>01498 <span class="comment">   @verbatim</span>
<a name="l01499"></a>01499 <span class="comment">   Octeon ebb6800# fatload ide 0 $(loadaddr) vmlinux.64</span>
<a name="l01500"></a>01500 <span class="comment">   Octeon ebb6800# bootoctlinux $(fileaddr)</span>
<a name="l01501"></a>01501 <span class="comment">   @endverbatim</span>
<a name="l01502"></a>01502 <span class="comment">-# Startup and connect the debugger</span>
<a name="l01503"></a>01503 <span class="comment"> + OCTEON Simulator</span>
<a name="l01504"></a>01504 <span class="comment">   @verbatim</span>
<a name="l01505"></a>01505 <span class="comment">   $ cd linux/kernel/linux</span>
<a name="l01506"></a>01506 <span class="comment">   $ mipsisa64-octeon-elf-ddd --debugger mipsisa64-octeon-elf-gdb vmlinux.64</span>
<a name="l01507"></a>01507 <span class="comment">   gdb&gt; target octeon tcp::2021</span>
<a name="l01508"></a>01508 <span class="comment">   gdb&gt; load</span>
<a name="l01509"></a>01509 <span class="comment">   gdb&gt; stepi</span>
<a name="l01510"></a>01510 <span class="comment">   @endverbatim</span>
<a name="l01511"></a>01511 <span class="comment"> + EBB68XX Hardware Reference Board</span>
<a name="l01512"></a>01512 <span class="comment">  - For debugging over serial port</span>
<a name="l01513"></a>01513 <span class="comment">    @verbatim</span>
<a name="l01514"></a>01514 <span class="comment">    $ cd linux/kernel/linux</span>
<a name="l01515"></a>01515 <span class="comment">    $ mipsisa64-octeon-elf-ddd --debugger mipsisa64-octeon-elf-gdb vmlinux.64</span>
<a name="l01516"></a>01516 <span class="comment">    gdb&gt; target octeon /dev/ttyS1</span>
<a name="l01517"></a>01517 <span class="comment">    gdb&gt; load</span>
<a name="l01518"></a>01518 <span class="comment">    gdb&gt; stepi</span>
<a name="l01519"></a>01519 <span class="comment">    @endverbatim</span>
<a name="l01520"></a>01520 <span class="comment">  - For debugging over PCI</span>
<a name="l01521"></a>01521 <span class="comment">    @verbatim</span>
<a name="l01522"></a>01522 <span class="comment">    # cd linux/kernel/linux</span>
<a name="l01523"></a>01523 <span class="comment">    # mipsisa64-octeon-elf-ddd --debugger mipsisa64-octeon-elf-gdb vmlinux.64</span>
<a name="l01524"></a>01524 <span class="comment">    gdb&gt; set pci_bootcmd oct-pci-boot    // this is required only for </span>
<a name="l01525"></a>01525 <span class="comment">                                         // PCIBOOT mode</span>
<a name="l01526"></a>01526 <span class="comment">    gdb&gt; target octeonpci bootoctlinux $(loadaddr)</span>
<a name="l01527"></a>01527 <span class="comment">    gdb&gt; load</span>
<a name="l01528"></a>01528 <span class="comment">    gdb&gt; stepi</span>
<a name="l01529"></a>01529 <span class="comment">    @endverbatim</span>
<a name="l01530"></a>01530 <span class="comment"></span>
<a name="l01531"></a>01531 <span class="comment">NOTE: The bootoctlinux command will load the kernel and run on OCTEON, or with GDB:</span>
<a name="l01532"></a>01532 <span class="comment"></span>
<a name="l01533"></a>01533 <span class="comment">@verbatim</span>
<a name="l01534"></a>01534 <span class="comment">/usr/local/Cavium_Networks/OCTEON-SDK mipsisa64-octeon-elf-gdb -q linux/kernel/linux/vmlinux.64</span>
<a name="l01535"></a>01535 <span class="comment">(Core#0-gdb) target octeon /dev/ttyS0</span>
<a name="l01536"></a>01536 <span class="comment">Remote target octeon connected to /dev/ttyS0</span>
<a name="l01537"></a>01537 <span class="comment">(Core#0-gdb) b r4k_wait</span>
<a name="l01538"></a>01538 <span class="comment">Breakpoint 1 at 0xffffffff8110a434: file arch/mips/kernel/cpu-probe.c, line 51.</span>
<a name="l01539"></a>01539 <span class="comment">(Core#0-gdb) c</span>
<a name="l01540"></a>01540 <span class="comment">Continuing.</span>
<a name="l01541"></a>01541 <span class="comment">Breakpoint 1, r4k_wait () at arch/mips/kernel/cpu-probe.c:51</span>
<a name="l01542"></a>01542 <span class="comment">51__asm__(&quot;.set\tmips3\n\t&quot;</span>
<a name="l01543"></a>01543 <span class="comment">(Core#0-gdb)</span>
<a name="l01544"></a>01544 <span class="comment">@endverbatim</span>
<a name="l01545"></a>01545 <span class="comment"></span>
<a name="l01546"></a>01546 <span class="comment">Control-C interrupt handling is handled in the kernel inside do_IRQ in</span>
<a name="l01547"></a>01547 <span class="comment">arch/mips/kernel/irq.c. Whenever interrupt 2 occurs, the debug uart is</span>
<a name="l01548"></a>01548 <span class="comment">polled. If there is any data available, the MCD0 signal is pulsed. This</span>
<a name="l01549"></a>01549 <span class="comment">causes all cores to enter the interrupt handler. A side effect of this is</span>
<a name="l01550"></a>01550 <span class="comment">that any Control-C interrupt, or initial debug entry will always stop in</span>
<a name="l01551"></a>01551 <span class="comment">do_IRQ under exception context.</span>
<a name="l01552"></a>01552 <span class="comment"></span>
<a name="l01553"></a>01553 <span class="comment">Commonly the kernel uses smp_call_function to synchronize operations across</span>
<a name="l01554"></a>01554 <span class="comment">all cores. This will hang forever if a core is currently stopped in the</span>
<a name="l01555"></a>01555 <span class="comment">debug exception. Make sure @b step-all is @b on whenever SMP operations are</span>
<a name="l01556"></a>01556 <span class="comment">expected.</span>
<a name="l01557"></a>01557 <span class="comment"></span>
<a name="l01558"></a>01558 <span class="comment">@section linux_kernel_debugging_kgdb 22. Debugging the Kernel with KGDB</span>
<a name="l01559"></a>01559 <span class="comment"></span>
<a name="l01560"></a>01560 <span class="comment">The standard Linux kernel debugger, KGDB, is also available on OCTEON. The</span>
<a name="l01561"></a>01561 <span class="comment">setup for KGDB is very similar to the Cavium Inc. Multicore GDB. Here</span>
<a name="l01562"></a>01562 <span class="comment">are the steps:</span>
<a name="l01563"></a>01563 <span class="comment"></span>
<a name="l01564"></a>01564 <span class="comment">-# For the EBB68XX, you will need two serial port connections to the</span>
<a name="l01565"></a>01565 <span class="comment">   board. Connect the two serial ports by the LED display to the host</span>
<a name="l01566"></a>01566 <span class="comment">   PC using null modem cables. The first should already be hooked up</span>
<a name="l01567"></a>01567 <span class="comment">   for use with Minicom as a console. The second will be used for the</span>
<a name="l01568"></a>01568 <span class="comment">   debugger traffic. Optionally, a single uart can be used if &quot;Console</span>
<a name="l01569"></a>01569 <span class="comment">   output to GDB&quot; is enabled. This is not recommended since it breaks</span>
<a name="l01570"></a>01570 <span class="comment">   output for userspace applications.</span>
<a name="l01571"></a>01571 <span class="comment"></span>
<a name="l01572"></a>01572 <span class="comment">-# Build the kernel with debugging support and without the OCTEON watchdog driver.</span>
<a name="l01573"></a>01573 <span class="comment">   @verbatim</span>
<a name="l01574"></a>01574 <span class="comment">    $ cd linux</span>
<a name="l01575"></a>01575 <span class="comment">    $ make -s [sim|kernel]-config</span>
<a name="l01576"></a>01576 <span class="comment">    $ cd kernel/linux</span>
<a name="l01577"></a>01577 <span class="comment">    $ make menuconfig</span>
<a name="l01578"></a>01578 <span class="comment">    Machine selection  ---&gt;</span>
<a name="l01579"></a>01579 <span class="comment">        &lt; &gt; OCTEON watchdog driver</span>
<a name="l01580"></a>01580 <span class="comment">    Kernel hacking  ---&gt;</span>
<a name="l01581"></a>01581 <span class="comment">        [*] KGDB: kernel debugging with remote gdb  ---&gt;</span>
<a name="l01582"></a>01582 <span class="comment">              &lt;*&gt;   8250/16550 and compatible serial support</span>
<a name="l01583"></a>01583 <span class="comment"></span>
<a name="l01584"></a>01584 <span class="comment">    $ cd ../..</span>
<a name="l01585"></a>01585 <span class="comment">    $ make -s [sim|kernel]</span>
<a name="l01586"></a>01586 <span class="comment">   @endverbatim</span>
<a name="l01587"></a>01587 <span class="comment">-# Start the Linux kernel.</span>
<a name="l01588"></a>01588 <span class="comment"> + OCTEON Simulator</span>
<a name="l01589"></a>01589 <span class="comment">   @verbatim</span>
<a name="l01590"></a>01590 <span class="comment">    $ cd linux/kernel</span>
<a name="l01591"></a>01591 <span class="comment">    $ ./oct-linux -quiet -noperf -uart1=2021</span>
<a name="l01592"></a>01592 <span class="comment">    terminal 2 $ telnet localhost 2020</span>
<a name="l01593"></a>01593 <span class="comment">   @endverbatim</span>
<a name="l01594"></a>01594 <span class="comment"> + EBB68XX Hardware Reference Board</span>
<a name="l01595"></a>01595 <span class="comment">   Copy the Linux kernel to a compact flash.</span>
<a name="l01596"></a>01596 <span class="comment">   @verbatim</span>
<a name="l01597"></a>01597 <span class="comment">    $ mkdir -p /mnt/usb</span>
<a name="l01598"></a>01598 <span class="comment">    $ fdisk -l /dev/sda         # Only needed on some Kernel 2.6 systems</span>
<a name="l01599"></a>01599 <span class="comment">    $ mount /dev/sda1 /mnt/usb</span>
<a name="l01600"></a>01600 <span class="comment">    $ mips64-octeon-linux-gnu-strip -o /mnt/usb/vmlinux.64 kernel/linux/vmlinux.64</span>
<a name="l01601"></a>01601 <span class="comment">    $ umount /mnt/usb</span>
<a name="l01602"></a>01602 <span class="comment">   @endverbatim</span>
<a name="l01603"></a>01603 <span class="comment">   Put the compact flash into the EBB68XX and reset the board. At the</span>
<a name="l01604"></a>01604 <span class="comment">   bootloader prompt load linux.</span>
<a name="l01605"></a>01605 <span class="comment">   @verbatim</span>
<a name="l01606"></a>01606 <span class="comment">    Octeon ebb6800# fatload ide 0 $(loadaddr) vmlinux.64</span>
<a name="l01607"></a>01607 <span class="comment">    Octeon ebb6800# bootoctlinux $(fileaddr) kgdbwait kgdboc=ttyS1,38400</span>
<a name="l01608"></a>01608 <span class="comment">   @endverbatim</span>
<a name="l01609"></a>01609 <span class="comment">-# Startup and connect the debugger</span>
<a name="l01610"></a>01610 <span class="comment"> + OCTEON Simulator</span>
<a name="l01611"></a>01611 <span class="comment">   @verbatim</span>
<a name="l01612"></a>01612 <span class="comment">    $ cd linux/kernel/linux</span>
<a name="l01613"></a>01613 <span class="comment">    $ mips64-octeon-linux-gnu-gdb vmlinux.64</span>
<a name="l01614"></a>01614 <span class="comment">    (gdb) target remote tcp::2021</span>
<a name="l01615"></a>01615 <span class="comment">    (gdb) stepi</span>
<a name="l01616"></a>01616 <span class="comment">   @endverbatim</span>
<a name="l01617"></a>01617 <span class="comment"> + EBB68XX Hardware Reference Board</span>
<a name="l01618"></a>01618 <span class="comment">   @verbatim</span>
<a name="l01619"></a>01619 <span class="comment">    $ cd linux/kernel/linux</span>
<a name="l01620"></a>01620 <span class="comment">    $ mips64-octeon-linux-gnu-gdb vmlinux.64</span>
<a name="l01621"></a>01621 <span class="comment">    (gdb) set remotebaud 38400</span>
<a name="l01622"></a>01622 <span class="comment">    (gdb) target remote /dev/ttyS1</span>
<a name="l01623"></a>01623 <span class="comment">    (gdb) stepi</span>
<a name="l01624"></a>01624 <span class="comment">   @endverbatim</span>
<a name="l01625"></a>01625 <span class="comment"></span>
<a name="l01626"></a>01626 <span class="comment">@section linux_kernel_boot2 23. Booting Two Separate Kernels on an EBB68XX</span>
<a name="l01627"></a>01627 <span class="comment"></span>
<a name="l01628"></a>01628 <span class="comment">OCTEON Linux can be configured to run two separate kernels with</span>
<a name="l01629"></a>01629 <span class="comment">each kernel using a separate uart for the console. Below is the</span>
<a name="l01630"></a>01630 <span class="comment">procedure to boot same kernel on all the even cores with all the IOs</span>
<a name="l01631"></a>01631 <span class="comment">support and another on all the odd cores without any IOs.</span>
<a name="l01632"></a>01632 <span class="comment"></span>
<a name="l01633"></a>01633 <span class="comment">-1 Configure the kernel to mapped kernel</span>
<a name="l01634"></a>01634 <span class="comment">@verbatim</span>
<a name="l01635"></a>01635 <span class="comment">$ cd ${OCTEON_ROOT}/linux</span>
<a name="l01636"></a>01636 <span class="comment">$ cd kernel/linux</span>
<a name="l01637"></a>01637 <span class="comment">$ cp ../kernel.config .config</span>
<a name="l01638"></a>01638 <span class="comment">$ make menuconfig</span>
<a name="l01639"></a>01639 <span class="comment">  kernel_type ---&gt;</span>
<a name="l01640"></a>01640 <span class="comment">      [*] Mapped kernel</span>
<a name="l01641"></a>01641 <span class="comment"></span>
<a name="l01642"></a>01642 <span class="comment">$ cd ../../</span>
<a name="l01643"></a>01643 <span class="comment">@endverbatim</span>
<a name="l01644"></a>01644 <span class="comment">NOTE: Configure the kernel to disable the early console, as this</span>
<a name="l01645"></a>01645 <span class="comment">      might cause early boot messages to appear on the wrong UART.</span>
<a name="l01646"></a>01646 <span class="comment">@verbatim</span>
<a name="l01647"></a>01647 <span class="comment">      make menuconfig</span>
<a name="l01648"></a>01648 <span class="comment">      [ ] Early printk</span>
<a name="l01649"></a>01649 <span class="comment">@endverbatim</span>
<a name="l01650"></a>01650 <span class="comment"></span>
<a name="l01651"></a>01651 <span class="comment"></span>
<a name="l01652"></a>01652 <span class="comment">-2 Build a Linux kernel.</span>
<a name="l01653"></a>01653 <span class="comment"></span>
<a name="l01654"></a>01654 <span class="comment">@verbatim</span>
<a name="l01655"></a>01655 <span class="comment">$ make -s [kernel|kernel-deb] strip</span>
<a name="l01656"></a>01656 <span class="comment">@endverbatim</span>
<a name="l01657"></a>01657 <span class="comment"></span>
<a name="l01658"></a>01658 <span class="comment">-3 Prepare compact flash with kernel image</span>
<a name="l01659"></a>01659 <span class="comment"></span>
<a name="l01660"></a>01660 <span class="comment">For embedded_rootfs kernel:</span>
<a name="l01661"></a>01661 <span class="comment"></span>
<a name="l01662"></a>01662 <span class="comment">@verbatim</span>
<a name="l01663"></a>01663 <span class="comment">$ mount /mnt/cf1</span>
<a name="l01664"></a>01664 <span class="comment">$ cp kernel/linux/vmlinux.64 /mnt/cf1/vmlinux-mapped.64</span>
<a name="l01665"></a>01665 <span class="comment">$ umount /mnt/cf1</span>
<a name="l01666"></a>01666 <span class="comment">@endverbatim</span>
<a name="l01667"></a>01667 <span class="comment"></span>
<a name="l01668"></a>01668 <span class="comment">For debian rootfs kernel:</span>
<a name="l01669"></a>01669 <span class="comment">@verbatim</span>
<a name="l01670"></a>01670 <span class="comment"># cd debian</span>
<a name="l01671"></a>01671 <span class="comment"># make DISK=/dev/ttyDISK compact-flash</span>
<a name="l01672"></a>01672 <span class="comment"># cd ..</span>
<a name="l01673"></a>01673 <span class="comment">@endverbatim</span>
<a name="l01674"></a>01674 <span class="comment"></span>
<a name="l01675"></a>01675 <span class="comment">-4 Choose which IOs to be used by kernel instance. Linux kernel enables</span>
<a name="l01676"></a>01676 <span class="comment">Packet I/O, serial port, I2C, GPIOs etc through device tree.</span>
<a name="l01677"></a>01677 <span class="comment"></span>
<a name="l01678"></a>01678 <span class="comment">a. Print the device tree from bootloader prompt (this is from ebb6800 board):</span>
<a name="l01679"></a>01679 <span class="comment"></span>
<a name="l01680"></a>01680 <span class="comment">@verbatim</span>
<a name="l01681"></a>01681 <span class="comment">fdt print</span>
<a name="l01682"></a>01682 <span class="comment">   .....</span>
<a name="l01683"></a>01683 <span class="comment">        aliases {</span>
<a name="l01684"></a>01684 <span class="comment">         mix0 = &quot;/soc@0/ethernet@1070000100000&quot;;</span>
<a name="l01685"></a>01685 <span class="comment">         pip = &quot;/soc@0/pip@11800a0000000&quot;;</span>
<a name="l01686"></a>01686 <span class="comment">         smi0 = &quot;/soc@0/mdio@1180000003800&quot;;</span>
<a name="l01687"></a>01687 <span class="comment">         smi1 = &quot;/soc@0/mdio@1180000003880&quot;;</span>
<a name="l01688"></a>01688 <span class="comment">         smi2 = &quot;/soc@0/mdio@1180000003900&quot;;</span>
<a name="l01689"></a>01689 <span class="comment">         smi3 = &quot;/soc@0/mdio@1180000003980&quot;;</span>
<a name="l01690"></a>01690 <span class="comment">         twsi0 = &quot;/soc@0/i2c@1180000001000&quot;;</span>
<a name="l01691"></a>01691 <span class="comment">         twsi1 = &quot;/soc@0/i2c@1180000001200&quot;;</span>
<a name="l01692"></a>01692 <span class="comment">         uart0 = &quot;/soc@0/serial@1180000000800&quot;;</span>
<a name="l01693"></a>01693 <span class="comment">         uart1 = &quot;/soc@0/serial@1180000000c00&quot;;</span>
<a name="l01694"></a>01694 <span class="comment">         flash0 = &quot;/soc@0/bootbus@1180000000000/nor@0,0&quot;;</span>
<a name="l01695"></a>01695 <span class="comment">        };</span>
<a name="l01696"></a>01696 <span class="comment">@endverbatim</span>
<a name="l01697"></a>01697 <span class="comment"></span>
<a name="l01698"></a>01698 <span class="comment">Note down all the information that is mentioned in aliases.</span>
<a name="l01699"></a>01699 <span class="comment"></span>
<a name="l01700"></a>01700 <span class="comment">b. Gather information about device tree.</span>
<a name="l01701"></a>01701 <span class="comment"></span>
<a name="l01702"></a>01702 <span class="comment">   Get the size of the device tree:</span>
<a name="l01703"></a>01703 <span class="comment"></span>
<a name="l01704"></a>01704 <span class="comment">   @verbatim</span>
<a name="l01705"></a>01705 <span class="comment">   fdt header</span>
<a name="l01706"></a>01706 <span class="comment">   magic:                  0xd00dfeed</span>
<a name="l01707"></a>01707 <span class="comment">   totalsize:              0x423d (16957)</span>
<a name="l01708"></a>01708 <span class="comment">   off_dt_struct:          0x38</span>
<a name="l01709"></a>01709 <span class="comment">   off_dt_strings:         0x3f50</span>
<a name="l01710"></a>01710 <span class="comment">   off_mem_rsvmap:         0x28</span>
<a name="l01711"></a>01711 <span class="comment">   version:                17</span>
<a name="l01712"></a>01712 <span class="comment">   last_comp_version:      16</span>
<a name="l01713"></a>01713 <span class="comment">   boot_cpuid_phys:        0x0</span>
<a name="l01714"></a>01714 <span class="comment">   size_dt_strings:        0x2ed</span>
<a name="l01715"></a>01715 <span class="comment">   size_dt_struct:         0x3f18</span>
<a name="l01716"></a>01716 <span class="comment">   number mem_rsv:         0x0                        </span>
<a name="l01717"></a>01717 <span class="comment">   @endverbatim</span>
<a name="l01718"></a>01718 <span class="comment"></span>
<a name="l01719"></a>01719 <span class="comment">   Round totalsize to the nearest 100s, which will be 0x5000 bytes.</span>
<a name="l01720"></a>01720 <span class="comment"></span>
<a name="l01721"></a>01721 <span class="comment">   Get the address of the device tree:</span>
<a name="l01722"></a>01722 <span class="comment"></span>
<a name="l01723"></a>01723 <span class="comment">   @verbatim</span>
<a name="l01724"></a>01724 <span class="comment">   fdt addr -c</span>
<a name="l01725"></a>01725 <span class="comment">   The address of the fdt is 00080000</span>
<a name="l01726"></a>01726 <span class="comment">   @endverbatim</span>
<a name="l01727"></a>01727 <span class="comment"></span>
<a name="l01728"></a>01728 <span class="comment">c. Create named block to save device tree information and enable </span>
<a name="l01729"></a>01729 <span class="comment">   only the needed devices</span>
<a name="l01730"></a>01730 <span class="comment"></span>
<a name="l01731"></a>01731 <span class="comment">   Check the available memory for creating the named block</span>
<a name="l01732"></a>01732 <span class="comment"></span>
<a name="l01733"></a>01733 <span class="comment">   @verbatim</span>
<a name="l01734"></a>01734 <span class="comment">   freeprint</span>
<a name="l01735"></a>01735 <span class="comment"></span>
<a name="l01736"></a>01736 <span class="comment">   Printing bootmem block list, descriptor: 0x6c108, head is 0xf100000</span>
<a name="l01737"></a>01737 <span class="comment">   Descriptor version: 3.0</span>
<a name="l01738"></a>01738 <span class="comment">   Block address: 0x0f100000, size: 0x00e2ac90, next: 0x0ffeb640</span>
<a name="l01739"></a>01739 <span class="comment">   Block address: 0x0ffeb640, size: 0x00000020, next: 0x0ffebed0</span>
<a name="l01740"></a>01740 <span class="comment">   Block address: 0x0ffebed0, size: 0x00000010, next: 0x30000000</span>
<a name="l01741"></a>01741 <span class="comment">   Block address: 0x30000000, size: 0x1df000000, next: 0x00000000</span>
<a name="l01742"></a>01742 <span class="comment"></span>
<a name="l01743"></a>01743 <span class="comment"></span>
<a name="l01744"></a>01744 <span class="comment">   @endverbatim</span>
<a name="l01745"></a>01745 <span class="comment"></span>
<a name="l01746"></a>01746 <span class="comment">   First entry has enough memory to create named block of 0x5000 bytes.</span>
<a name="l01747"></a>01747 <span class="comment"></span>
<a name="l01748"></a>01748 <span class="comment">   @verbatim</span>
<a name="l01749"></a>01749 <span class="comment">   namedalloc dd_fdt 0x5000 0x0f100000</span>
<a name="l01750"></a>01750 <span class="comment">   @endverbatim</span>
<a name="l01751"></a>01751 <span class="comment"></span>
<a name="l01752"></a>01752 <span class="comment">   Verify the named block by invoking &apos;namedprint&apos;.</span>
<a name="l01753"></a>01753 <span class="comment"></span>
<a name="l01754"></a>01754 <span class="comment">d. Copy device tree to the newly created named block</span>
<a name="l01755"></a>01755 <span class="comment"></span>
<a name="l01756"></a>01756 <span class="comment">   @verbatim</span>
<a name="l01757"></a>01757 <span class="comment">   fdt move 0x00080000 0x0f100000</span>
<a name="l01758"></a>01758 <span class="comment">   @endverbatim</span>
<a name="l01759"></a>01759 <span class="comment"></span>
<a name="l01760"></a>01760 <span class="comment">   This command changes device tree&apos;s address to 0x0f1000a0, where the</span>
<a name="l01761"></a>01761 <span class="comment">   named block is created.</span>
<a name="l01762"></a>01762 <span class="comment"></span>
<a name="l01763"></a>01763 <span class="comment">e. Load the mapped kernel.</span>
<a name="l01764"></a>01764 <span class="comment"></span>
<a name="l01765"></a>01765 <span class="comment">   @verbatim</span>
<a name="l01766"></a>01766 <span class="comment">   fatload ide 0 $(loadaddr) vmlinux.64</span>
<a name="l01767"></a>01767 <span class="comment">   @endverbatim</span>
<a name="l01768"></a>01768 <span class="comment"></span>
<a name="l01769"></a>01769 <span class="comment">f. Keep all the devices that are needed for booting on 2nd kernel. Generally</span>
<a name="l01770"></a>01770 <span class="comment">   recommended to have IOs in the main kernel, only need to keep device tree</span>
<a name="l01771"></a>01771 <span class="comment">   information for uart1 for kernel stdout/stderr messages.</span>
<a name="l01772"></a>01772 <span class="comment"></span>
<a name="l01773"></a>01773 <span class="comment">   @verbatim</span>
<a name="l01774"></a>01774 <span class="comment">   fdt rm /soc@0/ethernet@1070000100000</span>
<a name="l01775"></a>01775 <span class="comment">   fdt rm /soc@0/pip@11800a0000000</span>
<a name="l01776"></a>01776 <span class="comment">   fdt rm /soc@0/mdio@1180000003800</span>
<a name="l01777"></a>01777 <span class="comment">   fdt rm /soc@0/mdio@1180000003880</span>
<a name="l01778"></a>01778 <span class="comment">   fdt rm /soc@0/mdio@1180000003900</span>
<a name="l01779"></a>01779 <span class="comment">   fdt rm /soc@0/mdio@1180000003980</span>
<a name="l01780"></a>01780 <span class="comment">   fdt rm /soc@0/i2c@1180000001000</span>
<a name="l01781"></a>01781 <span class="comment">   fdt rm /soc@0/i2c@1180000001200</span>
<a name="l01782"></a>01782 <span class="comment">   fdt rm /soc@0/serial@1180000000800</span>
<a name="l01783"></a>01783 <span class="comment">   fdt rm /soc@0/bootbus@1180000000000</span>
<a name="l01784"></a>01784 <span class="comment">   fdt rm /soc@0/mmc@1180000002000</span>
<a name="l01785"></a>01785 <span class="comment">   @endverbatim</span>
<a name="l01786"></a>01786 <span class="comment"></span>
<a name="l01787"></a>01787 <span class="comment">   These values are examples only.</span>
<a name="l01788"></a>01788 <span class="comment">   Real values for your board should be taken from &apos;fdt print&apos; command.</span>
<a name="l01789"></a>01789 <span class="comment"></span>
<a name="l01790"></a>01790 <span class="comment">g. Boot the 2nd kernel</span>
<a name="l01791"></a>01791 <span class="comment"></span>
<a name="l01792"></a>01792 <span class="comment">   For embedded_rootfs kernel:</span>
<a name="l01793"></a>01793 <span class="comment"></span>
<a name="l01794"></a>01794 <span class="comment">   @verbatim</span>
<a name="l01795"></a>01795 <span class="comment">   bootoctlinux $(loadaddr) coremask=0xaaaa endbootargs nousb pcie-octeon.pcie_disable=1 octeon_error_tree.disable=1</span>
<a name="l01796"></a>01796 <span class="comment">   @endverbatim</span>
<a name="l01797"></a>01797 <span class="comment"></span>
<a name="l01798"></a>01798 <span class="comment">   For debian rootfs kernel: </span>
<a name="l01799"></a>01799 <span class="comment">   @verbatim</span>
<a name="l01800"></a>01800 <span class="comment">   bootoctlinux $(loadaddr) coremask=0xaaaa endbootargs root=/dev/sda2 mem=1024M nousb pcie-octeon.pcie_disable=1</span>
<a name="l01801"></a>01801 <span class="comment">   @endverbatim</span>
<a name="l01802"></a>01802 <span class="comment"></span>
<a name="l01803"></a>01803 <span class="comment">h. Prepare to boot main kernel</span>
<a name="l01804"></a>01804 <span class="comment"></span>
<a name="l01805"></a>01805 <span class="comment">   Switch device tree address to point to the original address</span>
<a name="l01806"></a>01806 <span class="comment"></span>
<a name="l01807"></a>01807 <span class="comment">   @verbatim</span>
<a name="l01808"></a>01808 <span class="comment">   fdt addr 0x00080000</span>
<a name="l01809"></a>01809 <span class="comment">   @endverbatim</span>
<a name="l01810"></a>01810 <span class="comment"></span>
<a name="l01811"></a>01811 <span class="comment">   Remove device tree for uart1</span>
<a name="l01812"></a>01812 <span class="comment"></span>
<a name="l01813"></a>01813 <span class="comment">   @verbatim</span>
<a name="l01814"></a>01814 <span class="comment">   fdt rm /soc@0/serial@1180000000c00</span>
<a name="l01815"></a>01815 <span class="comment">   @endverbatim</span>
<a name="l01816"></a>01816 <span class="comment"></span>
<a name="l01817"></a>01817 <span class="comment">i. Boot the main kernel</span>
<a name="l01818"></a>01818 <span class="comment"></span>
<a name="l01819"></a>01819 <span class="comment">   For embedded_rootfs kernel:</span>
<a name="l01820"></a>01820 <span class="comment"></span>
<a name="l01821"></a>01821 <span class="comment">   @verbatim</span>
<a name="l01822"></a>01822 <span class="comment">   bootoctlinux $(loadaddr) coremask=0x5555 endbootargs</span>
<a name="l01823"></a>01823 <span class="comment">   @endverbatim</span>
<a name="l01824"></a>01824 <span class="comment"></span>
<a name="l01825"></a>01825 <span class="comment">   For debian rootfs kernel: </span>
<a name="l01826"></a>01826 <span class="comment">   @verbatim</span>
<a name="l01827"></a>01827 <span class="comment">   bootoctlinux $(loadaddr) coremask=0x5555 endbootargs root=/dev/sda2 mem=1024M</span>
<a name="l01828"></a>01828 <span class="comment">   @endverbatim</span>
<a name="l01829"></a>01829 <span class="comment"></span>
<a name="l01830"></a>01830 <span class="comment">j. You should get kernel boot messages out of both uarts.</span>
<a name="l01831"></a>01831 <span class="comment"></span>
<a name="l01832"></a>01832 <span class="comment">@section linux_kernel_boot2_pow_ethernet 24. Ethernet between two booted kernels using the POW</span>
<a name="l01833"></a>01833 <span class="comment"></span>
<a name="l01834"></a>01834 <span class="comment">When running multiple kernels on OCTEON, ethernet traffic between the</span>
<a name="l01835"></a>01835 <span class="comment">kernels gets more complicated than with a normal ethernet driver. Only one</span>
<a name="l01836"></a>01836 <span class="comment">kernel is allowed to run the Cavium ethernet driver. The other kernels</span>
<a name="l01837"></a>01837 <span class="comment">communicate ethernet traffic using the &lt;b&gt;octeon-pow-ethernet&lt;/b&gt; device driver.</span>
<a name="l01838"></a>01838 <span class="comment">This driver uses the OCTEON POW to route network traffic between different</span>
<a name="l01839"></a>01839 <span class="comment">kernels using a group per kernel. The octeon-pow-ethernet module takes two</span>
<a name="l01840"></a>01840 <span class="comment">parameters:</span>
<a name="l01841"></a>01841 <span class="comment"></span>
<a name="l01842"></a>01842 <span class="comment">- &lt;b&gt;receive_group&lt;/b&gt;: 0-15 POW group to receive packets from. This must</span>
<a name="l01843"></a>01843 <span class="comment">    be unique in the system. If you don&apos;t specify a value, the hardware</span>
<a name="l01844"></a>01844 <span class="comment">    core ID will be used of the CPU that loads the module. If this is</span>
<a name="l01845"></a>01845 <span class="comment">    not specified, it is &lt;b&gt;strongly&lt;/b&gt; advised that you always use</span>
<a name="l01846"></a>01846 <span class="comment">    &quot;schedtool -a 0 -e modprobe octeon-pow-ethernet ...&quot;</span>
<a name="l01847"></a>01847 <span class="comment">    to load the module. This way the default value of this parameter is</span>
<a name="l01848"></a>01848 <span class="comment">    deterministic.</span>
<a name="l01849"></a>01849 <span class="comment"></span>
<a name="l01850"></a>01850 <span class="comment">- &lt;b&gt;broadcast_groups&lt;/b&gt;: Bitmask of groups to send broadcasts to. This</span>
<a name="l01851"></a>01851 <span class="comment">    &lt;b&gt;must be specified&lt;/b&gt;. Be careful to not send broadcasts to groups</span>
<a name="l01852"></a>01852 <span class="comment">    that aren&apos;t read otherwise you may fill the POW and stop receiving</span>
<a name="l01853"></a>01853 <span class="comment">    packets. The value of this parameter is exceedingly important. It should</span>
<a name="l01854"></a>01854 <span class="comment">    have a bit set for the first core of each kernel that is running. By</span>
<a name="l01855"></a>01855 <span class="comment">    &quot;first core&quot;, I mean the core that loads the octeon-pow-ethernet driver. If you</span>
<a name="l01856"></a>01856 <span class="comment">    followed the suggestion under receive_group, this should be set to</span>
<a name="l01857"></a>01857 <span class="comment">    virtual core zero under each kernel by schedtool. An error in specifying</span>
<a name="l01858"></a>01858 <span class="comment">    this parameter may cause some kernels to not be able to communicate or</span>
<a name="l01859"></a>01859 <span class="comment">    loss of packet buffers to unread POW groups.</span>
<a name="l01860"></a>01860 <span class="comment"></span>
<a name="l01861"></a>01861 <span class="comment">- &lt;b&gt;reverse_endian&lt;/b&gt;: If a mix of big/little-endian code is running,</span>
<a name="l01862"></a>01862 <span class="comment">    set reverse_endian=1 on one side only.</span>
<a name="l01863"></a>01863 <span class="comment"></span>
<a name="l01864"></a>01864 <span class="comment">- &lt;b&gt;pki_packet_pool&lt;/b&gt;: CN78XX devices only. Specify the buffer pool to be used for</span>
<a name="l01865"></a>01865 <span class="comment">    packets. Unlike previous devices the CN78XX uses a dynamic memory mechanism</span>
<a name="l01866"></a>01866 <span class="comment">    to handle port-based packet memory.</span>
<a name="l01867"></a>01867 <span class="comment">    After the modprobe octeon3-ethernet command check dmesg for a line that begins:</span>
<a name="l01868"></a>01868 <span class="comment">    rx sso grp:[grp_nums] aura:[aura_id] pknd:[pknd_id] pko_queue:[pko_queue]</span>
<a name="l01869"></a>01869 <span class="comment">    The argument aura_id is used as the pki_packet_pool argument for both kernels.</span>
<a name="l01870"></a>01870 <span class="comment"></span>
<a name="l01871"></a>01871 <span class="comment">In order to use this driver you must:</span>
<a name="l01872"></a>01872 <span class="comment"></span>
<a name="l01873"></a>01873 <span class="comment">-# Enable the driver under menuconfig</span>
<a name="l01874"></a>01874 <span class="comment">@verbatim</span>
<a name="l01875"></a>01875 <span class="comment">make menuconfig</span>
<a name="l01876"></a>01876 <span class="comment">    Device Drivers ---&gt;</span>
<a name="l01877"></a>01877 <span class="comment">        Networking Device Support ---&gt;</span>
<a name="l01878"></a>01878 <span class="comment">            Ethernet (1000 Mbit) ---&gt;</span>
<a name="l01879"></a>01879 <span class="comment">            &lt;M&gt; POW based internal only ethernet driver</span>
<a name="l01880"></a>01880 <span class="comment">@endverbatim</span>
<a name="l01881"></a>01881 <span class="comment">-# Under kernel one, modprobe the octeon-pow-ethernet device driver. It is &lt;b&gt;very</span>
<a name="l01882"></a>01882 <span class="comment">    important&lt;/b&gt; that the broadcast_groups be set correctly. If the</span>
<a name="l01883"></a>01883 <span class="comment">    parameter isn&apos;t set properly, you will leak packet buffers into unused</span>
<a name="l01884"></a>01884 <span class="comment">    POW groups, causing a lockup of networking.</span>
<a name="l01885"></a>01885 <span class="comment">@verbatim</span>
<a name="l01886"></a>01886 <span class="comment">        $ schedtool -a 0 -e modprobe octeon-pow-ethernet broadcast_groups=3</span>
<a name="l01887"></a>01887 <span class="comment">@endverbatim</span>
<a name="l01888"></a>01888 <span class="comment">-# Under kernel two, modprobe the octeon-pow-ethernet device driver.</span>
<a name="l01889"></a>01889 <span class="comment">@verbatim</span>
<a name="l01890"></a>01890 <span class="comment">        $ schedtool -a 0 -e modprobe octeon-pow-ethernet broadcast_groups=3</span>
<a name="l01891"></a>01891 <span class="comment">@endverbatim</span>
<a name="l01892"></a>01892 <span class="comment">For CN78XX devices use the following line on both kernels (pool 1021 used as example)</span>
<a name="l01893"></a>01893 <span class="comment">@verbatim</span>
<a name="l01894"></a>01894 <span class="comment">        $ schedtool -a 0 -e modprobe octeon-pow-ethernet broadcast_groups=3 pki_packet_pool=1021</span>
<a name="l01895"></a>01895 <span class="comment">@endverbatim</span>
<a name="l01896"></a>01896 <span class="comment">-# If desired, setup kernel one to bridge traffic between the main network</span>
<a name="l01897"></a>01897 <span class="comment">    and the POW network.</span>
<a name="l01898"></a>01898 <span class="comment">@verbatim</span>
<a name="l01899"></a>01899 <span class="comment">        $ brctl addbr br0</span>
<a name="l01900"></a>01900 <span class="comment">        $ brctl addif br0 eth0</span>
<a name="l01901"></a>01901 <span class="comment">        $ brctl addif br0 oct0</span>
<a name="l01902"></a>01902 <span class="comment">        $ ifconfig eth0 up promisc</span>
<a name="l01903"></a>01903 <span class="comment">        $ ifconfig oct0 up promisc</span>
<a name="l01904"></a>01904 <span class="comment">        $ ifconfig br0 up</span>
<a name="l01905"></a>01905 <span class="comment">        Wait for the bridge to begin forwarding.</span>
<a name="l01906"></a>01906 <span class="comment">@endverbatim</span>
<a name="l01907"></a>01907 <span class="comment">-# Either use ifconfig or dhcp to assign IP addresses to kernel one.</span>
<a name="l01908"></a>01908 <span class="comment">@verbatim</span>
<a name="l01909"></a>01909 <span class="comment">        $ ifconfig br0 10.0.0.1</span>
<a name="l01910"></a>01910 <span class="comment">        or</span>
<a name="l01911"></a>01911 <span class="comment">    $ udhcpc -i br0</span>
<a name="l01912"></a>01912 <span class="comment">@endverbatim</span>
<a name="l01913"></a>01913 <span class="comment">-# Either use ifconfig or dhcp to assign IP addresses to kernel two.</span>
<a name="l01914"></a>01914 <span class="comment">@verbatim</span>
<a name="l01915"></a>01915 <span class="comment">    $ ifconfig oct0 10.0.0.2</span>
<a name="l01916"></a>01916 <span class="comment">        or</span>
<a name="l01917"></a>01917 <span class="comment">    $ udhcpc -i oct0</span>
<a name="l01918"></a>01918 <span class="comment">@endverbatim</span>
<a name="l01919"></a>01919 <span class="comment"></span>
<a name="l01920"></a>01920 <span class="comment">@section linux_mixed_endian 25. Mixing Big-Endian &amp; Litte-Endian Kernels</span>
<a name="l01921"></a>01921 <span class="comment"></span>
<a name="l01922"></a>01922 <span class="comment"></span>
<a name="l01923"></a>01923 <span class="comment">- &lt;b&gt;pow-ethernet-bi-endian:&lt;/b&gt;</span>
<a name="l01924"></a>01924 <span class="comment">Example demonstrating mixed big-/little-endian kernels on one chip, communicating via POW ethernet.</span>
<a name="l01925"></a>01925 <span class="comment">This covers building &amp;amp; booting two kernels on one Octeon, and networking between them.</span>
<a name="l01926"></a>01926 <span class="comment">&lt;a href=&quot;../../docs/pow-ethernet-bi-endian/README.txt&quot;&gt;docs/pow-ethernet-bi-endian/README.txt&lt;/a&gt;</span>
<a name="l01927"></a>01927 <span class="comment">Sometimes different CPUs must run a mix of big-endian &amp; little-endian code.</span>
<a name="l01928"></a>01928 <span class="comment">For example, Simple Executive is only defined for big-endian, and Android is only</span>
<a name="l01929"></a>01929 <span class="comment">defined for little-endian.  The octeon-pow-ethernet can still be used to network</span>
<a name="l01930"></a>01930 <span class="comment">between the two flavors, but one species must specify the reverse_endian=1</span>
<a name="l01931"></a>01931 <span class="comment">parameter to the octeon-pow-ethernet driver.</span>
<a name="l01932"></a>01932 <span class="comment">See &lt;a href=&quot;../../docs/pow-ethernet-bi-endian/pow-setup&quot;&gt;docs/pow-ethernet-bi-endian/pow-setup&lt;/a&gt;</span>
<a name="l01933"></a>01933 <span class="comment">for details of module parameters &amp; network setup.</span>
<a name="l01934"></a>01934 <span class="comment"></span>
<a name="l01935"></a>01935 <span class="comment">As an example, here&apos;s how to TFTP-boot two kernels, identical except for endian-ness.</span>
<a name="l01936"></a>01936 <span class="comment">A real-world case would surely have more difference between the two kernel+rootfs</span>
<a name="l01937"></a>01937 <span class="comment">images than just the byte-ordering, but this serves as a demontration of what&apos;s possible.</span>
<a name="l01938"></a>01938 <span class="comment"></span>
<a name="l01939"></a>01939 <span class="comment">To build a second, little-endian kernel, begin by following @ref linux_kernel_boot2</span>
<a name="l01940"></a>01940 <span class="comment">to create a mapped big-endian embedded_rootfs kernel.  Then save it by</span>
<a name="l01941"></a>01941 <span class="comment">    @verbatim</span>
<a name="l01942"></a>01942 <span class="comment">    $ cp kernel/linux/vmlinux.64 /tftpboot/vmlinux.64be</span>
<a name="l01943"></a>01943 <span class="comment">    @endverbatim</span>
<a name="l01944"></a>01944 <span class="comment">Then change kernel &amp; rootfs to little-endian by</span>
<a name="l01945"></a>01945 <span class="comment">    @verbatim</span>
<a name="l01946"></a>01946 <span class="comment">    $ pushd ../sdk</span>
<a name="l01947"></a>01947 <span class="comment">    $ . env-setup OCTEON_CN66XX --little-endian  # or whichever model, but force endian</span>
<a name="l01948"></a>01948 <span class="comment">    $ popd</span>
<a name="l01949"></a>01949 <span class="comment">    $ sed -i \</span>
<a name="l01950"></a>01950 <span class="comment">    -e &apos;s/# CONFIG_CPU_LITTLE_ENDIAN is not set/CONFIG_CPU_LITTLE_ENDIAN=y/g&apos; \</span>
<a name="l01951"></a>01951 <span class="comment">    -e &apos;s/# TOOLCHAIN_LITTLE_ENDIAN is not set/TOOLCHAIN_LITTLE_ENDIAN=y/g&apos; \</span>
<a name="l01952"></a>01952 <span class="comment">    -e &apos;s/CONFIG_CPU_BIG_ENDIAN=y/# CONFIG_CPU_BIG_ENDIAN is not set/g&apos; \</span>
<a name="l01953"></a>01953 <span class="comment">    -e &apos;s/TOOLCHAIN_BIG_ENDIAN=y/# TOOLCHAIN_BIG_ENDIAN is not set/g&apos; \</span>
<a name="l01954"></a>01954 <span class="comment">    kernel/linux/.config embedded_rootfs/.config</span>
<a name="l01955"></a>01955 <span class="comment">    @endverbatim</span>
<a name="l01956"></a>01956 <span class="comment">Now build this kernel, and save result:</span>
<a name="l01957"></a>01957 <span class="comment">    @verbatim</span>
<a name="l01958"></a>01958 <span class="comment">    $ make kernel strip</span>
<a name="l01959"></a>01959 <span class="comment">    $ cp kernel/linux/vmlinux.64 /tftpboot/vmlinux.64le</span>
<a name="l01960"></a>01960 <span class="comment">    @endverbatim</span>
<a name="l01961"></a>01961 <span class="comment">The two kernels can be loaded &amp; booted by a script like</span>
<a name="l01962"></a>01962 <span class="comment">&lt;a href=&quot;../../docs/pow-ethernet-bi-endian/bootscript.in&quot;&gt;bootscript.in&lt;/a&gt;</span>
<a name="l01963"></a>01963 <span class="comment">(the addresses here are cn66XX-specific, but can be simply altered for any hardware)</span>
<a name="l01964"></a>01964 <span class="comment"></span>
<a name="l01965"></a>01965 <span class="comment">@section linux_kernel_watchdog 26. OCTEON Watchdog Driver</span>
<a name="l01966"></a>01966 <span class="comment"></span>
<a name="l01967"></a>01967 <span class="comment">OCTEON Linux includes a watchdog driver for monitoring all cores</span>
<a name="l01968"></a>01968 <span class="comment">running Linux. The watchdog driver is controlled by the kernel config</span>
<a name="l01969"></a>01969 <span class="comment">option CONFIG_OCTEON_WDT. The driver consists of the two</span>
<a name="l01970"></a>01970 <span class="comment">files &lt;b&gt;octeon-wdt-main.c&lt;/b&gt; and &lt;b&gt;octeon-wdt-nmi.S&lt;/b&gt; located under</span>
<a name="l01971"></a>01971 <span class="comment">the &quot;drivers/watchdog&quot; directory.  The driver supports</span>
<a name="l01972"></a>01972 <span class="comment">three parameters: &lt;b&gt;heartbeat=s&lt;/b&gt; the watchdog timeout in</span>
<a name="l01973"></a>01973 <span class="comment">seconds. &lt;b&gt;nowayout=x&lt;/b&gt; keep the watchdog active even if userspace</span>
<a name="l01974"></a>01974 <span class="comment">monitoring app dies. &lt;b&gt;disable&gt;=v&lt;/b&gt; to disable watchdog entirely. Here is an overview</span>
<a name="l01975"></a>01975 <span class="comment">of the processing of watchdogs.</span>
<a name="l01976"></a>01976 <span class="comment"></span>
<a name="l01977"></a>01977 <span class="comment">-# Every core that is &quot;online&quot; under Linux is configured to receive</span>
<a name="l01978"></a>01978 <span class="comment">the interrupt for the watchdog with its same number.</span>
<a name="l01979"></a>01979 <span class="comment">-# Each of the watchdogs is configured to generate an interrupt,</span>
<a name="l01980"></a>01980 <span class="comment">followed by a NMI, followed finally by a chip soft reset. Each</span>
<a name="l01981"></a>01981 <span class="comment">progression occurs every &quot;timeout&quot;.</span>
<a name="l01982"></a>01982 <span class="comment">-# The interrupt handler pokes the watchdog for the associated core</span>
<a name="l01983"></a>01983 <span class="comment">reseting it to the first state.</span>
<a name="l01984"></a>01984 <span class="comment">-# If for some reason the interrupt handler doesn&apos;t poke the watchdog,</span>
<a name="l01985"></a>01985 <span class="comment">a NMI is sent to the core after another timeout.</span>
<a name="l01986"></a>01986 <span class="comment">-# The NMI handler prints a message to UART0 and then sits in a spin</span>
<a name="l01987"></a>01987 <span class="comment">loop until chip reset.</span>
<a name="l01988"></a>01988 <span class="comment">-# Since the NMI doesn&apos;t stop the watchdog, it will perform a chip wide</span>
<a name="l01989"></a>01989 <span class="comment">soft reset after another timeout.</span>
<a name="l01990"></a>01990 <span class="comment">-# If a userspace application opens /dev/watchdog, the driver</span>
<a name="l01991"></a>01991 <span class="comment">quits poking the watchdog from the interrupt handler.  The</span>
<a name="l01992"></a>01992 <span class="comment">poking is instead done when a userspace application</span>
<a name="l01993"></a>01993 <span class="comment">writes to the device.</span>
<a name="l01994"></a>01994 <span class="comment"></span>
<a name="l01995"></a>01995 <span class="comment">When programming the watchdogs, keep these notes in mind:</span>
<a name="l01996"></a>01996 <span class="comment"></span>
<a name="l01997"></a>01997 <span class="comment">-# A soft reset does not stop the watchdog counters. It is possible to</span>
<a name="l01998"></a>01998 <span class="comment">continue to get NMI and soft resets after a chip reboot. For this</span>
<a name="l01999"></a>01999 <span class="comment">reason the Linux kernel disables the watchdogs before rebooting the</span>
<a name="l02000"></a>02000 <span class="comment">system with a soft reset.</span>
<a name="l02001"></a>02001 <span class="comment">-# Once a watchdog has expired it must be poked before it can operate</span>
<a name="l02002"></a>02002 <span class="comment">again. It is not sufficient to disable/enable the watchdog. It is</span>
<a name="l02003"></a>02003 <span class="comment">advised that you always poke the watchdog once during watchdog</span>
<a name="l02004"></a>02004 <span class="comment">initialization.</span>
<a name="l02005"></a>02005 <span class="comment">-# Bit 44 of CIU_INTX_SUM0 is the logical OR of all watchdog signals</span>
<a name="l02006"></a>02006 <span class="comment">enabled in CIU_INTX_EN1. Since CIU_INTX_EN0 bit 44 isn&apos;t implemented,</span>
<a name="l02007"></a>02007 <span class="comment">you must mask watchdog interrupts using CIU_INTX_EN1 instead of the</span>
<a name="l02008"></a>02008 <span class="comment">usual CIU_INTX_EN0.</span>
<a name="l02009"></a>02009 <span class="comment">-# The bootloader reset vector and the NMI interrupt handler are at the</span>
<a name="l02010"></a>02010 <span class="comment">same location in flash. In order to install a NMI handler you must use</span>
<a name="l02011"></a>02011 <span class="comment">one of the bootbus moveable regions to shadow the reset vector. Also</span>
<a name="l02012"></a>02012 <span class="comment">keep in mind that the NMI vector is only 128 bytes.</span>
<a name="l02013"></a>02013 <span class="comment">-# It is not possible to program the watchdogs to cause a soft reset</span>
<a name="l02014"></a>02014 <span class="comment">without a NMI. This means you almost always require a NMI handler.</span>
<a name="l02015"></a>02015 <span class="comment">-# In many cases, interrupts can continue to be processed even</span>
<a name="l02016"></a>02016 <span class="comment">though the system appears &quot;dead&quot;. For example, after a halt of</span>
<a name="l02017"></a>02017 <span class="comment">the kernel using the &quot;poweroff&quot; command, the kernel continues</span>
<a name="l02018"></a>02018 <span class="comment">to process interrupts. This means the watchdogs may continue</span>
<a name="l02019"></a>02019 <span class="comment">to be poked even though the system is unusable.  However, if a</span>
<a name="l02020"></a>02020 <span class="comment">userspace application has opened /dev/watchdog, the watchdogs</span>
<a name="l02021"></a>02021 <span class="comment">are no longer poked in the interrupt handlers, and the system</span>
<a name="l02022"></a>02022 <span class="comment">&lt;b&gt;will&lt;/b&gt; reset.</span>
<a name="l02023"></a>02023 <span class="comment"></span>
<a name="l02024"></a>02024 <span class="comment">@section linux_user_changes 27. OCTEON Specific Changes in Userspace</span>
<a name="l02025"></a>02025 <span class="comment"></span>
<a name="l02026"></a>02026 <span class="comment">-# Enable userspace access to XKPHYS addresses only for OCTEON hardware IO</span>
<a name="l02027"></a>02027 <span class="comment">    addresses.</span>
<a name="l02028"></a>02028 <span class="comment">-# GLIBC patches for abi=n32 and abi=n64.</span>
<a name="l02029"></a>02029 <span class="comment">-# /proc/octeon_info contains OCTEON board specific information.</span>
<a name="l02030"></a>02030 <span class="comment">-# /proc/octeon_perf contains OCTEON specific performance counters.</span>
<a name="l02031"></a>02031 <span class="comment"></span>
<a name="l02032"></a>02032 <span class="comment">@section linux_config_options 28. OCTEON Specific Kernel Config Options</span>
<a name="l02033"></a>02033 <span class="comment"></span>
<a name="l02034"></a>02034 <span class="comment">- @b CONFIG_CAVIUM_OCTEON2: This option enables the generation of OCTEON II specific</span>
<a name="l02035"></a>02035 <span class="comment">  instructions by the compiler, resulting in a kernel that is more efficient, but</span>
<a name="l02036"></a>02036 <span class="comment">  that will not run on OCTEON and OCTEON Plus processor cores.</span>
<a name="l02037"></a>02037 <span class="comment"></span>
<a name="l02038"></a>02038 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_CHK_CVMX_PARAMETER: Compile the kernel with CVMX parameter checking enabled.</span>
<a name="l02039"></a>02039 <span class="comment">  This might catch some programming errors, but will result in a slower kernel.</span>
<a name="l02040"></a>02040 <span class="comment"></span>
<a name="l02041"></a>02041 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_CHK_CVMX_ADDRESS: Compile the kernel with CVMX CSR address checking enabled.</span>
<a name="l02042"></a>02042 <span class="comment">  This might catch some programming errors, but will result in a slower kernel.</span>
<a name="l02043"></a>02043 <span class="comment"></span>
<a name="l02044"></a>02044 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_CHK_CVMX_POW: Compile the kernel with CVMX CSR POW checking enabled.</span>
<a name="l02045"></a>02045 <span class="comment">  This might catch some programming errors, but will result in a slower kernel.</span>
<a name="l02046"></a>02046 <span class="comment"></span>
<a name="l02047"></a>02047 <span class="comment">- @b CONFIG_FAST_ACCESS_TO_THREAD_POINTER: For Mips, normally the TLS thread pointer is accessed by</span>
<a name="l02048"></a>02048 <span class="comment">  the userspace program executing a &quot;rdhwr&quot; from register $29. This register doesn&apos;t exist, so</span>
<a name="l02049"></a>02049 <span class="comment">  the kernel emulates the instruction assigning the thread pointer to the value register. This</span>
<a name="l02050"></a>02050 <span class="comment">  option supplies an alternate, faster access to the thread pointer. A side effect of this option</span>
<a name="l02051"></a>02051 <span class="comment">  is that the highest 8 bytes of CVMSEG is used by the kernel to save and restore the thread</span>
<a name="l02052"></a>02052 <span class="comment">  pointer during the TLB fault handlers. This CVMSEG address isn&apos;t available to user applications.</span>
<a name="l02053"></a>02053 <span class="comment"></span>
<a name="l02054"></a>02054 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_EXTRA_CVMSEG: CVMSEG LM is a segment that</span>
<a name="l02055"></a>02055 <span class="comment">  accesses portions of the dcache as a local memory; the larger CVMSEG</span>
<a name="l02056"></a>02056 <span class="comment">  is, the smaller the cache is. This selects the size of CVMSEG LM,</span>
<a name="l02057"></a>02057 <span class="comment">  which is in cache blocks. The legally range is from zero to 54 cache</span>
<a name="l02058"></a>02058 <span class="comment">  blocks (i.e. CVMSEG LM is between zero and 6192 bytes). The kernel</span>
<a name="l02059"></a>02059 <span class="comment">  and its driver require several lines of CVMSEG LM (three on OCTEON</span>
<a name="l02060"></a>02060 <span class="comment">  III, two on other OCTEON models) Also see section 8 for additional</span>
<a name="l02061"></a>02061 <span class="comment">  information.</span>
<a name="l02062"></a>02062 <span class="comment"></span>
<a name="l02063"></a>02063 <span class="comment">- @b CONFIG_OCTEON_WDT: This option enables a watchdog driver for all cores running Linux.</span>
<a name="l02064"></a>02064 <span class="comment">  It installs a NMI handler and pokes the watchdog based on an interrupt. On first expiration of</span>
<a name="l02065"></a>02065 <span class="comment">  the watchdog, the interrupt handler pokes it. The second expiration causes an NMI that prints a</span>
<a name="l02066"></a>02066 <span class="comment">  message and resets the chip. The third expiration causes a global soft reset. Also see section 19 for</span>
<a name="l02067"></a>02067 <span class="comment">  additional information.</span>
<a name="l02068"></a>02068 <span class="comment"></span>
<a name="l02069"></a>02069 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2: Enable locking parts of the kernel into the L2 cache.</span>
<a name="l02070"></a>02070 <span class="comment"></span>
<a name="l02071"></a>02071 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2_TLB: Lock the low level TLB fast path into L2.</span>
<a name="l02072"></a>02072 <span class="comment"></span>
<a name="l02073"></a>02073 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2_EXCEPTION: Lock the low level exception handler into L2.</span>
<a name="l02074"></a>02074 <span class="comment"></span>
<a name="l02075"></a>02075 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2_LOW_LEVEL_INTERRUPT: Lock the low level interrupt handler into L2.</span>
<a name="l02076"></a>02076 <span class="comment"></span>
<a name="l02077"></a>02077 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2_INTERRUPT: Lock the 2nd level interrupt handler in L2.</span>
<a name="l02078"></a>02078 <span class="comment"></span>
<a name="l02079"></a>02079 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_LOCK_L2_MEMCPY: Lock the kernel&apos;s implementation of memcpy() into L2.</span>
<a name="l02080"></a>02080 <span class="comment"></span>
<a name="l02081"></a>02081 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_USER_IO_PER_PROCESS: Allows user applications to use XKPHYS addresses</span>
<a name="l02082"></a>02082 <span class="comment">  directly to access IO space. This option dynamically enable/disable with sysmips syscall, by a</span>
<a name="l02083"></a>02083 <span class="comment">  process with root privilege. Without root privilege you can only remove access.</span>
<a name="l02084"></a>02084 <span class="comment"></span>
<a name="l02085"></a>02085 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_USER_MEM_PER_PROCESS: Allows user applications to use XKPHYS addresses</span>
<a name="l02086"></a>02086 <span class="comment">  directly to memory. This option dynamically enable/disable with sysmips syscall, Without root</span>
<a name="l02087"></a>02087 <span class="comment">  privilege you can only remove access.</span>
<a name="l02088"></a>02088 <span class="comment"></span>
<a name="l02089"></a>02089 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_USER_IO: Allows all user applications to directly access the OCTEON</span>
<a name="l02090"></a>02090 <span class="comment">  hardware IO addresses (0x1000000000000 - 0x1ffffffffffff). This allows high performance networking</span>
<a name="l02091"></a>02091 <span class="comment">  applications to run in user space with minimal performance penalties. This also means a user</span>
<a name="l02092"></a>02092 <span class="comment">  application can bring down the entire system. Only use this option on embedded devices where</span>
<a name="l02093"></a>02093 <span class="comment">  all user applications are strictly controlled.</span>
<a name="l02094"></a>02094 <span class="comment"></span>
<a name="l02095"></a>02095 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_USER_MEM: Allows all user applications to use XKPHYS addresses directly</span>
<a name="l02096"></a>02096 <span class="comment">  to memory. This allows user space direct access to shared memory not in use by Linux. This memory</span>
<a name="l02097"></a>02097 <span class="comment">  is suitable for use with the OCTEON hardware. Cavium simple executive applications also share</span>
<a name="l02098"></a>02098 <span class="comment">  this memory. Since this bypass all of the Linux memory protection, only use this option on</span>
<a name="l02099"></a>02099 <span class="comment">  embedded devices where all user applications are strictly controlled.</span>
<a name="l02100"></a>02100 <span class="comment"></span>
<a name="l02101"></a>02101 <span class="comment">- @b CONFIG_CAVIUM_RESERVE32: Reserve a shared memory region for user processes to use for hardware</span>
<a name="l02102"></a>02102 <span class="comment">  memory buffers. This is required for 32bit applications to be able to send and receive packets</span>
<a name="l02103"></a>02103 <span class="comment">  directly. Applications access this memory by memory mapping /dev/mem for the addresses in</span>
<a name="l02104"></a>02104 <span class="comment">  /proc/octeon_info.  When this option is configured the Octeon ethernet driver will allocate its</span>
<a name="l02105"></a>02105 <span class="comment">  buffers from this shared memory region.</span>
<a name="l02106"></a>02106 <span class="comment"></span>
<a name="l02107"></a>02107 <span class="comment">- @b CONFIG_OCTEON_ETHERNET: This driver supports the builtin ethernet</span>
<a name="l02108"></a>02108 <span class="comment">  ports on Cavium Inc.&apos;s products in the OCTEON family. This driver</span>
<a name="l02109"></a>02109 <span class="comment">  supports the CN3XXX, CN5XXX, CN6XXX, CN70XX and CN71XX OCTEON</span>
<a name="l02110"></a>02110 <span class="comment">  processors.</span>
<a name="l02111"></a>02111 <span class="comment"></span>
<a name="l02112"></a>02112 <span class="comment">- @b CONFIG_OCTEON3_ETHERNET: This driver supports the builtin ethernet ports on CN7XXX processors.</span>
<a name="l02113"></a>02113 <span class="comment"></span>
<a name="l02114"></a>02114 <span class="comment">- @b CONFIG_OCTEON_POW_ONLY_ETHERNET: This option enables a very simple ethernet driver for</span>
<a name="l02115"></a>02115 <span class="comment">  internal core to core traffic. It relies on another driver, Octeon ethernet driver, to perform all</span>
<a name="l02116"></a>02116 <span class="comment">  hardware setup. This driver&apos;s purpose is to supply basic networking between different Linux</span>
<a name="l02117"></a>02117 <span class="comment">  images running on the same chip. A single core loads the Octeon ethernet driver module, all other cores</span>
<a name="l02118"></a>02118 <span class="comment">  load this driver. On load, the driver waits for some other core to perform hardware setup.</span>
<a name="l02119"></a>02119 <span class="comment"></span>
<a name="l02120"></a>02120 <span class="comment">- @b CONFIG_OCTEON_MGMT_ETHERNET: This option enables the ethernet driver for the</span>
<a name="l02121"></a>02121 <span class="comment">  management port on Cavium Inc. OCTEON CN57XX, CN56XX, CN55XX, CN54XX,</span>
<a name="l02122"></a>02122 <span class="comment">  CN52XX, and CN6XXX chips.</span>
<a name="l02123"></a>02123 <span class="comment"></span>
<a name="l02124"></a>02124 <span class="comment">- @b CONFIG_USB_OCTEON_HCD: The OCTEON DWC_OTG USB host controller.  All CN3XXX and</span>
<a name="l02125"></a>02125 <span class="comment">  CN5XXX based chips with USB are supported.</span>
<a name="l02126"></a>02126 <span class="comment"></span>
<a name="l02127"></a>02127 <span class="comment">- @b CONFIG_USB_OCTEON_EHCI: Enable support for the OCTEON II SOC&apos;s on-chip EHCI</span>
<a name="l02128"></a>02128 <span class="comment">  controller.  It is needed for high-speed (480Mbit/sec) USB 2.0 device support.</span>
<a name="l02129"></a>02129 <span class="comment">  All CN6XXX based chips with USB are supported.</span>
<a name="l02130"></a>02130 <span class="comment"></span>
<a name="l02131"></a>02131 <span class="comment">- @b CONFIG_USB_OCTEON_OHCI: Enable support for the OCTEON II SOC&apos;s on-chip OHCI</span>
<a name="l02132"></a>02132 <span class="comment">  controller.  It is needed for low-speed USB 1.0 device support.  All CN6XXX</span>
<a name="l02133"></a>02133 <span class="comment">  based chips with USB are supported.</span>
<a name="l02134"></a>02134 <span class="comment"></span>
<a name="l02135"></a>02135 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_RAPIDIO: Connect the SRIO interfaces available in the OCTEON II series of</span>
<a name="l02136"></a>02136 <span class="comment">  processors to the kernel&apos;s RapidIO subsystem. The existence of the SRIO ports is</span>
<a name="l02137"></a>02137 <span class="comment">  automatically detected and configured as either a host or device. Bus enumeration</span>
<a name="l02138"></a>02138 <span class="comment">  will be performed on host interfaces as appropriate. After configuring this</span>
<a name="l02139"></a>02139 <span class="comment">  option, you will likely want to enable the RapidIO network adapter under the devices menu.</span>
<a name="l02140"></a>02140 <span class="comment"></span>
<a name="l02141"></a>02141 <span class="comment">- @b CONFIG_CAVIUM_OCTEON_ERROR_TREE: Install handlers for error signals from many on-SoC devices.</span>
<a name="l02142"></a>02142 <span class="comment"></span>
<a name="l02143"></a>02143 <span class="comment">- @b CONFIG_CAVIUM_KERNEL_CRYPTO: Use of OCTEON crypto instructions from kernel code requires</span>
<a name="l02144"></a>02144 <span class="comment">  great care, and if done improperly, can corrupt userspace crypto state.</span>
<a name="l02145"></a>02145 <span class="comment">  If OCTEON crypto instruction support is needed, select this option.</span>
<a name="l02146"></a>02146 <span class="comment"></span>
<a name="l02147"></a>02147 <span class="comment">@section linux_octeon2 29. OCTEON II specific kernel considerations.</span>
<a name="l02148"></a>02148 <span class="comment"></span>
<a name="l02149"></a>02149 <span class="comment">The default configuration of the OCTEON Linux kernel will run on</span>
<a name="l02150"></a>02150 <span class="comment">all OCTEON chips.  However, the OCTEON II processor (CN6XXX) has</span>
<a name="l02151"></a>02151 <span class="comment">several new machine instructions available that allow for more</span>
<a name="l02152"></a>02152 <span class="comment">efficient code that cannot be used in a Linux kernel intended for</span>
<a name="l02153"></a>02153 <span class="comment">general purpose use on the entire OCTEON family.  If it is known</span>
<a name="l02154"></a>02154 <span class="comment">that the kernel will be run only on OCTEON II processors, several</span>
<a name="l02155"></a>02155 <span class="comment">optimizations can be enabled, yielding an increase in performance.</span>
<a name="l02156"></a>02156 <span class="comment"></span>
<a name="l02157"></a>02157 <span class="comment">Many of the most performance critical portions of the kernel</span>
<a name="l02158"></a>02158 <span class="comment">automatically select the most efficient machine instructions for</span>
<a name="l02159"></a>02159 <span class="comment">the actual processor being used.  OCTEON II specific instructions</span>
<a name="l02160"></a>02160 <span class="comment">are already used in these places even with the default</span>
<a name="l02161"></a>02161 <span class="comment">configuration.</span>
<a name="l02162"></a>02162 <span class="comment"></span>
<a name="l02163"></a>02163 <span class="comment">- @b CONFIG_CAVIUM_OCTEON2: As mentioned above, this option</span>
<a name="l02164"></a>02164 <span class="comment">  enables the generation of OCTEON II specific instructions by the</span>
<a name="l02165"></a>02165 <span class="comment">  compiler, resulting in a kernel that is more efficient, but that</span>
<a name="l02166"></a>02166 <span class="comment">  will not run on OCTEON and OCTEON Plus processor cores.  Note</span>
<a name="l02167"></a>02167 <span class="comment">  that the use of this option has @b no affect on the ability of</span>
<a name="l02168"></a>02168 <span class="comment">  the kernel to run OCTEON and OCTEON Plus programs.</span>
<a name="l02169"></a>02169 <span class="comment"></span>
<a name="l02170"></a>02170 <span class="comment">- @b CONFIG_USB_OCTEON_HCD: Because the OCTEON II has EHCI/OHCI</span>
<a name="l02171"></a>02171 <span class="comment">  compatible USB hardware, there is no need to include the DWC_OTG</span>
<a name="l02172"></a>02172 <span class="comment">  USB driver.  Disabling this driver will reduce the size of the</span>
<a name="l02173"></a>02173 <span class="comment">  kernel, thus saving memory.</span>
<a name="l02174"></a>02174 <span class="comment"></span>
<a name="l02175"></a>02175 <span class="comment">@section linux_ftrace 30. Kernel tracing with ftrace</span>
<a name="l02176"></a>02176 <span class="comment"></span>
<a name="l02177"></a>02177 <span class="comment">The Linux kernel has a built-in tracing system that allows many</span>
<a name="l02178"></a>02178 <span class="comment">aspects of the kernel to be recorded and then played back for</span>
<a name="l02179"></a>02179 <span class="comment">analysis.  This is called the &lt;b&gt;ftrace&lt;/b&gt; system.</span>
<a name="l02180"></a>02180 <span class="comment"></span>
<a name="l02181"></a>02181 <span class="comment">The tracing infrastructure is disabled by default, because even</span>
<a name="l02182"></a>02182 <span class="comment">when inactive, it adds a small overhead to many kernel operations.</span>
<a name="l02183"></a>02183 <span class="comment">It can be enabled from menuconfig:</span>
<a name="l02184"></a>02184 <span class="comment"></span>
<a name="l02185"></a>02185 <span class="comment">@verbatim</span>
<a name="l02186"></a>02186 <span class="comment">Kernel hacking  ---&gt;</span>
<a name="l02187"></a>02187 <span class="comment">    [*] Tracers  ---&gt;</span>
<a name="l02188"></a>02188 <span class="comment">        [*]   Kernel Function Tracer</span>
<a name="l02189"></a>02189 <span class="comment">        [*]     Kernel Function Graph Tracer</span>
<a name="l02190"></a>02190 <span class="comment">        [*]   Interrupts-off Latency Tracer</span>
<a name="l02191"></a>02191 <span class="comment">        [*]   Scheduling Latency Tracer</span>
<a name="l02192"></a>02192 <span class="comment">        [*]   Trace syscalls</span>
<a name="l02193"></a>02193 <span class="comment">        [*]   Trace max stack</span>
<a name="l02194"></a>02194 <span class="comment">        [*]   Support for tracing block io actions</span>
<a name="l02195"></a>02195 <span class="comment">        [*]   enable/disable ftrace tracepoints dynamically</span>
<a name="l02196"></a>02196 <span class="comment">        [*]   Kernel function profiler</span>
<a name="l02197"></a>02197 <span class="comment">        &lt;*&gt;   Ring buffer benchmark stress tester</span>
<a name="l02198"></a>02198 <span class="comment">@endverbatim</span>
<a name="l02199"></a>02199 <span class="comment"></span>
<a name="l02200"></a>02200 <span class="comment">Once the tracing enabled kernel is running, the tracing can be</span>
<a name="l02201"></a>02201 <span class="comment">controlled as described in the kernel&apos;s tracing documentation in</span>
<a name="l02202"></a>02202 <span class="comment">the &lt;b&gt;linux/kernel/linux/Documentation/trace&lt;/b&gt; directory.</span>
<a name="l02203"></a>02203 <span class="comment">The &lt;b&gt;ftrace.txt&lt;/b&gt; file is a good place to start.</span>
<a name="l02204"></a>02204 <span class="comment"></span>
<a name="l02205"></a>02205 <span class="comment">The embedded_rootfs contains the optional program &lt;b&gt;trace-cmd&lt;/b&gt;</span>
<a name="l02206"></a>02206 <span class="comment">which can be used to facilitate tracing.  It has the ability to</span>
<a name="l02207"></a>02207 <span class="comment">transmit trace data over a network port or save it to a file for</span>
<a name="l02208"></a>02208 <span class="comment">off-line analysis.  Please see the trace-cmd manual pages for more</span>
<a name="l02209"></a>02209 <span class="comment">information.</span>
<a name="l02210"></a>02210 <span class="comment"></span>
<a name="l02211"></a>02211 <span class="comment">&lt;b&gt;trace-cmd&lt;/b&gt; and its graphical companion tool &lt;b&gt;kernelshark&lt;/b&gt; can</span>
<a name="l02212"></a>02212 <span class="comment">also be used on a development workstation to analyze trace data</span>
<a name="l02213"></a>02213 <span class="comment">obtained from the OCTEON Linux target board.</span>
<a name="l02214"></a>02214 <span class="comment"></span>
<a name="l02215"></a>02215 <span class="comment">@section linux_randomize_va_space 31. Address Space Randomization</span>
<a name="l02216"></a>02216 <span class="comment"></span>
<a name="l02217"></a>02217 <span class="comment">In order to make the system more secure, the addresses of program</span>
<a name="l02218"></a>02218 <span class="comment">stacks, shared libraries and heap are randomized.  This is</span>
<a name="l02219"></a>02219 <span class="comment">normally desired, however, it can make debugging a program more</span>
<a name="l02220"></a>02220 <span class="comment">difficult because each run of the program will have a different</span>
<a name="l02221"></a>02221 <span class="comment">address space layout.</span>
<a name="l02222"></a>02222 <span class="comment"></span>
<a name="l02223"></a>02223 <span class="comment">The randomization may be disable at boot time by passing</span>
<a name="l02224"></a>02224 <span class="comment">&lt;b&gt;norandmaps&lt;/b&gt; on the kernel command line.  It can also be</span>
<a name="l02225"></a>02225 <span class="comment">controlled at runtime.</span>
<a name="l02226"></a>02226 <span class="comment"></span>
<a name="l02227"></a>02227 <span class="comment">To diable randomization:</span>
<a name="l02228"></a>02228 <span class="comment">@verbatim</span>
<a name="l02229"></a>02229 <span class="comment">~ # echo 0 &gt; /proc/sys/kernel/randomize_va_space</span>
<a name="l02230"></a>02230 <span class="comment">@endverbatim</span>
<a name="l02231"></a>02231 <span class="comment"></span>
<a name="l02232"></a>02232 <span class="comment">To enable randomization:</span>
<a name="l02233"></a>02233 <span class="comment">@verbatim</span>
<a name="l02234"></a>02234 <span class="comment">~ # echo 2 &gt; /proc/sys/kernel/randomize_va_space</span>
<a name="l02235"></a>02235 <span class="comment">@endverbatim</span>
<a name="l02236"></a>02236 <span class="comment"></span>
<a name="l02237"></a>02237 <span class="comment">@section linux_kexec 32. Kernel KEXEC support</span>
<a name="l02238"></a>02238 <span class="comment"></span>
<a name="l02239"></a>02239 <span class="comment">kexec, kernel execution, is a mechanism to launch a new kernel over </span>
<a name="l02240"></a>02240 <span class="comment">currently running linux kernel image. kexec skips the bootloader stage</span>
<a name="l02241"></a>02241 <span class="comment">(hardware initialization phase by the firmware or BIOS) and directly</span>
<a name="l02242"></a>02242 <span class="comment">loads the new kernel into memory, where it starts executing immediately.</span>
<a name="l02243"></a>02243 <span class="comment">This is to avoid long time associated with a full reboot and can help</span>
<a name="l02244"></a>02244 <span class="comment">systems to meet high-availability requirements by minimizing downtime.</span>
<a name="l02245"></a>02245 <span class="comment"></span>
<a name="l02246"></a>02246 <span class="comment">To use kexec feature, need to enable the following kernel configurations</span>
<a name="l02247"></a>02247 <span class="comment"></span>
<a name="l02248"></a>02248 <span class="comment">@verbatim</span>
<a name="l02249"></a>02249 <span class="comment">make menuconfig</span>
<a name="l02250"></a>02250 <span class="comment">  Kernel Type ---&gt;</span>
<a name="l02251"></a>02251 <span class="comment">    [*] Kexec system call</span>
<a name="l02252"></a>02252 <span class="comment">  File System ---&gt;</span>
<a name="l02253"></a>02253 <span class="comment">    Pseudo filesystems ---&gt;</span>
<a name="l02254"></a>02254 <span class="comment">       [*] /proc file system support</span>
<a name="l02255"></a>02255 <span class="comment">       [*] /proc/kcore support</span>
<a name="l02256"></a>02256 <span class="comment">@endverbatim</span>
<a name="l02257"></a>02257 <span class="comment"></span>
<a name="l02258"></a>02258 <span class="comment">Invoke &apos;make kernel-deb&apos; to build Linux kernel image. Prepare compact</span>
<a name="l02259"></a>02259 <span class="comment">flash with debian rootfs.</span>
<a name="l02260"></a>02260 <span class="comment"></span>
<a name="l02261"></a>02261 <span class="comment">Or invoke &apos;make kernel&apos; to build embedded rootfs Linux kernel image. Enable</span>
<a name="l02262"></a>02262 <span class="comment">kexec-tools in embedded_rootfs. Adjust the parameters passed for booting</span>
<a name="l02263"></a>02263 <span class="comment">linux kernel image.</span>
<a name="l02264"></a>02264 <span class="comment"></span>
<a name="l02265"></a>02265 <span class="comment">NOTE: The example is assuming the kernels are build with embedded_rootfs</span>
<a name="l02266"></a>02266 <span class="comment">      by enabling kexec-tools.</span>
<a name="l02267"></a>02267 <span class="comment"></span>
<a name="l02268"></a>02268 <span class="comment">Create 2 named blocks, one for first kernel and another for kexec kernel.</span>
<a name="l02269"></a>02269 <span class="comment">Boot the kernel from a named block. Create a named block at bootloader prompt</span>
<a name="l02270"></a>02270 <span class="comment"></span>
<a name="l02271"></a>02271 <span class="comment">@verbatim</span>
<a name="l02272"></a>02272 <span class="comment">Octeon ebb6800# namedprint</span>
<a name="l02273"></a>02273 <span class="comment">List of currently allocated named bootmem blocks:</span>
<a name="l02274"></a>02274 <span class="comment">Name: __uboot_code_data, address: 0x10f000000, size: 0x01000000, index: 0</span>
<a name="l02275"></a>02275 <span class="comment">Name: __fdt, address: 0x00080000, size: 0x00020000, index: 1</span>
<a name="l02276"></a>02276 <span class="comment">Name: __tmp_uboot_exception, address: 0x000ff000, size: 0x00000500, index: 2</span>
<a name="l02277"></a>02277 <span class="comment">Name: __nand_buffer, address: 0x0fff9a00, size: 0x00004200, index: 3</span>
<a name="l02278"></a>02278 <span class="comment">Name: __tmp_nand_dma_buf, address: 0x0fff5800, size: 0x00004200, index: 4</span>
<a name="l02279"></a>02279 <span class="comment">Name: __boot_vector1__, address: 0x0ffed800, size: 0x00008000, index: 5</span>
<a name="l02280"></a>02280 <span class="comment">Name: idle-core-loop, address: 0x000ffff0, size: 0x00000010, index: 6</span>
<a name="l02281"></a>02281 <span class="comment">Name: __tmp_load, address: 0x20000000, size: 0x10000000, index: 7</span>
<a name="l02282"></a>02282 <span class="comment">Name: __tmp_reserved_linux, address: 0x00100000, size: 0x0f000000, index: 8</span>
<a name="l02283"></a>02283 <span class="comment">Name: __low_reserved_000000000000_0, address: 0x000a0000, size: 0x0005f000, index: 9</span>
<a name="l02284"></a>02284 <span class="comment">Name: __low_reserved_000000000000_1, address: 0x000ff500, size: 0x00000af0, index: 10</span>
<a name="l02285"></a>02285 <span class="comment">Name: cvmx_qlm_jtag, address: 0x0ffebf00, size: 0x00001900, index: 11</span>
<a name="l02286"></a>02286 <span class="comment">Name: __pci_console, address: 0x0ffeb680, size: 0x00000850, index: 12</span>
<a name="l02287"></a>02287 <span class="comment">Name: cvmx_mgmt_port, address: 0x0ff2ad00, size: 0x000c0940, index: 13</span>
<a name="l02288"></a>02288 <span class="comment">Name: __mac_meminfo, address: 0x0ff2ac90, size: 0x00000070, index: 14</span>
<a name="l02289"></a>02289 <span class="comment"></span>
<a name="l02290"></a>02290 <span class="comment">@endverbatim</span>
<a name="l02291"></a>02291 <span class="comment"> </span>
<a name="l02292"></a>02292 <span class="comment">Lets reuse the memory that is in __tmp_load and __tmp_reserved_linux blocks.</span>
<a name="l02293"></a>02293 <span class="comment"></span>
<a name="l02294"></a>02294 <span class="comment">Free the memory and create a named block &apos;ddblock0&apos; and &apos;ddblock1&apos;.</span>
<a name="l02295"></a>02295 <span class="comment"></span>
<a name="l02296"></a>02296 <span class="comment">@verbatim</span>
<a name="l02297"></a>02297 <span class="comment">namedfree __tmp_load</span>
<a name="l02298"></a>02298 <span class="comment">namedfree __tmp_reserved_linux</span>
<a name="l02299"></a>02299 <span class="comment">namedalloc ddblock0 0x0f000000 0x00100000</span>
<a name="l02300"></a>02300 <span class="comment">namedalloc ddblock1 0x10000000 0x20000000</span>
<a name="l02301"></a>02301 <span class="comment">@endverbatim</span>
<a name="l02302"></a>02302 <span class="comment"></span>
<a name="l02303"></a>02303 <span class="comment">Now load the kernel and use the memory that was allocated.</span>
<a name="l02304"></a>02304 <span class="comment"></span>
<a name="l02305"></a>02305 <span class="comment">@verbatim</span>
<a name="l02306"></a>02306 <span class="comment">tftp ${loadaddr} vmlinux.64</span>
<a name="l02307"></a>02307 <span class="comment">bootoctlinux $(loadaddr) numcores=$(numcores) namedblock=ddblock0 endbootargs mem=block:ddblock0,ddblock1 root=/dev/sda2 rootwait rw</span>
<a name="l02308"></a>02308 <span class="comment">@endverbatim</span>
<a name="l02309"></a>02309 <span class="comment"></span>
<a name="l02310"></a>02310 <span class="comment">namedblock=ddblock0 : the bootoctlinux will locate the kernel image in </span>
<a name="l02311"></a>02311 <span class="comment">                      ddblock0 named block instead of allocating</span>
<a name="l02312"></a>02312 <span class="comment">                      anonymous memory.</span>
<a name="l02313"></a>02313 <span class="comment"></span>
<a name="l02314"></a>02314 <span class="comment">mem=block:ddblock0,ddblock1 : kernel gets memory only from these named blocks.</span>
<a name="l02315"></a>02315 <span class="comment"></span>
<a name="l02316"></a>02316 <span class="comment">After kernel boots up, get the kernel to boot using kexec command.</span>
<a name="l02317"></a>02317 <span class="comment"></span>
<a name="l02318"></a>02318 <span class="comment">@verbatim</span>
<a name="l02319"></a>02319 <span class="comment"></span>
<a name="l02320"></a>02320 <span class="comment">~ # dhclient mgmt0</span>
<a name="l02321"></a>02321 <span class="comment"></span>
<a name="l02322"></a>02322 <span class="comment">// get the kernel image</span>
<a name="l02323"></a>02323 <span class="comment">~ # tftp -g -r vmlinux.64 192.168.162.57</span>
<a name="l02324"></a>02324 <span class="comment"></span>
<a name="l02325"></a>02325 <span class="comment">// Inform kexec about the kernel to start.</span>
<a name="l02326"></a>02326 <span class="comment">// disable error interrupts in the kexeced kernel, its already enabled</span>
<a name="l02327"></a>02327 <span class="comment">~ # kexec --command-line=&apos;mem=block:ddblock0,ddblock1 root=/dev/sda2 rootwait rw&apos; -l vmlinux.64</span>
<a name="l02328"></a>02328 <span class="comment"></span>
<a name="l02329"></a>02329 <span class="comment">// Start the kernel</span>
<a name="l02330"></a>02330 <span class="comment">~ # kexec -e</span>
<a name="l02331"></a>02331 <span class="comment">@endverbatim</span>
<a name="l02332"></a>02332 <span class="comment"></span>
<a name="l02333"></a>02333 <span class="comment"></span>
<a name="l02334"></a>02334 <span class="comment">@section linux_kdump 33. Kernel KDUMP support</span>
<a name="l02335"></a>02335 <span class="comment"></span>
<a name="l02336"></a>02336 <span class="comment">kexec can also be used for collecting and analysing Linux kernel crashes.</span>
<a name="l02337"></a>02337 <span class="comment">Linux kernel is a stable entity, at some times it can crash. The &apos;-p&apos;</span>
<a name="l02338"></a>02338 <span class="comment">option to &apos;kexec&apos; utility is used to capture the crashed kernel core file</span>
<a name="l02339"></a>02339 <span class="comment">which later can be passed to gdb for debugging the cause of the crash.</span>
<a name="l02340"></a>02340 <span class="comment"></span>
<a name="l02341"></a>02341 <span class="comment">To collect crashed kernel statistics, need to build two linux kernel</span>
<a name="l02342"></a>02342 <span class="comment">images, build the first kernel as per steps mentioned in @ref linux_kexec</span>
<a name="l02343"></a>02343 <span class="comment">section. And build the second kernel by configuring as below:</span>
<a name="l02344"></a>02344 <span class="comment"></span>
<a name="l02345"></a>02345 <span class="comment">Enable the following kernel configurations for building the first kernel:</span>
<a name="l02346"></a>02346 <span class="comment"></span>
<a name="l02347"></a>02347 <span class="comment">@verbatim</span>
<a name="l02348"></a>02348 <span class="comment">make menuconfig</span>
<a name="l02349"></a>02349 <span class="comment">  Kernel Type ---&gt;</span>
<a name="l02350"></a>02350 <span class="comment">    [*] Kexec system call</span>
<a name="l02351"></a>02351 <span class="comment">  File System ---&gt;</span>
<a name="l02352"></a>02352 <span class="comment">    Pseudo filesystems ---&gt;</span>
<a name="l02353"></a>02353 <span class="comment">       [*] /proc file system support</span>
<a name="l02354"></a>02354 <span class="comment">       [*] /proc/kcore support</span>
<a name="l02355"></a>02355 <span class="comment">@endverbatim</span>
<a name="l02356"></a>02356 <span class="comment"></span>
<a name="l02357"></a>02357 <span class="comment">After configuring the kernel, build the kernel and lets rename linux kernel</span>
<a name="l02358"></a>02358 <span class="comment">image as vmlinux-1.64.</span>
<a name="l02359"></a>02359 <span class="comment"></span>
<a name="l02360"></a>02360 <span class="comment">Enable the following kernel configurations for building the second kernel:</span>
<a name="l02361"></a>02361 <span class="comment"></span>
<a name="l02362"></a>02362 <span class="comment">@verbatim</span>
<a name="l02363"></a>02363 <span class="comment">make menuconfig</span>
<a name="l02364"></a>02364 <span class="comment">  Kernel Type ---&gt;</span>
<a name="l02365"></a>02365 <span class="comment">    [ ] Multi-Processing support</span>
<a name="l02366"></a>02366 <span class="comment">    [*] Kexec system call</span>
<a name="l02367"></a>02367 <span class="comment">    [*] kernel crash dumps</span>
<a name="l02368"></a>02368 <span class="comment">    (0xffffffff84000000) Physical address where the kernel is loaded (NEW)</span>
<a name="l02369"></a>02369 <span class="comment">  File System ---&gt;</span>
<a name="l02370"></a>02370 <span class="comment">    Pseudo filesystems ---&gt;</span>
<a name="l02371"></a>02371 <span class="comment">       [*] /proc file system support</span>
<a name="l02372"></a>02372 <span class="comment">       [*] /proc/kcore support</span>
<a name="l02373"></a>02373 <span class="comment">@endverbatim</span>
<a name="l02374"></a>02374 <span class="comment"></span>
<a name="l02375"></a>02375 <span class="comment">After configuring the kernel, build the kernel and lets rename linux kernel</span>
<a name="l02376"></a>02376 <span class="comment">image as vmlinux-2.64.</span>
<a name="l02377"></a>02377 <span class="comment"></span>
<a name="l02378"></a>02378 <span class="comment">NOTE: The example is assuming the kernels are build with embedded_rootfs</span>
<a name="l02379"></a>02379 <span class="comment">      by enabling kexec-tools.</span>
<a name="l02380"></a>02380 <span class="comment"></span>
<a name="l02381"></a>02381 <span class="comment">Create 3 named blocks, ddblock0 and ddblock1 are for first kernel. ddump1 is </span>
<a name="l02382"></a>02382 <span class="comment">for second kernel. Boot the kernel from a named block.</span>
<a name="l02383"></a>02383 <span class="comment">Create a named block at bootloader prompt</span>
<a name="l02384"></a>02384 <span class="comment"></span>
<a name="l02385"></a>02385 <span class="comment">We reuse __tmp_load and __tmp_reserved_linux and create new blocks for</span>
<a name="l02386"></a>02386 <span class="comment">loading second kernel.</span>
<a name="l02387"></a>02387 <span class="comment"></span>
<a name="l02388"></a>02388 <span class="comment">@verbatim</span>
<a name="l02389"></a>02389 <span class="comment">namedfree __tmp_load</span>
<a name="l02390"></a>02390 <span class="comment">namedfree __tmp_reserved_linux</span>
<a name="l02391"></a>02391 <span class="comment">namedalloc ddblock0 0x03f00000 0x00100000</span>
<a name="l02392"></a>02392 <span class="comment">namedalloc ddump1 0x0b000000 0x04000000</span>
<a name="l02393"></a>02393 <span class="comment">namedalloc ddblock1 0x30000000 0x20000000</span>
<a name="l02394"></a>02394 <span class="comment">@endverbatim</span>
<a name="l02395"></a>02395 <span class="comment"></span>
<a name="l02396"></a>02396 <span class="comment">Load the first kernel with crashkernel parameter that takes the size of</span>
<a name="l02397"></a>02397 <span class="comment">the linux kernel, followed by starting address, these should match the</span>
<a name="l02398"></a>02398 <span class="comment">ddump1 named block created above.</span>
<a name="l02399"></a>02399 <span class="comment"></span>
<a name="l02400"></a>02400 <span class="comment">According to ddump1 named block, crashkernel size will be 176 Mbytes</span>
<a name="l02401"></a>02401 <span class="comment">(0x0b000000) and craskernel address will be 64 Mbytes (0x04000000).</span>
<a name="l02402"></a>02402 <span class="comment"></span>
<a name="l02403"></a>02403 <span class="comment">@verbatim</span>
<a name="l02404"></a>02404 <span class="comment">tftp $(loadaddr) vmlinux-1.64</span>
<a name="l02405"></a>02405 <span class="comment">bootoctl 0 numcores=$(numcores) namedblock=ddblock0 endbootargs mem=block:ddblock0,ddblock1,ddump1 root=/dev/sda2 rootwait rw crashkernel=176M@64M</span>
<a name="l02406"></a>02406 <span class="comment">@endverbatim</span>
<a name="l02407"></a>02407 <span class="comment"></span>
<a name="l02408"></a>02408 <span class="comment">After the first kernel boots up and load second kernel to capture panic</span>
<a name="l02409"></a>02409 <span class="comment">status.</span>
<a name="l02410"></a>02410 <span class="comment"></span>
<a name="l02411"></a>02411 <span class="comment">@verbatim</span>
<a name="l02412"></a>02412 <span class="comment">~ # dhclient mgmt0</span>
<a name="l02413"></a>02413 <span class="comment"></span>
<a name="l02414"></a>02414 <span class="comment">// get the kernel image</span>
<a name="l02415"></a>02415 <span class="comment">~ # tftp -g -r vmlinux-2.64 192.168.162.57</span>
<a name="l02416"></a>02416 <span class="comment"></span>
<a name="l02417"></a>02417 <span class="comment">// Load second kernel by passing &apos;-p&apos; option to kexec, to be booted in</span>
<a name="l02418"></a>02418 <span class="comment">// case of crash</span>
<a name="l02419"></a>02419 <span class="comment">~ # kexec --debug --command-line=&apos;mem=block:ddump1 root=/dev/sda2 rootwait rw&apos; -p vmlinux-2.64</span>
<a name="l02420"></a>02420 <span class="comment"></span>
<a name="l02421"></a>02421 <span class="comment">// simulate crash on current kernel</span>
<a name="l02422"></a>02422 <span class="comment">~ # echo &apos;c&apos; &gt; /proc/sysrq-trigger</span>
<a name="l02423"></a>02423 <span class="comment">@endverbatim</span>
<a name="l02424"></a>02424 <span class="comment"></span>
<a name="l02425"></a>02425 <span class="comment">To debug the cause of the linux kernel crash, load the core file into</span>
<a name="l02426"></a>02426 <span class="comment">debugger once the crashed kernel boots up.</span>
<a name="l02427"></a>02427 <span class="comment"></span>
<a name="l02428"></a>02428 <span class="comment">@verbatim</span>
<a name="l02429"></a>02429 <span class="comment">~ # gdb</span>
<a name="l02430"></a>02430 <span class="comment">        GNU gdb (Cavium Inc. Version: SDK_3_1_0 build 29) 7.6</span>
<a name="l02431"></a>02431 <span class="comment">        Copyright (C) 2013 Free Software Foundation, Inc.</span>
<a name="l02432"></a>02432 <span class="comment">        License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span>
<a name="l02433"></a>02433 <span class="comment">        This is free software: you are free to change and redistribute it.</span>
<a name="l02434"></a>02434 <span class="comment">        There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span>
<a name="l02435"></a>02435 <span class="comment">        and &quot;show warranty&quot; for details.</span>
<a name="l02436"></a>02436 <span class="comment">        This GDB was configured as &quot;mips64-octeon-linux-gnu&quot;.</span>
<a name="l02437"></a>02437 <span class="comment">        For bug reporting instructions, please see:</span>
<a name="l02438"></a>02438 <span class="comment">        &lt;http://www.cavium.com/support.html&gt;.</span>
<a name="l02439"></a>02439 <span class="comment">    --&gt; (gdb) core-file /proc/vmcore</span>
<a name="l02440"></a>02440 <span class="comment">        [New LWP 1033]</span>
<a name="l02441"></a>02441 <span class="comment">        #0  0xffffffff801ac968 in ?? ()</span>
<a name="l02442"></a>02442 <span class="comment">        (gdb) symbol-file /tmp/vmlinux.64</span>
<a name="l02443"></a>02443 <span class="comment">        Reading symbols from /tmp/vmlinux.64...done.</span>
<a name="l02444"></a>02444 <span class="comment">    --&gt; (gdb) bt</span>
<a name="l02445"></a>02445 <span class="comment">        #0  prepare_frametrace (regs=0x800000004e4436c0,</span>
<a name="l02446"></a>02446 <span class="comment">        at /home/pmallappa/sdk-base/sdk/linux/kernel/linux/arch/mips/include/asm/stacktrace.h:32</span>
<a name="l02447"></a>02447 <span class="comment">        #1  crash_setup_regs (oldregs=0xf2, newregs=0x800000004e4436c0)</span>
<a name="l02448"></a>02448 <span class="comment">        at /home/pmallappa/sdk-base/sdk/linux/kernel/linux/arch/mips/include/asm/kexec.h:33</span>
<a name="l02449"></a>02449 <span class="comment">        #2  crash_kexec (regs=0xf2) at kernel/kexec.c:1091</span>
<a name="l02450"></a>02450 <span class="comment">    --&gt; (gdb)</span>
<a name="l02451"></a>02451 <span class="comment">@endverbatim</span>
<a name="l02452"></a>02452 <span class="comment"></span>
<a name="l02453"></a>02453 <span class="comment">@section linux_sample_log 34. Sample Boot Log</span>
<a name="l02454"></a>02454 <span class="comment"></span>
<a name="l02455"></a>02455 <span class="comment">Here is a sample boot of Linux with 32 cores on an EBB68XX. The kernel</span>
<a name="l02456"></a>02456 <span class="comment">is loaded through TFP from a host at 10.91.205.197. DHCP is used to get</span>
<a name="l02457"></a>02457 <span class="comment">the network IP address.</span>
<a name="l02458"></a>02458 <span class="comment">@verbatim</span>
<a name="l02459"></a>02459 <span class="comment">Looking for valid bootloader image....</span>
<a name="l02460"></a>02460 <span class="comment">Jumping to start of image at address 0xbfd90000</span>
<a name="l02461"></a>02461 <span class="comment"></span>
<a name="l02462"></a>02462 <span class="comment"></span>
<a name="l02463"></a>02463 <span class="comment">U-Boot 2013.07 (Development build, svnversion: u-boot:167210, exec:)-svn167207 (Build time: Oct 18 2017 - 11:27:35)</span>
<a name="l02464"></a>02464 <span class="comment"></span>
<a name="l02465"></a>02465 <span class="comment">Octeon unique ID: 00000246440075c00000</span>
<a name="l02466"></a>02466 <span class="comment">Skipping PCIe port 0 BIST, reset not done. (port not configured)</span>
<a name="l02467"></a>02467 <span class="comment">Skipping PCIe port 1 BIST, reset not done. (port not configured)</span>
<a name="l02468"></a>02468 <span class="comment">BIST check passed.</span>
<a name="l02469"></a>02469 <span class="comment">N0.LMC0 Configuration Completed: 2048 MB</span>
<a name="l02470"></a>02470 <span class="comment">N0.LMC1 Configuration Completed: 2048 MB</span>
<a name="l02471"></a>02471 <span class="comment">N0.LMC2 Configuration Completed: 2048 MB</span>
<a name="l02472"></a>02472 <span class="comment">N0.LMC3 Configuration Completed: 2048 MB</span>
<a name="l02473"></a>02473 <span class="comment">EBB6800 board revision major:2, minor:0, serial #: 2015-2.0-00563</span>
<a name="l02474"></a>02474 <span class="comment">OCTEON CN6880-AAP pass 2.2, Core clock: 800 MHz, IO clock: 800 MHz, DDR clock: 667 MHz (1334 Mhz DDR)</span>
<a name="l02475"></a>02475 <span class="comment">Base DRAM address used by u-boot: 0x20f000000, size: 0x1000000</span>
<a name="l02476"></a>02476 <span class="comment">DRAM: 8 GiB</span>
<a name="l02477"></a>02477 <span class="comment">Clearing DRAM...... done</span>
<a name="l02478"></a>02478 <span class="comment">NAND:  4096 MiB</span>
<a name="l02479"></a>02479 <span class="comment">Registered IDE device 0 from IDE bus:dev 0:0</span>
<a name="l02480"></a>02480 <span class="comment">Flash: 8 MiB</span>
<a name="l02481"></a>02481 <span class="comment">USB0:   USB EHCI 1.00</span>
<a name="l02482"></a>02482 <span class="comment">scanning bus 0 for devices... 2 USB Device(s) found</span>
<a name="l02483"></a>02483 <span class="comment">0:PCIe: Port 0 is unknown, skipping.</span>
<a name="l02484"></a>02484 <span class="comment">PCIe: Link timeout on port 1, probably the slot is empty</span>
<a name="l02485"></a>02485 <span class="comment">PCI console init succeeded, 1 consoles, 1024 bytes each</span>
<a name="l02486"></a>02486 <span class="comment">Bus 0: not available  </span>
<a name="l02487"></a>02487 <span class="comment">Net:   octmgmt0, octeth0, octeth1, octeth2, octeth3, octeth4 [PRIME], octeth5</span>
<a name="l02488"></a>02488 <span class="comment">Type the command &apos;usb start&apos; to scan for USB storage devices.</span>
<a name="l02489"></a>02489 <span class="comment"></span>
<a name="l02490"></a>02490 <span class="comment">Octeon ebb6800# dhcp </span>
<a name="l02491"></a>02491 <span class="comment">Node 0 Interface 0 has 1 ports (RXAUI)</span>
<a name="l02492"></a>02492 <span class="comment">Node 0 Interface 1 has 1 ports (RXAUI)</span>
<a name="l02493"></a>02493 <span class="comment">Node 0 Interface 2 has 4 ports (SGMII)</span>
<a name="l02494"></a>02494 <span class="comment">Node 0 Interface 7 has 32 ports (NPI)</span>
<a name="l02495"></a>02495 <span class="comment">Node 0 Interface 8 has 8 ports (LOOP)</span>
<a name="l02496"></a>02496 <span class="comment">BOOTP broadcast 1</span>
<a name="l02497"></a>02497 <span class="comment">octeth4: Up 1000 Mbps Full duplex (port 2592) (SGMII)</span>
<a name="l02498"></a>02498 <span class="comment">DHCP client bound to address 10.91.205.222</span>
<a name="l02499"></a>02499 <span class="comment">Octeon ebb6800# setenv serverip 10.91.205.197</span>
<a name="l02500"></a>02500 <span class="comment">Octeon ebb6800# saveenv</span>
<a name="l02501"></a>02501 <span class="comment">Saving Environment to Flash...</span>
<a name="l02502"></a>02502 <span class="comment">. done</span>
<a name="l02503"></a>02503 <span class="comment">Un-Protected 1 sectors</span>
<a name="l02504"></a>02504 <span class="comment">Erasing Flash...</span>
<a name="l02505"></a>02505 <span class="comment">. done</span>
<a name="l02506"></a>02506 <span class="comment">Erased 1 sectors</span>
<a name="l02507"></a>02507 <span class="comment">Writing to Flash... done</span>
<a name="l02508"></a>02508 <span class="comment">. done</span>
<a name="l02509"></a>02509 <span class="comment">Protected 1 sectors</span>
<a name="l02510"></a>02510 <span class="comment">Octeon ebb6800# tftp $(loadaddr) vmlinux.64</span>
<a name="l02511"></a>02511 <span class="comment">Using octeth4 device</span>
<a name="l02512"></a>02512 <span class="comment">TFTP from server 10.91.205.197; our IP address is 10.91.205.222</span>
<a name="l02513"></a>02513 <span class="comment">Filename &apos;vmlinux.64&apos;.</span>
<a name="l02514"></a>02514 <span class="comment">Load address: 0x20000000</span>
<a name="l02515"></a>02515 <span class="comment">Loading: T #################################################################</span>
<a name="l02516"></a>02516 <span class="comment">             #################################################################</span>
<a name="l02517"></a>02517 <span class="comment">             #################################################################</span>
<a name="l02518"></a>02518 <span class="comment">             #################################################################</span>
<a name="l02519"></a>02519 <span class="comment">             #################################################################</span>
<a name="l02520"></a>02520 <span class="comment">             #################################################################</span>
<a name="l02521"></a>02521 <span class="comment">             #################################################################</span>
<a name="l02522"></a>02522 <span class="comment">             #################################################################</span>
<a name="l02523"></a>02523 <span class="comment">             #################################################################</span>
<a name="l02524"></a>02524 <span class="comment">             #################################################################</span>
<a name="l02525"></a>02525 <span class="comment">             #################################################################</span>
<a name="l02526"></a>02526 <span class="comment">             #################################################################</span>
<a name="l02527"></a>02527 <span class="comment">             #################################################################</span>
<a name="l02528"></a>02528 <span class="comment">             #################################################################</span>
<a name="l02529"></a>02529 <span class="comment">             #################################################################</span>
<a name="l02530"></a>02530 <span class="comment">             #################################################################</span>
<a name="l02531"></a>02531 <span class="comment">             #################################################################</span>
<a name="l02532"></a>02532 <span class="comment">             #################################################################</span>
<a name="l02533"></a>02533 <span class="comment">             #################################################################</span>
<a name="l02534"></a>02534 <span class="comment">             #################################################################</span>
<a name="l02535"></a>02535 <span class="comment">             #################################################################</span>
<a name="l02536"></a>02536 <span class="comment">             #################################################################</span>
<a name="l02537"></a>02537 <span class="comment">             #################################################################</span>
<a name="l02538"></a>02538 <span class="comment">             #################################################################</span>
<a name="l02539"></a>02539 <span class="comment">             #################################################################</span>
<a name="l02540"></a>02540 <span class="comment">             #############################################</span>
<a name="l02541"></a>02541 <span class="comment">             3.6 MiB/s</span>
<a name="l02542"></a>02542 <span class="comment">             done</span>
<a name="l02543"></a>02543 <span class="comment">             Bytes transferred = 196287428 (bb31bc4 hex)</span>
<a name="l02544"></a>02544 <span class="comment">    Octeon ebb6800# bootoctl $(loadaddr) numcores=$(numcores) endbootargs mem=0</span>
<a name="l02545"></a>02545 <span class="comment">    Allocating memory for ELF segment: addr: 0xffffffff80800000 (adjusted to: 0x800000), size 0x541cb10</span>
<a name="l02546"></a>02546 <span class="comment">## Loading big-endian Linux kernel with entry point: 0xffffffff80e9a1b0 ...</span>
<a name="l02547"></a>02547 <span class="comment">    ERROR: cvmx_fpa1_shutdown_pool: POOL 0 not empty, 308/1000.</span>
<a name="l02548"></a>02548 <span class="comment">    ERROR: cvmx_fpa1_shutdown_pool: POOL 1 not empty, 308/1000.</span>
<a name="l02549"></a>02549 <span class="comment">    Bootloader: Done loading app on coremask:</span>
<a name="l02550"></a>02550 <span class="comment">     0xffffffff</span>
<a name="l02551"></a>02551 <span class="comment">     Starting cores:</span>
<a name="l02552"></a>02552 <span class="comment">      0xffffffff</span>
<a name="l02553"></a>02553 <span class="comment">      Linux version 4.9.43-Cavium-Octeon+ (root@gshankar-OptiPlex-3046) (gcc version 4.7.0 (Cavium Inc. Version: SDK_BUILD build 51) ) #1 SMP Tue Aug 29 137</span>
<a name="l02554"></a>02554 <span class="comment">      CVMSEG size: 2 cache lines (256 bytes)</span>
<a name="l02555"></a>02555 <span class="comment">    Cavium Inc. SDK-5.1.0-prerelease</span>
<a name="l02556"></a>02556 <span class="comment">    bootconsole [early0] enabled</span>
<a name="l02557"></a>02557 <span class="comment">    CPU0 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02558"></a>02558 <span class="comment">    Checking for the multiply/shift bug... no.</span>
<a name="l02559"></a>02559 <span class="comment">    Checking for the daddiu bug... no.</span>
<a name="l02560"></a>02560 <span class="comment">    Determined physical RAM map:</span>
<a name="l02561"></a>02561 <span class="comment">     memory: 000000000feff000 @ 00000000f0001000 (usable)</span>
<a name="l02562"></a>02562 <span class="comment">     memory: 000000006fd00000 @ 0000000080300000 (usable)</span>
<a name="l02563"></a>02563 <span class="comment">     memory: 000000010efff000 @ 0000000100001000 (usable)</span>
<a name="l02564"></a>02564 <span class="comment">     memory: 000000005fc00000 @ 0000000020300000 (usable)</span>
<a name="l02565"></a>02565 <span class="comment">     memory: 0000000009c00000 @ 0000000006000000 (usable)</span>
<a name="l02566"></a>02566 <span class="comment">     memory: 0000000000400000 @ 0000000000400000 (usable)</span>
<a name="l02567"></a>02567 <span class="comment">     memory: 00000000008ff000 @ 0000000000800000 (kernel data and code)</span>
<a name="l02568"></a>02568 <span class="comment">     memory: 000000000013d000 @ 0000000005ae0000 (kernel data and code)</span>
<a name="l02569"></a>02569 <span class="comment">     memory: 00000000049e1000 @ 00000000010ff000 (usable after init)</span>
<a name="l02570"></a>02570 <span class="comment">    Initrd not found or empty - disabling initrd</span>
<a name="l02571"></a>02571 <span class="comment">    Using passed Device Tree &lt;800000000fce4700&gt;.</span>
<a name="l02572"></a>02572 <span class="comment">    Using passed Device Tree.</span>
<a name="l02573"></a>02573 <span class="comment">    software IO TLB [mem 0x20300000-0x24300000] (64MB) mapped at [8000000020300000-80000000242fffff]</span>
<a name="l02574"></a>02574 <span class="comment">    Primary instruction cache 37kB, virtually tagged, 37 way, 8 sets, linesize 128 bytes.</span>
<a name="l02575"></a>02575 <span class="comment">    Primary data cache 32kB, 32-way, 8 sets, linesize 128 bytes.</span>
<a name="l02576"></a>02576 <span class="comment">    Secondary unified cache 4096kB, 16-way, 2048 sets, linesize 128 bytes.</span>
<a name="l02577"></a>02577 <span class="comment">    Secondary unified cache 4096kB, 16-way, 2048 sets, linesize 128 bytes.</span>
<a name="l02578"></a>02578 <span class="comment">    Zone ranges:</span>
<a name="l02579"></a>02579 <span class="comment">    DMA32    [mem 0x0000000000400000-0x00000000efffffff]</span>
<a name="l02580"></a>02580 <span class="comment">    Normal   [mem 0x00000000f0000000-0x000000020effffff]</span>
<a name="l02581"></a>02581 <span class="comment">    Movable zone start for each node</span>
<a name="l02582"></a>02582 <span class="comment">    Early memory node ranges</span>
<a name="l02583"></a>02583 <span class="comment">      node   0: [mem 0x0000000000400000-0x0000000005c1cfff]</span>
<a name="l02584"></a>02584 <span class="comment">      node   0: [mem 0x0000000006000000-0x000000000fbfffff]</span>
<a name="l02585"></a>02585 <span class="comment">      node   0: [mem 0x0000000020300000-0x000000007fefffff]</span>
<a name="l02586"></a>02586 <span class="comment">      node   0: [mem 0x0000000080300000-0x00000000efffffff]</span>
<a name="l02587"></a>02587 <span class="comment">      node   0: [mem 0x00000000f0001000-0x00000000ffefffff]</span>
<a name="l02588"></a>02588 <span class="comment">      node   0: [mem 0x0000000100001000-0x000000020effffff]</span>
<a name="l02589"></a>02589 <span class="comment">    Initmem setup node 0 [mem 0x0000000000400000-0x000000020effffff]</span>
<a name="l02590"></a>02590 <span class="comment">    percpu: Embedded 17 pages/cpu @800000002436b000 s31744 r8192 d29696 u69632</span>
<a name="l02591"></a>02591 <span class="comment">    Built 1 zonelists in Node order, mobility grouping on.  Total pages: 2059413</span>
<a name="l02592"></a>02592 <span class="comment">    Policy zone: Normal</span>
<a name="l02593"></a>02593 <span class="comment">    Kernel command line:  console=ttyS0,115200</span>
<a name="l02594"></a>02594 <span class="comment">    log_buf_len individual max cpu contribution: 4096 bytes</span>
<a name="l02595"></a>02595 <span class="comment">    log_buf_len total cpu_extra contributions: 126976 bytes</span>
<a name="l02596"></a>02596 <span class="comment">    log_buf_len min size: 65536 bytes</span>
<a name="l02597"></a>02597 <span class="comment">    log_buf_len: 262144 bytes</span>
<a name="l02598"></a>02598 <span class="comment">    early log buf free: 61552(93%)</span>
<a name="l02599"></a>02599 <span class="comment">    PID hash table entries: 4096 (order: 3, 32768 bytes)</span>
<a name="l02600"></a>02600 <span class="comment">    Memory: 8082516k/24430756k available (6795k kernel code, 16348240k reserved, 2416k data, 75652k init)</span>
<a name="l02601"></a>02601 <span class="comment">    SLUB: HWalign=128, Order=0-3, MinObjects=0, CPUs=32, Nodes=2</span>
<a name="l02602"></a>02602 <span class="comment">    Hierarchical RCU implementation.</span>
<a name="l02603"></a>02603 <span class="comment">      Build-time adjustment of leaf fanout to 64.</span>
<a name="l02604"></a>02604 <span class="comment">      RCU restricting CPUs from NR_CPUS=48 to nr_cpu_ids=32.</span>
<a name="l02605"></a>02605 <span class="comment">    RCU: Adjusting geometry for rcu_fanout_leaf=64, nr_cpu_ids=32</span>
<a name="l02606"></a>02606 <span class="comment">    NR_IRQS:767 nr_irqs:767 9</span>
<a name="l02607"></a>02607 <span class="comment">    clocksource: OCTEON_CVMCOUNT: mask: 0xffffffffffffffff max_cycles: 0xb881274fa3, max_idle_ns: 440795210636 ns</span>
<a name="l02608"></a>02608 <span class="comment">    Calibrating delay loop (skipped) preset value.. 1600.00 BogoMIPS (lpj=8000000)</span>
<a name="l02609"></a>02609 <span class="comment">    pid_max: default: 32768 minimum: 301</span>
<a name="l02610"></a>02610 <span class="comment">    Security Framework initialized</span>
<a name="l02611"></a>02611 <span class="comment">    Dentry cache hash table entries: 1048576 (order: 11, 8388608 bytes)</span>
<a name="l02612"></a>02612 <span class="comment">    Inode-cache hash table entries: 524288 (order: 10, 4194304 bytes)</span>
<a name="l02613"></a>02613 <span class="comment">    Mount-cache hash table entries: 16384 (order: 5, 131072 bytes)</span>
<a name="l02614"></a>02614 <span class="comment">    Mountpoint-cache hash table entries: 16384 (order: 5, 131072 bytes)</span>
<a name="l02615"></a>02615 <span class="comment">    Checking for the daddi bug... no.</span>
<a name="l02616"></a>02616 <span class="comment">    Performance counters: octeon PMU enabled, 2 64-bit counters available to each CPU, irq 7</span>
<a name="l02617"></a>02617 <span class="comment">    SMP: Booting CPU01 (CoreId  1)...</span>
<a name="l02618"></a>02618 <span class="comment">    CPU1 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02619"></a>02619 <span class="comment">    Cpu 1 online</span>
<a name="l02620"></a>02620 <span class="comment">    SMP: Booting CPU02 (CoreId  2)...</span>
<a name="l02621"></a>02621 <span class="comment">    CPU2 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02622"></a>02622 <span class="comment">    Cpu 2 online</span>
<a name="l02623"></a>02623 <span class="comment">    SMP: Booting CPU03 (CoreId  3)...</span>
<a name="l02624"></a>02624 <span class="comment">    CPU3 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02625"></a>02625 <span class="comment">    Cpu 3 online</span>
<a name="l02626"></a>02626 <span class="comment">    SMP: Booting CPU04 (CoreId  4)...</span>
<a name="l02627"></a>02627 <span class="comment">    CPU4 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02628"></a>02628 <span class="comment">    Cpu 4 online</span>
<a name="l02629"></a>02629 <span class="comment">    SMP: Booting CPU05 (CoreId  5)...</span>
<a name="l02630"></a>02630 <span class="comment">    CPU5 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02631"></a>02631 <span class="comment">    Cpu 5 online</span>
<a name="l02632"></a>02632 <span class="comment">    SMP: Booting CPU06 (CoreId  6)...</span>
<a name="l02633"></a>02633 <span class="comment">    CPU6 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02634"></a>02634 <span class="comment">    Cpu 6 online</span>
<a name="l02635"></a>02635 <span class="comment">    SMP: Booting CPU07 (CoreId  7)...</span>
<a name="l02636"></a>02636 <span class="comment">    CPU7 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02637"></a>02637 <span class="comment">    Cpu 7 online</span>
<a name="l02638"></a>02638 <span class="comment">    SMP: Booting CPU08 (CoreId  8)...</span>
<a name="l02639"></a>02639 <span class="comment">    CPU8 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02640"></a>02640 <span class="comment">    Cpu 8 online</span>
<a name="l02641"></a>02641 <span class="comment">    SMP: Booting CPU09 (CoreId  9)...</span>
<a name="l02642"></a>02642 <span class="comment">    CPU9 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02643"></a>02643 <span class="comment">    Cpu 9 online</span>
<a name="l02644"></a>02644 <span class="comment">    SMP: Booting CPU10 (CoreId 10)...</span>
<a name="l02645"></a>02645 <span class="comment">    CPU10 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02646"></a>02646 <span class="comment">    Cpu 10 online</span>
<a name="l02647"></a>02647 <span class="comment">    SMP: Booting CPU11 (CoreId 11)...</span>
<a name="l02648"></a>02648 <span class="comment">    CPU11 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02649"></a>02649 <span class="comment">    Cpu 11 online</span>
<a name="l02650"></a>02650 <span class="comment">    SMP: Booting CPU12 (CoreId 12)...</span>
<a name="l02651"></a>02651 <span class="comment">    CPU12 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02652"></a>02652 <span class="comment">    Cpu 12 online</span>
<a name="l02653"></a>02653 <span class="comment">    SMP: Booting CPU13 (CoreId 13)...</span>
<a name="l02654"></a>02654 <span class="comment">    CPU13 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02655"></a>02655 <span class="comment">    Cpu 13 online</span>
<a name="l02656"></a>02656 <span class="comment">    SMP: Booting CPU14 (CoreId 14)...</span>
<a name="l02657"></a>02657 <span class="comment">    CPU14 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02658"></a>02658 <span class="comment">    Cpu 14 online</span>
<a name="l02659"></a>02659 <span class="comment">    SMP: Booting CPU15 (CoreId 15)...</span>
<a name="l02660"></a>02660 <span class="comment">    CPU15 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02661"></a>02661 <span class="comment">    Cpu 15 online</span>
<a name="l02662"></a>02662 <span class="comment">    SMP: Booting CPU16 (CoreId 16)...</span>
<a name="l02663"></a>02663 <span class="comment">    CPU16 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02664"></a>02664 <span class="comment">    Cpu 16 online</span>
<a name="l02665"></a>02665 <span class="comment">    SMP: Booting CPU17 (CoreId 17)...</span>
<a name="l02666"></a>02666 <span class="comment">    CPU17 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02667"></a>02667 <span class="comment">    Cpu 17 online</span>
<a name="l02668"></a>02668 <span class="comment">    SMP: Booting CPU18 (CoreId 18)...</span>
<a name="l02669"></a>02669 <span class="comment">    CPU18 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02670"></a>02670 <span class="comment">    Cpu 18 online</span>
<a name="l02671"></a>02671 <span class="comment">    SMP: Booting CPU19 (CoreId 19)...</span>
<a name="l02672"></a>02672 <span class="comment">    CPU19 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02673"></a>02673 <span class="comment">    Cpu 19 online</span>
<a name="l02674"></a>02674 <span class="comment">    SMP: Booting CPU20 (CoreId 20)...</span>
<a name="l02675"></a>02675 <span class="comment">    CPU20 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02676"></a>02676 <span class="comment">    Cpu 20 online</span>
<a name="l02677"></a>02677 <span class="comment">    SMP: Booting CPU21 (CoreId 21)...</span>
<a name="l02678"></a>02678 <span class="comment">    CPU21 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02679"></a>02679 <span class="comment">    Cpu 21 online</span>
<a name="l02680"></a>02680 <span class="comment">    SMP: Booting CPU22 (CoreId 22)...</span>
<a name="l02681"></a>02681 <span class="comment">    CPU22 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02682"></a>02682 <span class="comment">    Cpu 22 online</span>
<a name="l02683"></a>02683 <span class="comment">    SMP: Booting CPU23 (CoreId 23)...</span>
<a name="l02684"></a>02684 <span class="comment">    CPU23 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02685"></a>02685 <span class="comment">    Cpu 23 online</span>
<a name="l02686"></a>02686 <span class="comment">    SMP: Booting CPU24 (CoreId 24)...</span>
<a name="l02687"></a>02687 <span class="comment">    CPU24 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02688"></a>02688 <span class="comment">    Cpu 24 online</span>
<a name="l02689"></a>02689 <span class="comment">    SMP: Booting CPU25 (CoreId 25)...</span>
<a name="l02690"></a>02690 <span class="comment">    CPU25 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02691"></a>02691 <span class="comment">    Cpu 25 online</span>
<a name="l02692"></a>02692 <span class="comment">    SMP: Booting CPU26 (CoreId 26)...</span>
<a name="l02693"></a>02693 <span class="comment">    CPU26 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02694"></a>02694 <span class="comment">    Cpu 26 online</span>
<a name="l02695"></a>02695 <span class="comment">    SMP: Booting CPU27 (CoreId 27)...</span>
<a name="l02696"></a>02696 <span class="comment">    CPU27 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02697"></a>02697 <span class="comment">    Cpu 27 online</span>
<a name="l02698"></a>02698 <span class="comment">    SMP: Booting CPU28 (CoreId 28)...</span>
<a name="l02699"></a>02699 <span class="comment">    CPU28 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02700"></a>02700 <span class="comment">    Cpu 28 online</span>
<a name="l02701"></a>02701 <span class="comment">    SMP: Booting CPU29 (CoreId 29)...</span>
<a name="l02702"></a>02702 <span class="comment">    CPU29 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02703"></a>02703 <span class="comment">    Cpu 29 online</span>
<a name="l02704"></a>02704 <span class="comment">    SMP: Booting CPU30 (CoreId 30)...</span>
<a name="l02705"></a>02705 <span class="comment">    CPU30 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02706"></a>02706 <span class="comment">    Cpu 30 online</span>
<a name="l02707"></a>02707 <span class="comment">    SMP: Booting CPU31 (CoreId 31)...</span>
<a name="l02708"></a>02708 <span class="comment">    CPU31 revision is: 000d910a (Cavium Octeon II)</span>
<a name="l02709"></a>02709 <span class="comment">    Cpu 31 online</span>
<a name="l02710"></a>02710 <span class="comment">    Brought up 32 CPUs</span>
<a name="l02711"></a>02711 <span class="comment">    devtmpfs: initialized</span>
<a name="l02712"></a>02712 <span class="comment">    clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns</span>
<a name="l02713"></a>02713 <span class="comment">    futex hash table entries: 8192 (order: 8, 1048576 bytes)</span>
<a name="l02714"></a>02714 <span class="comment">    NET: Registered protocol family 16</span>
<a name="l02715"></a>02715 <span class="comment">    PTP Clock: Using sclk reference at 800000000 Hz</span>
<a name="l02716"></a>02716 <span class="comment">    PCIe: Initializing port 0:0</span>
<a name="l02717"></a>02717 <span class="comment">    0:PCIe: Port 0 is unknown, skipping.</span>
<a name="l02718"></a>02718 <span class="comment">    PCIe: Initializing port 0:1</span>
<a name="l02719"></a>02719 <span class="comment">    random: fast init done</span>
<a name="l02720"></a>02720 <span class="comment">    PCIe: Link timeout on port 1, probably the slot is empty</span>
<a name="l02721"></a>02721 <span class="comment">    HugeTLB registered 2 MB page size, pre-allocated 0 pages</span>
<a name="l02722"></a>02722 <span class="comment">    vgaarb: loaded</span>
<a name="l02723"></a>02723 <span class="comment">    SCSI subsystem initialized</span>
<a name="l02724"></a>02724 <span class="comment">    usbcore: registered new interface driver usbfs</span>
<a name="l02725"></a>02725 <span class="comment">    usbcore: registered new interface driver hub</span>
<a name="l02726"></a>02726 <span class="comment">    usbcore: registered new device driver usb</span>
<a name="l02727"></a>02727 <span class="comment">    pps_core: LinuxPPS API ver. 1 registered</span>
<a name="l02728"></a>02728 <span class="comment">    pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;</span>
<a name="l02729"></a>02729 <span class="comment">    PTP clock support registered</span>
<a name="l02730"></a>02730 <span class="comment">    EDAC MC: Ver: 3.0.0</span>
<a name="l02731"></a>02731 <span class="comment">    PCI host bridge to bus 0000:00</span>
<a name="l02732"></a>02732 <span class="comment">    pci_bus 0000:00: root bus resource [mem 0x1000000000000]</span>
<a name="l02733"></a>02733 <span class="comment">    pci_bus 0000:00: root bus resource [io  0x0000]</span>
<a name="l02734"></a>02734 <span class="comment">    pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]</span>
<a name="l02735"></a>02735 <span class="comment">    pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]</span>
<a name="l02736"></a>02736 <span class="comment">    clocksource: Switched to clocksource OCTEON_CVMCOUNT</span>
<a name="l02737"></a>02737 <span class="comment">    NET: Registered protocol family 2</span>
<a name="l02738"></a>02738 <span class="comment">    TCP established hash table entries: 65536 (order: 7, 524288 bytes)</span>
<a name="l02739"></a>02739 <span class="comment">    TCP bind hash table entries: 65536 (order: 8, 1048576 bytes)</span>
<a name="l02740"></a>02740 <span class="comment">    TCP: Hash tables configured (established 65536 bind 65536)</span>
<a name="l02741"></a>02741 <span class="comment">    UDP hash table entries: 4096 (order: 5, 131072 bytes)</span>
<a name="l02742"></a>02742 <span class="comment">    UDP-Lite hash table entries: 4096 (order: 5, 131072 bytes)</span>
<a name="l02743"></a>02743 <span class="comment">    NET: Registered protocol family 1</span>
<a name="l02744"></a>02744 <span class="comment">    RPC: Registered named UNIX socket transport module.</span>
<a name="l02745"></a>02745 <span class="comment">    RPC: Registered udp transport module.</span>
<a name="l02746"></a>02746 <span class="comment">    RPC: Registered tcp transport module.</span>
<a name="l02747"></a>02747 <span class="comment">    RPC: Registered tcp NFSv4.1 backchannel transport module.</span>
<a name="l02748"></a>02748 <span class="comment">    random: crng init done</span>
<a name="l02749"></a>02749 <span class="comment">    octeon_pci_console: Initialized.</span>
<a name="l02750"></a>02750 <span class="comment">    /proc/octeon_perf: Octeon performance counter interface loaded</span>
<a name="l02751"></a>02751 <span class="comment">    workingset: timestamp_bits=61 max_order=23 bucket_order=0</span>
<a name="l02752"></a>02752 <span class="comment">    squashfs: version 4.0 (2009/01/31) Phillip Lougher</span>
<a name="l02753"></a>02753 <span class="comment">    NFS: Registering the id_resolver key type</span>
<a name="l02754"></a>02754 <span class="comment">    Key type id_resolver registered</span>
<a name="l02755"></a>02755 <span class="comment">    Key type id_legacy registered</span>
<a name="l02756"></a>02756 <span class="comment">    io scheduler noop registered</span>
<a name="l02757"></a>02757 <span class="comment">    io scheduler deadline registered</span>
<a name="l02758"></a>02758 <span class="comment">    io scheduler cfq registered (default)</span>
<a name="l02759"></a>02759 <span class="comment">    octeon_gpio 1070000000800.gpio-controller: OCTEON GPIO: base = 0</span>
<a name="l02760"></a>02760 <span class="comment">    Serial: 8250/16550 driver, 6 ports, IRQ sharing disabled</span>
<a name="l02761"></a>02761 <span class="comment">    console [ttyS0] disabled</span>
<a name="l02762"></a>02762 <span class="comment">    1180000000800.serial: ttyS0 at MMIO 0x1180000000800 (irq = 228, base_baud = 50000000) is a OCTEON</span>
<a name="l02763"></a>02763 <span class="comment">    console [ttyS0] enabled</span>
<a name="l02764"></a>02764 <span class="comment">    console [ttyS0] enabled</span>
<a name="l02765"></a>02765 <span class="comment">    bootconsole [early0] disabled</span>
<a name="l02766"></a>02766 <span class="comment">    bootconsole [early0] disabled</span>
<a name="l02767"></a>02767 <span class="comment">    1180000000c00.serial: ttyS1 at MMIO 0x1180000000c00 (irq = 229, base_baud = 50000000) is a OCTEON</span>
<a name="l02768"></a>02768 <span class="comment">    brd: module loaded</span>
<a name="l02769"></a>02769 <span class="comment">    loop: module loaded</span>
<a name="l02770"></a>02770 <span class="comment">    pata_octeon_cf 1d040000.compact-flash: version 2.2 16 bit, True IDE.</span>
<a name="l02771"></a>02771 <span class="comment">    scsi host0: pata_octeon_cf</span>
<a name="l02772"></a>02772 <span class="comment">    ata1: PATA max PIO6 cmd 800000001d040000 ctl 800000001d05000d irq 210</span>
<a name="l02773"></a>02773 <span class="comment">    slram: not enough parameters.</span>
<a name="l02774"></a>02774 <span class="comment">    libphy: mdio_octeon: probed</span>
<a name="l02775"></a>02775 <span class="comment">    mdio_octeon 1180000003800.mdio: Probed</span>
<a name="l02776"></a>02776 <span class="comment">    libphy: mdio_octeon: probed</span>
<a name="l02777"></a>02777 <span class="comment">    mdio_octeon 1180000003880.mdio: Probed</span>
<a name="l02778"></a>02778 <span class="comment">    libphy: mdio_octeon: probed</span>
<a name="l02779"></a>02779 <span class="comment">    mdio_octeon 1180000003900.mdio: Probed</span>
<a name="l02780"></a>02780 <span class="comment">    libphy: mdio_octeon: probed</span>
<a name="l02781"></a>02781 <span class="comment">    mdio_octeon 1180000003980.mdio: Probed</span>
<a name="l02782"></a>02782 <span class="comment">    libphy: Fixed MDIO Bus: probed</span>
<a name="l02783"></a>02783 <span class="comment">    octeon_mgmt 1070000100000.ethernet: Version 2.0</span>
<a name="l02784"></a>02784 <span class="comment">    octeon-pow-ethernet ERROR: You must specify a broadcast group mask.</span>
<a name="l02785"></a>02785 <span class="comment">    octeon-ethernet 2.0</span>
<a name="l02786"></a>02786 <span class="comment">    Node 0 Interface 0 has 1 ports (RXAUI)</span>
<a name="l02787"></a>02787 <span class="comment">    Node 0 Interface 1 has 1 ports (RXAUI)</span>
<a name="l02788"></a>02788 <span class="comment">    Node 0 Interface 2 has 4 ports (SGMII)</span>
<a name="l02789"></a>02789 <span class="comment">    Node 0 Interface 7 has 32 ports (NPI)</span>
<a name="l02790"></a>02790 <span class="comment">    Node 0 Interface 8 has 8 ports (LOOP)</span>
<a name="l02791"></a>02791 <span class="comment">    e1000: Intel(R) PRO/1000 Network Driver - version 7.3.21-k8-NAPI</span>
<a name="l02792"></a>02792 <span class="comment">    e1000: Copyright (c) 1999-2006 Intel Corporation.</span>
<a name="l02793"></a>02793 <span class="comment">    e1000e: Intel(R) PRO/1000 Network Driver - 3.2.6-k</span>
<a name="l02794"></a>02794 <span class="comment">    e1000e: Copyright(c) 1999 - 2015 Intel Corporation.</span>
<a name="l02795"></a>02795 <span class="comment">    igb: Intel(R) Gigabit Ethernet Network Driver - version 5.4.0-k</span>
<a name="l02796"></a>02796 <span class="comment">    igb: Copyright (c) 2007-2014 Intel Corporation.</span>
<a name="l02797"></a>02797 <span class="comment">    ehci_hcd: USB 2.0 &apos;Enhanced&apos; Host Controller (EHCI) Driver</span>
<a name="l02798"></a>02798 <span class="comment">    ehci-pci: EHCI PCI platform driver</span>
<a name="l02799"></a>02799 <span class="comment">    ehci-platform: EHCI generic platform driver</span>
<a name="l02800"></a>02800 <span class="comment">    ehci-platform 16f0000000000.ehci: EHCI Host Controller</span>
<a name="l02801"></a>02801 <span class="comment">    ehci-platform 16f0000000000.ehci: new USB bus registered, assigned bus number 1</span>
<a name="l02802"></a>02802 <span class="comment">    ehci-platform 16f0000000000.ehci: irq 236, io mem 0x16f0000000000</span>
<a name="l02803"></a>02803 <span class="comment">    ehci-platform 16f0000000000.ehci: USB 2.0 started, EHCI 1.00</span>
<a name="l02804"></a>02804 <span class="comment">    hub 1-0:1.0: USB hub found</span>
<a name="l02805"></a>02805 <span class="comment">    hub 1-0:1.0: 2 ports detected</span>
<a name="l02806"></a>02806 <span class="comment">    ohci_hcd: USB 1.1 &apos;Open&apos; Host Controller (OHCI) Driver</span>
<a name="l02807"></a>02807 <span class="comment">    ohci-pci: OHCI PCI platform driver</span>
<a name="l02808"></a>02808 <span class="comment">    ohci-platform: OHCI generic platform driver</span>
<a name="l02809"></a>02809 <span class="comment">    ohci-platform 16f0000000400.ohci: Generic Platform OHCI controller</span>
<a name="l02810"></a>02810 <span class="comment">    ohci-platform 16f0000000400.ohci: new USB bus registered, assigned bus number 2</span>
<a name="l02811"></a>02811 <span class="comment">    ohci-platform 16f0000000400.ohci: irq 236, io mem 0x16f0000000400</span>
<a name="l02812"></a>02812 <span class="comment">    hub 2-0:1.0: USB hub found</span>
<a name="l02813"></a>02813 <span class="comment">    hub 2-0:1.0: 2 ports detected</span>
<a name="l02814"></a>02814 <span class="comment">    usbcore: registered new interface driver usb-storage</span>
<a name="l02815"></a>02815 <span class="comment">    i2c /dev entries driver</span>
<a name="l02816"></a>02816 <span class="comment">    rtc-ds1307 0-0068: rtc core: registered ds1337 as rtc0</span>
<a name="l02817"></a>02817 <span class="comment">    i2c-octeon 1180000001000.i2c: probed</span>
<a name="l02818"></a>02818 <span class="comment">    i2c-octeon 1180000001200.i2c: probed</span>
<a name="l02819"></a>02819 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 2</span>
<a name="l02820"></a>02820 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 3</span>
<a name="l02821"></a>02821 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 4</span>
<a name="l02822"></a>02822 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 5</span>
<a name="l02823"></a>02823 <span class="comment">    pcf857x 6-003e: probed</span>
<a name="l02824"></a>02824 <span class="comment">    pcf857x 6-003f: probed</span>
<a name="l02825"></a>02825 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 6</span>
<a name="l02826"></a>02826 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 7</span>
<a name="l02827"></a>02827 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 8</span>
<a name="l02828"></a>02828 <span class="comment">    i2c i2c-0: Added multiplexed i2c bus 9</span>
<a name="l02829"></a>02829 <span class="comment">    pca954x 0-0070: registered 8 multiplexed busses for I2C switch pca9548</span>
<a name="l02830"></a>02830 <span class="comment">    octeon_wdt: Initial granularity 5 Sec</span>
<a name="l02831"></a>02831 <span class="comment">    EDAC DEVICE0: Giving out device to module octeon-cpu controller cache: DEV octeon_pc_edac (INTERRUPT)</span>
<a name="l02832"></a>02832 <span class="comment">    EDAC DEVICE1: Giving out device to module octeon-l2c controller octeon_l2c_err: DEV octeon_l2c_edac (POLLED)</span>
<a name="l02833"></a>02833 <span class="comment">    EDAC MC0: Giving out device to module octeon-lmc controller co_lmc_err: DEV octeon_lmc_edac.0 (POLLED)</span>
<a name="l02834"></a>02834 <span class="comment">    octeon_lmc_edac octeon_lmc_edac.1: Disabled (ECC not enabled)</span>
<a name="l02835"></a>02835 <span class="comment">    octeon_lmc_edac octeon_lmc_edac.2: Disabled (ECC not enabled)</span>
<a name="l02836"></a>02836 <span class="comment">    EDAC MC3: Giving out device to module octeon-lmc controller co_lmc_err: DEV octeon_lmc_edac.3 (POLLED)</span>
<a name="l02837"></a>02837 <span class="comment">    NET: Registered protocol family 17</span>
<a name="l02838"></a>02838 <span class="comment">    Key type dns_resolver registered</span>
<a name="l02839"></a>02839 <span class="comment">    L2 lock: TLB refill 256 bytes</span>
<a name="l02840"></a>02840 <span class="comment">    L2 lock: General exception 128 bytes</span>
<a name="l02841"></a>02841 <span class="comment">    L2 lock: low-level interrupt 128 bytes</span>
<a name="l02842"></a>02842 <span class="comment">    L2 lock: interrupt 640 bytes</span>
<a name="l02843"></a>02843 <span class="comment">    L2 lock: memcpy 1152 bytes</span>
<a name="l02844"></a>02844 <span class="comment">    Bootbus flash: Setting flash for 8MB flash at 0x1f400000</span>
<a name="l02845"></a>02845 <span class="comment">    phys_mapped_flash: Found 1 x16 devices at 0x0 in 8-bit bank. Manufacturer ID 0x000001 Chip ID 0x001001</span>
<a name="l02846"></a>02846 <span class="comment">    Amd/Fujitsu Extended Query Table at 0x0040</span>
<a name="l02847"></a>02847 <span class="comment">      Amd/Fujitsu Extended Query version 1.3.</span>
<a name="l02848"></a>02848 <span class="comment">      phys_mapped_flash: Swapping erase regions for top-boot CFI table.</span>
<a name="l02849"></a>02849 <span class="comment">      number of CFI chips: 1</span>
<a name="l02850"></a>02850 <span class="comment">      rtc-ds1307 0-0068: setting system clock to 2017-10-18 05:16:32 UTC (1508303792)</span>
<a name="l02851"></a>02851 <span class="comment">    OF: fdt:not creating &apos;/sys/firmware/fdt&apos;: CRC check failed</span>
<a name="l02852"></a>02852 <span class="comment">    Freeing unused kernel memory: 75652K</span>
<a name="l02853"></a>02853 <span class="comment">    This architecture does not have kernel memory protection.</span>
<a name="l02854"></a>02854 <span class="comment">    /sbin/rc starting</span>
<a name="l02855"></a>02855 <span class="comment">    Mounting file systems</span>
<a name="l02856"></a>02856 <span class="comment">    mount: mounting none on /proc/bus/usb failed: No such file or directory</span>
<a name="l02857"></a>02857 <span class="comment">    Setting up loopback</span>
<a name="l02858"></a>02858 <span class="comment">    Starting syslogd</span>
<a name="l02859"></a>02859 <span class="comment">    Starting telnetd</span>
<a name="l02860"></a>02860 <span class="comment">    Oct 18 05:16:32 (none) syslog.info syslogd started: BusyBox v1.26.2</span>
<a name="l02861"></a>02861 <span class="comment">    /sbin/rc complete</span>
<a name="l02862"></a>02862 <span class="comment">    Oct 18 05:16:32 (none) daemon.info nit: starting pid 1517, tty &apos;&apos;: &apos;-/bin/cav_sh /bin/sh&apos;</span>
<a name="l02863"></a>02863 <span class="comment"></span>
<a name="l02864"></a>02864 <span class="comment"></span>
<a name="l02865"></a>02865 <span class="comment">    BusyBox v1.26.2 (2017-08-29 13:14:34 IST) built-in shell (ash)</span>
<a name="l02866"></a>02866 <span class="comment">    Enter &apos;help&apos; for a list of built-in commands.</span>
<a name="l02867"></a>02867 <span class="comment"></span>
<a name="l02868"></a>02868 <span class="comment">    ~ # usb 1-1: new high-speed USB device number 2 using ehci-platform</span>
<a name="l02869"></a>02869 <span class="comment">    usb-storage 1-1:1.0: USB Mass Storage device detected</span>
<a name="l02870"></a>02870 <span class="comment">    scsi host1: usb-storage 1-1:1.0</span>
<a name="l02871"></a>02871 <span class="comment">    scsi 1:0:0:0: Direct-Access     SanDisk  Cruzer Blade     1.00 PQ: 0 ANSI: 6</span>
<a name="l02872"></a>02872 <span class="comment">    sd 1:0:0:0: [sda] 30464000 512-byte logical blocks: (15.6 GB/14.5 GiB)</span>
<a name="l02873"></a>02873 <span class="comment">    sd 1:0:0:0: [sda] Write Protect is off</span>
<a name="l02874"></a>02874 <span class="comment">    sd 1:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn&apos;t support DPO or FUA</span>
<a name="l02875"></a>02875 <span class="comment">     sda: sda1 sda2</span>
<a name="l02876"></a>02876 <span class="comment">     sd 1:0:0:0: [sda] Attached SCSI removable disk</span>
<a name="l02877"></a>02877 <span class="comment"></span>
<a name="l02878"></a>02878 <span class="comment"></span>
<a name="l02879"></a>02879 <span class="comment">     ~ # udhcpc -i eth0</span>
<a name="l02880"></a>02880 <span class="comment">     udhcpc: started, v1.26.2</span>
<a name="l02881"></a>02881 <span class="comment">     udhcpc: sending discover</span>
<a name="l02882"></a>02882 <span class="comment">     udhcpc: sending select for 10.91.207.201</span>
<a name="l02883"></a>02883 <span class="comment">     udhcpc: lease of 10.91.207.201 obtained, lease time 691200</span>
<a name="l02884"></a>02884 <span class="comment">     deleting routers</span>
<a name="l02885"></a>02885 <span class="comment">     SIOCDELRT: No such process</span>
<a name="l02886"></a>02886 <span class="comment">     adding dns 10.89.12.27</span>
<a name="l02887"></a>02887 <span class="comment">     adding dns 10.90.4.10</span>
<a name="l02888"></a>02888 <span class="comment">     ~ # ping 10.91.205.197</span>
<a name="l02889"></a>02889 <span class="comment">     PING 10.91.205.197 (10.91.205.197) 56(84) bytes of data.</span>
<a name="l02890"></a>02890 <span class="comment">     64 bytes from 10.91.205.197: icmp_seq=1 ttl=64 time=0.155 ms</span>
<a name="l02891"></a>02891 <span class="comment">     64 bytes from 10.91.205.197: icmp_seq=2 ttl=64 time=0.119 ms</span>
<a name="l02892"></a>02892 <span class="comment">     64 bytes from 10.91.205.197: icmp_seq=3 ttl=64 time=0.230 ms</span>
<a name="l02893"></a>02893 <span class="comment">     ^C</span>
<a name="l02894"></a>02894 <span class="comment">     --- 10.91.205.197 ping statistics ---</span>
<a name="l02895"></a>02895 <span class="comment">     3 packets transmitted, 3 received, 0% packet loss, time 2096ms</span>
<a name="l02896"></a>02896 <span class="comment">     rtt min/avg/max/mdev = 0.119/0.168/0.230/0.046 ms</span>
<a name="l02897"></a>02897 <span class="comment">     ~ # ping -c 3 www.google.com</span>
<a name="l02898"></a>02898 <span class="comment">     PING www.google.com (216.58.197.36) 56(84) bytes of data.</span>
<a name="l02899"></a>02899 <span class="comment">     64 bytes from maa03s20-in-f36.1e100.net (216.58.197.36): icmp_seq=1 ttl=55 time=13.7 ms</span>
<a name="l02900"></a>02900 <span class="comment">     64 bytes from maa03s20-in-f36.1e100.net (216.58.197.36): icmp_seq=2 ttl=55 time=14.8 ms</span>
<a name="l02901"></a>02901 <span class="comment">     64 bytes from maa03s20-in-f4.1e100.net (216.58.197.36): icmp_seq=3 ttl=55 time=14.9 ms</span>
<a name="l02902"></a>02902 <span class="comment">                                                                                                                                                       --- www.google.com ping statistics --- </span>
<a name="l02903"></a>02903 <span class="comment">     3 packets transmitted, 3 received, 0% packet loss, time 7416ms</span>
<a name="l02904"></a>02904 <span class="comment">     rtt min/avg/max/mdev = 13.785/14.535/14.952/0.549 ms</span>
<a name="l02905"></a>02905 <span class="comment">     ~#</span>
<a name="l02906"></a>02906 <span class="comment"></span>
<a name="l02907"></a>02907 <span class="comment">@endverbatim</span>
<a name="l02908"></a>02908 <span class="comment"></span>
<a name="l02909"></a>02909 <span class="comment">*/</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
