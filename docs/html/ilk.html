<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: OCTEON II/OCTEON III Interlaken Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="ilk">OCTEON II/OCTEON III Interlaken Interface </a></h1><p>This is a guide on how to experiment with the Interlaken (ILK) interfaces on EBB6800 and EBB7800 evaluation boards by Cavium Inc.</p>
<h2><a class="anchor" id="ilk_hw_setup">
1. HW Setup</a></h2>
<h3><a class="anchor" id="ilk_brd_req">
2.1 Board Requirement</a></h3>
<p>The ILK interfaces can be tested with either a single EBB6800/EBB7800 board or two EBB6800/EBB7800 boards connected to each other.</p>
<h3><a class="anchor" id="ilk_cbl_conn">
2.2 Cable Connections</a></h3>
<p>If a single EBB6800 board is used, QLM1 and QLM2 on the board need to be connected to each other via an external ILK cable. This is an externel HW loopback configuration.</p>
<p>If two EBB6800 boards are used, QLM1s on each board need to be connected to each other with an ILK cable. QLM2s of both boards can also be connected to each other if both ILK interfaces need to be tested simultaneously.</p>
<p>For EBB7800, please refer to Hardware Reference Manual for possible combinations.</p>
<h3><a class="anchor" id="ilk_mcu_conf">
2.3 MCU Configuration for EBB6800</a></h3>
<p>Connect a null modem cable between a serial console and MCU DB-9 connector on EBB6800 board. Follow the screen instructions to allocate both QLM1 and QLM2 to CN68XX ILK interfaces and to specify the ILK lane speed.</p>
<p>As an initial experiment, the ILK lane speed can be set at 3.125G. As a general rule, the higher the speed, the more difficult it is to realize a word boundary lock, due to signal skew.</p>
<h3><a class="anchor" id="ilk_mcu_conf">
2.3 MCU Configuration for EBB6800</a></h3>
<p>Connect a null modem cable between a serial console and MCU DB-9 connector on EBB7800 board. Follow the screen instructions to allocate supported QLMs based on the lanes to configure to ILK interfaces and to specify the ILK lane speed at 6.250G.</p>
<h2><a class="anchor" id="ilk_run_sdk_sw_1bd">
2. Running SDK SW for 1-Board Experiment</a></h2>
<ul>
<li>Source OCTEON_ROOT to be the base directory where OCTEON SDK is installed i.e. run the env-setup script.</li>
<li>Change to $OCTEON_ROOT/examples/traffic-gen. Build the traffic generator by issuing "make". The binary image will be "traffic-gen".</li>
<li>Power up the board. At the U-Boot prompt, issue the following commands to download and boot the traffic generator<ul>
<li>tftp ${loadaddr} traffic-gen</li>
<li>bootoct ${loadaddr} numcores=32</li>
</ul>
</li>
<li>At the traffic generator prompt, issue the following commands to send and receive ILK traffic, where "1024" (or 0x400) is the internal designation for the start of ILK #0 logical channels; "1283" (or 0x503) is the internal designation for the 4th logical channel of ILK #1. In general, ILK #0 logical channels are numbered between 0x400 and 0x4FF; ILK #1 logical channels are numbered between 0x500 and 0x5FF<ul>
<li>hide all</li>
<li>default 1024 1283</li>
<li>show</li>
<li>start</li>
</ul>
</li>
<li>Now the ILK packet counts should show up in the console display. You should see ILK #0 channel 0 Tx counts matches with ILK #1 channel 0 Rx counts, ILK #0 channel 1 Tx counts matches with ILK #1 channel 1 Rx counts, and so on.</li>
<li>You can stop and restart ILK traffic by issuing "stop" then "start" again.</li>
</ul>
<h2><a class="anchor" id="ilk_run_sdk_sw_2bd">
3. Running SDK SW for 2-Board Experiment</a></h2>
<ul>
<li>In addition to "traffic-gen", you need to build "passthrough" in a similar way in $OCTEON_ROOT/examples/passthrough directory.</li>
<li>Download and boot "traffic-gen" as in the 1-board experiment onto the 1st EBB6800 board. After the "traffic-gen" booted, download and boot "passthrough" onto the 2nd EBB6800 board in a similar way. Note &lt;# of cores&gt; on the "passthrough" side can be 1, 2, 4, 8, 16, or 32.</li>
<li>Start the ILK traffic as in the 1-board experiment. You should see ILK #0 channel 0 Tx counts matches with ILK #0 channel 0 Rx counts, ILK #0 channel 1 Tx counts matches with ILK #0 channel 1 Rx counts, and so on.</li>
</ul>
<h2><a class="anchor" id="ilk_known_limit">
4. Known Limitations for EBB6800</a></h2>
<h3><a class="anchor" id="ilk_hi_qlm_spd">
4.1 High QLM Speed</a></h3>
<p>At the highest lane speed 6.25G, a special cable may be needed to reduce signal skew. Otherwise, the word boundary lock may fail and the interfaces cannot be used.</p>
<h3><a class="anchor" id="ilk_logic_chan">
4.2 Limit on the number of ILK logical channels</a></h3>
<p>Only 4 channels on each ILK interface are tested. More testing is under way. However, the ultimate limit on the number of channels is the available port kinds. There are total 64 port kinds on CN68XX. each ILK channel takes one. The port kinds are also shared between ILK and other interfaces being used. The net port kinds available to ILK is around 45 max. This means there can be only 45 logical channels for both ILK interfaces.</p>
<h3><a class="anchor" id="ilk_la">
4.3 Notes for look-aside mode</a></h3>
<p>ILK la mode is currently only supported in the CN68XX revision 2.0 and later. Receive calendar support is known to have problems in many cases such as two CN68XX devices connected back to back and should only be enabled in a limited set of circumstances.</p>
<p>ILK la mode also restricts an interface to using channels 0 and 1. Channel 0 is required and channel 1 is optional.</p>
<p>An 8-byte header of type <a class="el" href="unioncvmx__ilk__la__nsp__compact__hdr__t.html" title="This header is placed in front of all received ILK look-aside mode packets.">cvmx_ilk_la_nsp_compact_hdr_t</a> must be present at the beginning of every packet with bit 39 (la_mode) set to 1. If set to 0 then the packet will be sent in non LA-mode.</p>
<p>All packets will be received on channels 128 and 129 even though they are sent on channels 0 and 1 if the la_mode bit is set.</p>
<p>FCS is known not to work in LA mode. The PIP should be configured to disable FCS checks as well as minimum length checks. The PKO can also disable FCS generation and set the minimum length to be as small as 8 bytes.</p>
<p>All packets received will contain the 8-byte header defined by <a class="el" href="unioncvmx__ilk__la__nsp__compact__hdr__t.html" title="This header is placed in front of all received ILK look-aside mode packets.">cvmx_ilk_la_nsp_compact_hdr_t</a> in <a class="el" href="cvmx-ilk_8h.html" title="This file contains defines for the ILK interface.">cvmx-ilk.h</a>. The PIP can be configured to skip the 8-byte header.</p>
<p>Two "weak" functions have been defined. By weak, a user may create a new function with the same name and the linker will choose the non-weak function if it is present. The functions are cvmx_ilk_use_la_mode(interface, channel) which returns 1 if LA mode is to be used. If LA mode is to be used on an interface it MUST return 1 for channel 0. Channel 1 is optional.</p>
<p>The other "weak" function is cvmx_ilk_la_mode_enable_rx_calendar which returns non-zero to enable the RX calendar.</p>
<p>There are also several new defines for LA mode for executive-config.h. These are CVMX_HELPER_ILK_LA_MODE_INTERFACE0, CVMX_HELPER_ILK_LA_MODE_INTERFACE1, CVMX_HELPER_ILK_LA_MODE_CAL_ENABLE_INTERFACE0 and CVMX_HELPER_ILK_LA_MODE_CAL_ENABLE_INTERFACE1.</p>
<p>The traffic-gen example program has been enhanced to support LA mode. It is recommended to not use the RX calendar with this application.</p>
<h2><a class="anchor" id="ilk_api">
5. ILK API under Simple Executive</a></h2>
<ul>
<li><a class="el" href="cvmx-helper-ilk_8c.html#af302da77fff5234078892288a1762d85" title="Internal use function.">__cvmx_helper_ilk_probe()</a> - Probe a ILK interface and determine the number of ports connected to it. The ILK interface should still be down after this call.</li>
<li><a class="el" href="cvmx-helper-ilk_8c.html#ab1141fd8bb7c61d0ee036d648b2108b0" title="Internal use function.">__cvmx_helper_ilk_enable()</a> - Bringup and enable ILK interface. After this call packet I/O should be fully functional. This is called with IPD enabled but PKO disabled.</li>
<li><a class="el" href="cvmx-helper-ilk_8c.html#aba4f272ddcaa8dc8cba7c1bf98ab4f38" title="Internal use function.">__cvmx_helper_ilk_link_get()</a> - Return the link state of an IPD/PKO port as returned by ILK link status.</li>
<li><a class="el" href="cvmx-helper-ilk_8c.html#a17b7ccc3959c02decfa7a488dc129690" title="Internal use function.">__cvmx_helper_ilk_link_set()</a> - Set the link state of an IPD/PKO port.</li>
<li><a class="el" href="cvmx-helper-ilk_8c.html#ace09436909a0c7e779f0ede4c30492f2" title="Display ilk interface statistics.">__cvmx_helper_ilk_show_stats()</a> - Display ilk interface statistics.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a3b11568fa8c7d20a12bd2012fdb819dc" title="Initialize and start the ILK interface.">cvmx_ilk_start_interface()</a> - Initialize and start the ILK interface.</li>
<li>cvmx_ilk_start_interface_la - Initialize and start the ILK interface with look-aside support.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a2d306b7655308207575bc080834ad0f4" title="set pipe group base and length for the interface">cvmx_ilk_set_pipe()</a> - Set pipe group base and length for the interface.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a67ea01ee81ea5c4c47cab16f5baf3d39" title="set logical channels for tx">cvmx_ilk_tx_set_channel()</a> - Set logical channels for TX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a0264d775fef2f0937e3694181129947e" title="set pkind for rx">cvmx_ilk_rx_set_pknd()</a> - Set pkind for RX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#ad3583dc04217952d17427691bb5ba75e" title="configure calendar for rx">cvmx_ilk_rx_cal_conf()</a> - Configure calendar for RX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a999c94365213d173739d55d5691555ce" title="set high water mark for rx">cvmx_ilk_rx_set_hwm()</a> - Set high water mark for RX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#ae778a189c63ed94146c2c4589b4304eb" title="enable calendar for rx">cvmx_ilk_rx_cal_ena()</a> - Enable calendar for RX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a7d44d7a6107f9f8a9a17faefdfdcdadf" title="set up calendar for rx">cvmx_ilk_cal_setup_rx()</a> - Set up calendar for RX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#ac8fa562ac6f0b5efc585219c2e56c842" title="configure calendar for tx">cvmx_ilk_tx_cal_conf()</a> - Configure calendar for TX.</li>
<li>cvmx_ilk_bp_conf() - Configure backpressure for TX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a473d59c8fae14c748d14055fbe2dc1a9" title="enable calendar for tx">cvmx_ilk_tx_cal_ena()</a> - Enable calendar for TX.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a07973b1d6bd7c80d9abc39b0f0b033b3" title="set up calendar for tx">cvmx_ilk_cal_setup_tx()</a> - Set up calendar for TX.</li>
<li>cvmx_ilk_runtime_status() - Show run time status.</li>
<li><a class="el" href="cvmx-ilk_8c.html#aa709bf973f55b7e53b607ff19e3a32b4" title="show run time status">cvmx_ilk_enable()</a> - Enable interface.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a0a7945bfea5b0c5a1127e2898534974f" title="Disable interface.">cvmx_ilk_disable()</a> - Disable interface.</li>
<li><a class="el" href="cvmx-ilk_8c.html#ac47aeadc3695db358af5992d0908c3ae" title="Provide interface enable status.">cvmx_ilk_get_intf_ena()</a> - Provide interface enable status.</li>
<li><a class="el" href="cvmx-ilk_8h.html#a85e0c7db7f2cd8b78482613e3391623e">cvmx_ilk_get_chan_info()</a> - Provide channel info.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a6718ee4558dd748aa60d5e7cdd88747b" title="Show channel statistics.">cvmx_ilk_show_stats()</a> - Show channel statistics.</li>
<li><a class="el" href="cvmx-ilk_8c.html#ad0eb61d1a45d7b3bc9a9477f57936045" title="enable or disable loopbacks">cvmx_ilk_lpbk()</a> - Enable or disable loopbacks.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a824910ed8d63cd851c42676e09469ed4" title="User-overrideable callback function that returns whether or not an interface should...">cvmx_ilk_use_la_mode()</a> - returns whether the interface and channel should use LA mode.</li>
<li><a class="el" href="cvmx-ilk_8c.html#a894cbdfed8ce2dee133eaebfe46df102" title="User-overrideable callback function that returns whether or not an interface in look-aside...">cvmx_ilk_la_mode_enable_rx_calendar()</a> - returns if the interface should enable the rx calendar. </li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
