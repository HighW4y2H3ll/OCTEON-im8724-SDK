<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: Linux Userspace Debugging</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="linuxdebugger">Linux Userspace Debugging </a></h1><p>The Linux User Space Debugger <b>gdb</b> is part of the minimial root file system, located under /usr/bin directory.</p>
<p>Please refer to <a href="http://sources.redhat.com/gdb/current/onlinedocs/gdb_toc.html">http://sources.redhat.com/gdb/current/onlinedocs/gdb_toc.html</a> for a list of debugger commands and options.</p>
<h2>Debugging an application using Linux Native Debugger</h2>
<p>To build an application to debug, use OCTEON Linux cross compiler (mips64-octeon-linux-gnu-gcc) to compile on the host, adding the "-g" flag to the compilation command line.</p>
<p>Here is an example how to debug low-latency-mem example from OCTEON-SDK/examples directory. By default, the low-latency-mem-linux example is stripped of debugging information, rebuild it before attempting to debug it.</p>
<div class="fragment"><pre class="fragment">
    # gdb low-latency-mem-linux
    GNU gdb 6.3
    Copyright 2004 Free Software Foundation, Inc.
    GDB is free software, covered by the GNU General Public License, and you are
    welcome to change it and/or distribute copies of it under certain conditions.
    Type "show copying" to see the conditions.
    There is absolutely no warranty for GDB.  Type "show warranty" for details.
    This GDB was configured as "mips64-octeon-linux-gnu"...Using host libthread_db library "/lib64/libthread_db.so.1".

    (gdb) break appmain
    Breakpoint 1 at 0x120005840: file low-latency-mem.c, line 521.
    (gdb) run
    Starting program: /examples/low-latency-mem-linux
    CVMX_SHARED: 0x120180000-0x120182000
    Active coremask = 0x1

    Breakpoint 1, appmain () at low-latency-mem.c:521
    521         const char *names[] = {"add_slow", "add_fast", "add_slow", "add_fast",
    (gdb) next
    523         const int   replication[] = {CVMX_LLM_REPLICATION_NONE, CVMX_LLM_REPLICATION_NONE, REPLICATION_CODE, REPLI,(gdb)
    533         cvmx_user_app_init();
    (gdb) next
    535         sysinfo = cvmx_sysinfo_get();
    (gdb) next
    536         core_mask = sysinfo-&gt;core_mask;
    (gdb) next
    537         CVMX_POP(num_cores, core_mask);
    (gdb) p core_mask
    $1 = 1
    (gdb) next
    541         if (cvmx_coremask_first_core(core_mask))
    (gdb) break do_tests
    Breakpoint 2 at 0x120004c5c: file low-latency-mem.c, line 445.
    (gdb) continue
    Continuing.
    clock mult: 12, LLM ONE PORT
    Initializing Low latency Memory
    Initialization Complete

    Breakpoint 2, do_tests (core_mask=1, totals=0xfffffffa90, cycles=0xfffffffad0)
        at low-latency-mem.c:445
    445         CVMX_SYNC;
    (gdb) backtrace
    #0  do_tests (core_mask=1, totals=0xfffffffa90, cycles=0xfffffffad0)
        at low-latency-mem.c:445
    #1  0x000000012000598c in appmain () at low-latency-mem.c:547
    #2  0x00000001200065f0 in main (argc=1, argv=0xfffffffdd8)
        at /usr/local/Cavium_Networks/OCTEON-SDK/executive/cvmx-app-init-linux.c:292
    (gdb) next
    447         do_wait(core_mask);
    (gdb) run
    The program being debugged has been started already.
    Start it from the beginning? (y or n) y

    Starting program: /examples/low-latency-mem-linux
    CVMX_SHARED: 0x120180000-0x120182000
    Active coremask = 0x1

    Breakpoint 1, appmain () at low-latency-mem.c:521
    521         const char *names[] = {"add_slow", "add_fast", "add_slow", "add_fast",
    (gdb) n
    523         const int   replication[] = {CVMX_LLM_REPLICATION_NONE, CVMX_LLM_REPLICATION_NONE, REPLICATION_CODE, REPLI,(gdb)
    533         cvmx_user_app_init();
    (gdb) n
    535         sysinfo = cvmx_sysinfo_get();
    (gdb) step
    cvmx_sysinfo_get ()
        at /usr/local/Cavium_Networks/OCTEON-SDK/executive/cvmx-sysinfo.c:77
    77      /usr/local/Cavium_Networks/OCTEON-SDK/executive/cvmx-sysinfo.c: No such file or directory.
            in /usr/local/Cavium_Networks/OCTEON-SDK/executive/cvmx-sysinfo.c
    (gdb)
</pre></div><p>Please note that the first breakpoint is at "appmain" not at "main". The simple executive applications start at <a class="el" href="cvmx-app-init-linux_8c.html#af88aff83363a7c5942eb39122a0c99a4">appmain()</a> under Linux.</p>
<p>When the application was built on the host, the simple executive sources were located at /usr/local/Cavium_Networks/OCTEON-SDK/executive directory. While debugging and stepping into <a class="el" href="cvmx-sysinfo_8c.html#accfd43a83b0d1a8af4fe2728880e3e56" title="This function returns the application information as obtained by the bootloader.">cvmx_sysinfo_get()</a>, the debugger will look for the same path and likely not find the source code. One may use the 'dir' gdb command to tell the debugger to look at an alternate location for the source code.</p>
<h2>Using hardware watchpoints with the Linux Native Debugger</h2>
<p>The Linux Native Debugger on OCTEON Linux supports a single hardware backed watchpoint. It can be used to find where a program variable is being modified.</p>
<p>Here is an example of using a hardware watchpoints. Note that the strcpy() on line 20 clobbers the other fields in the structure.</p>
<div class="fragment"><pre class="fragment">
    # gdb watchtest1
    GNU gdb 6.8 Cavium Inc. Development Build
    Copyright (C) 2008 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
    and "show warranty" for details.
    This GDB was configured as "mips64-octeon-linux-gnu"...
    (gdb) l 1,26
    1   #include &lt;stdio.h&gt;
    2   #include &lt;string.h&gt;
    3
    4   struct bar {
    5     char name[16];
    6     int f1;
    7     int f2;
    8   };
    9
    10  const char *val = "This name is too long";
    11
    12  int main(int argc, char **argv)
    13  {
    14    struct bar s;
    15
    16    s.f1 = 3;
    17    s.f2 = 10;
    18    printf("s.f1: %d, s.f2: %d\n", s.f1, s.f2);
    19
    20    strcpy(s.name, val);
    21
    22    printf("s.f1: %d, s.f2: %d\n", s.f1, s.f2);
    23
    24    return 0;
    25  }
    (gdb) b 17
    Breakpoint 1 at 0x1200009a8: file watchtest1.c, line 17.
    (gdb) run
    Starting program: /mnt/watchtest1

    Breakpoint 1, main (argc=1, argv=0xffffcb0298) at watchtest1.c:17
    17    s.f2 = 10;
    (gdb) watch s.f1
    Hardware watchpoint 2: s.f1
    (gdb) c
    Continuing.
    s.f1: 3, s.f2: 10
    Hardware watchpoint 2: s.f1

    Old value = 3
    New value = 536870915
    0x00000055556214d0 in strcpy () from /lib64/libc.so.6
    (gdb) bt
    #0  0x00000055556214d0 in strcpy () from /lib64/libc.so.6
    #1  0x00000001200009ec in main (argc=1, argv=0xffffcb0298) at watchtest1.c:20
    (gdb)
</pre></div><h2>Debugging an application using Linux Native gdbserver</h2>
<p>Applications can also be debugged using the Linux cross debugger. The host machine runs mips64-octeon-linux-gnu-gdb and OCTEON runs gdbserver.</p>
<p>Here is an example how to debug the low-latency-memory example. Build the low-latency-memory example with debugging symbols by passing the <b>"-g"</b> option.</p>
<p>On OCTEON (running Linux) invoke:</p>
<dl class="note"><dt><b>Note:</b></dt><dd>When using Debian root file system, add to the PATH environment variable /usr/local/Cavium_Networks/OCTEON-SDK/tools/usr/bin to pick the correct gdbserver for debugging n64 ABI application.</dd></dl>
<div class="fragment"><pre class="fragment">
	# export PATH=/usr/local/Cavium_Networks/OCTEON-SDK/tools/usr/bin:$PATH
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>In the gdbserver command "2349" is a tcp port number. Later gdb will connect to this port from the host.</dd></dl>
<div class="fragment"><pre class="fragment">
    # gdbserver :2349 low-latency-memory-linux_64
    Process ./low-latency-mem-linux_64 created; pid = 891
    Listening on port 2349
</pre></div><p>And on your host:</p>
<dl class="note"><dt><b>Note:</b></dt><dd>"192.168.16.61:2349" in "target remote" is the IP address of OCTEON, followed by the gdbserver port number (from above).</dd></dl>
<div class="fragment"><pre class="fragment">
    $ mips64-octeon-linux-gnu-gdb low-latency-memoy-linux_64

    GNU gdb 6.3
    Copyright 2004 Free Software Foundation, Inc.
    GDB is free software, covered by the GNU General Public License, and you are
    welcome to change it and/or distribute copies of it under certain conditions.
    Type "show copying" to see the conditions.
    There is absolutely no warranty for GDB.  Type "show warranty" for details.
    This GDB was configured as "--host=i686-pc-linux-gnu --target=mips64-octeon-linux-gnu"...
    (gdb) target remote 192.168.16.61:2349
    Remote debugging using 192.168.16.61:2349
    0x0000000120003620 in _ftext ()
</pre></div><p>Once a connection is made, gdbserver will display an acknowledgement message:</p>
<div class="fragment"><pre class="fragment">
    Remote debugging from host 192.168.16.30
</pre></div><p>Continue debugging the program:</p>
<div class="fragment"><pre class="fragment">
    (gdb) b appmain
    Breakpoint 1 at 0x120005168: file low-latency-mem.c, line 521.
    (gdb) c
    Continuing.

    Breakpoint 1, appmain () at low-latency-mem.c:521
    521         const char *names[] = {"add_slow", "add_fast", "add_slow", "add_fast",
    (gdb) next
    523         const int   replication[] = {CVMX_LLM_REPLICATION_NONE, CVMX_LLM_REPLICATION_NONE, REPLICATION_CODE, REPLICATION_CODE2,
    (gdb) next
    533         cvmx_user_app_init();
    (gdb) next
    535         sysinfo = cvmx_sysinfo_get();
    (gdb) next
    536         core_mask = sysinfo-&gt;core_mask;
    (gdb) next
    537         CVMX_POP(num_cores, core_mask);
    (gdb) p core_mask
    $1 = 1
    (gdb) next
    541         if (cvmx_coremask_first_core(core_mask))
    (gdb) b do_tests
    Breakpoint 2 at 0x120004584: file low-latency-mem.c, line 445.
    (gdb) c
    Continuing.

    Breakpoint 2, do_tests (core_mask=1, totals=0xffffe688d0, cycles=0xffffe68910)
        at low-latency-mem.c:445
    445         CVMX_SYNC;
    (gdb) backtrace
    #0  do_tests (core_mask=1, totals=0xffffe688d0, cycles=0xffffe68910) at low-latency-mem.c:445
    #1  0x00000001200052b4 in appmain () at low-latency-mem.c:547
    #2  0x00000001200067e0 in main (argc=1, argv=0xffffe68c98)
        at /usr/local/Cavium_Networks/OCTEON-SDK/executive/cvmx-app-init-linux.c:384
    (gdb) next
    447         do_wait(core_mask);
    (gdb) continue
    Continuing.

    Program exited normally.
    (gdb) quit
</pre></div><p>Output from the application will show up on OCTEON:</p>
<div class="fragment"><pre class="fragment">
    CVMX_SHARED: 0x120190000-0x120192000
    Active coremask = 0x1
    Configuring 1 llm port.
    Initializing Low latency Memory
    Initialization Complete
    Core  0: add_slow   1x sum = 523776 in  69399 cycles
    Core  0: add_fast   1x sum = 523776 in  34776 cycles
    Core  0: add_slow   2x sum = 523776 in  65702 cycles
    Core  0: add_fast   8x sum = 523776 in  34416 cycles
    Core  0: add_slow64 1x sum = 523776 in  34304 cycles
    Core  0: add_fast64 1x sum = 523776 in  17451 cycles
    Core  0: add_slow64 2x sum = 523776 in  34277 cycles
    Core  0: add_fast64 8x sum = 523776 in  17258 cycles

    Average: add_slow   1x =  69399 cycles
    Average: add_fast   1x =  34776 cycles
    Average: add_slow   2x =  65702 cycles
    Average: add_fast   8x =  34416 cycles
    Average: add_slow64 1x =  34304 cycles
    Average: add_fast64 1x =  17451 cycles
    Average: add_slow64 2x =  34277 cycles
    Average: add_fast64 8x =  17258 cycles

    TEST PASSED

    Child exited with retcode = 0

    Child exited with status 0
    GDBserver exiting
</pre></div><h2>GDB Server over a Serial Line</h2>
<p>To debug the application over a serial port, you need to enable the second serial port as mentioned in <a class="el" href="linux.html">Linux on the OCTEON</a> and rebuild the Linux Kernel. Invoke gdbserver by specifying the serial device (/dev/ttyS1) and pass serial device to "target remote" command instead of an IP address and port number.</p>
<div class="fragment"><pre class="fragment">
    gdbserver /dev/ttyS1 low-latency-memory-linux_64
</pre></div><div class="fragment"><pre class="fragment">
    mips64-octeon-linux-gnu-gdb low-latency-memory-linux_64
    GNU gdb 6.3
    Copyright 2004 Free Software Foundation, Inc.
    GDB is free software, covered by the GNU General Public License, and you are
    welcome to change it and/or distribute copies of it under certain conditions.
    Type "show copying" to see the conditions.
    There is absolutely no warranty for GDB.  Type "show warranty" for details.
    This GDB was configured as "--host=i686-pc-linux-gnu --target=mips64-octeon-linux-gnu"...
    (gdb) set remotebaud 9600
    (gdb) target remote /dev/ttyUSB1
</pre></div><h2>Known Issues</h2>
<ol type="1">
<li>The debugger does not show the correct value for "long double" variables. </li>
</ol>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
