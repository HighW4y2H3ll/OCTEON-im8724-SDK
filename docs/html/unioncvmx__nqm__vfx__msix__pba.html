<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Octeon Software Development Kit: cvmx_nqm_vfx_msix_pba Union Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cvmx_nqm_vfx_msix_pba Union Reference</h1><!-- doxytag: class="cvmx_nqm_vfx_msix_pba" -->
<p>cvmx_nqm_vf::_msix_pba  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="cvmx-nqm-defs_8h_source.html">cvmx-nqm-defs.h</a>&gt;</code></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcvmx__nqm__vfx__msix__pba_1_1cvmx__nqm__vfx__msix__pba__s.html">cvmx_nqm_vfx_msix_pba_s</a></td></tr>
<tr><td colspan="2"><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">uint64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#a5c2ba4298df56b8df0ac0e6c4bccec02">u64</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <br class="typebreak"/>
<a class="el" href="structcvmx__nqm__vfx__msix__pba_1_1cvmx__nqm__vfx__msix__pba__s.html">cvmx_nqm_vfx_msix_pba::cvmx_nqm_vfx_msix_pba_s</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#ae5e0611c78d4f007e674e324d016fa9d">s</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structcvmx__nqm__vfx__msix__pba_1_1cvmx__nqm__vfx__msix__pba__s.html">cvmx_nqm_vfx_msix_pba_s</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#a11c4fe018b33af7238136ebddba737cb">cn73xx</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>cvmx_nqm_vf::_msix_pba </p>
<p>NQM_VF(x)_MSIX_PBA contains the PCI-standard MSI-X PBA structure for function x.</p>
<p>When migrating a function, the current MSI-X state of the function can be captured via the following sequence:</p>
<p>(1) Quiet remote host activity for the function. At this point, all corresponding NQM_VF()_CQ()_HDBL should be stable in the function.</p>
<p>(2) Save a copy and reset all of the NQM_VF()_VEC()_MSIX_CTL's in the function.</p>
<p>After this step, NQM stops sending MSIs for the function to the remote host because all the NQM_VF()_VEC()_MSIX_CTL[MASK]'s are set.</p>
<p>(3) Save a copy of all the NQM_VF()_VEC()_MSIX_ADDR's and reset them.</p>
<p>(4) Read a copy of all corresponding NQM_VF()_CQ()_TAIL in the function. Let initTAIL[cq] = the NQM_VF()_CQ(cq)_TAIL[TAIL] value read.</p>
<p>(5) Delay long enough to ensure that any NQM_VF()_CQ()_TAIL changes are reflected in the NQM_VF()_VEC()_MSIX_INT_ST's read in the next step.</p>
<p>A simple method is to wait for each NQM_VF(0..1027)_CPL(0..16)_IFC[COUNT] in the function to be zero at least once (independently) before continuing.</p>
<p>(6) Read a copy of all corresponding NQM_VF()_VEC()_MSIX_INT_ST. let initINTCNTi be the NQM_VF()_VEC(i)_MSIX_INT_ST[INTCNT] value read.</p>
<p>(7) Read a copy of corresponding NQM_VF()_MSIX_PBA. Let PBA = the NQM_VF()_MSIX_PBA[PEND] value read.</p>
<p>(8) Ensure that all CPL/CQ's in the function are both disabled and idle. See the NQM_VF()_CQ()_ENA[ENABLE] description.</p>
<p>The CQ tails should be stable after this step.</p>
<p>Corresponding NQM_VF()_MSIX_PBA and all NQM_VF()_VEC()_MSIX_INT_ST[INTCNT] in the function should be zero after this step.</p>
<p>(8) For each MSI-X vector used (i), do this:</p>
<p>a_cq_tail_changed = 0; for each cq if((cq was enabled before this sequence) and (cq had interrupts enabled before this sequence) and (cq used MSI-X vector i before this sequence) and (initTAIL[cq] does not equal the migrated NQM_VF(0..1027)_CQ(cq)_TAIL[TAIL])) then a_cq_tail_changed = 1 endif end for if(a_cq_tail_changed or (initINTCNT[i] is not zero)) then PBA<em> = 1 endif</em></p>
<p><em> (9) Migrate the resultant PBA value together eith the MSIX_ADDR and MSIX_CTL values captured in (2) and (3) above. PBA will be written to NQM_VF()_MSIX_PBA[PEND] when the function is restored.</em></p>
<p><em> For MSI-X vectors that are used, the corresponding PBA bit will be set at this point unless an MSI had already been sent since the CQ's attached to the interrupt vector became non-empty. When PBA gets written to NQM_VF()_MSIX_PBA[PEND] during the restore, the hardware will not allow a PEND bit to be written to a one unless there is a non-empty CQ attached to the MSI-X vector.</em></p>
<p><em> (10) Make a copy and reset corresponding PCIEEP*_CFG044[MSIXEN,FUNM].</em></p>
<p><em> When restoring a migrated function, the following sequence can restore the MSI-X state:</em></p>
<p><em> (1) Restore the saved PCIEEP*_CFG044[MSIXEN,FUNM].</em></p>
<p><em> (2) Restore the saved NQM_VF()_VEC()_MSIX_ADDR's.</em></p>
<p><em> (3) Restore all other state of the function, enabling all SQ's and CQ's.</em></p>
<p><em> (4) Write the saved PBA value to NQM_VF()_MSIX_PBA[PEND].</em></p>
<p><em> See the comment in (9) above.</em></p>
<p><em> (5) After either the remote host is ready to receive MSIs from the function, or all saved NQM_VF()_VEC()_MSIX_CTL[MASK]'s are clear, or saved PCIEEP*_CFG044[MSIXEN] is clear, or saved PCIEEP*_CFG044[FUNM] is set:</em></p>
<p><em> Restore all NQM_VF()_VEC()_MSIX_CTL's. </em></p>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="a11c4fe018b33af7238136ebddba737cb"></a><!-- doxytag: member="cvmx_nqm_vfx_msix_pba::cn73xx" ref="a11c4fe018b33af7238136ebddba737cb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcvmx__nqm__vfx__msix__pba_1_1cvmx__nqm__vfx__msix__pba__s.html">cvmx_nqm_vfx_msix_pba_s</a> <a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#a11c4fe018b33af7238136ebddba737cb">cvmx_nqm_vfx_msix_pba::cn73xx</a><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae5e0611c78d4f007e674e324d016fa9d"></a><!-- doxytag: member="cvmx_nqm_vfx_msix_pba::s" ref="ae5e0611c78d4f007e674e324d016fa9d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcvmx__nqm__vfx__msix__pba_1_1cvmx__nqm__vfx__msix__pba__s.html">cvmx_nqm_vfx_msix_pba::cvmx_nqm_vfx_msix_pba_s</a>  <a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#ae5e0611c78d4f007e674e324d016fa9d">cvmx_nqm_vfx_msix_pba::s</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5c2ba4298df56b8df0ac0e6c4bccec02"></a><!-- doxytag: member="cvmx_nqm_vfx_msix_pba::u64" ref="a5c2ba4298df56b8df0ac0e6c4bccec02" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t <a class="el" href="unioncvmx__nqm__vfx__msix__pba.html#a5c2ba4298df56b8df0ac0e6c4bccec02">cvmx_nqm_vfx_msix_pba::u64</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this union was generated from the following file:<ul>
<li><a class="el" href="cvmx-nqm-defs_8h_source.html">cvmx-nqm-defs.h</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Oct 2017 for Octeon Software Development Kit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
